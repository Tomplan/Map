import{u as U,r as o,K as W,j as e,I as d,ax as Z,aX as ee,aY as re,az as ae,aA as te,M as se,aw as le,s as v}from"./index-ef143467.js";import{u as ne}from"./useCategories-dbe747a3.js";const oe=[{name:"mdiCarOutline",label:"Car"},{name:"mdiTent",label:"Tent"},{name:"mdiTrailer",label:"Trailer"},{name:"mdiCarCog",label:"Car Parts"},{name:"mdiAirplane",label:"Airplane"},{name:"mdiHomeCity",label:"Building"},{name:"mdiAccountGroup",label:"People"},{name:"mdiTerrainIcon",label:"Terrain"},{name:"mdiCellphone",label:"Phone"},{name:"mdiDotsHorizontal",label:"Other"}],ie=["#1976d2","#2e7d32","#f57c00","#d32f2f","#00796b","#5d4037","#303f9f","#689f38","#7b1fa2","#616161","#c62828","#00897b","#5e35b1","#455a64","#6d4c41","#d84315"];function pe(){const{t:a,i18n:L}=U(),{categories:m,loading:R,error:E,createCategory:H,updateCategory:M,categoryStats:w,deleteCategory:q,getCategoryStats:ce,refetch:T}=ne(L.language);o.useEffect(()=>{$(r=>{const s=JSON.stringify(r||{}),t=JSON.stringify(w||{});return s!==t?w||{}:r})},[w]);const{confirm:J,toastError:C,toastSuccess:P}=W(),[u,S]=o.useState([]),[p,b]=o.useState(null),[i,_]=o.useState(!1),[D,g]=o.useState(null),[B,x]=o.useState(!1),[h,O]=o.useState(null),[k,$]=o.useState({}),[l,n]=o.useState({slug:"",icon:"mdiDotsHorizontal",color:"#616161",sort_order:0,translations:{nl:{name:"",description:""},en:{name:"",description:""},de:{name:"",description:""}}});o.useEffect(()=>{i||S(r=>{const s=JSON.stringify(r||[]),t=JSON.stringify(m||[]);return s!==t?m||[]:r})},[m,i]);const F=(r,s,t)=>{b({category:s,index:t}),r.dataTransfer&&(r.dataTransfer.effectAllowed="move");try{r.currentTarget.style.opacity="0.4"}catch{}},V=r=>{try{r.currentTarget.style.opacity="1"}catch{}b(null),g(null)},z=(r,s)=>{r.preventDefault(),r.dataTransfer&&(r.dataTransfer.dropEffect="move"),g(s)},G=()=>g(null),A=async(r,s)=>{if(r.preventDefault(),!!p){if(p.index===s){b(null),g(null);return}_(!0);try{const t=[...u||[]],[f]=t.splice(p.index,1);t.splice(s,0,f),S(t);const I=t.map((c,N)=>({id:c.id,sort_order:N+1}));let j=null;if(v&&v.rpc){const{error:c}=await v.rpc("update_category_order",{updates:I});c&&(j=c)}if(j&&console.warn("RPC update_category_order failed, falling back to sequential updates",j),j)for(const c of I){const{error:N}=await v.from("categories").update({sort_order:c.sort_order}).eq("id",c.id);if(N)throw N}T&&await T(),P(a("helpPanel.categories.reorderSuccess")||a("common.saveSuccess"))}catch(t){console.error("Error reordering categories:",t),C(a("helpPanel.categories.reorderError",{error:t.message||t})),S(m||[])}finally{_(!1),b(null),g(null)}}},y=()=>{n({slug:"",icon:"mdiDotsHorizontal",color:"#616161",sort_order:m.length+1,translations:{nl:{name:"",description:""},en:{name:"",description:""},de:{name:"",description:""}}}),O(null)},K=()=>{y(),x(!0)},X=r=>{O(r);const s={nl:{},en:{},de:{}};Array.isArray(r.translations)&&r.translations.forEach(t=>{s[t.language]&&(s[t.language]={name:t.name||"",description:t.description||""})}),["nl","en","de"].forEach(t=>{s[t].name||(s[t]={name:r.name||"",description:r.description||""})}),n({slug:r.slug,icon:r.iconName,color:r.color,sort_order:r.sort_order,translations:s}),x(!0)},Y=async(r,s)=>{if(!await J({title:a("helpPanel.categories.deleteCategory"),message:a("helpPanel.categories.confirmDelete",{name:s}),confirmText:a("common.delete"),variant:"danger"}))return;const f=await q(r);f.success?P(a("helpPanel.categories.deleteSuccess")):C(a("helpPanel.categories.deleteError",{error:f.error}))},Q=async r=>{r.preventDefault();const s={slug:l.slug,icon:l.icon,color:l.color,sort_order:l.sort_order,translations:l.translations};let t;h?t=await M(h.id,s,l.translations):t=await H(s),t.success?(x(!1),y(),P(a(h?"helpPanel.categories.updateSuccess":"helpPanel.categories.createSuccess"))):C(a("helpPanel.categories.saveError",{error:t.error}))};return R?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:a("common.loading")})}):E?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-red-800",children:[a("common.error"),": ",E]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:a("helpPanel.categories.title")}),e.jsx("p",{className:"text-gray-600 mt-1",children:a("helpPanel.categories.description")}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:a("helpPanel.categories.dragToReorder")||"Drag to reorder categories"})]}),e.jsxs("button",{onClick:K,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(d,{path:Z,size:.8}),a("helpPanel.categories.createNew")]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("helpPanel.categories.order")}),e.jsx("th",{className:"px-3 py-3 w-12"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("helpPanel.categories.category")}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("helpPanel.categories.slug")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("helpPanel.categories.exhibitors")}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("common.actions")})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[u.map((r,s)=>e.jsxs("tr",{className:`hover:bg-gray-50 ${D===s?"border-t-2 border-blue-400":""}`,draggable:!i,"data-testid":`category-row-${s}`,onDragStart:t=>F(t,r,s),onDragEnd:t=>V(t),onDragOver:t=>z(t,s),onDragLeave:G,onDrop:t=>A(t,s),role:"option","aria-grabbed":(p==null?void 0:p.index)===s?"true":"false","aria-dropeffect":D!==null?"move":"none",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(d,{path:ee,size:.8,className:"cursor-move"}),e.jsx("span",{className:"font-medium",children:r.sort_order})]})}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap w-12",children:e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:r.color},children:e.jsx(d,{path:r.icon,size:.7,className:"text-white"})})}),e.jsxs("td",{className:"px-3 py-4 whitespace-nowrap text-left",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:r.name}),r.description&&e.jsx("div",{className:"text-xs text-gray-500 truncate",children:r.description})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("code",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded font-mono",children:r.slug})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{path:re,size:.7,className:"text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:k[r.id]||0})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>X(r),className:"text-blue-600 hover:text-blue-900 mr-3",disabled:i,title:i?a("helpPanel.categories.reordering"):"",children:e.jsx(d,{path:ae,size:.8})}),e.jsx("button",{onClick:()=>Y(r.id,r.name),className:"text-red-600 hover:text-red-900",disabled:i||k[r.id]>0,title:i?a("helpPanel.categories.reordering"):k[r.id]>0?a("helpPanel.categories.cannotDelete"):"",children:e.jsx(d,{path:te,size:.8})})]})]},r.id)),e.jsx("tr",{className:`h-6 ${D===(u||[]).length?"bg-blue-50":""}`,onDragOver:r=>z(r,(u||[]).length),onDrop:r=>A(r,(u||[]).length),children:e.jsx("td",{colSpan:6,className:"p-0"})},"drop-end")]})]}),m.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:a("helpPanel.categories.noCategories")})]}),e.jsx(se,{isOpen:B,onClose:()=>{x(!1),y()},title:a(h?"helpPanel.categories.editCategory":"helpPanel.categories.createCategory"),size:"lg",children:e.jsxs("form",{onSubmit:Q,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[a("helpPanel.categories.slug")," *"]}),e.jsx("input",{type:"text",required:!0,value:l.slug,onChange:r=>n({...l,slug:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"vehicles-dealers"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:a("helpPanel.categories.slugHelp")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("helpPanel.categories.icon")}),e.jsx("select",{value:l.icon,onChange:r=>n({...l,icon:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:oe.map(r=>e.jsx("option",{value:r.name,children:r.label},r.name))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("helpPanel.categories.color")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:l.color,onChange:r=>n({...l,color:r.target.value}),className:"w-16 h-10 border border-gray-300 rounded cursor-pointer"}),e.jsx("input",{type:"text",value:l.color,onChange:r=>n({...l,color:r.target.value}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"#1976d2"})]}),e.jsx("div",{className:"flex gap-1 mt-2",children:ie.map(r=>e.jsx("button",{type:"button",onClick:()=>n({...l,color:r}),className:"w-6 h-6 rounded border-2 border-gray-200 hover:border-gray-400",style:{backgroundColor:r},title:r},r))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("helpPanel.categories.sortOrder")}),e.jsx("input",{type:"number",value:l.sort_order,onChange:r=>n({...l,sort_order:parseInt(r.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:a("helpPanel.categories.translations")}),["nl","en","de"].map(r=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsx("h5",{className:"font-medium text-gray-700 uppercase",children:r}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[a("helpPanel.categories.name")," (",r,") *"]}),e.jsx("input",{type:"text",required:!0,value:l.translations[r].name,onChange:s=>n({...l,translations:{...l.translations,[r]:{...l.translations[r],name:s.target.value}}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[a("helpPanel.categories.description")," (",r,")"]}),e.jsx("textarea",{value:l.translations[r].description,onChange:s=>n({...l,translations:{...l.translations,[r]:{...l.translations[r],description:s.target.value}}}),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]},r))]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{x(!1),y()},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:a("common.cancel")}),e.jsxs("button",{type:"submit",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(d,{path:le,size:.8}),a(h?"common.save":"common.create")]})]})]})})]})}export{pe as default};
