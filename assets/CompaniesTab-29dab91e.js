import{r as p,s as H,j as e,I as D,aw as pe,d as ge,K as me,u as J,m as xe,ax as ue,M as he,g as be,b as fe,c as ye,ay as k,az as je,aA as Ce,a1 as Ne,aB as we,aC as ve,aD as Se}from"./index-07c61819.js";import{u as Ee}from"./useCompanies-7852d30b.js";import{u as Le}from"./useOrganizationProfile-80dc06ad.js";import{u as Te}from"./useCategories-c6258c26.js";import{L as ze}from"./LogoUploader-06ade7c8.js";import{E as Ie,I as Pe,P as ke,g as De,f as $e}from"./ImportButton-3f19aff8.js";import"./phone-376c158e.js";import"./dataExportImport-7f2c2e0e.js";function Fe({createCompany:s,updateCompany:o,deleteCompany:i,updateProfile:h,organizationLogo:l,confirm:y,toastError:g}){const[c,j]=p.useState(null),[v,S]=p.useState({}),[T,d]=p.useState(!1),[m,b]=p.useState({name:"",logo:l||"",website:"",info:""});return{editingId:c,editForm:v,setEditForm:S,isCreating:T,newCompanyForm:m,setNewCompanyForm:b,handleEdit:C=>{j(C.id),S({...C})},handleSave:async()=>{const C=c;if(C==="organization"){const{name:_,logo:W,website:N,info:B,contact:O,phone:U,email:$}=v;await h({name:_,logo:W,website:N,info:B,contact:O,phone:U,email:$})}else await o(C,v);j(null),S({})},handleCancel:()=>{j(null),S({})},handleDelete:async(C,_)=>{if(!await y({title:"Delete Company",message:`Are you sure you want to delete "${_}"? This will also delete all assignments for this company.`,confirmText:"Delete",variant:"danger"}))return;const{error:N}=await i(C);N&&g(`Error deleting company: ${N}`)},handleCreate:async()=>{if(!m.name.trim()){g("Company name is required");return}const{error:C}=await s(m);C?g(`Error creating company: ${C}`):(d(!1),b({name:"",logo:l,website:"",info:""}))},handleStartCreate:()=>{d(!0),b({name:"",logo:l,website:"",info:""})},handleCancelCreate:()=>{d(!1),b({name:"",logo:l,website:"",info:""})}}}function te(s){const[o,i]=p.useState({}),[h,l]=p.useState(!1),[y,g]=p.useState(null),c=p.useCallback(async()=>{if(!s){i({});return}try{l(!0),g(null);const{data:d,error:m}=await H.from("company_translations").select("language_code, info").eq("company_id",s);if(m)throw m;const b={};(d||[]).forEach(z=>{b[z.language_code]=z.info}),i(b)}catch(d){console.error("Error loading translations:",d),g(d.message)}finally{l(!1)}},[s]),j=async(d,m)=>{if(s)try{g(null);const{error:b}=await H.from("company_translations").upsert({company_id:s,language_code:d,info:m,updated_at:new Date().toISOString()},{onConflict:"company_id,language_code"});if(b)throw b;return i(z=>({...z,[d]:m})),!0}catch(b){return console.error("Error saving translation:",b),g(b.message),!1}},v=async d=>{if(s)try{g(null);const{error:m}=await H.from("company_translations").delete().eq("company_id",s).eq("language_code",d);if(m)throw m;return i(b=>{const z={...b};return delete z[d],z}),!0}catch(m){return console.error("Error deleting translation:",m),g(m.message),!1}},S=(d,m="nl")=>o[d]||o[m]||"",T=()=>Object.keys(o);return p.useEffect(()=>{c()},[c]),{translations:o,loading:h,error:y,saveTranslation:j,deleteTranslation:v,getTranslation:S,getAvailableLanguages:T,reload:c}}const Ae=[{code:"nl",label:"Nederlands",flag:"ðŸ‡³ðŸ‡±"},{code:"en",label:"English",flag:"ðŸ‡¬ðŸ‡§"},{code:"de",label:"Deutsch",flag:"ðŸ‡©ðŸ‡ª"}];function _e({currentLanguage:s,onLanguageChange:o,translations:i={},className:h=""}){return e.jsx("div",{className:`flex items-center gap-1 ${h}`,children:Ae.map(l=>{const y=s===l.code,g=i[l.code]&&i[l.code].trim()!=="";return e.jsxs("button",{type:"button",onClick:()=>o(l.code),className:`px-2 py-1 rounded text-xs font-medium transition flex items-center gap-1 ${y?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("span",{children:l.flag}),e.jsx("span",{children:l.label}),g&&!y&&e.jsx(D,{path:pe,size:.5,className:"text-green-600"})]},l.code)})})}function Oe({translations:s={}}){const o=Object.keys(s).filter(i=>s[i]&&s[i].trim()!=="").length;return o<=1?null:e.jsx("span",{className:"inline-block ml-1 text-blue-600",title:`Available in ${o} languages`,children:"ðŸŒ"})}const ae={en:we,nl:ve,de:Se};function t(s,o){var i,h,l;try{if(k&&k.exists(s))return k.t(s,o);const y=((i=k)==null?void 0:i.language)||"nl",g=s.split(".");let c=ae[y]||ae.nl;for(const j of g){if(!c||typeof c!="object"){c=void 0;break}c=c[j]}return c!==void 0?typeof c=="string"?c:JSON.stringify(c):(h=k)!=null&&h.t?k.t(s,o):s}catch{return(l=k)!=null&&l.t?k.t(s,o):s}}function Me({companyId:s,editingLanguage:o,onLanguageChange:i}){const{translations:h,saveTranslation:l}=te(s),{t:y}=J(),[g,c]=p.useState(""),[j,v]=p.useState(!1);p.useEffect(()=>{c(h[o]||"")},[o,h]);const S=async()=>{if(g!==(h[o]||"")){v(!0);try{await l(o,g)}catch(T){console.error("Failed to save translation:",T)}finally{v(!1)}}};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(_e,{currentLanguage:o,onLanguageChange:i,translations:h,className:"mb-2"}),e.jsx("textarea",{value:g,onChange:T=>c(T.target.value),onBlur:S,className:"w-full bg-white text-gray-900 border rounded px-2 py-1",rows:4,placeholder:t("companies.modal.enterInfoInLanguage",{lang:y(o==="nl"?"languages.dutch":"languages.english")}),disabled:j}),j&&e.jsx("span",{className:"text-xs text-gray-500 italic",children:t("companies.saving")})]})}function We({companyId:s,currentLanguage:o}){const{translations:i,getTranslation:h}=te(s);J();const l=h(o,"nl");return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("p",{className:"line-clamp-3 whitespace-pre-wrap flex-1",children:l||e.jsx("span",{className:"text-gray-400 text-sm italic",children:t("companies.notSet")})}),e.jsx(Oe,{translations:i})]})}function Ke(){const{companies:s,loading:o,error:i,createCompany:h,updateCompany:l,deleteCompany:y,searchCompanies:g,reload:c}=Ee(),{profile:j,loading:v,error:S,updateProfile:T}=Le(),{organizationLogo:d}=ge(),{confirm:m,toastError:b}=me(),{i18n:z,t:F}=J(),{categories:R,getCompanyCategories:V,getAllCompanyCategories:K,assignCategoriesToCompany:Q}=Te(),[A,C]=p.useState(""),[_,W]=p.useState("nl"),[N,B]=p.useState("public"),[O,U]=p.useState({}),[$,M]=p.useState([]),{editingId:f,editForm:u,setEditForm:I,isCreating:r,newCompanyForm:x,setNewCompanyForm:E,handleEdit:se,handleSave:ne,handleCancel:oe,handleDelete:re,handleCreate:le,handleStartCreate:ie,handleCancelCreate:X}=Fe({createCompany:h,updateCompany:l,deleteCompany:y,updateProfile:T,organizationLogo:d,confirm:m,toastError:b});p.useEffect(()=>{(async()=>{if(f&&f!=="organization"){const w=(await V(f)).map(L=>L.id);M(w)}else f||M([])})()},[f]),p.useEffect(()=>{const a=async()=>{if(s.length>0){const n=s.map(L=>L.id),w=await K(n);U(w)}};N==="public"&&s.length>0&&a()},[N,s.length,s]);const ce=async()=>{if(await ne(),f&&f!=="organization"){const a=await Q(f,$);if(!a.success)console.error("Failed to assign categories:",a.error),alert("Failed to save categories: "+a.error);else{const n=await V(f);U(w=>({...w,[f]:n}))}}M([])},Y=()=>{oe(),M([])},G=p.useMemo(()=>{const a=[];if(j&&a.push({...j,id:"organization",isOrganization:!0}),a.push(...s),!A)return a;const n=A.toLowerCase();return a.filter(w=>{var L;return(L=w.name)==null?void 0:L.toLowerCase().includes(n)})},[j,s,A]),de=o||v,Z=i||S;return de?e.jsx("div",{className:"p-4",children:t("companies.loadingData")}):Z?e.jsx("div",{className:"p-4 text-red-600",children:t("companies.errorWithMessage",{message:Z})}):e.jsxs("div",{className:"h-full flex flex-col p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{path:xe,size:1,className:"text-gray-500"}),e.jsx("input",{type:"text",placeholder:t("companies.searchPlaceholder"),value:A,onChange:a=>C(a.target.value),className:"px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[G.length," of ",s.length+1]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ie,{dataType:"companies",data:s,filename:`companies-${new Date().toISOString().split("T")[0]}`,additionalData:{supabase:H}}),e.jsx(Pe,{dataType:"companies",existingData:s,onImportComplete:async()=>{await c()}}),e.jsxs("button",{onClick:ie,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(D,{path:ue,size:.8}),t("companies.addCompany")]})]})]}),e.jsxs("div",{className:"flex gap-2 mb-4 border-b flex-shrink-0",children:[e.jsx("button",{onClick:()=>B("public"),className:`px-4 py-2 font-medium transition-colors ${N==="public"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:F("companies.publicInfoTab")}),e.jsx("button",{onClick:()=>B("manager"),className:`px-4 py-2 font-medium transition-colors ${N==="manager"?"text-green-600 border-b-2 border-green-600":"text-gray-600 hover:text-gray-900"}`,children:F("companies.privateInfoTab")})]}),e.jsx(he,{isOpen:r||!!f,onClose:r?X:Y,title:r?t("companies.newCompany"):t("companies.modal.editTitle",{name:u.name||t("companies.newCompany")}),size:"lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3 text-blue-800",children:t("companies.modal.publicInfoHeading","Public Info (visible to attendees)")}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",placeholder:t("companies.companyNamePlaceholder"),value:r?x.name:u.name,onChange:a=>r?E({...x,name:a.target.value}):I({...u,name:a.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-900",children:t("companies.companyLogo")}),e.jsx(ze,{currentLogo:r?x.logo:u.logo,onUploadComplete:(a,n)=>{r?E({...x,logo:a}):I({...u,logo:a})},folder:f==="organization"?"organization":"companies",label:t("companies.modal.uploadLogo"),showPreview:!0,allowDelete:!0,onDelete:()=>{r?E({...x,logo:d}):I({...u,logo:d})}}),e.jsx("input",{type:"text",placeholder:t("companies.logoUrlPlaceholder"),value:r?x.logo:u.logo||"",onChange:a=>r?E({...x,logo:a.target.value}):I({...u,logo:a.target.value}),className:"w-full px-3 py-2 border rounded mt-2 text-sm bg-white text-gray-900"})]}),e.jsx("input",{type:"text",placeholder:t("companies.websiteUrlPlaceholder"),value:r?x.website:u.website||"",onChange:a=>r?E({...x,website:a.target.value}):I({...u,website:a.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900"}),f==="organization"?e.jsx("textarea",{placeholder:t("companies.infoPlaceholder"),value:r?x.info:u.info||"",onChange:a=>r?E({...x,info:a.target.value}):I({...u,info:a.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900",rows:3}):r?e.jsx("textarea",{placeholder:t("companies.infoPlaceholder"),value:x.info,onChange:a=>E({...x,info:a.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900",rows:3}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-900",children:t("companies.modal.infoMultiLanguageLabel")}),e.jsx(Me,{companyId:f,editingLanguage:_,onLanguageChange:W})]}),!r&&f!=="organization"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-900",children:t("companies.modal.categoriesLabel")}),R.length>0?e.jsx("div",{className:"flex flex-col gap-1.5",children:R.map(a=>e.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer px-2.5 py-1.5 rounded text-sm",style:{backgroundColor:$.includes(a.id)?a.color+"30":a.color+"15",color:a.color,border:`1px solid ${a.color}40`},children:[e.jsx("input",{type:"checkbox",checked:$.includes(a.id),onChange:n=>{const w=n.target.checked?[...$,a.id]:$.filter(L=>L!==a.id);M(w)},className:"cursor-pointer"}),a.icon&&e.jsx(D,{path:a.icon,size:.6}),a.name]},a.id))}):e.jsx("span",{className:"text-red-500 text-sm italic",children:t("companies.noCategoriesAvailable")})]})]})]}),e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3 text-green-800",children:t("companies.modal.managerInfoHeading","Manager-only Info (default contact info)")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",placeholder:t("companies.contactPlaceholder"),value:r?x.contact||"":u.contact||"",onChange:a=>r?E({...x,contact:a.target.value}):I({...u,contact:a.target.value}),className:"px-3 py-2 border rounded bg-white text-gray-900"}),e.jsx(ke,{value:r?x.phone||"":u.phone||"",onChange:a=>r?E({...x,phone:a}):I({...u,phone:a}),placeholder:t("companies.phonePlaceholder")}),e.jsx("input",{type:"email",placeholder:t("companies.emailPlaceholder"),value:r?x.email||"":u.email||"",onChange:a=>{const n=a.target.value.toLowerCase();r?E({...x,email:n}):I({...u,email:n})},className:"px-3 py-2 border rounded bg-white text-gray-900"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 justify-end",children:[e.jsx("button",{onClick:r?X:Y,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:F("cancel")}),e.jsx("button",{onClick:r?le:ce,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:F(r?"companies.create":"save")})]})]})}),e.jsxs("div",{className:"flex-1 overflow-auto border rounded-lg",children:[e.jsxs("table",{className:"w-full rounded",style:{tableLayout:"fixed",fontSize:"11px"},children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[N==="public"?e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:t("companies.table.name")}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:t("companies.table.logo")}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:t("companies.table.website")}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:t("companies.table.info")}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:t("companies.table.categories")})]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:t("companies.table.name")}),e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:t("companies.table.contact")}),e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:t("companies.table.phone")}),e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:t("companies.table.email")})]}),e.jsx("th",{className:"p-2 bg-gray-100 border-b font-semibold text-gray-900",style:{minWidth:"90px",width:"90px",maxWidth:"120px"},children:t("companies.table.actions")})]})}),e.jsx("tbody",{children:G.map(a=>{const n=a.isOrganization,w=n?"bg-gray-700 text-white":"bg-white text-gray-900 hover:bg-gray-50",L=N==="public"?"bg-blue-50":"bg-green-50";return e.jsxs("tr",{className:`${w} border-b`,children:[e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":L}`,children:e.jsx("span",{className:"font-semibold",children:a.name})}),N==="public"?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-blue-50"}`,children:e.jsx("img",{...(()=>{const P=be(),ee=n?P:a.logo&&a.logo.trim()!==""?a.logo:P,q=fe(ee);return q?{src:q.src,srcSet:q.srcSet,sizes:q.sizes}:{src:ye(ee)}})(),alt:a.name,className:"h-8 object-contain"})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-blue-50"}`,children:a.website?e.jsx("a",{href:a.website.startsWith("http")?a.website:`https://${a.website}`,target:"_blank",rel:"noopener noreferrer",className:n?"text-blue-300 hover:underline":"text-blue-600 hover:underline",children:a.website.replace(/^https?:\/\//,"").substring(0,30)}):e.jsx("span",{className:"text-gray-400 text-sm italic",children:t("companies.notSet")})}),e.jsx("td",{className:`py-2 px-3 border-b text-left max-w-xs ${n?"":"bg-blue-50"}`,children:n?e.jsx("p",{className:"line-clamp-3 whitespace-pre-wrap",children:a.info||e.jsx("span",{className:"text-gray-400 text-sm italic",children:t("companies.notSet")})}):e.jsx(We,{companyId:a.id,currentLanguage:f===a.id?k.language:"nl"})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-blue-50"}`,children:n?e.jsx("span",{className:"text-gray-400 text-xs italic",children:t("companies.notApplicable")}):e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(O[a.id]||[]).map(P=>e.jsxs("span",{className:"text-xs px-1.5 py-0.5 rounded inline-flex items-center gap-1",style:{backgroundColor:P.color+"20",color:P.color},children:[P.icon&&e.jsx(D,{path:P.icon,size:.5}),P.name]},P.id)),(!O[a.id]||O[a.id].length===0)&&e.jsx("span",{className:"text-gray-400 text-xs italic",children:t("companies.none")})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-green-50"}`,children:e.jsx("span",{className:"text-xs",children:a.contact||e.jsx("span",{className:"text-gray-400 italic",children:t("companies.notSet")})})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-green-50"}`,children:a.phone?e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx("span",{children:De(a.phone)}),e.jsx("span",{children:$e(a.phone)})]}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:t("companies.notSet")})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-green-50"}`,children:e.jsx("span",{className:"text-xs",children:a.email||e.jsx("span",{className:"text-gray-400 italic",children:t("companies.notSet")})})})]}),e.jsx("td",{className:"py-2 px-3 border-b text-left",children:e.jsxs("div",{className:"flex gap-1 justify-center",children:[e.jsx("button",{onClick:()=>se(a),className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700",title:t("companies.edit"),children:e.jsx(D,{path:je,size:.8})}),!n&&e.jsx("button",{onClick:()=>re(a.id,a.name),className:"p-1.5 bg-red-600 text-white rounded hover:bg-red-700",title:t("companies.delete"),children:e.jsx(D,{path:Ce,size:.8})}),n&&e.jsx("div",{className:"flex items-center justify-center pt-1 text-gray-300",children:e.jsx(D,{path:Ne,size:.8})})]})})]},a.id)})})]}),G.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:t(A?"companies.noResults":"companies.noCompanies")})]})]})}export{Ke as default};
