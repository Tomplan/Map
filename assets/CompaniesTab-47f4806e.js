import{r as i,s as H,j as e,I as k,aw as me,d as xe,K as ue,u as J,m as he,ax as be,M as fe,g as ye,b as je,c as Ce,ay as D,az as Ne,aA as we,a1 as ve,aB as Se,aC as Ee,aD as Le}from"./index-d4e44bf1.js";import{u as Te}from"./useCompanies-90d86461.js";import{u as ze}from"./useOrganizationProfile-293deeaf.js";import{u as Ie}from"./useCategories-ff878cbb.js";import{L as Pe}from"./LogoUploader-ce13ddc9.js";import{E as $e,I as De,P as ke,g as Fe,f as Ae}from"./ImportButton-8789321e.js";import"./phone-376c158e.js";import"./dataExportImport-2c941890.js";function _e({createCompany:s,updateCompany:o,deleteCompany:c,updateProfile:h,organizationLogo:l,confirm:y,toastError:g}){const[d,j]=i.useState(null),[w,v]=i.useState({}),[L,p]=i.useState(!1),[m,b]=i.useState({name:"",logo:l||"",website:"",info:""});return{editingId:d,editForm:w,setEditForm:v,isCreating:L,newCompanyForm:m,setNewCompanyForm:b,handleEdit:C=>{j(C.id),v({...C})},handleSave:async()=>{const C=d;if(C==="organization"){const{name:z,logo:B,website:A,info:V,contact:I,phone:U,email:M}=w;await h({name:z,logo:B,website:A,info:V,contact:I,phone:U,email:M})}else await o(C,w);j(null),v({})},handleCancel:()=>{j(null),v({})},handleDelete:async(C,z)=>{if(!await y({title:"Delete Company",message:`Are you sure you want to delete "${z}"? This will also delete all assignments for this company.`,confirmText:"Delete",variant:"danger"}))return;const{error:A}=await c(C);A&&g(`Error deleting company: ${A}`)},handleCreate:async()=>{if(!m.name.trim()){g("Company name is required");return}const{error:C}=await s(m);C?g(`Error creating company: ${C}`):(p(!1),b({name:"",logo:l,website:"",info:""}))},handleStartCreate:()=>{p(!0),b({name:"",logo:l,website:"",info:""})},handleCancelCreate:()=>{p(!1),b({name:"",logo:l,website:"",info:""})}}}function ne(s){const[o,c]=i.useState({}),[h,l]=i.useState(!1),[y,g]=i.useState(null),d=i.useCallback(async()=>{if(!s){c({});return}try{l(!0),g(null);const{data:p,error:m}=await H.from("company_translations").select("language_code, info").eq("company_id",s);if(m)throw m;const b={};(p||[]).forEach(T=>{b[T.language_code]=T.info}),c(b)}catch(p){console.error("Error loading translations:",p),g(p.message)}finally{l(!1)}},[s]),j=async(p,m)=>{if(s)try{g(null);const{error:b}=await H.from("company_translations").upsert({company_id:s,language_code:p,info:m,updated_at:new Date().toISOString()},{onConflict:"company_id,language_code"});if(b)throw b;return c(T=>({...T,[p]:m})),!0}catch(b){return console.error("Error saving translation:",b),g(b.message),!1}},w=async p=>{if(s)try{g(null);const{error:m}=await H.from("company_translations").delete().eq("company_id",s).eq("language_code",p);if(m)throw m;return c(b=>{const T={...b};return delete T[p],T}),!0}catch(m){return console.error("Error deleting translation:",m),g(m.message),!1}},v=(p,m="nl")=>o[p]||o[m]||"",L=()=>Object.keys(o);return i.useEffect(()=>{d()},[d]),{translations:o,loading:h,error:y,saveTranslation:j,deleteTranslation:w,getTranslation:v,getAvailableLanguages:L,reload:d}}const Me=[{code:"nl",label:"Nederlands",flag:"ðŸ‡³ðŸ‡±"},{code:"en",label:"English",flag:"ðŸ‡¬ðŸ‡§"},{code:"de",label:"Deutsch",flag:"ðŸ‡©ðŸ‡ª"}];function Oe({currentLanguage:s,onLanguageChange:o,translations:c={},className:h=""}){return e.jsx("div",{className:`flex items-center gap-1 ${h}`,children:Me.map(l=>{const y=s===l.code,g=c[l.code]&&c[l.code].trim()!=="";return e.jsxs("button",{type:"button",onClick:()=>o(l.code),className:`px-2 py-1 rounded text-xs font-medium transition flex items-center gap-1 ${y?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("span",{children:l.flag}),e.jsx("span",{children:l.label}),g&&!y&&e.jsx(k,{path:me,size:.5,className:"text-green-600"})]},l.code)})})}function We({translations:s={}}){const o=Object.keys(s).filter(c=>s[c]&&s[c].trim()!=="").length;return o<=1?null:e.jsx("span",{className:"inline-block ml-1 text-blue-600",title:`Available in ${o} languages`,children:"ðŸŒ"})}const se={en:Se,nl:Ee,de:Le};function t(s,o){var c,h,l;try{if(D&&D.exists(s))return D.t(s,o);const y=((c=D)==null?void 0:c.language)||"nl",g=s.split(".");let d=se[y]||se.nl;for(const j of g){if(!d||typeof d!="object"){d=void 0;break}d=d[j]}return d!==void 0?typeof d=="string"?d:JSON.stringify(d):(h=D)!=null&&h.t?D.t(s,o):s}catch{return(l=D)!=null&&l.t?D.t(s,o):s}}function Be({companyId:s,editingLanguage:o,onLanguageChange:c}){const{translations:h,saveTranslation:l}=ne(s),{t:y}=J(),[g,d]=i.useState(""),[j,w]=i.useState(!1);i.useEffect(()=>{d(h[o]||"")},[o,h]);const v=async()=>{if(g!==(h[o]||"")){w(!0);try{await l(o,g)}catch(L){console.error("Failed to save translation:",L)}finally{w(!1)}}};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(Oe,{currentLanguage:o,onLanguageChange:c,translations:h,className:"mb-2"}),e.jsx("textarea",{value:g,onChange:L=>d(L.target.value),onBlur:v,className:"w-full bg-white text-gray-900 border rounded px-2 py-1",rows:4,placeholder:t("companies.modal.enterInfoInLanguage",{lang:y(o==="nl"?"languages.dutch":"languages.english")}),disabled:j}),j&&e.jsx("span",{className:"text-xs text-gray-500 italic",children:t("companies.saving")})]})}function Ue({companyId:s,currentLanguage:o}){const{translations:c,getTranslation:h}=ne(s);J();const l=h(o,"nl");return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("p",{className:"line-clamp-3 whitespace-pre-wrap flex-1",children:l||e.jsx("span",{className:"text-gray-400 text-sm italic",children:t("companies.notSet")})}),e.jsx(We,{translations:c})]})}function Xe(){const{companies:s,loading:o,error:c,createCompany:h,updateCompany:l,deleteCompany:y,searchCompanies:g,reload:d}=Te(),{profile:j,loading:w,error:v,updateProfile:L}=ze(),{organizationLogo:p}=xe(),{confirm:m,toastError:b}=ue(),{i18n:T,t:F}=J(),{categories:_,getCompanyCategories:K,getAllCompanyCategories:Q,assignCategoriesToCompany:X}=Ie(),R=i.useMemo(()=>(_||[]).map(a=>`${a.id}:${a.name||""}`).join("|"),[_]),C=i.useMemo(()=>(s||[]).map(a=>`${a.id}`).join(","),[s]),[z,B]=i.useState(""),[A,V]=i.useState("nl"),[I,U]=i.useState("public"),[M,Y]=i.useState({}),[O,W]=i.useState([]),{editingId:f,editForm:u,setEditForm:P,isCreating:r,newCompanyForm:x,setNewCompanyForm:S,handleEdit:oe,handleSave:re,handleCancel:le,handleDelete:ie,handleCreate:ce,handleStartCreate:de,handleCancelCreate:Z}=_e({createCompany:h,updateCompany:l,deleteCompany:y,updateProfile:L,organizationLogo:p,confirm:m,toastError:b});i.useEffect(()=>{(async()=>{if(f&&f!=="organization"){const N=(await K(f)).map(E=>E.id);W(N)}else f||W([])})()},[f,R]),i.useEffect(()=>{const a=async()=>{if(s.length>0){const n=s.map(E=>E.id),N=await Q(n);Y(N)}};I==="public"&&s.length>0&&a()},[I,s.length,C,R]);const pe=async()=>{if(await re(),f&&f!=="organization"){const a=await X(f,O);if(!a.success)console.error("Failed to assign categories:",a.error),alert("Failed to save categories: "+a.error);else{const n=await K(f);Y(N=>({...N,[f]:n}))}}W([])},ee=()=>{le(),W([])},G=i.useMemo(()=>{const a=[];if(j&&a.push({...j,id:"organization",isOrganization:!0}),a.push(...s),!z)return a;const n=z.toLowerCase();return a.filter(N=>{var E;return(E=N.name)==null?void 0:E.toLowerCase().includes(n)})},[j,s,z]),ge=o||w,ae=c||v;return ge?e.jsx("div",{className:"p-4",children:t("companies.loadingData")}):ae?e.jsx("div",{className:"p-4 text-red-600",children:t("companies.errorWithMessage",{message:ae})}):e.jsxs("div",{className:"h-full flex flex-col p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{path:he,size:1,className:"text-gray-500"}),e.jsx("input",{type:"text",placeholder:t("companies.searchPlaceholder"),value:z,onChange:a=>B(a.target.value),className:"px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[G.length," of ",s.length+1]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($e,{dataType:"companies",data:s,filename:`companies-${new Date().toISOString().split("T")[0]}`,additionalData:{supabase:H}}),e.jsx(De,{dataType:"companies",existingData:s,onImportComplete:async()=>{await d()}}),e.jsxs("button",{onClick:de,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(k,{path:be,size:.8}),t("companies.addCompany")]})]})]}),e.jsxs("div",{className:"flex gap-2 mb-4 border-b flex-shrink-0",children:[e.jsx("button",{onClick:()=>U("public"),className:`px-4 py-2 font-medium transition-colors ${I==="public"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:F("companies.publicInfoTab")}),e.jsx("button",{onClick:()=>U("manager"),className:`px-4 py-2 font-medium transition-colors ${I==="manager"?"text-green-600 border-b-2 border-green-600":"text-gray-600 hover:text-gray-900"}`,children:F("companies.privateInfoTab")})]}),e.jsx(fe,{isOpen:r||!!f,onClose:r?Z:ee,title:r?t("companies.newCompany"):t("companies.modal.editTitle",{name:u.name||t("companies.newCompany")}),size:"lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3 text-blue-800",children:t("companies.modal.publicInfoHeading","Public Info (visible to attendees)")}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",placeholder:t("companies.companyNamePlaceholder"),value:r?x.name:u.name,onChange:a=>r?S({...x,name:a.target.value}):P({...u,name:a.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-900",children:t("companies.companyLogo")}),e.jsx(Pe,{currentLogo:r?x.logo:u.logo,onUploadComplete:(a,n)=>{r?S({...x,logo:a}):P({...u,logo:a})},folder:f==="organization"?"organization":"companies",label:t("companies.modal.uploadLogo"),showPreview:!0,allowDelete:!0,onDelete:()=>{r?S({...x,logo:p}):P({...u,logo:p})}}),e.jsx("input",{type:"text",placeholder:t("companies.logoUrlPlaceholder"),value:r?x.logo:u.logo||"",onChange:a=>r?S({...x,logo:a.target.value}):P({...u,logo:a.target.value}),className:"w-full px-3 py-2 border rounded mt-2 text-sm bg-white text-gray-900"})]}),e.jsx("input",{type:"text",placeholder:t("companies.websiteUrlPlaceholder"),value:r?x.website:u.website||"",onChange:a=>r?S({...x,website:a.target.value}):P({...u,website:a.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900"}),f==="organization"?e.jsx("textarea",{placeholder:t("companies.infoPlaceholder"),value:r?x.info:u.info||"",onChange:a=>r?S({...x,info:a.target.value}):P({...u,info:a.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900",rows:3}):r?e.jsx("textarea",{placeholder:t("companies.infoPlaceholder"),value:x.info,onChange:a=>S({...x,info:a.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900",rows:3}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-900",children:t("companies.modal.infoMultiLanguageLabel")}),e.jsx(Be,{companyId:f,editingLanguage:A,onLanguageChange:V})]}),!r&&f!=="organization"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-900",children:t("companies.modal.categoriesLabel")}),_.length>0?e.jsx("div",{className:"flex flex-col gap-1.5",children:_.map(a=>e.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer px-2.5 py-1.5 rounded text-sm",style:{backgroundColor:O.includes(a.id)?a.color+"30":a.color+"15",color:a.color,border:`1px solid ${a.color}40`},children:[e.jsx("input",{type:"checkbox",checked:O.includes(a.id),onChange:n=>{const N=n.target.checked?[...O,a.id]:O.filter(E=>E!==a.id);W(N)},className:"cursor-pointer"}),a.icon&&e.jsx(k,{path:a.icon,size:.6}),a.name]},a.id))}):e.jsx("span",{className:"text-red-500 text-sm italic",children:t("companies.noCategoriesAvailable")})]})]})]}),e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3 text-green-800",children:t("companies.modal.managerInfoHeading","Manager-only Info (default contact info)")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",placeholder:t("companies.contactPlaceholder"),value:r?x.contact||"":u.contact||"",onChange:a=>r?S({...x,contact:a.target.value}):P({...u,contact:a.target.value}),className:"px-3 py-2 border rounded bg-white text-gray-900"}),e.jsx(ke,{value:r?x.phone||"":u.phone||"",onChange:a=>r?S({...x,phone:a}):P({...u,phone:a}),placeholder:t("companies.phonePlaceholder")}),e.jsx("input",{type:"email",placeholder:t("companies.emailPlaceholder"),value:r?x.email||"":u.email||"",onChange:a=>{const n=a.target.value.toLowerCase();r?S({...x,email:n}):P({...u,email:n})},className:"px-3 py-2 border rounded bg-white text-gray-900"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 justify-end",children:[e.jsx("button",{onClick:r?Z:ee,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:F("cancel")}),e.jsx("button",{onClick:r?ce:pe,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:F(r?"companies.create":"save")})]})]})}),e.jsxs("div",{className:"flex-1 overflow-auto border rounded-lg",children:[e.jsxs("table",{className:"w-full rounded",style:{tableLayout:"fixed",fontSize:"11px"},children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[I==="public"?e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:t("companies.table.name")}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:t("companies.table.logo")}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:t("companies.table.website")}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:t("companies.table.info")}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:t("companies.table.categories")})]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:t("companies.table.name")}),e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:t("companies.table.contact")}),e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:t("companies.table.phone")}),e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:t("companies.table.email")})]}),e.jsx("th",{className:"p-2 bg-gray-100 border-b font-semibold text-gray-900",style:{minWidth:"90px",width:"90px",maxWidth:"120px"},children:t("companies.table.actions")})]})}),e.jsx("tbody",{children:G.map(a=>{const n=a.isOrganization,N=n?"bg-gray-700 text-white":"bg-white text-gray-900 hover:bg-gray-50",E=I==="public"?"bg-blue-50":"bg-green-50";return e.jsxs("tr",{className:`${N} border-b`,children:[e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":E}`,children:e.jsx("span",{className:"font-semibold",children:a.name})}),I==="public"?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-blue-50"}`,children:e.jsx("img",{...(()=>{const $=ye(),te=n?$:a.logo&&a.logo.trim()!==""?a.logo:$,q=je(te);return q?{src:q.src,srcSet:q.srcSet,sizes:q.sizes}:{src:Ce(te)}})(),alt:a.name,className:"h-8 object-contain"})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-blue-50"}`,children:a.website?e.jsx("a",{href:a.website.startsWith("http")?a.website:`https://${a.website}`,target:"_blank",rel:"noopener noreferrer",className:n?"text-blue-300 hover:underline":"text-blue-600 hover:underline",children:a.website.replace(/^https?:\/\//,"").substring(0,30)}):e.jsx("span",{className:"text-gray-400 text-sm italic",children:t("companies.notSet")})}),e.jsx("td",{className:`py-2 px-3 border-b text-left max-w-xs ${n?"":"bg-blue-50"}`,children:n?e.jsx("p",{className:"line-clamp-3 whitespace-pre-wrap",children:a.info||e.jsx("span",{className:"text-gray-400 text-sm italic",children:t("companies.notSet")})}):e.jsx(Ue,{companyId:a.id,currentLanguage:f===a.id?D.language:"nl"})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-blue-50"}`,children:n?e.jsx("span",{className:"text-gray-400 text-xs italic",children:t("companies.notApplicable")}):e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(M[a.id]||[]).map($=>e.jsxs("span",{className:"text-xs px-1.5 py-0.5 rounded inline-flex items-center gap-1",style:{backgroundColor:$.color+"20",color:$.color},children:[$.icon&&e.jsx(k,{path:$.icon,size:.5}),$.name]},$.id)),(!M[a.id]||M[a.id].length===0)&&e.jsx("span",{className:"text-gray-400 text-xs italic",children:t("companies.none")})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-green-50"}`,children:e.jsx("span",{className:"text-xs",children:a.contact||e.jsx("span",{className:"text-gray-400 italic",children:t("companies.notSet")})})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-green-50"}`,children:a.phone?e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx("span",{children:Fe(a.phone)}),e.jsx("span",{children:Ae(a.phone)})]}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:t("companies.notSet")})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-green-50"}`,children:e.jsx("span",{className:"text-xs",children:a.email||e.jsx("span",{className:"text-gray-400 italic",children:t("companies.notSet")})})})]}),e.jsx("td",{className:"py-2 px-3 border-b text-left",children:e.jsxs("div",{className:"flex gap-1 justify-center",children:[e.jsx("button",{onClick:()=>oe(a),className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700",title:t("companies.edit"),children:e.jsx(k,{path:Ne,size:.8})}),!n&&e.jsx("button",{onClick:()=>ie(a.id,a.name),className:"p-1.5 bg-red-600 text-white rounded hover:bg-red-700",title:t("companies.delete"),children:e.jsx(k,{path:we,size:.8})}),n&&e.jsx("div",{className:"flex items-center justify-center pt-1 text-gray-300",children:e.jsx(k,{path:ve,size:.8})})]})})]},a.id)})})]}),G.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:t(z?"companies.noResults":"companies.noCompanies")})]})]})}export{Xe as default};
