import{r as l,s as L,j as e,I,am as le,b as ie,a3 as ce,u as de,m as ge,an as xe,M as pe,g as me,c as he,ao as ue,ap as be,Q as fe}from"./index-f3aaddb5.js";import{u as ye}from"./useCompanies-e99a91be.js";import{n as je}from"./phone-376c158e.js";import{u as Ne}from"./useCategories-8e231f0a.js";import{a as Ce}from"./getDefaultLogo-7dd9d292.js";import{L as we}from"./LogoUploader-27d60181.js";import{E as ve,I as Pe,P as Ee,g as Se,f as ze}from"./ImportButton-02296983.js";import"./exceljs.min-df4f794b.js";function Te(){const[s,r]=l.useState(null),[d,u]=l.useState(!0),[i,y]=l.useState(null),x=l.useCallback(async()=>{try{u(!0);const{data:a,error:c}=await L.from("organization_profile").select("*").single();if(c)if(c.code==="PGRST116")console.warn("No organization profile found. A default one should be created by the migration."),r(null);else throw c;r(a),y(null)}catch(a){console.error("Error fetching organization profile:",a),y(a.message)}finally{u(!1)}},[]);return l.useEffect(()=>{x();const a=L.channel("public:organization_profile").on("postgres_changes",{event:"*",schema:"public",table:"organization_profile",filter:"id=eq.1"},c=>{c.new&&r(c.new)}).subscribe();return()=>{L.removeChannel(a)}},[x]),{profile:s,loading:d,error:i,updateProfile:async a=>{try{(a!=null&&a.phone||(a==null?void 0:a.phone)==="")&&(a.phone=je(a.phone)),a!=null&&a.email&&(a.email=a.email.toLowerCase().trim());const{data:c,error:j}=await L.from("organization_profile").update(a).eq("id",1).select().single();if(j)throw j;return r(c),{data:c,error:null}}catch(c){return console.error("Error updating organization profile:",c),{data:null,error:c.message}}}}}function ke({createCompany:s,updateCompany:r,deleteCompany:d,updateProfile:u,organizationLogo:i,confirm:y,toastError:x}){const[C,a]=l.useState(null),[c,j]=l.useState({}),[_,g]=l.useState(!1),[p,b]=l.useState({name:"",logo:i||"",website:"",info:""});return{editingId:C,editForm:c,setEditForm:j,isCreating:_,newCompanyForm:p,setNewCompanyForm:b,handleEdit:w=>{a(w.id),j({...w})},handleSave:async()=>{const w=C;if(w==="organization"){const{name:F,logo:M,website:v,info:W,contact:A,phone:q,email:$}=c;await u({name:F,logo:M,website:v,info:W,contact:A,phone:q,email:$})}else await r(w,c);a(null),j({})},handleCancel:()=>{a(null),j({})},handleDelete:async(w,F)=>{if(!await y({title:"Delete Company",message:`Are you sure you want to delete "${F}"? This will also delete all assignments for this company.`,confirmText:"Delete",variant:"danger"}))return;const{error:v}=await d(w);v&&x(`Error deleting company: ${v}`)},handleCreate:async()=>{if(!p.name.trim()){x("Company name is required");return}const{error:w}=await s(p);w?x(`Error creating company: ${w}`):(g(!1),b({name:"",logo:i,website:"",info:""}))},handleStartCreate:()=>{g(!0),b({name:"",logo:i,website:"",info:""})},handleCancelCreate:()=>{g(!1),b({name:"",logo:i,website:"",info:""})}}}function Y(s){const[r,d]=l.useState({}),[u,i]=l.useState(!1),[y,x]=l.useState(null),C=l.useCallback(async()=>{if(!s){d({});return}try{i(!0),x(null);const{data:g,error:p}=await L.from("company_translations").select("language_code, info").eq("company_id",s);if(p)throw p;const b={};(g||[]).forEach(E=>{b[E.language_code]=E.info}),d(b)}catch(g){console.error("Error loading translations:",g),x(g.message)}finally{i(!1)}},[s]),a=async(g,p)=>{if(s)try{x(null);const{error:b}=await L.from("company_translations").upsert({company_id:s,language_code:g,info:p,updated_at:new Date().toISOString()},{onConflict:"company_id,language_code"});if(b)throw b;return d(E=>({...E,[g]:p})),!0}catch(b){return console.error("Error saving translation:",b),x(b.message),!1}},c=async g=>{if(s)try{x(null);const{error:p}=await L.from("company_translations").delete().eq("company_id",s).eq("language_code",g);if(p)throw p;return d(b=>{const E={...b};return delete E[g],E}),!0}catch(p){return console.error("Error deleting translation:",p),x(p.message),!1}},j=(g,p="nl")=>r[g]||r[p]||"",_=()=>Object.keys(r);return l.useEffect(()=>{C()},[C]),{translations:r,loading:u,error:y,saveTranslation:a,deleteTranslation:c,getTranslation:j,getAvailableLanguages:_,reload:C}}const Ie=[{code:"nl",label:"Nederlands",flag:"ðŸ‡³ðŸ‡±"},{code:"en",label:"English",flag:"ðŸ‡¬ðŸ‡§"},{code:"de",label:"Deutsch",flag:"ðŸ‡©ðŸ‡ª"}];function Le({currentLanguage:s,onLanguageChange:r,translations:d={},className:u=""}){return e.jsx("div",{className:`flex items-center gap-1 ${u}`,children:Ie.map(i=>{const y=s===i.code,x=d[i.code]&&d[i.code].trim()!=="";return e.jsxs("button",{type:"button",onClick:()=>r(i.code),className:`px-2 py-1 rounded text-xs font-medium transition flex items-center gap-1 ${y?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("span",{children:i.flag}),e.jsx("span",{children:i.label}),x&&!y&&e.jsx(I,{path:le,size:.5,className:"text-green-600"})]},i.code)})})}function $e({translations:s={}}){const r=Object.keys(s).filter(d=>s[d]&&s[d].trim()!=="").length;return r<=1?null:e.jsx("span",{className:"inline-block ml-1 text-blue-600",title:`Available in ${r} languages`,children:"ðŸŒ"})}function De({companyId:s,editingLanguage:r,onLanguageChange:d}){const{translations:u,saveTranslation:i}=Y(s),[y,x]=l.useState(""),[C,a]=l.useState(!1);l.useEffect(()=>{x(u[r]||"")},[r,u]);const c=async()=>{if(y!==(u[r]||"")){a(!0);try{await i(r,y)}catch(j){console.error("Failed to save translation:",j)}finally{a(!1)}}};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(Le,{currentLanguage:r,onLanguageChange:d,translations:u,className:"mb-2"}),e.jsx("textarea",{value:y,onChange:j=>x(j.target.value),onBlur:c,className:"w-full bg-white text-gray-900 border rounded px-2 py-1",rows:4,placeholder:`Enter info in ${r==="nl"?"Dutch":"English"}...`,disabled:C}),C&&e.jsx("span",{className:"text-xs text-gray-500 italic",children:"Saving..."})]})}function _e({companyId:s,currentLanguage:r}){const{translations:d,getTranslation:u}=Y(s),i=u(r,"nl");return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("p",{className:"line-clamp-3 whitespace-pre-wrap flex-1",children:i||e.jsx("span",{className:"text-gray-400 text-sm italic",children:"Not set"})}),e.jsx($e,{translations:d})]})}function Re(){const{companies:s,loading:r,error:d,createCompany:u,updateCompany:i,deleteCompany:y,searchCompanies:x,reload:C}=ye(),{profile:a,loading:c,error:j,updateProfile:_}=Te(),{organizationLogo:g}=ie(),{confirm:p,toastError:b}=ce(),{i18n:E,t:N}=de(),{categories:B,getCompanyCategories:R,getAllCompanyCategories:V,assignCategoriesToCompany:Q}=Ne(),[D,w]=l.useState(""),[F,M]=l.useState("nl"),[v,W]=l.useState("public"),[A,q]=l.useState({}),[$,O]=l.useState([]),{editingId:f,editForm:h,setEditForm:T,isCreating:o,newCompanyForm:m,setNewCompanyForm:S,handleEdit:Z,handleSave:ee,handleCancel:te,handleDelete:ae,handleCreate:se,handleStartCreate:ne,handleCancelCreate:H}=ke({createCompany:u,updateCompany:i,deleteCompany:y,updateProfile:_,organizationLogo:g,confirm:p,toastError:b});l.useEffect(()=>{(async()=>{if(f&&f!=="organization"){const P=(await R(f)).map(z=>z.id);O(P)}else f||O([])})()},[f]),l.useEffect(()=>{const t=async()=>{if(s.length>0){const n=s.map(z=>z.id),P=await V(n);q(P)}};v==="public"&&s.length>0&&t()},[v,s.length,s]);const re=async()=>{if(await ee(),f&&f!=="organization"){const t=await Q(f,$);if(!t.success)console.error("Failed to assign categories:",t.error),alert("Failed to save categories: "+t.error);else{const n=await R(f);q(P=>({...P,[f]:n}))}}O([])},J=()=>{te(),O([])},G=l.useMemo(()=>{const t=[];if(a&&t.push({...a,id:"organization",isOrganization:!0}),t.push(...s),!D)return t;const n=D.toLowerCase();return t.filter(P=>{var z;return(z=P.name)==null?void 0:z.toLowerCase().includes(n)})},[a,s,D]),oe=r||c,K=d||j;return oe?e.jsx("div",{className:"p-4",children:"Loading data..."}):K?e.jsxs("div",{className:"p-4 text-red-600",children:["Error: ",K]}):e.jsxs("div",{className:"h-full flex flex-col p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{path:ge,size:1,className:"text-gray-500"}),e.jsx("input",{type:"text",placeholder:N("helpPanel.companies.searchPlaceholder"),value:D,onChange:t=>w(t.target.value),className:"px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[G.length," of ",s.length+1]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ve,{dataType:"companies",data:s,filename:`companies-${new Date().toISOString().split("T")[0]}`,additionalData:{supabase:L}}),e.jsx(Pe,{dataType:"companies",existingData:s,onImportComplete:async()=>{await C()}}),e.jsxs("button",{onClick:ne,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(I,{path:xe,size:.8}),N("helpPanel.companies.addCompany")]})]})]}),e.jsxs("div",{className:"flex gap-2 mb-4 border-b flex-shrink-0",children:[e.jsx("button",{onClick:()=>W("public"),className:`px-4 py-2 font-medium transition-colors ${v==="public"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:N("helpPanel.companies.publicInfoTab","Public Info")}),e.jsx("button",{onClick:()=>W("manager"),className:`px-4 py-2 font-medium transition-colors ${v==="manager"?"text-green-600 border-b-2 border-green-600":"text-gray-600 hover:text-gray-900"}`,children:N("helpPanel.companies.privateInfoTab","Private Info")})]}),e.jsx(pe,{isOpen:o||!!f,onClose:o?H:J,title:o?N("helpPanel.companies.newCompany"):`Edit: ${h.name||"Company"}`,size:"lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3 text-blue-800",children:"Public Info (visible to attendees)"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",placeholder:N("helpPanel.companies.companyNamePlaceholder"),value:o?m.name:h.name,onChange:t=>o?S({...m,name:t.target.value}):T({...h,name:t.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-900",children:N("helpPanel.companies.companyLogo")}),e.jsx(we,{currentLogo:o?m.logo:h.logo,onUploadComplete:(t,n)=>{o?S({...m,logo:t}):T({...h,logo:t})},folder:f==="organization"?"organization":"companies",label:"Upload Logo",showPreview:!0,allowDelete:!0,onDelete:()=>{o?S({...m,logo:g}):T({...h,logo:g})}}),e.jsx("input",{type:"text",placeholder:N("helpPanel.companies.logoUrlPlaceholder"),value:o?m.logo:h.logo||"",onChange:t=>o?S({...m,logo:t.target.value}):T({...h,logo:t.target.value}),className:"w-full px-3 py-2 border rounded mt-2 text-sm bg-white text-gray-900"})]}),e.jsx("input",{type:"text",placeholder:"Website URL",value:o?m.website:h.website||"",onChange:t=>o?S({...m,website:t.target.value}):T({...h,website:t.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900"}),f==="organization"?e.jsx("textarea",{placeholder:N("helpPanel.companies.infoPlaceholder"),value:o?m.info:h.info||"",onChange:t=>o?S({...m,info:t.target.value}):T({...h,info:t.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900",rows:3}):o?e.jsx("textarea",{placeholder:N("helpPanel.companies.infoPlaceholder"),value:m.info,onChange:t=>S({...m,info:t.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900",rows:3}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-900",children:"Info (Multi-language)"}),e.jsx(De,{companyId:f,editingLanguage:F,onLanguageChange:M})]}),!o&&f!=="organization"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-900",children:"Categories"}),B.length>0?e.jsx("div",{className:"flex flex-col gap-1.5",children:B.map(t=>e.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer px-2.5 py-1.5 rounded text-sm",style:{backgroundColor:$.includes(t.id)?t.color+"30":t.color+"15",color:t.color,border:`1px solid ${t.color}40`},children:[e.jsx("input",{type:"checkbox",checked:$.includes(t.id),onChange:n=>{const P=n.target.checked?[...$,t.id]:$.filter(z=>z!==t.id);O(P)},className:"cursor-pointer"}),t.icon&&e.jsx(I,{path:t.icon,size:.6}),t.name]},t.id))}):e.jsx("span",{className:"text-red-500 text-sm italic",children:"No categories available"})]})]})]}),e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3 text-green-800",children:"Manager-Only Info (default contact info)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",placeholder:"Contact Person",value:o?m.contact||"":h.contact||"",onChange:t=>o?S({...m,contact:t.target.value}):T({...h,contact:t.target.value}),className:"px-3 py-2 border rounded bg-white text-gray-900"}),e.jsx(Ee,{value:o?m.phone||"":h.phone||"",onChange:t=>o?S({...m,phone:t}):T({...h,phone:t}),placeholder:"Phone (e.g., +31612345678)"}),e.jsx("input",{type:"email",placeholder:"Email",value:o?m.email||"":h.email||"",onChange:t=>{const n=t.target.value.toLowerCase();o?S({...m,email:n}):T({...h,email:n})},className:"px-3 py-2 border rounded bg-white text-gray-900"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 justify-end",children:[e.jsx("button",{onClick:o?H:J,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:o?se:re,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:o?"Create":"Save"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-auto border rounded-lg",children:[e.jsxs("table",{className:"w-full rounded",style:{tableLayout:"fixed",fontSize:"11px"},children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[v==="public"?e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:"Name"}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:"Logo"}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:"Website"}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:"Info"}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:"Categories"})]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:"Name"}),e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:"Contact"}),e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:"Phone"}),e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:"Email"})]}),e.jsx("th",{className:"p-2 bg-gray-100 border-b font-semibold text-gray-900",style:{minWidth:"90px",width:"90px",maxWidth:"120px"},children:"Actions"})]})}),e.jsx("tbody",{children:G.map(t=>{const n=t.isOrganization,P=n?"bg-gray-700 text-white":"bg-white text-gray-900 hover:bg-gray-50",z=v==="public"?"bg-blue-50":"bg-green-50";return e.jsxs("tr",{className:`${P} border-b`,children:[e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":z}`,children:e.jsx("span",{className:"font-semibold",children:t.name})}),v==="public"?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-blue-50"}`,children:e.jsx("img",{...(()=>{const k=Ce(),X=n?k:t.logo&&t.logo.trim()!==""?t.logo:k,U=me(X);return U?{src:U.src,srcSet:U.srcSet,sizes:U.sizes}:{src:he(X)}})(),alt:t.name,className:"h-8 object-contain"})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-blue-50"}`,children:t.website?e.jsx("a",{href:t.website.startsWith("http")?t.website:`https://${t.website}`,target:"_blank",rel:"noopener noreferrer",className:n?"text-blue-300 hover:underline":"text-blue-600 hover:underline",children:t.website.replace(/^https?:\/\//,"").substring(0,30)}):e.jsx("span",{className:"text-gray-400 text-sm italic",children:"Not set"})}),e.jsx("td",{className:`py-2 px-3 border-b text-left max-w-xs ${n?"":"bg-blue-50"}`,children:n?e.jsx("p",{className:"line-clamp-3 whitespace-pre-wrap",children:t.info||e.jsx("span",{className:"text-gray-400 text-sm italic",children:"Not set"})}):e.jsx(_e,{companyId:t.id,currentLanguage:f===t.id?E.language:"nl"})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-blue-50"}`,children:n?e.jsx("span",{className:"text-gray-400 text-xs italic",children:"N/A"}):e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(A[t.id]||[]).map(k=>e.jsxs("span",{className:"text-xs px-1.5 py-0.5 rounded inline-flex items-center gap-1",style:{backgroundColor:k.color+"20",color:k.color},children:[k.icon&&e.jsx(I,{path:k.icon,size:.5}),k.name]},k.id)),(!A[t.id]||A[t.id].length===0)&&e.jsx("span",{className:"text-gray-400 text-xs italic",children:"None"})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-green-50"}`,children:e.jsx("span",{className:"text-xs",children:t.contact||e.jsx("span",{className:"text-gray-400 italic",children:"Not set"})})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-green-50"}`,children:t.phone?e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx("span",{children:Se(t.phone)}),e.jsx("span",{children:ze(t.phone)})]}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"Not set"})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${n?"":"bg-green-50"}`,children:e.jsx("span",{className:"text-xs",children:t.email||e.jsx("span",{className:"text-gray-400 italic",children:"Not set"})})})]}),e.jsx("td",{className:"py-2 px-3 border-b text-left",children:e.jsxs("div",{className:"flex gap-1 justify-center",children:[e.jsx("button",{onClick:()=>Z(t),className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700",title:"Edit",children:e.jsx(I,{path:ue,size:.8})}),!n&&e.jsx("button",{onClick:()=>ae(t.id,t.name),className:"p-1.5 bg-red-600 text-white rounded hover:bg-red-700",title:"Delete",children:e.jsx(I,{path:be,size:.8})}),n&&e.jsx("div",{className:"flex items-center justify-center pt-1 text-gray-300",children:e.jsx(I,{path:fe,size:.8})})]})})]},t.id)})})]}),G.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:N(D?"helpPanel.companies.noResults":"helpPanel.companies.noCompanies")})]})]})}export{Re as default};
