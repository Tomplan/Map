import{r as s,s as F,R as e,I as L,aj as re,b as le,a1 as oe,u as se,m as ce,ak as ie,M as me,g as ge,al as de,am as pe,N as ue}from"./index-1e4c7e6c.js";import{u as be}from"./useCompanies-49571dae.js";import{n as fe}from"./phone-376c158e.js";import{u as he}from"./useCategories-30773e88.js";import{L as xe}from"./LogoUploader-aa5b1e88.js";import{P as ye,g as Ee,f as Ne}from"./PhoneInput-847f9104.js";function Ce(){const[n,r]=s.useState(null),[g,h]=s.useState(!0),[c,E]=s.useState(null),d=s.useCallback(async()=>{try{h(!0);const{data:a,error:i}=await F.from("organization_profile").select("*").single();if(i)if(i.code==="PGRST116")console.warn("No organization profile found. A default one should be created by the migration."),r(null);else throw i;r(a),E(null)}catch(a){console.error("Error fetching organization profile:",a),E(a.message)}finally{h(!1)}},[]);return s.useEffect(()=>{d();const a=F.channel("public:organization_profile").on("postgres_changes",{event:"*",schema:"public",table:"organization_profile",filter:"id=eq.1"},i=>{i.new&&r(i.new)}).subscribe();return()=>{F.removeChannel(a)}},[d]),{profile:n,loading:g,error:c,updateProfile:async a=>{try{(a!=null&&a.phone||(a==null?void 0:a.phone)==="")&&(a.phone=fe(a.phone)),a!=null&&a.email&&(a.email=a.email.toLowerCase().trim());const{data:i,error:N}=await F.from("organization_profile").update(a).eq("id",1).select().single();if(N)throw N;return r(i),{data:i,error:null}}catch(i){return console.error("Error updating organization profile:",i),{data:null,error:i.message}}}}}function we({createCompany:n,updateCompany:r,deleteCompany:g,updateProfile:h,organizationLogo:c,confirm:E,toastError:d}){const[C,a]=s.useState(null),[i,N]=s.useState({}),[T,b]=s.useState(!1),[p,x]=s.useState({name:"",logo:c||"",website:"",info:""});return{editingId:C,editForm:i,setEditForm:N,isCreating:T,newCompanyForm:p,setNewCompanyForm:x,handleEdit:w=>{a(w.id),N({...w})},handleSave:async()=>{const w=C;if(w==="organization"){const{name:O,logo:P,website:I,info:M,contact:j,phone:$,email:_}=i;await h({name:O,logo:P,website:I,info:M,contact:j,phone:$,email:_})}else await r(w,i);a(null),N({})},handleCancel:()=>{a(null),N({})},handleDelete:async(w,O)=>{if(!await E({title:"Delete Company",message:`Are you sure you want to delete "${O}"? This will also delete all assignments for this company.`,confirmText:"Delete",variant:"danger"}))return;const{error:I}=await g(w);I&&d(`Error deleting company: ${I}`)},handleCreate:async()=>{if(!p.name.trim()){d("Company name is required");return}const{error:w}=await n(p);w?d(`Error creating company: ${w}`):(b(!1),x({name:"",logo:c,website:"",info:""}))},handleStartCreate:()=>{b(!0),x({name:"",logo:c,website:"",info:""})},handleCancelCreate:()=>{b(!1),x({name:"",logo:c,website:"",info:""})}}}function K(n){const[r,g]=s.useState({}),[h,c]=s.useState(!1),[E,d]=s.useState(null),C=s.useCallback(async()=>{if(!n){g({});return}try{c(!0),d(null);const{data:b,error:p}=await F.from("company_translations").select("language_code, info").eq("company_id",n);if(p)throw p;const x={};(b||[]).forEach(m=>{x[m.language_code]=m.info}),g(x)}catch(b){console.error("Error loading translations:",b),d(b.message)}finally{c(!1)}},[n]),a=async(b,p)=>{if(n)try{d(null);const{error:x}=await F.from("company_translations").upsert({company_id:n,language_code:b,info:p,updated_at:new Date().toISOString()},{onConflict:"company_id,language_code"});if(x)throw x;return g(m=>({...m,[b]:p})),!0}catch(x){return console.error("Error saving translation:",x),d(x.message),!1}},i=async b=>{if(n)try{d(null);const{error:p}=await F.from("company_translations").delete().eq("company_id",n).eq("language_code",b);if(p)throw p;return g(x=>{const m={...x};return delete m[b],m}),!0}catch(p){return console.error("Error deleting translation:",p),d(p.message),!1}},N=(b,p="nl")=>r[b]||r[p]||"",T=()=>Object.keys(r);return s.useEffect(()=>{C()},[C]),{translations:r,loading:h,error:E,saveTranslation:a,deleteTranslation:i,getTranslation:N,getAvailableLanguages:T,reload:C}}const ve=[{code:"nl",label:"Nederlands",flag:"ðŸ‡³ðŸ‡±"},{code:"en",label:"English",flag:"ðŸ‡¬ðŸ‡§"},{code:"de",label:"Deutsch",flag:"ðŸ‡©ðŸ‡ª"}];function Pe({currentLanguage:n,onLanguageChange:r,translations:g={},className:h=""}){return e.createElement("div",{className:`flex items-center gap-1 ${h}`},ve.map(c=>{const E=n===c.code,d=g[c.code]&&g[c.code].trim()!=="";return e.createElement("button",{key:c.code,type:"button",onClick:()=>r(c.code),className:`px-2 py-1 rounded text-xs font-medium transition flex items-center gap-1 ${E?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`},e.createElement("span",null,c.flag),e.createElement("span",null,c.label),d&&!E&&e.createElement(L,{path:re,size:.5,className:"text-green-600"}))}))}function Se({translations:n={}}){const r=Object.keys(n).filter(g=>n[g]&&n[g].trim()!=="").length;return r<=1?null:e.createElement("span",{className:"inline-block ml-1 text-blue-600",title:`Available in ${r} languages`},"ðŸŒ")}function ke({companyId:n,editingLanguage:r,onLanguageChange:g}){const{translations:h,saveTranslation:c}=K(n),[E,d]=s.useState(""),[C,a]=s.useState(!1);s.useEffect(()=>{d(h[r]||"")},[r,h]);const i=async()=>{if(E!==(h[r]||"")){a(!0);try{await c(r,E)}catch(N){console.error("Failed to save translation:",N)}finally{a(!1)}}};return e.createElement("div",{className:"space-y-2"},e.createElement(Pe,{currentLanguage:r,onLanguageChange:g,translations:h,className:"mb-2"}),e.createElement("textarea",{value:E,onChange:N=>d(N.target.value),onBlur:i,className:"w-full bg-white text-gray-900 border rounded px-2 py-1",rows:4,placeholder:`Enter info in ${r==="nl"?"Dutch":"English"}...`,disabled:C}),C&&e.createElement("span",{className:"text-xs text-gray-500 italic"},"Saving..."))}function ze({companyId:n,currentLanguage:r}){const{translations:g,getTranslation:h}=K(n),c=h(r,"nl");return e.createElement("div",{className:"flex items-start gap-2"},e.createElement("p",{className:"line-clamp-3 whitespace-pre-wrap flex-1"},c||e.createElement("span",{className:"text-gray-400 text-sm italic"},"Not set")),e.createElement(Se,{translations:g}))}function De(){const{companies:n,loading:r,error:g,createCompany:h,updateCompany:c,deleteCompany:E,searchCompanies:d}=be(),{profile:C,loading:a,error:i,updateProfile:N}=Ce(),{organizationLogo:T}=le(),{confirm:b,toastError:p}=oe(),{i18n:x,t:m}=se(),{categories:W,getCompanyCategories:q,getAllCompanyCategories:R,assignCategoriesToCompany:B}=he(),[D,G]=s.useState(""),[w,O]=s.useState("nl"),[P,I]=s.useState("public"),[M,j]=s.useState({}),[$,_]=s.useState([]),{editingId:y,editForm:f,setEditForm:z,isCreating:o,newCompanyForm:u,setNewCompanyForm:S,handleEdit:Q,handleSave:X,handleCancel:Y,handleDelete:Z,handleCreate:ee,handleStartCreate:te,handleCancelCreate:V}=we({createCompany:h,updateCompany:c,deleteCompany:E,updateProfile:N,organizationLogo:T,confirm:b,toastError:p});s.useEffect(()=>{(async()=>{if(y&&y!=="organization"){const v=(await q(y)).map(k=>k.id);_(v)}else y||_([])})()},[y]),s.useEffect(()=>{const t=async()=>{if(n.length>0){const l=n.map(k=>k.id),v=await R(l);j(v)}};P==="public"&&n.length>0&&t()},[P,n.length]);const ae=async()=>{if(await X(),y&&y!=="organization"){const t=await B(y,$);if(!t.success)console.error("Failed to assign categories:",t.error),alert("Failed to save categories: "+t.error);else{const l=await q(y);j(v=>({...v,[y]:l}))}}_([])},H=()=>{Y(),_([])},U=s.useMemo(()=>{const t=[];if(C&&t.push({...C,id:"organization",isOrganization:!0}),t.push(...n),!D)return t;const l=D.toLowerCase();return t.filter(v=>{var k;return(k=v.name)==null?void 0:k.toLowerCase().includes(l)})},[C,n,D]),ne=r||a,J=g||i;return ne?e.createElement("div",{className:"p-4"},"Loading data..."):J?e.createElement("div",{className:"p-4 text-red-600"},"Error: ",J):e.createElement("div",{className:"h-full flex flex-col p-4"},e.createElement("div",{className:"flex items-center justify-between mb-4 flex-shrink-0"},e.createElement("div",{className:"flex items-center gap-2"},e.createElement(L,{path:ce,size:1,className:"text-gray-500"}),e.createElement("input",{type:"text",placeholder:m("helpPanel.companies.searchPlaceholder"),value:D,onChange:t=>G(t.target.value),className:"px-3 py-2 border rounded-lg"}),e.createElement("span",{className:"text-sm text-gray-600"},U.length," of ",n.length+1)),e.createElement("button",{onClick:te,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},e.createElement(L,{path:ie,size:.8}),m("helpPanel.companies.addCompany"))),e.createElement("div",{className:"flex gap-2 mb-4 border-b flex-shrink-0"},e.createElement("button",{onClick:()=>I("public"),className:`px-4 py-2 font-medium transition-colors ${P==="public"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`},m("helpPanel.companies.publicInfoTab","Public Info")),e.createElement("button",{onClick:()=>I("manager"),className:`px-4 py-2 font-medium transition-colors ${P==="manager"?"text-green-600 border-b-2 border-green-600":"text-gray-600 hover:text-gray-900"}`},m("helpPanel.companies.privateInfoTab","Private Info"))),e.createElement(me,{isOpen:o||!!y,onClose:o?V:H,title:o?m("helpPanel.companies.newCompany"):`Edit: ${f.name||"Company"}`,size:"lg"},e.createElement("div",{className:"p-6"},e.createElement("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"},e.createElement("h4",{className:"font-semibold text-sm mb-3 text-blue-800"},"Public Info (visible to attendees)"),e.createElement("div",{className:"space-y-3"},e.createElement("input",{type:"text",placeholder:m("helpPanel.companies.companyNamePlaceholder"),value:o?u.name:f.name,onChange:t=>o?S({...u,name:t.target.value}):z({...f,name:t.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900"}),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium mb-1 text-gray-900"},m("helpPanel.companies.companyLogo")),e.createElement(xe,{currentLogo:o?u.logo:f.logo,onUploadComplete:(t,l)=>{o?S({...u,logo:t}):z({...f,logo:t})},folder:y==="organization"?"organization":"companies",label:"Upload Logo",showPreview:!0,allowDelete:!0,onDelete:()=>{o?S({...u,logo:T}):z({...f,logo:T})}}),e.createElement("input",{type:"text",placeholder:m("helpPanel.companies.logoUrlPlaceholder"),value:o?u.logo:f.logo||"",onChange:t=>o?S({...u,logo:t.target.value}):z({...f,logo:t.target.value}),className:"w-full px-3 py-2 border rounded mt-2 text-sm bg-white text-gray-900"})),e.createElement("input",{type:"text",placeholder:"Website URL",value:o?u.website:f.website||"",onChange:t=>o?S({...u,website:t.target.value}):z({...f,website:t.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900"}),y==="organization"?e.createElement("textarea",{placeholder:m("helpPanel.companies.infoPlaceholder"),value:o?u.info:f.info||"",onChange:t=>o?S({...u,info:t.target.value}):z({...f,info:t.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900",rows:3}):o?e.createElement("textarea",{placeholder:m("helpPanel.companies.infoPlaceholder"),value:u.info,onChange:t=>S({...u,info:t.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900",rows:3}):e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium mb-1 text-gray-900"},"Info (Multi-language)"),e.createElement(ke,{companyId:y,editingLanguage:w,onLanguageChange:O})),!o&&y!=="organization"&&e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium mb-2 text-gray-900"},"Categories"),W.length>0?e.createElement("div",{className:"flex flex-col gap-1.5"},W.map(t=>e.createElement("label",{key:t.id,className:"inline-flex items-center gap-2 cursor-pointer px-2.5 py-1.5 rounded text-sm",style:{backgroundColor:$.includes(t.id)?t.color+"30":t.color+"15",color:t.color,border:`1px solid ${t.color}40`}},e.createElement("input",{type:"checkbox",checked:$.includes(t.id),onChange:l=>{const v=l.target.checked?[...$,t.id]:$.filter(k=>k!==t.id);_(v)},className:"cursor-pointer"}),t.icon&&e.createElement(L,{path:t.icon,size:.6}),t.name))):e.createElement("span",{className:"text-red-500 text-sm italic"},"No categories available")))),e.createElement("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg"},e.createElement("h4",{className:"font-semibold text-sm mb-3 text-green-800"},"Manager-Only Info (default contact info)"),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3"},e.createElement("input",{type:"text",placeholder:"Contact Person",value:o?u.contact||"":f.contact||"",onChange:t=>o?S({...u,contact:t.target.value}):z({...f,contact:t.target.value}),className:"px-3 py-2 border rounded bg-white text-gray-900"}),e.createElement(ye,{value:o?u.phone||"":f.phone||"",onChange:t=>o?S({...u,phone:t}):z({...f,phone:t}),placeholder:"Phone (e.g., +31612345678)"}),e.createElement("input",{type:"email",placeholder:"Email",value:o?u.email||"":f.email||"",onChange:t=>{const l=t.target.value.toLowerCase();o?S({...u,email:l}):z({...f,email:l})},className:"px-3 py-2 border rounded bg-white text-gray-900"}))),e.createElement("div",{className:"flex gap-3 mt-6 justify-end"},e.createElement("button",{onClick:o?V:H,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"},"Cancel"),e.createElement("button",{onClick:o?ee:ae,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},o?"Create":"Save")))),e.createElement("div",{className:"flex-1 overflow-auto border rounded-lg"},e.createElement("table",{className:"w-full rounded",style:{tableLayout:"fixed",fontSize:"11px"}},e.createElement("thead",{className:"sticky top-0 z-10"},e.createElement("tr",null,P==="public"?e.createElement(e.Fragment,null,e.createElement("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900"},"Name"),e.createElement("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900"},"Logo"),e.createElement("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900"},"Website"),e.createElement("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900"},"Info"),e.createElement("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900"},"Categories")):e.createElement(e.Fragment,null,e.createElement("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900"},"Name"),e.createElement("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900"},"Contact"),e.createElement("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900"},"Phone"),e.createElement("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900"},"Email")),e.createElement("th",{className:"p-2 bg-gray-100 border-b font-semibold text-gray-900",style:{minWidth:"90px",width:"90px",maxWidth:"120px"}},"Actions"))),e.createElement("tbody",null,U.map(t=>{const l=t.isOrganization,v=l?"bg-gray-700 text-white":"bg-white text-gray-900 hover:bg-gray-50",k=P==="public"?"bg-blue-50":"bg-green-50";return e.createElement("tr",{key:t.id,className:`${v} border-b`},e.createElement("td",{className:`py-2 px-3 border-b text-left ${l?"":k}`},e.createElement("span",{className:"font-semibold"},t.name)),P==="public"?e.createElement(e.Fragment,null,e.createElement("td",{className:`py-2 px-3 border-b text-left ${l?"":"bg-blue-50"}`},e.createElement("img",{src:ge(t.logo&&t.logo.trim()!==""?t.logo:T),alt:t.name,className:"h-8 object-contain"})),e.createElement("td",{className:`py-2 px-3 border-b text-left ${l?"":"bg-blue-50"}`},t.website?e.createElement("a",{href:t.website.startsWith("http")?t.website:`https://${t.website}`,target:"_blank",rel:"noopener noreferrer",className:l?"text-blue-300 hover:underline":"text-blue-600 hover:underline"},t.website.replace(/^https?:\/\//,"").substring(0,30)):e.createElement("span",{className:"text-gray-400 text-sm italic"},"Not set")),e.createElement("td",{className:`py-2 px-3 border-b text-left max-w-xs ${l?"":"bg-blue-50"}`},l?e.createElement("p",{className:"line-clamp-3 whitespace-pre-wrap"},t.info||e.createElement("span",{className:"text-gray-400 text-sm italic"},"Not set")):e.createElement(ze,{companyId:t.id,currentLanguage:y===t.id?x.language:"nl"})),e.createElement("td",{className:`py-2 px-3 border-b text-left ${l?"":"bg-blue-50"}`},l?e.createElement("span",{className:"text-gray-400 text-xs italic"},"N/A"):e.createElement("div",{className:"flex flex-wrap gap-1"},(M[t.id]||[]).map(A=>e.createElement("span",{key:A.id,className:"text-xs px-1.5 py-0.5 rounded inline-flex items-center gap-1",style:{backgroundColor:A.color+"20",color:A.color}},A.icon&&e.createElement(L,{path:A.icon,size:.5}),A.name)),(!M[t.id]||M[t.id].length===0)&&e.createElement("span",{className:"text-gray-400 text-xs italic"},"None")))):e.createElement(e.Fragment,null,e.createElement("td",{className:`py-2 px-3 border-b text-left ${l?"":"bg-green-50"}`},e.createElement("span",{className:"text-xs"},t.contact||e.createElement("span",{className:"text-gray-400 italic"},"Not set"))),e.createElement("td",{className:`py-2 px-3 border-b text-left ${l?"":"bg-green-50"}`},t.phone?e.createElement("span",{className:"text-xs flex items-center gap-1"},e.createElement("span",null,Ee(t.phone)),e.createElement("span",null,Ne(t.phone))):e.createElement("span",{className:"text-gray-400 italic text-xs"},"Not set")),e.createElement("td",{className:`py-2 px-3 border-b text-left ${l?"":"bg-green-50"}`},e.createElement("span",{className:"text-xs"},t.email||e.createElement("span",{className:"text-gray-400 italic"},"Not set")))),e.createElement("td",{className:"py-2 px-3 border-b text-left"},e.createElement("div",{className:"flex gap-1 justify-center"},e.createElement("button",{onClick:()=>Q(t),className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700",title:"Edit"},e.createElement(L,{path:de,size:.8})),!l&&e.createElement("button",{onClick:()=>Z(t.id,t.name),className:"p-1.5 bg-red-600 text-white rounded hover:bg-red-700",title:"Delete"},e.createElement(L,{path:pe,size:.8})),l&&e.createElement("div",{className:"flex items-center justify-center pt-1 text-gray-300"},e.createElement(L,{path:ue,size:.8})))))}))),U.length===0&&e.createElement("div",{className:"text-center py-8 text-gray-500"},m(D?"helpPanel.companies.noResults":"helpPanel.companies.noCompanies"))))}export{De as default};
