import{r as o,s as _,j as e,I as T,ak as ne,b as re,a2 as le,u as oe,m as ie,al as ce,M as de,g as ge,am as xe,an as he,O as pe}from"./index-8fb29835.js";import{u as me}from"./useCompanies-f1922231.js";import{n as ue}from"./phone-376c158e.js";import{u as be}from"./useCategories-278a1a88.js";import{L as fe}from"./LogoUploader-2913cbb8.js";import{P as ye,g as je,f as Ne}from"./PhoneInput-bf048d47.js";function Ce(){const[s,n]=o.useState(null),[g,b]=o.useState(!0),[i,j]=o.useState(null),x=o.useCallback(async()=>{try{b(!0);const{data:a,error:c}=await _.from("organization_profile").select("*").single();if(c)if(c.code==="PGRST116")console.warn("No organization profile found. A default one should be created by the migration."),n(null);else throw c;n(a),j(null)}catch(a){console.error("Error fetching organization profile:",a),j(a.message)}finally{b(!1)}},[]);return o.useEffect(()=>{x();const a=_.channel("public:organization_profile").on("postgres_changes",{event:"*",schema:"public",table:"organization_profile",filter:"id=eq.1"},c=>{c.new&&n(c.new)}).subscribe();return()=>{_.removeChannel(a)}},[x]),{profile:s,loading:g,error:i,updateProfile:async a=>{try{(a!=null&&a.phone||(a==null?void 0:a.phone)==="")&&(a.phone=ue(a.phone)),a!=null&&a.email&&(a.email=a.email.toLowerCase().trim());const{data:c,error:N}=await _.from("organization_profile").update(a).eq("id",1).select().single();if(N)throw N;return n(c),{data:c,error:null}}catch(c){return console.error("Error updating organization profile:",c),{data:null,error:c.message}}}}}function we({createCompany:s,updateCompany:n,deleteCompany:g,updateProfile:b,organizationLogo:i,confirm:j,toastError:x}){const[C,a]=o.useState(null),[c,N]=o.useState({}),[k,m]=o.useState(!1),[h,f]=o.useState({name:"",logo:i||"",website:"",info:""});return{editingId:C,editForm:c,setEditForm:N,isCreating:k,newCompanyForm:h,setNewCompanyForm:f,handleEdit:w=>{a(w.id),N({...w})},handleSave:async()=>{const w=C;if(w==="organization"){const{name:A,logo:P,website:L,info:O,contact:M,phone:I,email:$}=c;await b({name:A,logo:P,website:L,info:O,contact:M,phone:I,email:$})}else await n(w,c);a(null),N({})},handleCancel:()=>{a(null),N({})},handleDelete:async(w,A)=>{if(!await j({title:"Delete Company",message:`Are you sure you want to delete "${A}"? This will also delete all assignments for this company.`,confirmText:"Delete",variant:"danger"}))return;const{error:L}=await g(w);L&&x(`Error deleting company: ${L}`)},handleCreate:async()=>{if(!h.name.trim()){x("Company name is required");return}const{error:w}=await s(h);w?x(`Error creating company: ${w}`):(m(!1),f({name:"",logo:i,website:"",info:""}))},handleStartCreate:()=>{m(!0),f({name:"",logo:i,website:"",info:""})},handleCancelCreate:()=>{m(!1),f({name:"",logo:i,website:"",info:""})}}}function K(s){const[n,g]=o.useState({}),[b,i]=o.useState(!1),[j,x]=o.useState(null),C=o.useCallback(async()=>{if(!s){g({});return}try{i(!0),x(null);const{data:m,error:h}=await _.from("company_translations").select("language_code, info").eq("company_id",s);if(h)throw h;const f={};(m||[]).forEach(d=>{f[d.language_code]=d.info}),g(f)}catch(m){console.error("Error loading translations:",m),x(m.message)}finally{i(!1)}},[s]),a=async(m,h)=>{if(s)try{x(null);const{error:f}=await _.from("company_translations").upsert({company_id:s,language_code:m,info:h,updated_at:new Date().toISOString()},{onConflict:"company_id,language_code"});if(f)throw f;return g(d=>({...d,[m]:h})),!0}catch(f){return console.error("Error saving translation:",f),x(f.message),!1}},c=async m=>{if(s)try{x(null);const{error:h}=await _.from("company_translations").delete().eq("company_id",s).eq("language_code",m);if(h)throw h;return g(f=>{const d={...f};return delete d[m],d}),!0}catch(h){return console.error("Error deleting translation:",h),x(h.message),!1}},N=(m,h="nl")=>n[m]||n[h]||"",k=()=>Object.keys(n);return o.useEffect(()=>{C()},[C]),{translations:n,loading:b,error:j,saveTranslation:a,deleteTranslation:c,getTranslation:N,getAvailableLanguages:k,reload:C}}const ve=[{code:"nl",label:"Nederlands",flag:"ðŸ‡³ðŸ‡±"},{code:"en",label:"English",flag:"ðŸ‡¬ðŸ‡§"},{code:"de",label:"Deutsch",flag:"ðŸ‡©ðŸ‡ª"}];function Pe({currentLanguage:s,onLanguageChange:n,translations:g={},className:b=""}){return e.jsx("div",{className:`flex items-center gap-1 ${b}`,children:ve.map(i=>{const j=s===i.code,x=g[i.code]&&g[i.code].trim()!=="";return e.jsxs("button",{type:"button",onClick:()=>n(i.code),className:`px-2 py-1 rounded text-xs font-medium transition flex items-center gap-1 ${j?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("span",{children:i.flag}),e.jsx("span",{children:i.label}),x&&!j&&e.jsx(T,{path:ne,size:.5,className:"text-green-600"})]},i.code)})})}function Ee({translations:s={}}){const n=Object.keys(s).filter(g=>s[g]&&s[g].trim()!=="").length;return n<=1?null:e.jsx("span",{className:"inline-block ml-1 text-blue-600",title:`Available in ${n} languages`,children:"ðŸŒ"})}function Se({companyId:s,editingLanguage:n,onLanguageChange:g}){const{translations:b,saveTranslation:i}=K(s),[j,x]=o.useState(""),[C,a]=o.useState(!1);o.useEffect(()=>{x(b[n]||"")},[n,b]);const c=async()=>{if(j!==(b[n]||"")){a(!0);try{await i(n,j)}catch(N){console.error("Failed to save translation:",N)}finally{a(!1)}}};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(Pe,{currentLanguage:n,onLanguageChange:g,translations:b,className:"mb-2"}),e.jsx("textarea",{value:j,onChange:N=>x(N.target.value),onBlur:c,className:"w-full bg-white text-gray-900 border rounded px-2 py-1",rows:4,placeholder:`Enter info in ${n==="nl"?"Dutch":"English"}...`,disabled:C}),C&&e.jsx("span",{className:"text-xs text-gray-500 italic",children:"Saving..."})]})}function ze({companyId:s,currentLanguage:n}){const{translations:g,getTranslation:b}=K(s),i=b(n,"nl");return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("p",{className:"line-clamp-3 whitespace-pre-wrap flex-1",children:i||e.jsx("span",{className:"text-gray-400 text-sm italic",children:"Not set"})}),e.jsx(Ee,{translations:g})]})}function Fe(){const{companies:s,loading:n,error:g,createCompany:b,updateCompany:i,deleteCompany:j,searchCompanies:x}=me(),{profile:C,loading:a,error:c,updateProfile:N}=Ce(),{organizationLogo:k}=re(),{confirm:m,toastError:h}=le(),{i18n:f,t:d}=oe(),{categories:W,getCompanyCategories:q,getAllCompanyCategories:R,assignCategoriesToCompany:B}=be(),[F,G]=o.useState(""),[w,A]=o.useState("nl"),[P,L]=o.useState("public"),[O,M]=o.useState({}),[I,$]=o.useState([]),{editingId:y,editForm:u,setEditForm:z,isCreating:l,newCompanyForm:p,setNewCompanyForm:E,handleEdit:Q,handleSave:X,handleCancel:Y,handleDelete:Z,handleCreate:ee,handleStartCreate:te,handleCancelCreate:V}=we({createCompany:b,updateCompany:i,deleteCompany:j,updateProfile:N,organizationLogo:k,confirm:m,toastError:h});o.useEffect(()=>{(async()=>{if(y&&y!=="organization"){const v=(await q(y)).map(S=>S.id);$(v)}else y||$([])})()},[y]),o.useEffect(()=>{const t=async()=>{if(s.length>0){const r=s.map(S=>S.id),v=await R(r);M(v)}};P==="public"&&s.length>0&&t()},[P,s.length]);const ae=async()=>{if(await X(),y&&y!=="organization"){const t=await B(y,I);if(!t.success)console.error("Failed to assign categories:",t.error),alert("Failed to save categories: "+t.error);else{const r=await q(y);M(v=>({...v,[y]:r}))}}$([])},H=()=>{Y(),$([])},U=o.useMemo(()=>{const t=[];if(C&&t.push({...C,id:"organization",isOrganization:!0}),t.push(...s),!F)return t;const r=F.toLowerCase();return t.filter(v=>{var S;return(S=v.name)==null?void 0:S.toLowerCase().includes(r)})},[C,s,F]),se=n||a,J=g||c;return se?e.jsx("div",{className:"p-4",children:"Loading data..."}):J?e.jsxs("div",{className:"p-4 text-red-600",children:["Error: ",J]}):e.jsxs("div",{className:"h-full flex flex-col p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{path:ie,size:1,className:"text-gray-500"}),e.jsx("input",{type:"text",placeholder:d("helpPanel.companies.searchPlaceholder"),value:F,onChange:t=>G(t.target.value),className:"px-3 py-2 border rounded-lg"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[U.length," of ",s.length+1]})]}),e.jsxs("button",{onClick:te,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(T,{path:ce,size:.8}),d("helpPanel.companies.addCompany")]})]}),e.jsxs("div",{className:"flex gap-2 mb-4 border-b flex-shrink-0",children:[e.jsx("button",{onClick:()=>L("public"),className:`px-4 py-2 font-medium transition-colors ${P==="public"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:d("helpPanel.companies.publicInfoTab","Public Info")}),e.jsx("button",{onClick:()=>L("manager"),className:`px-4 py-2 font-medium transition-colors ${P==="manager"?"text-green-600 border-b-2 border-green-600":"text-gray-600 hover:text-gray-900"}`,children:d("helpPanel.companies.privateInfoTab","Private Info")})]}),e.jsx(de,{isOpen:l||!!y,onClose:l?V:H,title:l?d("helpPanel.companies.newCompany"):`Edit: ${u.name||"Company"}`,size:"lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3 text-blue-800",children:"Public Info (visible to attendees)"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",placeholder:d("helpPanel.companies.companyNamePlaceholder"),value:l?p.name:u.name,onChange:t=>l?E({...p,name:t.target.value}):z({...u,name:t.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-900",children:d("helpPanel.companies.companyLogo")}),e.jsx(fe,{currentLogo:l?p.logo:u.logo,onUploadComplete:(t,r)=>{l?E({...p,logo:t}):z({...u,logo:t})},folder:y==="organization"?"organization":"companies",label:"Upload Logo",showPreview:!0,allowDelete:!0,onDelete:()=>{l?E({...p,logo:k}):z({...u,logo:k})}}),e.jsx("input",{type:"text",placeholder:d("helpPanel.companies.logoUrlPlaceholder"),value:l?p.logo:u.logo||"",onChange:t=>l?E({...p,logo:t.target.value}):z({...u,logo:t.target.value}),className:"w-full px-3 py-2 border rounded mt-2 text-sm bg-white text-gray-900"})]}),e.jsx("input",{type:"text",placeholder:"Website URL",value:l?p.website:u.website||"",onChange:t=>l?E({...p,website:t.target.value}):z({...u,website:t.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900"}),y==="organization"?e.jsx("textarea",{placeholder:d("helpPanel.companies.infoPlaceholder"),value:l?p.info:u.info||"",onChange:t=>l?E({...p,info:t.target.value}):z({...u,info:t.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900",rows:3}):l?e.jsx("textarea",{placeholder:d("helpPanel.companies.infoPlaceholder"),value:p.info,onChange:t=>E({...p,info:t.target.value}),className:"w-full px-3 py-2 border rounded bg-white text-gray-900",rows:3}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-900",children:"Info (Multi-language)"}),e.jsx(Se,{companyId:y,editingLanguage:w,onLanguageChange:A})]}),!l&&y!=="organization"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-900",children:"Categories"}),W.length>0?e.jsx("div",{className:"flex flex-col gap-1.5",children:W.map(t=>e.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer px-2.5 py-1.5 rounded text-sm",style:{backgroundColor:I.includes(t.id)?t.color+"30":t.color+"15",color:t.color,border:`1px solid ${t.color}40`},children:[e.jsx("input",{type:"checkbox",checked:I.includes(t.id),onChange:r=>{const v=r.target.checked?[...I,t.id]:I.filter(S=>S!==t.id);$(v)},className:"cursor-pointer"}),t.icon&&e.jsx(T,{path:t.icon,size:.6}),t.name]},t.id))}):e.jsx("span",{className:"text-red-500 text-sm italic",children:"No categories available"})]})]})]}),e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3 text-green-800",children:"Manager-Only Info (default contact info)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",placeholder:"Contact Person",value:l?p.contact||"":u.contact||"",onChange:t=>l?E({...p,contact:t.target.value}):z({...u,contact:t.target.value}),className:"px-3 py-2 border rounded bg-white text-gray-900"}),e.jsx(ye,{value:l?p.phone||"":u.phone||"",onChange:t=>l?E({...p,phone:t}):z({...u,phone:t}),placeholder:"Phone (e.g., +31612345678)"}),e.jsx("input",{type:"email",placeholder:"Email",value:l?p.email||"":u.email||"",onChange:t=>{const r=t.target.value.toLowerCase();l?E({...p,email:r}):z({...u,email:r})},className:"px-3 py-2 border rounded bg-white text-gray-900"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 justify-end",children:[e.jsx("button",{onClick:l?V:H,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:l?ee:ae,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:l?"Create":"Save"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-auto border rounded-lg",children:[e.jsxs("table",{className:"w-full rounded",style:{tableLayout:"fixed",fontSize:"11px"},children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{children:[P==="public"?e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:"Name"}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:"Logo"}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:"Website"}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:"Info"}),e.jsx("th",{className:"p-2 text-left bg-blue-100 border-b text-gray-900",children:"Categories"})]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:"Name"}),e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:"Contact"}),e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:"Phone"}),e.jsx("th",{className:"p-2 text-left bg-green-100 border-b text-gray-900",children:"Email"})]}),e.jsx("th",{className:"p-2 bg-gray-100 border-b font-semibold text-gray-900",style:{minWidth:"90px",width:"90px",maxWidth:"120px"},children:"Actions"})]})}),e.jsx("tbody",{children:U.map(t=>{const r=t.isOrganization,v=r?"bg-gray-700 text-white":"bg-white text-gray-900 hover:bg-gray-50",S=P==="public"?"bg-blue-50":"bg-green-50";return e.jsxs("tr",{className:`${v} border-b`,children:[e.jsx("td",{className:`py-2 px-3 border-b text-left ${r?"":S}`,children:e.jsx("span",{className:"font-semibold",children:t.name})}),P==="public"?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`py-2 px-3 border-b text-left ${r?"":"bg-blue-50"}`,children:e.jsx("img",{src:ge(t.logo&&t.logo.trim()!==""?t.logo:k),alt:t.name,className:"h-8 object-contain"})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${r?"":"bg-blue-50"}`,children:t.website?e.jsx("a",{href:t.website.startsWith("http")?t.website:`https://${t.website}`,target:"_blank",rel:"noopener noreferrer",className:r?"text-blue-300 hover:underline":"text-blue-600 hover:underline",children:t.website.replace(/^https?:\/\//,"").substring(0,30)}):e.jsx("span",{className:"text-gray-400 text-sm italic",children:"Not set"})}),e.jsx("td",{className:`py-2 px-3 border-b text-left max-w-xs ${r?"":"bg-blue-50"}`,children:r?e.jsx("p",{className:"line-clamp-3 whitespace-pre-wrap",children:t.info||e.jsx("span",{className:"text-gray-400 text-sm italic",children:"Not set"})}):e.jsx(ze,{companyId:t.id,currentLanguage:y===t.id?f.language:"nl"})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${r?"":"bg-blue-50"}`,children:r?e.jsx("span",{className:"text-gray-400 text-xs italic",children:"N/A"}):e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(O[t.id]||[]).map(D=>e.jsxs("span",{className:"text-xs px-1.5 py-0.5 rounded inline-flex items-center gap-1",style:{backgroundColor:D.color+"20",color:D.color},children:[D.icon&&e.jsx(T,{path:D.icon,size:.5}),D.name]},D.id)),(!O[t.id]||O[t.id].length===0)&&e.jsx("span",{className:"text-gray-400 text-xs italic",children:"None"})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`py-2 px-3 border-b text-left ${r?"":"bg-green-50"}`,children:e.jsx("span",{className:"text-xs",children:t.contact||e.jsx("span",{className:"text-gray-400 italic",children:"Not set"})})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${r?"":"bg-green-50"}`,children:t.phone?e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx("span",{children:je(t.phone)}),e.jsx("span",{children:Ne(t.phone)})]}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"Not set"})}),e.jsx("td",{className:`py-2 px-3 border-b text-left ${r?"":"bg-green-50"}`,children:e.jsx("span",{className:"text-xs",children:t.email||e.jsx("span",{className:"text-gray-400 italic",children:"Not set"})})})]}),e.jsx("td",{className:"py-2 px-3 border-b text-left",children:e.jsxs("div",{className:"flex gap-1 justify-center",children:[e.jsx("button",{onClick:()=>Q(t),className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700",title:"Edit",children:e.jsx(T,{path:xe,size:.8})}),!r&&e.jsx("button",{onClick:()=>Z(t.id,t.name),className:"p-1.5 bg-red-600 text-white rounded hover:bg-red-700",title:"Delete",children:e.jsx(T,{path:he,size:.8})}),r&&e.jsx("div",{className:"flex items-center justify-center pt-1 text-gray-300",children:e.jsx(T,{path:pe,size:.8})})]})})]},t.id)})})]}),U.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:d(F?"helpPanel.companies.noResults":"helpPanel.companies.noCompanies")})]})]})}export{Fe as default};
