import{r as u,c as Ne,a as Xe,j as t,I as ie,R as be,_ as Qe,g as Je}from"./vendor-react-505adfae.js";import{aF as ve,ae as Ve,ak as et,ad as f,aV as tt,aW as nt}from"./vendor-3a7855fa.js";import{L as T,u as ot,T as st,P as Ae,M as De,a as it,b as at,c as lt}from"./vendor-map-5eb3cb24.js";import{j as Re,k as q,u as Se,c as Me,d as we,a as je,b as Ee,i as Ze,s as _e,g as rt,l as ct,m as dt,B as ut}from"./index-5891cb02.js";import{F as Be,u as ht}from"./useTranslatedCompanyInfo-3c4be85b.js";import{u as Ue}from"./useCategories-6fd5f963.js";import{A as gt,m as Fe,M as pt,a as ft,b as yt}from"./vendor-ui-20405275.js";import{u as He}from"./useEventSubscriptions-015b6bb3.js";import{u as $e}from"./useAssignments-671cc28d.js";import"./vendor-canvas-85f1a6b6.js";import{u as mt}from"./useEventMapSettings-a4b2ca38.js";function xe(e){if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://"))return e;const o=Re();return e.startsWith("/assets/icons/")?`${o}${e.slice(1)}`:e.startsWith("icons/")?`${o}assets/icons/${e.slice(6)}`:`${o}assets/icons/${e}`}L.Icon.Glyph=L.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],className:"",prefix:"",glyph:"home",glyphColor:"white",glyphSize:"11px",glyphAnchor:[0,0]},createIcon:function(){var e=document.createElement("div"),o=this.options;return o.glyph&&e.appendChild(this._createGlyph()),e.style.position="relative",this._setIconStyles(e,o.className),e},_createGlyph:function(){var e,o,n=this.options;n.prefix?n.prefix==="fab"||n.prefix==="fal"||n.prefix==="far"||n.prefix==="fas"?e="fa-"+n.glyph:n.glyph.slice(0,n.prefix.length+1)===n.prefix+"-"?e=n.glyph:e=n.prefix+"-"+n.glyph:(e="",o=n.glyph);var r=L.DomUtil.create("span",n.prefix+" "+e);return r.style.position="absolute",r.style.fontSize=n.glyphSize,r.style.color=n.glyphColor,r.style.width=n.iconSize[0]+"px",r.style.lineHeight=n.iconSize[1]+"px",r.style.textAlign="center",r.style.left=n.glyphAnchor[0]+"px",r.style.top=n.glyphAnchor[1]+"px",r.style.pointerEvents="none",r.style.display="inline-block",o&&(r.innerHTML=o),r},_setIconStyles:function(e,o){if(o==="shadow")return L.Icon.prototype._setIconStyles.call(this,e,o);var n=this.options,r=L.point(n.iconSize),c=L.point(n.iconAnchor);!c&&r&&(c=r.divideBy(2,!0)),e.className="leaflet-marker-icon leaflet-glyph-icon "+o;var g=this._getIconUrl("icon");g&&(e.style.backgroundImage="url('"+g+"')"),n.bgPos&&(e.style.backgroundPosition=-n.bgPos.x+"px "+-n.bgPos.y+"px"),n.bgSize&&(e.style.backgroundSize=n.bgSize.x+"px "+n.bgSize.y+"px"),c&&(e.style.marginLeft=-c.x+"px",e.style.marginTop=-c.y+"px"),r&&(e.style.width=r.x+"px",e.style.height=r.y+"px");try{const b=e.querySelectorAll&&e.querySelectorAll("span");b&&b.length&&b.forEach(i=>{i.style.fontSize=n.glyphSize||i.style.fontSize||"",i.style.color=n.glyphColor||i.style.color||"",n.iconSize&&(i.style.width=n.iconSize[0]+"px",i.style.lineHeight=n.iconSize[1]+"px"),n.glyphAnchor&&n.glyphAnchor.length>=2&&(i.style.left=n.glyphAnchor[0]+"px",i.style.top=n.glyphAnchor[1]+"px")})}catch(b){console.warn("Failed to update glyph span styles in-place",b)}}});L.icon.glyph=function(e){return new L.Icon.Glyph(e)};L.Icon.Glyph.prototype.options.iconUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAUlSURBVFjDrZdLiBxVFIb/e289uqt6kkx6zIiIoKgLRReKuMhCcaOIAUEIiCCE4CIPggZ8kBjooPgM0TiYEUUjqBGchZqAQlyYRTA+kJiJQiJGMjN5zYzT3dP1rrr3HBeTjDGTSfc8Dvyruud89Z9z6kIJdBj31763MivsJXKuZYF6dak5++2mh7NOcsXVHq6sHbhOK/24kOJJMO4AE1vKygwZhxlKSHGKiD+RSu09vOXB43OCrHz96y6T2lsh+OmKXzFdlbLne2UopSAupBhjECcZgjDMgiiSxPhcK/nCr1sfOtcWcm/tq9uEsL4rl0vdK67pKVu2jUwTMk0wBBAzpBCQAnAtiZIlwWQwPlHPglZQAFj1Y23VwVkh92zbd59U+Kanp+p2L12mooKQ5AbcpuclS6LiKoRhxOfHzhXMcs3PtVV7Z0DufXH/LSzpSG9vr1/p6kIz0dDUrvx/IYXAsrJCkWc4e/Z0Zpgf+KX26A/TkNtrXziesY9Xq8tvWNZdVfVYg7hzwKVv3O3ZiKMWj46OTrq5fdOh1x5pSADwjdzo2nbv0u6qqkca2jCIMGcZAuqRhu8vEX7ZK2V2WgMAcXdtvyeKbPS662+osCohzMycHVweniNREoShoZO5KYobpciSh23bFq7rIUgNiLFghRkBlg2v7GlpiccsCHrcryzxUk3zmsNskeYGvt/lxVH4hMWEu9xSWaQFYQ7L1B6iGZ5bBoy+zWKiHiltFHpqeIsVhWaosg1iqlgg4wAAEYEXsV3EmNppJmExMFYUxfVSuIs6E0sI5FkBBhLJzH9laQxLSjBj0WQJgSJPweDTkknvS4JGbCuxKOt7UY4lEQfNnAu9TzLxN2nUdAQTLAEw8YIlAVgAkmDCSBL75eCutSeY+GTUqqNkqUVxUbIl4qgJo4vWzecrhyQAMJldYf1MXLLl1EIsYBZgoGwpRI2zMTPtGBhYbSQAlJF9lieRzNMIriVBzPOWawvoIkYaNC0u9IcAIAHgp75NLQl8ENbPZJ6jgAU48RyFqHEuZyE+Pda/vjENAQBD5s209Y+kPJlyM4+r3lUS0AWSyVEhpHnjYu1pyO+7N4ywwPvhxHDiuwo8j1b5rkQwMZIziYHBXetPzIAAgIV8exZOSMoieI6aU5vKtgR0jqw1JtiYbZfW/R/kSN+mcWbxdtwYjn1XTd9B7cQAfNdCWB/OhBR7jvWv/3tWCAAoO3ktjyZZJ0HHbsq2AooERVQXzPKly2vOgPz29jNNBr+e1IcSz5YAM4hmFzPDtyWS+lDK4N2DfU+dbgsBAFHyd+oszE3agt/GjWcrUBEjj5sQBb96pXpXhAzueDJi4u1p41TsuQpCiFln4bkKeXMoJeadg++tG+sYAgBBXOo3RRrruAnfkWDmGfIdCeQhiiQgQbxjtlqzQk59vCZlNluL5lDiORLyMjcA4DsKeXM4AfDKxa97ThAAqPaMfaR1Nq6jOiqOAhOm5TsKJg1QZGGRedY7V6tzVcjBWk1D0JZ8cigt2RJSimkXnqOgW8MxQLUTb6wN5g0BgGPV0c9BekTH41xx5YXrQ8FkTRgdpxU7ea9djbYQ1GokmJ43wUhWtgRcS04tQjAcw9CWw29tThYOAXD03XVfMps/TTTOy30blDZgiqxFK6p7OsnvCDJ1UD9LyUjORoPDkUQyPfdHbXW+qJCjfRsOwOAoNY4z6Xz01rHq3k5zO4ZMHTabYSIhJD87MLB64f8Ys8WdG/tfBljMJedfwY+s/2P4Pv8AAAAASUVORK5CYII=";function Ie({glyph:e,glyphColor:o="white",bgColor:n="white",glyphSize:r="8px",iconUrl:c="/Mapassets/icons/glyph-marker-icon-blue.svg",className:g,iconSize:b,prefix:i,glyphAnchor:m,isActive:s}){let a=r;if(typeof a=="number")a=`${a.toFixed(2)}px`;else if(typeof a=="string"&&!a.endsWith("px")){const N=parseFloat(a.replace(/[^0-9.-]/g,""));Number.isFinite(N)?a=`${N.toFixed(2)}px`:a=`${a}px`}else a||(a="8px");const x=b||[25,41],j=Math.round(x[0]*(41/25)),w=Math.round(x[1]*(41/41)),A=Math.round(j*12/41),v=w,I=Re();return T.icon.glyph({iconUrl:c||`${I}assets/icons/glyph-marker-icon-blue.svg`,iconSize:x,iconAnchor:[Math.round(x[0]/2),x[1]],popupAnchor:[1,-34],tooltipAnchor:[0,0],shadowUrl:`${I}assets/icons/marker-shadow.png`,shadowSize:[j,w],shadowAnchor:[A,v],prefix:i||"",glyph:e||"",glyphColor:o||"white",bgColor:n,glyphSize:a,glyphAnchor:m||[0,0],className:s?`${g} marker-active`:g||""})}function ke(e,o,n=!1,r=!1){const c=q.MARKER_SIZING;if(!c||!c.ENABLED||r&&!c.APPLY_IN_ADMIN)return o||(c?c.DEFAULT_SIZE:[25,41]);const g=c.ZOOM_BUCKETS.find(i=>e>=i.minZoom&&e<=i.maxZoom);let b=g?g.size:c.DEFAULT_SIZE;try{if(Array.isArray(o)&&o.length===2&&c.DEFAULT_SIZE&&Array.isArray(c.DEFAULT_SIZE)){const i=c.DEFAULT_SIZE[1]||c.DEFAULT_SIZE[0]||41,s=(o[1]||o[0]||i)/i;b=[Math.round(b[0]*s),Math.round(b[1]*s)]}}catch(i){console.warn("[markerSizing] failed to compute scaled size from baseSize",i)}return n&&c.SPECIAL_MARKER_MULTIPLIER&&(b=[Math.round(b[0]*c.SPECIAL_MARKER_MULTIPLIER),Math.round(b[1]*c.SPECIAL_MARKER_MULTIPLIER)]),b}function xt(e){const o=q.MARKER_SIZING;if(!o.ENABLED)return"default";const n=o.ZOOM_BUCKETS.find(r=>e>=r.minZoom&&e<=r.maxZoom);return n?`${n.minZoom}-${n.maxZoom}`:"default"}function fe(e,o=[25,41]){if(!Array.isArray(e)||e.length===0)return o;const n=e[0]||o[0],r=e[1]||Math.round(n*(o[1]/o[0]));return[n,r]}function Oe(e="md"){const o={sm:"(max-width: 639px)",md:"(max-width: 767px)",lg:"(max-width: 1023px)",xl:"(max-width: 1279px)","2xl":"(max-width: 1535px)"},n=o[e]||o.md,[r,c]=u.useState(()=>typeof window<"u"?window.matchMedia(n).matches:!1);return u.useEffect(()=>{if(typeof window>"u")return;const g=window.matchMedia(n),b=()=>c(g.matches);return g.addEventListener("change",b),()=>g.removeEventListener("change",b)},[n]),r}const Ge=({marker:e,onClose:o})=>{const n=ot(),{organizationLogo:r}=Se(),{isFavorite:c,toggleFavorite:g}=Me(),{i18n:b}=Ne(),{getCompanyCategories:i}=Ue(b.language),[m,s]=u.useState([]);return u.useEffect(()=>(n&&n.dragging.disable(),()=>{n&&n.dragging.enable()}),[n]),u.useEffect(()=>{e!=null&&e.companyId?i(e.companyId).then(s):s([])},[e==null?void 0:e.companyId,i]),e?Xe.createPortal(t.jsxs(gt,{children:[t.jsx(Fe.div,{className:"bottom-sheet-backdrop",onClick:o,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.25}},"backdrop"),t.jsxs(Fe.div,{className:"bottom-sheet",drag:"y",dragConstraints:{top:0,bottom:0},dragElastic:.25,onDragEnd:(a,x)=>{x.offset.y>100&&o()},initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",stiffness:180,damping:22},children:[t.jsx("div",{className:"handle"}),t.jsxs("div",{className:"content",children:[t.jsx("div",{className:"w-20 h-20 mx-auto mb-3 flex items-center justify-center bg-white rounded-md border border-gray-300 overflow-hidden",children:t.jsx("img",{src:we(e.logo,r),alt:e.name||"Logo",className:"max-w-[80%] max-h-[80%] object-contain"})}),t.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[t.jsx("div",{className:"text-base font-semibold text-gray-900",children:e.name}),e.companyId&&t.jsx(Be,{isFavorite:c(e.companyId),onToggle:()=>g(e.companyId),size:"md"})]}),e.glyph&&t.jsxs("div",{className:"text-sm text-gray-700 mb-1",children:["Booth ",e.glyph]}),m&&m.length>0&&t.jsx("div",{className:"mb-2 flex flex-wrap gap-1.5",children:m.map(a=>t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-white rounded",style:{backgroundColor:a.color},title:a.name,children:[t.jsx(ie,{path:a.icon,size:.5}),a.name]},a.id))}),e.website&&t.jsx("div",{className:"text-sm mb-1",children:t.jsx("a",{href:e.website.startsWith("http")?e.website:`https://${e.website}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:e.website})}),e.info&&t.jsx("div",{className:"text-sm text-gray-600 mt-2 pt-2 border-t border-gray-200",children:e.info}),t.jsx("button",{onClick:o,className:"mt-4 w-full bg-gray-200 py-2 rounded-md text-gray-700 font-medium hover:bg-gray-300",children:"Close"})]})]},"sheet")]}),document.body):null},bt=({marker:e,organizationLogo:o,showBoothNumber:n=!0})=>{const r=e.name||e.companyId;return t.jsxs("div",{className:"flex items-center gap-2 p-1",children:[r&&t.jsx("div",{className:"w-8 h-8 flex items-center justify-center bg-white rounded-sm border border-gray-200 overflow-hidden",children:t.jsx("img",{src:we(e.logo,o),alt:"",className:"max-w-[70%] max-h-[70%] object-contain"})}),t.jsxs("div",{className:"flex flex-col min-w-0",children:[n&&e.glyph&&t.jsxs("div",{className:"text-xs font-semibold text-gray-700",children:["Booth ",e.glyph]}),e.name?t.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}):t.jsx("div",{className:"text-xs font-medium text-gray-500 italic",children:"Unassigned"})]})]})},At=({marker:e,organizationLogo:o,showBoothNumber:n=!0})=>{const r=e.name||e.companyId,{isFavorite:c,toggleFavorite:g}=Me(),b=ht(e),{i18n:i}=Ne(),{getCompanyCategories:m}=Ue(i.language),[s,a]=u.useState([]);return u.useEffect(()=>{e.companyId?m(e.companyId).then(a):a([])},[e.companyId,m]),t.jsx(Ae,{closeButton:!0,className:"marker-popup-scrollable",autoPan:!0,maxWidth:320,minWidth:240,children:t.jsx("div",{className:"popup-scroll-container",children:t.jsxs("div",{className:"popup-scroll-content",children:[r&&t.jsx("div",{className:"w-24 h-24 mx-auto mb-3 flex items-center justify-center bg-white rounded-md border border-gray-300 overflow-hidden flex-shrink-0",children:t.jsx("img",{src:we(e.logo,o),alt:e.name||"Logo",className:"max-w-[80%] max-h-[80%] object-contain"})}),e.name?t.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[t.jsx("div",{className:"text-base font-semibold text-gray-900",children:e.name}),e.companyId&&t.jsx(Be,{isFavorite:c(e.companyId),onToggle:()=>g(e.companyId),size:"sm"})]}):t.jsx("div",{className:"text-base font-semibold text-gray-500 italic mb-1",children:"Unassigned Booth"}),n&&e.glyph&&t.jsxs("div",{className:"text-sm text-gray-700 mb-2",children:["Booth ",e.glyph]}),s&&s.length>0&&t.jsx("div",{className:"mb-2 flex flex-wrap gap-1.5",children:s.map(x=>t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-white rounded",style:{backgroundColor:x.color},title:x.name,children:[t.jsx(ie,{path:x.icon,size:.5}),x.name]},x.id))}),e.website&&t.jsx("div",{className:"text-sm mb-2",children:t.jsx("a",{href:e.website.startsWith("http")?e.website:`https://${e.website}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",style:{wordBreak:"break-all"},children:e.website})}),b&&t.jsx("div",{className:"text-sm text-gray-600 mt-2 pt-2 border-t border-gray-200",style:{wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap"},children:b})]})})})},St=({marker:e,onMoreInfo:o,organizationLogo:n,showBoothNumber:r=!0})=>{const c=e.name||e.companyId;return t.jsx(Ae,{closeButton:!0,className:"marker-popup",autoPan:!0,children:t.jsxs("div",{className:"p-2 text-center",children:[c&&t.jsx("div",{className:"w-12 h-12 mx-auto mb-2 flex items-center justify-center bg-white rounded-md border border-gray-300 overflow-hidden",children:t.jsx("img",{src:we(e.logo,n),alt:"",className:"max-w-[80%] max-h-[80%] object-contain"})}),e.name?t.jsx("div",{className:"font-semibold text-gray-900 text-sm",children:e.name}):t.jsx("div",{className:"font-semibold text-gray-500 italic text-sm",children:"Unassigned Booth"}),r&&e.glyph&&t.jsxs("div",{className:"text-xs text-gray-700 mb-2",children:["Booth ",e.glyph]}),c&&t.jsx("button",{onClick:o,className:"bg-blue-500/90 text-white text-xs px-3 py-1 rounded-full hover:bg-blue-600",children:"More Info"})]})})},Ye=({marker:e,onMoreInfo:o,isMobile:n,organizationLogo:r,showBoothNumber:c=!0})=>{const g=e&&(e.glyph!==void 0&&e.glyph!==null&&e.glyph!==""||e.name);return t.jsxs(t.Fragment,{children:[!n&&t.jsxs(t.Fragment,{children:[g&&t.jsx(st,{direction:"top",offset:[0,-10],opacity:.95,children:t.jsx(bt,{marker:e,organizationLogo:r,showBoothNumber:c})}),t.jsx(At,{marker:e,organizationLogo:r,showBoothNumber:c})]}),n&&t.jsx(St,{marker:e,onMoreInfo:o,organizationLogo:r,showBoothNumber:c})]})};function We({marker:e,subscriptions:o,assignments:n,onAssign:r,onUnassign:c,isLoading:g,onClose:b}){const[i,m]=u.useState(""),s=u.useRef(null),a=n.find(A=>A.marker_id===e.id),x=o.filter(A=>{const v=n.filter(C=>C.company_id===A.company_id),I=v.length,N=A.booth_count||1;return!v.some(C=>C.marker_id===e.id)&&I<N}).map(A=>{var C,l,P;const I=n.filter(D=>D.company_id===A.company_id).length,N=A.booth_count||1,$=N-I;return{id:A.company_id,name:((C=A.company)==null?void 0:C.name)||"Unknown Company",logo:((l=A.company)==null?void 0:l.logo)||null,website:((P=A.company)==null?void 0:P.website)||null,assignedBooths:I,totalBooths:N,remainingBooths:$}}).filter(A=>A.name.toLowerCase().includes(i.toLowerCase()));u.useEffect(()=>{s.current&&s.current.focus()},[]);const j=async A=>{await r(e.id,A),b()},w=async()=>{a&&(await c(e.id,a.company_id),b())};return t.jsxs("div",{className:"p-2",children:[t.jsx("div",{className:"flex items-center justify-between mb-3 pb-2 border-b border-gray-300",children:t.jsxs("h3",{className:"text-sm font-semibold text-gray-800 flex items-center gap-2",children:[t.jsx(ie,{path:ve,size:.8,className:"text-blue-600"}),e.name||`Marker ${e.id}`]})}),a&&(()=>{var $,C;const v=n.filter(l=>l.company_id===a.company_id).length,I=o.find(l=>l.company_id===a.company_id),N=(I==null?void 0:I.booth_count)||1;return t.jsx("div",{className:"mb-3 p-2 bg-blue-50 rounded border border-blue-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[($=a.company)!=null&&$.logo?t.jsx("img",{...(()=>{const l=je(a.company.logo);return l?{src:l.src,srcSet:l.srcSet,sizes:l.sizes}:{src:Ee(a.company.logo)}})(),alt:a.company.name,className:"w-8 h-8 object-contain flex-shrink-0"}):t.jsx(ie,{path:ve,size:1.2,className:"text-gray-400 flex-shrink-0"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium text-gray-800 truncate",children:((C=a.company)==null?void 0:C.name)||"Unknown"}),t.jsxs("div",{className:"text-xs text-gray-600",children:["Using ",v," of ",N," booth",N!==1?"s":""]})]})]}),t.jsx("button",{onClick:w,disabled:g,className:"ml-2 px-2 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",title:"Unassign company",children:t.jsx(ie,{path:Ve,size:.55,className:"inline"})})]})})})(),x.length>5&&t.jsxs("div",{className:"mb-2 relative",children:[t.jsx(ie,{path:et,size:.65,className:"absolute left-2 top-2 text-gray-400"}),t.jsx("input",{ref:s,type:"text",value:i,onChange:A=>m(A.target.value),placeholder:"Search companies...",className:"w-full pl-8 pr-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),t.jsx("div",{className:"max-h-64 overflow-y-auto",children:x.length===0?t.jsx("div",{className:"text-sm text-gray-500 text-center py-4",children:i?"No companies match your search":a?"No other companies available":"No subscribed companies available"}):t.jsx("div",{className:"space-y-1",children:x.map(A=>t.jsxs("button",{onClick:()=>j(A.id),disabled:g,className:"w-full flex items-center gap-2 p-2 hover:bg-gray-100 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-left",title:`Assign ${A.name} (${A.remainingBooths} booth${A.remainingBooths!==1?"s":""} available)`,children:[A.logo?t.jsx("img",{...(()=>{const v=je(A.logo);return v?{src:v.src,srcSet:v.srcSet,sizes:v.sizes}:{src:Ee(A.logo)}})(),alt:A.name,className:"w-8 h-8 object-contain flex-shrink-0"}):t.jsx(ie,{path:ve,size:1.2,className:"text-gray-400 flex-shrink-0"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm text-gray-800 truncate",children:A.name}),t.jsxs("div",{className:"text-xs text-gray-500",children:[A.remainingBooths," of ",A.totalBooths," booth",A.totalBooths!==1?"s":""," available"]})]})]},A.id))})}),g&&t.jsx("div",{className:"mt-2 text-xs text-center text-blue-600",children:"Processing..."})]})}function Ce({safeMarkers:e,updateMarker:o,isMarkerDraggable:n,selectedYear:r,isAdminView:c,selectedMarkerId:g,onMarkerSelect:b,currentZoom:i,applyVisitorSizing:m=!1,onMarkerDrag:s=null}){const a=Oe("md"),[x,j]=u.useState(null),w=c&&g!==void 0?e.find(h=>h.id===g):x,A=c&&b?h=>b(h?h.id:null):j,{organizationLogo:v}=Se(),[I,N]=u.useState({isOpen:!1,position:null,marker:null}),[$,C]=u.useState(!1),{subscriptions:l}=He(r||new Date().getFullYear()),{assignments:P,assignCompanyToMarker:D,unassignCompanyFromMarker:K}=$e(r||new Date().getFullYear()),{confirm:k}=Ze(),ae=u.useCallback(h=>F=>{const{lat:z,lng:J}=F.target.getLatLng();o(h,{lat:z,lng:J}),s&&s(h,z,J)},[o,s]),te=u.useCallback(h=>F=>{c&&(T.DomEvent.preventDefault(F),N({isOpen:!0,position:F.latlng,marker:h,timestamp:Date.now()}))},[c]),X=u.useCallback(async(h,F)=>{var J,Y;const z=P.filter(O=>O.marker_id===h);if(z.length>0){const O=(J=l.find(H=>H.company_id===F))==null?void 0:J.company,R=(O==null?void 0:O.name)||"this company",W=e.find(H=>H.id===h),B=(W==null?void 0:W.glyph)||(W==null?void 0:W.id)||"this booth";let Z;if(z.length===1){const H=((Y=z[0].company)==null?void 0:Y.name)||"another company";Z=`Booth ${B} is already assigned to ${H}.

Assign ${R} as an additional company for this booth?`}else{const H=z.map(V=>{var le;return(le=V.company)==null?void 0:le.name}).filter(Boolean).join(", ");Z=`Booth ${B} is already assigned to ${z.length} companies: ${H}.

Assign ${R} as another company for this booth?`}if(!await k({title:"Multiple Assignments",message:Z,confirmText:"Assign",variant:"warning"}))return}C(!0);try{await D(h,F)}catch(O){console.error("Error assigning company:",O)}finally{C(!1)}},[D,P,l,e,k]),G=u.useCallback(async(h,F)=>{C(!0);try{await K(h,F)}catch(z){console.error("Error unassigning company:",z)}finally{C(!1)}},[K]);return t.jsxs(t.Fragment,{children:[e.filter(h=>h.id>=1001).map(h=>{const F=[h.lat,h.lng],z=fe(Array.isArray(h.iconSize)?h.iconSize:[17,28],[17,28]),Y=ke(i,z,!0,c&&!m),O=Ie({className:h.type?`marker-icon marker-type-${h.type}`:"marker-icon",prefix:h.prefix,iconUrl:xe(h.iconUrl||`${h.type||"default"}.svg`),iconSize:Y,glyph:h.glyph||"?",glyphColor:h.glyphColor||"white",glyphSize:(()=>{if(h.glyphSize){let B=null;typeof h.glyphSize=="number"?B=h.glyphSize:typeof h.glyphSize=="string"&&(B=parseFloat(h.glyphSize.replace(/[^0-9.-]/g,"")));const Z=fe(Array.isArray(h.iconSize)?h.iconSize:[17,28],[17,28]),se=Z&&Z[1]?Z[1]:28;if(B&&se)return`${(Y[1]*B/se).toFixed(2)}px`;if(typeof h.glyphSize=="number")return`${h.glyphSize.toFixed(2)}px`;if(typeof h.glyphSize=="string"){const H=parseFloat(h.glyphSize.replace(/[^0-9.-]/g,""));return Number.isFinite(H)?`${H.toFixed(2)}px`:h.glyphSize}return""}return`${Math.round(Y[1]*.36)}px`})(),glyphAnchor:(()=>{const B=fe(Array.isArray(h.iconSize)?h.iconSize:[17,28],[17,28]),Z=B[0]||17,se=B[1]||28,H=Z?Y[0]/Z:1,V=se?Y[1]/se:1;if(Array.isArray(h.glyphAnchor)&&h.glyphAnchor.length>=2){const le=parseFloat(h.glyphAnchor[0])||0,ne=parseFloat(h.glyphAnchor[1])||0;return[parseFloat((le*H).toFixed(2)),parseFloat((ne*V).toFixed(2))]}return[parseFloat((0*H).toFixed(2)),parseFloat((-5*V).toFixed(2))]})(),isActive:(w==null?void 0:w.id)===h.id}),R=n(h),W={popupopen:B=>B.target.closeTooltip(),...R&&{dragend:ae(h.id)},...c&&{contextmenu:te(h)}};return t.jsx(De,{position:F,icon:O,draggable:R,eventHandlers:W,children:t.jsx(Ye,{marker:h,isMobile:a,organizationLogo:v,showBoothNumber:!1,onMoreInfo:()=>{A(h)}})},h.id)}),I.isOpen&&I.marker&&t.jsx(Ae,{position:I.position,onClose:()=>N({isOpen:!1,position:null,marker:null}),closeButton:!0,closeOnClick:!0,closeOnEscapeKey:!0,autoClose:!1,maxWidth:300,minWidth:250,children:t.jsx(We,{marker:I.marker,subscriptions:l,assignments:P,onAssign:X,onUnassign:G,isLoading:$,onClose:()=>N({isOpen:!1,position:null,marker:null})})},`context-${I.marker.id}-${I.timestamp||Date.now()}`),a&&w&&t.jsx(Ge,{marker:w,onClose:()=>A(null)})]})}Ce.propTypes={safeMarkers:f.array,updateMarker:f.func,isMarkerDraggable:f.func,selectedYear:f.number,isAdminView:f.bool,selectedMarkerId:f.number,onMarkerSelect:f.func,currentZoom:f.number,applyVisitorSizing:f.bool,onMarkerDrag:f.func};Ce.defaultProps={applyVisitorSizing:!1};const he={CHUNKED_LOADING:!0,SHOW_COVERAGE_ON_HOVER:!0,SPIDERFY_ON_MAX_ZOOM:!1,REMOVE_OUTSIDE_VISIBLE_BOUNDS:!0,DISABLE_CLUSTERING_AT_ZOOM:17,MAX_CLUSTER_RADIUS:400,MAX_MARKER_ID:1001},ee={FILE:"default.svg",SIZE:[15,25],GLYPH_COLOR:"white",GLYPH_SIZE:"9px",GLYPH_ANCHOR:[0,-4]},Mt=(e,o=!1,n=null,r=null)=>{var b;if(o)return xe("glyph-marker-icon-yellow.svg");if(e.iconUrl)return xe(e.iconUrl);const g=((b=e.assignments)==null?void 0:b.length)>0?n:r;return g!=null&&g.iconUrl?xe(g.iconUrl):xe(`${e.type||"default"}.svg`)},wt=(e,o=!1,n=!1,r=17,c=!1,g=null,b=null)=>{let i=e.type?`marker-icon marker-type-${e.type}`:"marker-icon";o&&(i+=" marker-active"),n&&(i+=" marker-favorited");const m=fe(Array.isArray(e.iconSize)?e.iconSize:ee.SIZE,ee.SIZE),s=ke(r,m,!1,c);return Ie({className:i,prefix:e.prefix,iconUrl:Mt(e,n,g,b),iconSize:s,glyph:e.glyph||"",glyphColor:e.glyphColor||ee.GLYPH_COLOR,glyphSize:(()=>{if(e.glyphSize){let a=null;typeof e.glyphSize=="number"?a=e.glyphSize:typeof e.glyphSize=="string"&&(a=parseFloat(e.glyphSize.replace(/[^0-9.-]/g,"")));const x=fe(Array.isArray(e.iconSize)?e.iconSize:ee.SIZE,ee.SIZE),j=x&&x[1]?x[1]:ee.SIZE[1];if(a&&j)return`${(s[1]*a/j).toFixed(2)}px`;if(typeof e.glyphSize=="number")return`${e.glyphSize.toFixed(2)}px`;if(typeof e.glyphSize=="string"){const w=parseFloat(e.glyphSize.replace(/[^0-9.-]/g,""));return Number.isFinite(w)?`${w.toFixed(2)}px`:e.glyphSize}return""}return`${Math.round(s[1]*.33)}px`})(),glyphAnchor:(()=>{const a=fe(Array.isArray(e.iconSize)?e.iconSize:ee.SIZE,ee.SIZE),x=a[0]||ee.SIZE[0],j=a[1]||ee.SIZE[1],w=x?s[0]/x:1,A=j?s[1]/j:1;if(Array.isArray(e.glyphAnchor)&&e.glyphAnchor.length>=2){const v=parseFloat(e.glyphAnchor[0])||0,I=parseFloat(e.glyphAnchor[1])||0;return[parseFloat((v*w).toFixed(2)),parseFloat((I*A).toFixed(2))]}return[parseFloat((ee.GLYPH_ANCHOR[0]*w).toFixed(2)),parseFloat((ee.GLYPH_ANCHOR[1]*A).toFixed(2))]})()})},Lt=e=>`${e.id}-${e.lat}-${e.lng}-${e.iconUrl||""}-${e.glyph||""}`,vt=u.memo(({marker:e,isDraggable:o,icon:n,eventHandlers:r,markerRef:c,isMobile:g,organizationLogo:b,onMarkerSelect:i})=>t.jsx(De,{position:[e.lat,e.lng],icon:n,draggable:o,eventHandlers:r,ref:c,children:t.jsx(Ye,{marker:e,isMobile:g,organizationLogo:b,onMoreInfo:()=>i(e)})}),(e,o)=>{const n=e.icon===o.icon,r=e.isDraggable===o.isDraggable,c=e.eventHandlers===o.eventHandlers;return n&&r&&c?!(e.marker.name!==o.marker.name||e.marker.logo!==o.marker.logo||e.marker.website!==o.marker.website||e.marker.info!==o.marker.info):!1});function ze({safeMarkers:e,updateMarker:o,isMarkerDraggable:n,iconCreateFunction:r,selectedYear:c,isAdminView:g,selectedMarkerId:b,onMarkerSelect:i,focusMarkerId:m,onFocusHandled:s,currentZoom:a,applyVisitorSizing:x=!1,onMarkerDrag:j=null}){const w=u.useRef({}),A=Oe("md"),[v,I]=u.useState(null),N=g&&b!==void 0?e.find(p=>p.id===b):v,$=g&&i?p=>i(p?p.id:null):I,{organizationLogo:C,loading:l}=Se();let P=null;try{P=Me()}catch{}const D=be.useMemo(()=>P!=null&&P.isFavorite?P.isFavorite:()=>!1,[P]),[K,k]=u.useState({isOpen:!1,position:null,marker:null}),[ae,te]=u.useState(!1),{subscriptions:X}=He(c||new Date().getFullYear()),{assignments:G,assignCompanyToMarker:h,unassignCompanyFromMarker:F}=$e(c||new Date().getFullYear()),[z,J]=u.useState({assigned:null,unassigned:null});u.useEffect(()=>{const p=async()=>{try{const{data:E,error:U}=await _e.from("markers_appearance").select("*").in("id",[-1,-2]).eq("event_year",0);if(U)throw U;const oe=E.find(y=>y.id===-1)||{},d=E.find(y=>y.id===-2)||{};J({assigned:oe,unassigned:d})}catch(E){console.error("Error loading default markers:",E)}};p();const S=_e.channel("default-markers-changes").on("postgres_changes",{event:"*",schema:"public",table:"markers_appearance",filter:"event_year=eq.0"},()=>{p()}).subscribe();return()=>{_e.removeChannel(S)}},[]);const{confirm:Y,toastError:O}=Ze(),R=u.useMemo(()=>e.filter(p=>p.id<he.MAX_MARKER_ID),[e]),W=u.useCallback(p=>S=>{const{lat:E,lng:U}=S.target.getLatLng();o(p,{lat:E,lng:U}),j&&j(p,E,U)},[o,j]),B=u.useCallback(p=>(w.current[p]||(w.current[p]=be.createRef()),w.current[p]),[]),Z=u.useCallback(p=>S=>{g&&(T.DomEvent.preventDefault(S),k({isOpen:!0,position:S.latlng,marker:p,timestamp:Date.now()}))},[g]),se=u.useCallback(async(p,S)=>{var oe,d;if(!e.some(y=>y.id===p)){O(`Cannot assign to marker ${p} - marker does not exist`);return}const U=G.filter(y=>y.marker_id===p);if(U.length>0){const y=(oe=X.find(Q=>Q.company_id===S))==null?void 0:oe.company,_=(y==null?void 0:y.name)||"this company",M=e.find(Q=>Q.id===p),re=(M==null?void 0:M.glyph)||(M==null?void 0:M.id)||"this booth";let ge;if(U.length===1){const Q=((d=U[0].company)==null?void 0:d.name)||"another company";ge=`Booth ${re} is already assigned to ${Q}.

Assign ${_} as an additional company for this booth?`}else{const Q=U.map(ce=>{var ue;return(ue=ce.company)==null?void 0:ue.name}).filter(Boolean).join(", ");ge=`Booth ${re} is already assigned to ${U.length} companies: ${Q}.

Assign ${_} as another company for this booth?`}if(!await Y({title:"Multiple Assignments",message:ge,confirmText:"Assign",variant:"warning"}))return}te(!0);try{await h(p,S)}catch(y){console.error("Error assigning company:",y)}finally{te(!1)}},[h,G,X,e,O,Y]),H=u.useCallback(async(p,S)=>{te(!0);try{await F(p,S)}catch(E){console.error("Error unassigning company:",E)}finally{te(!1)}},[F]),V=u.useRef({}),le=u.useCallback(p=>{const S=`${p.id}-${n?"draggable":"static"}-${g?"admin":"visitor"}`;if(!V.current[S]){const E={popupopen:U=>U.target.closeTooltip()};n&&(E.dragend=W(p.id)),g&&(E.contextmenu=Z(p)),V.current[S]=E}return V.current[S]},[n,W,g,Z]),ne=u.useRef({}),Le=u.useCallback((p,S)=>{var y,_,M;const E=p.companyId?D(p.companyId):!1,U=xt(a),oe=g&&!x,d=`${p.id}-${p.iconUrl||""}-${p.glyph||""}-${p.glyphColor||""}-${S}-${E}-${U}-${JSON.stringify(p.iconSize||ee.SIZE)}-${p.glyphSize}-${oe}-${((y=z.assigned)==null?void 0:y.iconUrl)||""}-${((_=z.unassigned)==null?void 0:_.iconUrl)||""}-${((M=p.assignments)==null?void 0:M.length)||0}`;return ne.current[d]||(ne.current[d]=wt(p,S,E,a,oe,z.assigned,z.unassigned)),ne.current[d]},[D,a,g,x,z]);return u.useEffect(()=>{const p=new Set(R.map(S=>S.id));Object.keys(V.current).forEach(S=>{const E=parseInt(S.split("-")[0],10);p.has(E)||delete V.current[S]}),Object.keys(ne.current).forEach(S=>{const E=parseInt(S.split("-")[0],10);p.has(E)||delete ne.current[S]})},[R]),u.useEffect(()=>{if(!m)return;const S=setTimeout(()=>{const E=w.current[m];E!=null&&E.current&&(E.current.openPopup(),s&&s())},1200);return()=>clearTimeout(S)},[m,R,s]),l?null:t.jsxs(t.Fragment,{children:[t.jsx(it,{chunkedLoading:he.CHUNKED_LOADING,showCoverageOnHover:he.SHOW_COVERAGE_ON_HOVER,spiderfyOnMaxZoom:he.SPIDERFY_ON_MAX_ZOOM,removeOutsideVisibleBounds:he.REMOVE_OUTSIDE_VISIBLE_BOUNDS,disableClusteringAtZoom:he.DISABLE_CLUSTERING_AT_ZOOM,maxClusterRadius:he.MAX_CLUSTER_RADIUS,iconCreateFunction:r,children:R.map(p=>{const S=(N==null?void 0:N.id)===p.id,E=Le(p,S),U=n(p),oe=Lt(p);return t.jsx(vt,{marker:p,isDraggable:U,icon:E,eventHandlers:le(p),markerRef:B(p.id),isMobile:A,organizationLogo:C,onMarkerSelect:$},oe)})},"cluster-group"),K.isOpen&&K.marker&&t.jsx(Ae,{position:K.position,onClose:()=>k({isOpen:!1,position:null,marker:null}),closeButton:!0,closeOnClick:!0,closeOnEscapeKey:!0,autoClose:!1,maxWidth:300,minWidth:250,children:t.jsx(We,{marker:K.marker,subscriptions:X,assignments:G,onAssign:se,onUnassign:H,isLoading:ae,onClose:()=>k({isOpen:!1,position:null,marker:null})})},`context-${K.marker.id}-${K.timestamp||Date.now()}`),A&&N&&t.jsx(Ge,{marker:N,onClose:()=>$(null)})]})}ze.propTypes={safeMarkers:f.arrayOf(f.shape({id:f.number.isRequired,lat:f.number.isRequired,lng:f.number.isRequired,type:f.string,iconUrl:f.string,iconSize:f.arrayOf(f.number),glyph:f.string,glyphColor:f.string,glyphSize:f.oneOfType([f.string,f.number]),glyphAnchor:f.arrayOf(f.number),prefix:f.string,name:f.string,logo:f.string,website:f.string,info:f.string,companyId:f.number})).isRequired,updateMarker:f.func.isRequired,isMarkerDraggable:f.func.isRequired,iconCreateFunction:f.func.isRequired,selectedYear:f.number,isAdminView:f.bool,selectedMarkerId:f.number,onMarkerSelect:f.func,focusMarkerId:f.number,onFocusHandled:f.func,currentZoom:f.number,applyVisitorSizing:f.bool,onMarkerDrag:f.func};ze.defaultProps={selectedYear:new Date().getFullYear(),isAdminView:!1,selectedMarkerId:null,onMarkerSelect:null,focusMarkerId:null,onFocusHandled:null,currentZoom:17,applyVisitorSizing:!1};function _t(e){e&&e.zoomIn()}function jt(e){e&&e.zoomOut()}function Et(e,o,n){e&&e.setView(o,n)}const Nt={appearance:"none",WebkitAppearance:"none",MozAppearance:"none",outline:"none",background:"#fff",border:"2px solid #1976d2",borderRadius:4,width:18,height:18,display:"inline-block",position:"relative",marginRight:8,cursor:"pointer",verticalAlign:"middle"};function It({mapInstance:e,mapCenter:o,mapZoom:n,searchControlRef:r,isAdminView:c,showLayersMenu:g,setShowLayersMenu:b,activeLayer:i,setActiveLayer:m,showRectanglesAndHandles:s,setShowRectanglesAndHandles:a,MAP_LAYERS:x}){const j=()=>_t(e),w=()=>jt(e),A=()=>Et(e,o,n);return t.jsxs("div",{className:"map-controls-print-hide",style:{position:"absolute",top:10,right:10,zIndex:1e3,display:"flex",flexDirection:"column",gap:"10px"},children:[t.jsxs("button",{onClick:A,"aria-label":"Home",className:"bg-white rounded-full shadow p-2 flex items-center justify-center",style:{width:44,height:44},children:[t.jsx(pt,{size:28,color:"#1976d2","aria-hidden":"true"}),t.jsx("span",{className:"sr-only",children:"Home"})]}),t.jsxs("button",{onClick:j,"aria-label":"Zoom in",className:"bg-white rounded-full shadow p-2 mb-2 flex items-center justify-center",style:{width:44,height:44},children:[t.jsx(ft,{size:28,color:"#1976d2","aria-hidden":"true"}),t.jsx("span",{className:"sr-only",children:"Zoom in"})]}),t.jsxs("button",{onClick:w,"aria-label":"Zoom out",className:"bg-white rounded-full shadow p-2 mb-2 flex items-center justify-center",style:{width:44,height:44},children:[t.jsx(yt,{size:28,color:"#1976d2","aria-hidden":"true"}),t.jsx("span",{className:"sr-only",children:"Zoom out"})]}),!1,c&&t.jsxs("div",{style:{position:"relative"},children:[t.jsxs("button",{"aria-label":"Map layers",className:"bg-white rounded-full shadow p-2 flex items-center justify-center mt-0 hover:bg-gray-100 focus:outline-none",style:{width:44,height:44},onClick:()=>b(v=>!v),children:[t.jsx(ie,{path:tt,size:1.2,color:"#1976d2"}),t.jsx("span",{className:"sr-only",children:"Map layers"})]}),g&&t.jsxs("div",{className:"absolute right-0 mt-2 bg-white rounded shadow-lg border z-50",style:{minWidth:200,padding:8,color:"#1976d2"},role:"menu","aria-label":"Layer selection",children:[t.jsx("div",{className:"font-semibold mb-2",children:"Base Layers"}),x.map(v=>t.jsx("button",{className:`w-full text-left px-2 py-1 rounded hover:bg-blue-50 ${i===v.key?"bg-blue-50 font-bold":""}`,onClick:()=>m(v.key),role:"menuitem",style:{color:"#1976d2"},children:v.name},v.key)),t.jsx("div",{className:"font-semibold mt-4 mb-2",children:"Map Features"}),t.jsxs("label",{className:"flex items-center px-2 py-1 cursor-pointer hover:bg-blue-50 rounded",style:{color:"#1976d2"},children:[t.jsx("input",{type:"checkbox",checked:s,onChange:v=>a(v.target.checked),style:Nt}),t.jsx("span",{style:{position:"relative",left:-26,width:18,height:18,pointerEvents:"none",display:s?"inline-block":"none"},children:t.jsx("svg",{width:"18",height:"18",viewBox:"0 0 18 18",style:{position:"absolute",top:0,left:0},children:t.jsx("polyline",{points:"4,9 8,13 14,5",stroke:"#1976d2",strokeWidth:"2.5",fill:"none"})})}),t.jsx("span",{style:{marginLeft:s?-8:0},children:"Booth Surface"})]})]})]})]})}function qe({isActive:e,onClick:o,favoritesCount:n,isAdminView:r}){return t.jsx("button",{onClick:o,className:`
        rounded-full shadow-md
        flex items-center justify-center
        transition-all duration-200
        ${e?"bg-yellow-100 border-2 border-yellow-300":"bg-white border-2 border-transparent hover:bg-gray-50"}
      `,style:{position:"absolute",top:r?"110px":"60px",left:"10px",zIndex:1002,width:"44px",height:"44px"},title:e?`Showing ${n} favorite${n!==1?"s":""} only`:`Show ${n} favorite${n!==1?"s":""} only`,"aria-label":e?"Show all exhibitors":"Show favorites only","aria-pressed":e,children:t.jsx(ie,{path:nt,size:1,className:e?"text-yellow-600":"text-gray-400"})})}qe.propTypes={isActive:f.bool.isRequired,onClick:f.func.isRequired,favoritesCount:f.number.isRequired};function Ot(e){return function(n){const r=rt(e),c="/Map".endsWith("/")?"/Map":"/Map/";return Ie({iconUrl:`${c}assets/icons/glyph-marker-icon-orange.svg`,iconSize:[25,41],iconAnchor:[25,41],glyph:`<div style='display:flex;align-items:center;justify-content:center;width:100%;height:100%;'>
  <img src='${r}' alt='logo' style='width:20px;height:20px;object-fit:contain;display:block;margin:auto;position:relative;left:1px;top:10px;' />
      </div>`,glyphColor:"white",glyphSize:"20px",glyphAnchor:[-1,-7],className:"custom-cluster-icon"})}}function Ct(e){return e.angle||0}function de(e,o,n){const r=n*Math.PI/180,c=e*Math.cos(r)-o*Math.sin(r),g=e*Math.sin(r)+o*Math.cos(r);return[c,g]}function ye(e){return e/111320}function me(e,o){return e/(40075e3*Math.cos(o*Math.PI/180)/360)}function zt(e){return e*111320}function Tt(e,o){return e*(40075e3*Math.cos(o*Math.PI/180)/360)}function Ft({mapInstance:e,markers:o,rectangleSize:n,isAdminView:r,showRectanglesAndHandles:c,updateMarker:g,rectangleLayerRef:b}){if(!e)return;b.current||(b.current=T.layerGroup(),b.current.addTo(e));const i=b.current;i._markerLayers||(i._markerLayers={}),Object.keys(i._markerLayers).forEach(m=>{o.find(s=>s.id===m)||(i.removeLayer(i._markerLayers[m].rectangle),i.removeLayer(i._markerLayers[m].handle),delete i._markerLayers[m])}),o.forEach(m=>{if(m.lat&&m.lng){const s=T.latLng(m.lat,m.lng),a=Array.isArray(m.rectangle)&&m.rectangle.length===2?m.rectangle:n,x=Number(a[0])/2,j=Number(a[1])/2,w=Ct(m),A="#1976d2",v=[de(-x,-j,w),de(x,-j,w),de(x,j,w),de(-x,j,w)],I=v.map(([C,l])=>T.latLng(s.lat+ye(l),s.lng+me(C,s.lat)));let N,$;if(i._markerLayers[m.id]){N=i._markerLayers[m.id].rectangle,N.setLatLngs(I),$=i._markerLayers[m.id].handle;const[C,l]=v[2],P=T.latLng(s.lat+ye(l),s.lng+me(C,s.lat));$.setLatLng(P)}else{N=T.polygon(I,{color:A,weight:1});const[C,l]=v[2],P=T.latLng(s.lat+ye(l),s.lng+me(C,s.lat));let D;if(r&&!m.coreLocked){const K=T.divIcon({className:"rotation-handle-icon",html:'<div style="width:8px;height:8px;background:#1976d2;border-radius:50%;"></div>',iconSize:[8,8],iconAnchor:[4,4]});D=T.marker(P,{icon:K,draggable:!0,interactive:!0,keyboard:!0,title:"Drag to rotate"}),D.on("dragstart",function(){e&&e.dragging.disable()});let k=w;D.on("drag",function(ae){const te=ae.target.getLatLng(),X=Tt(te.lng-s.lng,s.lat),G=zt(te.lat-s.lat);let F=Math.atan2(G,X)*180/Math.PI;F<0&&(F+=360),k=F;const z=[de(-x,-j,k),de(x,-j,k),de(x,j,k),de(-x,j,k)],J=z.map(([W,B])=>T.latLng(s.lat+ye(B),s.lng+me(W,s.lat)));N.setLatLngs(J);const[Y,O]=z[2],R=T.latLng(s.lat+ye(O),s.lng+me(Y,s.lat));D.setLatLng(R)}),D.on("dragend",function(){e&&e.dragging.enable(),g(m.id,{angle:k})})}else{const K=T.divIcon({className:"rotation-handle-icon",html:'<div style="width:8px;height:8px;background:#1976d2;border-radius:50%;opacity:0.5;"></div>',iconSize:[8,8],iconAnchor:[4,4]});D=T.marker(P,{icon:K,draggable:!1,interactive:!1,keyboard:!1,title:"Locked"})}i.addLayer(N),i.addLayer(D),i._markerLayers[m.id]={rectangle:N,handle:D}}}}),Object.values(i._markerLayers).forEach(({rectangle:m,handle:s})=>{c?(i.addLayer(m),i.addLayer(s)):(i.removeLayer(m),i.removeLayer(s))})}const Ke=e=>[e.name,e.glyph,e.label].filter(Boolean).join(" | "),Pe=(e,o)=>o&&e&&e.coreLocked===!1;function Pt(){const e=u.useCallback(n=>{},[]),o=u.useCallback(n=>{},[]);return{trackMarkerView:e,trackMapInteraction:o}}function Dt(e,o,n={}){const r=u.useRef(null),[c,g]=u.useState(null),b=u.useMemo(()=>JSON.stringify(n),[n]);return u.useEffect(()=>{if(!e)return;if(o&&typeof o.addLayer=="function"){g(o);return}const i=T.layerGroup();(Array.isArray(o)?o:[]).forEach(s=>{if(s&&s.lat&&s.lng){const a=Ke(s),x=T.marker([s.lat,s.lng],{opacity:0,interactive:!1});x.feature={type:"Feature",properties:{searchText:a}},x.bindPopup(s.name||s.label||""),i.addLayer(x)}}),g(i)},[e,o]),u.useEffect(()=>{if(!e||!c)return;const i={layer:c,propertyName:"searchText",initial:!1,zoom:q.SEARCH_ZOOM,marker:{icon:!1,animate:!0,circle:{radius:8,color:"#d32f2fff",weight:2,fillOpacity:.15}},textPlaceholder:"Search for name or booth...",position:"topleft"},m=Object.assign({},i,n||{});n&&n.marker&&(m.marker=Object.assign({},i.marker,n.marker),n.marker.circle&&(m.marker.circle=Object.assign({},i.marker.circle,n.marker.circle)));const s=new T.Control.Search(m);return e.addControl(s),r.current=s,s.on("search:locationfound",a=>{var x;if((x=a==null?void 0:a.layer)!=null&&x.getLatLng){const j=a.layer.getLatLng();e.flyTo(j,m.zoom,{animate:!0});const w=()=>{try{s._markerSearch?e.hasLayer&&e.hasLayer(s._markerSearch)?e.removeLayer(s._markerSearch):typeof s._markerSearch.remove=="function"&&s._markerSearch.remove():s._marker&&(e.hasLayer&&e.hasLayer(s._marker)?e.removeLayer(s._marker):typeof s._marker.remove=="function"&&s._marker.remove())}catch{}},A=()=>w();e.on&&e.on("zoomstart",A),s._input&&s._input.blur(),s.hideAlert&&s.hideAlert(),s.collapse&&s.collapse()}}),()=>{try{e&&typeof e.off=="function"&&e.off("zoomstart",zoomStartHandler)}catch{}e&&s&&(e.removeControl(s),r.current=null)}},[e,c,b,n]),r}function Rt(e){const{settings:o,loading:n}=ct(),{settings:r,loading:c}=mt(e),g=n||c;return{MAP_CONFIG:u.useMemo(()=>{if(n)return q;const i=r||o;return{DEFAULT_POSITION:[(i==null?void 0:i.map_center_lat)??q.DEFAULT_POSITION[0],(i==null?void 0:i.map_center_lng)??q.DEFAULT_POSITION[1]],ADMIN_DEFAULT_POSITION:q.ADMIN_DEFAULT_POSITION,DEFAULT_ZOOM:(i==null?void 0:i.map_default_zoom)??q.DEFAULT_ZOOM,ADMIN_DEFAULT_ZOOM:q.ADMIN_DEFAULT_ZOOM,MIN_ZOOM:(i==null?void 0:i.map_min_zoom)??q.MIN_ZOOM,MAX_ZOOM:(i==null?void 0:i.map_max_zoom)??q.MAX_ZOOM,SEARCH_ZOOM:(i==null?void 0:i.map_search_zoom)??q.SEARCH_ZOOM,ZOOM_DELTA:q.ZOOM_DELTA,ZOOM_SNAP:q.ZOOM_SNAP,RECTANGLE_SIZE:q.RECTANGLE_SIZE,MINIMAP:q.MINIMAP}},[o,r,n]),MAP_LAYERS:dt,BRANDING_CONFIG:ut,loading:g,usingEventSettings:!!r}}const Zt=u.lazy(()=>Qe(()=>import("./AdminMarkerPlacement-388f97c3.js"),["assets/AdminMarkerPlacement-388f97c3.js","assets/vendor-react-505adfae.js","assets/vendor-3a7855fa.js","assets/vendor-4b398481.css","assets/vendor-i18n-2e1fa53c.js"]));delete T.Icon.Default.prototype._getIconUrl;T.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});function Te({isAdminView:e,markersState:o,updateMarker:n,selectedYear:r,selectedMarkerId:c,onMarkerSelect:g,previewUseVisitorSizing:b=!1,editMode:i=!1,onMarkerDrag:m=null,onMapReady:s=null}){const{MAP_CONFIG:a,MAP_LAYERS:x}=Rt(r),[j,w]=u.useState({}),[A,v]=u.useState(!1),[I,N]=u.useState(x[0].key),[$,C]=u.useState(!1),[l,P]=u.useState(null),[D,K]=u.useState(null),{organizationLogo:k}=Se(),[ae,te]=Je(),X=`exhibitors_showFavoritesOnly_${r}`,[G,h]=u.useState(()=>{try{return localStorage.getItem(X)==="true"}catch{return!1}}),[F,z]=u.useState(a.DEFAULT_ZOOM),[J,Y]=u.useState(null);let O=null;try{O=Me()}catch{}const R=be.useMemo(()=>(O==null?void 0:O.favorites)||[],[O==null?void 0:O.favorites]),W=be.useMemo(()=>O!=null&&O.isFavorite?O.isFavorite:()=>!1,[O]),{t:B}=Ne(),Z=Dt(l,D,{textPlaceholder:B("map.searchPlaceholder")}),se=!!(Z&&Z.current),H=u.useRef(null),V=u.useRef(!1),[le,ne]=u.useState(null),Le=u.useMemo(()=>Ot(k),[k]),p=Oe();Pt();const S=u.useMemo(()=>Array.isArray(o)?o:[],[o]),E=u.useMemo(()=>!G||R.length===0?S:S.filter(d=>d.companyId&&W(d.companyId)),[S,G,R,W]);u.useEffect(()=>{S.forEach(d=>{if(d.logo){const y=new window.Image,_=je(d.logo);_&&"srcSet"in _?(y.src=_.src,y.srcset=_.srcSet):y.src=Ee(d.logo)}})},[S]),u.useEffect(()=>{try{localStorage.setItem(X,G?"true":"false")}catch{}},[X,G]),u.useEffect(()=>{try{const d=localStorage.getItem(X);h(d==="true")}catch{}},[X]),u.useEffect(()=>{if(R&&R.length===0&&G){try{localStorage.setItem(X,"false")}catch{}h(!1)}},[R,X,G]),u.useEffect(()=>{if(!l)return;let d=null;const y=()=>{d&&cancelAnimationFrame(d),d=requestAnimationFrame(()=>{try{const M=l.getZoom();Y(M)}catch{}})},_=()=>{const M=l.getZoom();Y(null),z(M);try{}catch{}};return z(l.getZoom()),l.on("zoom",y),l.on("zoomanim",y),l.on("zoomend",_),()=>{d&&cancelAnimationFrame(d),l.off("zoom",y),l.off("zoomanim",y),l.off("zoomend",_)}},[l]),u.useEffect(()=>{l&&Ft({mapInstance:l,markers:S,rectangleSize:a.RECTANGLE_SIZE,isAdminView:e,showRectanglesAndHandles:$,updateMarker:n,rectangleLayerRef:H})},[l,S,e,$,n,a.RECTANGLE_SIZE]),u.useEffect(()=>{if(!l)return;const d=T.layerGroup();S.forEach(y=>{if(y.lat&&y.lng){const _=Ke(y),M=T.marker([y.lat,y.lng],{opacity:0,interactive:!1});M.feature={type:"Feature",properties:{searchText:_}},M.bindPopup(y.name||y.label||""),M._markerId=y.id,d.addLayer(M)}}),K(d)},[l,S]),u.useEffect(()=>{const d=Z&&Z.current;if(!l||!D||!d)return;const y=_=>{if(_!=null&&_.layer){const M=_.layer._markerId;M&&setTimeout(()=>ne(M),800),d._input&&d._input.blur(),d.hideAlert&&d.hideAlert(),d.collapse&&d.collapse()}};return d.on("search:locationfound",y),()=>{d.off("search:locationfound",y)}},[l,D,Z,se]),u.useEffect(()=>{if(l&&!l._minimapControl){const d=T.tileLayer(x[0].url,{attribution:"",minZoom:0,maxZoom:16}),y=new T.Control.MiniMap(d,{position:"bottomright",width:a.MINIMAP.WIDTH,height:a.MINIMAP.HEIGHT,zoomLevelFixed:a.MINIMAP.ZOOM_LEVEL,toggleDisplay:!0,centerFixed:a.DEFAULT_POSITION,aimingRectOptions:{color:a.MINIMAP.AIMING_COLOR,weight:2,opacity:.9,fillOpacity:.1,fill:!0},shadowRectOptions:{color:a.MINIMAP.SHADOW_COLOR,weight:1,opacity:.5,fillOpacity:.05,fill:!0},strings:{hideText:"Hide MiniMap",showText:"Show MiniMap"}});y.addTo(l),l._minimapControl=y}},[l,x,a.MINIMAP,a.DEFAULT_POSITION]),u.useEffect(()=>{if(l&&!l._browserPrintInitialized)if(window.L&&window.L.BrowserPrint&&window.L.BrowserPrint.Mode&&window.L.browserPrint){const d=window.L.BrowserPrint.Mode,y=[d.Landscape("A4",{title:"Current view — landscape"}),d.Portrait("A4",{title:"A4 — Portrait"}),d.Landscape("A4",{title:"A4 — Landscape"}),d.Auto("A4",{title:"Auto fit"}),d.Custom("A4",{title:"Select area",customArea:!0})];try{const _=window.L.browserPrint(l,{printModes:y,closePopupsOnPrint:!0});l.printControl={browserPrint:_,options:{printModes:y}};try{if(window.L&&window.L.BrowserPrint&&window.L.BrowserPrint.Event){const M=window.L.BrowserPrint.Event,re=()=>{var pe;try{typeof l.closePopup=="function"&&l.closePopup(),l.eachLayer(ce=>{try{ce.closePopup&&ce.closePopup(),ce.closeTooltip&&ce.closeTooltip()}catch{}});const Q=(pe=l.getContainer)==null?void 0:pe.call(l);Q&&(Q.querySelectorAll(".leaflet-control, .leaflet-top, .leaflet-bottom, .map-controls-print-hide, .leaflet-control-minimap, .leaflet-control-zoom, .leaflet-control-layers, .leaflet-control-attribution").forEach(ue=>ue.classList.add("print-hide")),l._browserPrintHidden=!0)}catch{}},ge=()=>{var pe;try{if(l._browserPrintHidden){const Q=(pe=l.getContainer)==null?void 0:pe.call(l);Q&&Q.querySelectorAll(".print-hide").forEach(ue=>ue.classList.remove("print-hide")),l._browserPrintHidden=!1}}catch{}};l.on(M.PrintStart,re),l.on(M.PrintEnd,ge),l.on(M.PrintCancel,ge)}}catch(M){console.warn("Failed to attach BrowserPrint lifecycle listeners",M)}l._browserPrintInitialized=!0}catch(_){console.warn("Failed to initialize L.browserPrint backend:",_)}}else console.warn("BrowserPrint not available, print functionality will fallback to snapshot")},[l]),u.useEffect(()=>{if(!l||!S.length||V.current)return;const d=ae.get("focus");if(d){const y=parseInt(d,10),_=S.find(M=>M.id===y);_&&_.lat&&_.lng&&(setTimeout(()=>{l.flyTo([_.lat,_.lng],a.SEARCH_ZOOM,{animate:!0,duration:1}),ne(y)},300),V.current=!0,te({},{replace:!0}))}},[l,S,ae,te,a.SEARCH_ZOOM]);const U=d=>{const y=(d==null?void 0:d.target)||d;if(P(y),typeof s=="function")try{s(y)}catch{}setTimeout(()=>{y&&(y.invalidateSize(),console.log("Map resized and tiles should be loaded"))},100)};u.useEffect(()=>{if(!l)return;let d=null;const y=()=>{try{l._invalidateTimeout&&clearTimeout(l._invalidateTimeout),l._invalidateTimeout=setTimeout(()=>{try{l.invalidateSize()}catch{}l._invalidateTimeout=null},120)}catch{}};try{const M=l.getContainer&&l.getContainer();if(M&&typeof ResizeObserver<"u"){const re=new ResizeObserver(()=>y());re.observe(M),d=()=>re.disconnect()}}catch{}const _=()=>y();return window.addEventListener("resize",_),()=>{try{window.removeEventListener("resize",_)}catch{}d&&d()}},[l]);const oe=e?{height:"100%",width:"100%",minHeight:"400px",position:"relative",touchAction:"pan-x pan-y",overflow:"hidden",zIndex:1}:{height:"100svh",width:"100vw",position:"fixed",inset:0,zIndex:0,touchAction:"pan-x pan-y",overflow:"hidden"};return t.jsxs("div",{style:oe,tabIndex:0,"aria-label":"Event Map",role:"region",children:[t.jsx(It,{mapInstance:l,mapCenter:a.DEFAULT_POSITION,mapZoom:a.DEFAULT_ZOOM,searchControlRef:Z,isAdminView:e,showLayersMenu:A,setShowLayersMenu:v,activeLayer:I,setActiveLayer:N,showRectanglesAndHandles:$,setShowRectanglesAndHandles:C,MAP_LAYERS:x,markersState:S}),e&&t.jsx(u.Suspense,{fallback:null,children:t.jsx(Zt,{mapInstance:l,isAdminView:e,updateMarker:n})}),R.length>0&&t.jsx(qe,{isActive:G,onClick:()=>h(!G),favoritesCount:R.length,isAdminView:e}),t.jsx("div",{id:"map-container",className:e?"w-full h-full":"fixed inset-0 w-full h-full",style:{zIndex:1,height:e?"100%":"100svh",touchAction:"pan-x pan-y",overflow:"hidden"},"aria-label":B("map.ariaLabel"),children:t.jsxs(at,{center:e?a.ADMIN_DEFAULT_POSITION:a.DEFAULT_POSITION,zoom:e?a.ADMIN_DEFAULT_ZOOM:a.DEFAULT_ZOOM,minZoom:a.MIN_ZOOM,maxZoom:a.MAX_ZOOM,zoomDelta:a.ZOOM_DELTA,zoomSnap:a.ZOOM_SNAP,zoomControl:!1,style:{width:e?"100%":"100vw",height:e?"100%":"100svh",minHeight:e?"400px":"100svh"},className:"focus:outline-none focus:ring-2 focus:ring-primary",whenReady:U,attributionControl:!1,children:[x.filter(d=>d.key===I).map(d=>t.jsx(lt,{attribution:d.attribution,url:d.url,crossOrigin:"anonymous",maxZoom:a.MAX_ZOOM},d.key)),t.jsx(ze,{safeMarkers:E,infoButtonToggled:j,setInfoButtonToggled:w,isMobile:p,updateMarker:n,isMarkerDraggable:d=>Pe(d,e)||i&&d.id===c,iconCreateFunction:Le,selectedYear:r,isAdminView:e,applyVisitorSizing:b,selectedMarkerId:c,onMarkerSelect:g,focusMarkerId:le,onFocusHandled:()=>ne(null),currentZoom:F,zoomAnimating:J,onMarkerDrag:m}),t.jsx(Ce,{safeMarkers:S,infoButtonToggled:j,setInfoButtonToggled:w,isMobile:p,updateMarker:n,isMarkerDraggable:d=>Pe(d,e)||i&&d.id===c,selectedMarkerId:c,onMarkerSelect:g,isAdminView:e,applyVisitorSizing:b,selectedYear:r,currentZoom:F,zoomAnimating:J,onMarkerDrag:m})]})})]})}Te.propTypes={isAdminView:f.bool,previewUseVisitorSizing:f.bool,markersState:f.array,updateMarker:f.func.isRequired,selectedYear:f.number,selectedMarkerId:f.number,onMarkerSelect:f.func,editMode:f.bool,onMarkerDrag:f.func};Te.defaultProps={isAdminView:!1,markersState:[],selectedYear:new Date().getFullYear(),selectedMarkerId:null,onMarkerSelect:null,previewUseVisitorSizing:!1,editMode:!1,onMarkerDrag:null};const Qt=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{Te as E,Qt as a,xe as g};
