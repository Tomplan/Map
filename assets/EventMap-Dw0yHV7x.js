const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B-Zf2SX2.js","assets/index-q0T7srca.css"])))=>i.map(i=>d[i]);
import{r as m,a as ve,g as we,b as Le,l as H,c as je,R as E,L as Se,d as Ce,e as G,f as Me,h as de,i as Ne,w as Ee,j as C,k as r,m as ue,n as J,M as Ie,I as ze,o as Oe,_ as Pe,p as Ae,q as _e}from"./index-B-Zf2SX2.js";const Te=(e,t,n,i)=>{const l=[n,{code:t,...i||{}}];if(e?.services?.logger?.forward)return e.services.logger.forward(l,"warn","react-i18next::",!0);A(l[0])&&(l[0]=`react-i18next:: ${l[0]}`),e?.services?.logger?.warn?e.services.logger.warn(...l):console?.warn&&console.warn(...l)},ne={},fe=(e,t,n,i)=>{A(n)&&ne[n]||(A(n)&&(ne[n]=new Date),Te(e,t,n,i))},he=(e,t)=>()=>{if(e.isInitialized)t();else{const n=()=>{setTimeout(()=>{e.off("initialized",n)},0),t()};e.on("initialized",n)}},V=(e,t,n)=>{e.loadNamespaces(t,he(e,n))},oe=(e,t,n,i)=>{if(A(n)&&(n=[n]),e.options.preload&&e.options.preload.indexOf(t)>-1)return V(e,n,i);n.forEach(l=>{e.options.ns.indexOf(l)<0&&e.options.ns.push(l)}),e.loadLanguages(t,he(e,i))},Re=(e,t,n={})=>!t.languages||!t.languages.length?(fe(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0):t.hasLoadedNamespace(e,{lng:n.lng,precheck:(i,l)=>{if(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&i.services.backendConnector.backend&&i.isLanguageChangingTo&&!l(i.isLanguageChangingTo,e))return!1}}),A=e=>typeof e=="string",ke=e=>typeof e=="object"&&e!==null,He=m.createContext();class De{constructor(){this.usedNamespaces={}}addUsedNamespaces(t){t.forEach(n=>{this.usedNamespaces[n]||(this.usedNamespaces[n]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}var X={exports:{}},Y={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ie;function $e(){if(ie)return Y;ie=1;var e=ve();function t(f,u){return f===u&&(f!==0||1/f===1/u)||f!==f&&u!==u}var n=typeof Object.is=="function"?Object.is:t,i=e.useState,l=e.useEffect,c=e.useLayoutEffect,s=e.useDebugValue;function d(f,u){var b=u(),y=i({inst:{value:b,getSnapshot:u}}),v=y[0].inst,p=y[1];return c(function(){v.value=b,v.getSnapshot=u,o(v)&&p({inst:v})},[f,b,u]),l(function(){return o(v)&&p({inst:v}),f(function(){o(v)&&p({inst:v})})},[f]),s(b),b}function o(f){var u=f.getSnapshot;f=f.value;try{var b=u();return!n(f,b)}catch{return!0}}function a(f,u){return u()}var x=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?a:d;return Y.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:x,Y}var ae;function We(){return ae||(ae=1,X.exports=$e()),X.exports}var Ue=We();const Fe=(e,t)=>A(t)?t:ke(t)&&A(t.defaultValue)?t.defaultValue:Array.isArray(e)?e[e.length-1]:e,Be={t:Fe,ready:!1},Ge=()=>()=>{},ge=(e,t={})=>{const{i18n:n}=t,{i18n:i,defaultNS:l}=m.useContext(He)||{},c=n||i||we();c&&!c.reportNamespaces&&(c.reportNamespaces=new De),c||fe(c,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const s=m.useMemo(()=>({...Le(),...c?.options?.react,...t}),[c,t]),{useSuspense:d,keyPrefix:o}=s,a=m.useMemo(()=>{const g=l||c?.options?.defaultNS;return A(g)?[g]:g||["translation"]},[e,l,c]);c?.reportNamespaces?.addUsedNamespaces?.(a);const x=m.useCallback(g=>{if(!c)return Ge;const{bindI18n:w,bindI18nStore:j}=s;return w&&c.on(w,g),j&&c.store.on(j,g),()=>{w&&w.split(" ").forEach(M=>c.off(M,g)),j&&j.split(" ").forEach(M=>c.store.off(M,g))}},[c,s]),f=m.useRef(),u=m.useCallback(()=>{if(!c)return Be;const g=!!(c.isInitialized||c.initializedStoreOnce)&&a.every(z=>Re(z,c,s)),w=c.getFixedT(t.lng||c.language,s.nsMode==="fallback"?a:a[0],o),j=f.current;if(j&&j.ready===g&&j.lng===(t.lng||c.language)&&j.keyPrefix===o)return j;const M={t:w,ready:g,lng:t.lng||c.language,keyPrefix:o};return f.current=M,M},[c,a,o,s,t.lng]),[b,y]=m.useState(0),{t:v,ready:p}=Ue.useSyncExternalStore(x,u,u);m.useEffect(()=>{if(c&&!p&&!d){const g=()=>y(w=>w+1);t.lng?oe(c,t.lng,a,g):V(c,a,g)}},[c,t.lng,a,p,d,b]);const L=c||{},N=m.useMemo(()=>{const g=[v,L,p];return g.t=v,g.i18n=L,g.ready=p,g},[v,L,p]);if(c&&d&&!p)throw new Promise(g=>{const w=()=>g();t.lng?oe(c,t.lng,a,w):V(c,a,w)});return N};function Ze(e,t,n){const{opacity:i,zIndex:l}=t;i!=null&&i!==n.opacity&&e.setOpacity(i),l!=null&&l!==n.zIndex&&e.setZIndex(l)}function qe({bounds:e,boundsOptions:t,center:n,children:i,className:l,id:c,placeholder:s,style:d,whenReady:o,zoom:a,...x},f){const[u]=m.useState({className:l,id:c,style:d}),[b,y]=m.useState(null),v=m.useRef(void 0);m.useImperativeHandle(f,()=>b?.map??null,[b]);const p=m.useCallback(N=>{if(N!==null&&!v.current){const g=new H.Map(N,x);v.current=g,n!=null&&a!=null?g.setView(n,a):e!=null&&g.fitBounds(e,t),o!=null&&g.whenReady(o),y(je(g))}},[]);m.useEffect(()=>()=>{b?.map.remove()},[b]);const L=b?E.createElement(Se,{value:b},i):s??null;return E.createElement("div",{...u,ref:p},L)}const Xe=m.forwardRef(qe),pe=Ce(function({position:t,...n},i){const l=new H.Marker(t,n);return G(l,Me(i,{overlayContainer:l}))},function(t,n,i){n.position!==i.position&&t.setLatLng(n.position),n.icon!=null&&n.icon!==i.icon&&t.setIcon(n.icon),n.zIndexOffset!=null&&n.zIndexOffset!==i.zIndexOffset&&t.setZIndexOffset(n.zIndexOffset),n.opacity!=null&&n.opacity!==i.opacity&&t.setOpacity(n.opacity),t.dragging!=null&&n.draggable!==i.draggable&&(n.draggable===!0?t.dragging.enable():t.dragging.disable())}),re=de(function(t,n){const i=new H.Popup(t,n.overlayContainer);return G(i,n)},function(t,n,{position:i},l){m.useEffect(function(){const{instance:s}=t;function d(a){a.popup===s&&(s.update(),l(!0))}function o(a){a.popup===s&&l(!1)}return n.map.on({popupopen:d,popupclose:o}),n.overlayContainer==null?(i!=null&&s.setLatLng(i),s.openOn(n.map)):n.overlayContainer.bindPopup(s),function(){n.map.off({popupopen:d,popupclose:o}),n.overlayContainer?.unbindPopup(),n.map.removeLayer(s)}},[t,n,l,i])}),Ye=Ne(function({url:t,...n},i){const l=new H.TileLayer(t,Ee(n,i));return G(l,i)},function(t,n,i){Ze(t,n,i);const{url:l}=n;l!=null&&l!==i.url&&t.setUrl(l)}),K=de(function(t,n){const i=new H.Tooltip(t,n.overlayContainer);return G(i,n)},function(t,n,{position:i},l){m.useEffect(function(){const s=n.overlayContainer;if(s==null)return;const{instance:d}=t,o=x=>{x.tooltip===d&&(i!=null&&d.setLatLng(i),d.update(),l(!0))},a=x=>{x.tooltip===d&&l(!1)};return s.on({tooltipopen:o,tooltipclose:a}),s.bindTooltip(d),function(){s.off({tooltipopen:o,tooltipclose:a}),s._map!=null&&s.unbindTooltip()}},[t,n,l,i])});function Q({glyph:e,glyphColor:t="white",bgColor:n="white",glyphSize:i="8px",iconUrl:l="/Map/assets/icons/glyph-marker-icon-blue.svg",className:c,iconSize:s,prefix:d,glyphAnchor:o}){let a=i;typeof a=="number"?a=`${a}px`:typeof a=="string"&&!a.endsWith("px")?a=`${a}px`:a||(a="8px");const x=s||[25,41],f=Math.round(x[0]*(41/25)),u=Math.round(x[1]*(41/41)),b=Math.round(f*12/41),y=u;return C.icon.glyph({iconUrl:l||"/Map/assets/icons/glyph-marker-icon-blue.svg",iconSize:x,iconAnchor:[Math.round(x[0]/2),x[1]],popupAnchor:[1,-34],tooltipAnchor:[0,0],shadowUrl:"/Map/assets/icons/marker-shadow.png",shadowSize:[f,u],shadowAnchor:[b,y],prefix:d||"",glyph:e||"",glyphColor:t||"white",bgColor:n,glyphSize:a,glyphAnchor:o||[0,0],className:c||""})}function Ve({safeMarkers:e,infoButtonToggled:t,setInfoButtonToggled:n,isMobile:i,updateMarker:l,isMarkerDraggable:c}){return r.jsx(r.Fragment,{children:e.filter(s=>s.id>=1001).map(s=>{const d=t[s.id];let o=[s.lat,s.lng],a=s.iconUrl;a||(a=`${s.type||"glyph-marker-icon-blue"}.svg`),a=ue(a);const x=Q({className:s.type?`marker-icon marker-type-${s.type}`:"marker-icon",prefix:s.prefix,iconUrl:a,iconSize:Array.isArray(s.iconSize)?s.iconSize:[17,28],glyph:s.glyph||"?",glyphColor:s.glyphColor||"white",glyphSize:s.glyphSize||"12px",glyphAnchor:s.glyphAnchor||[0,-5]}),f=s.logo?J(s.logo):null,u=c(s),b={...u?{dragend:y=>{const{lat:v,lng:p}=y.target.getLatLng();l(s.id,{lat:v,lng:p})}}:{}};return r.jsx(pe,{position:o,icon:x,draggable:u,eventHandlers:b,children:r.jsx(K,{direction:"top",offset:[0,-32],opacity:1,permanent:!1,interactive:!0,children:r.jsxs("div",{className:"flex flex-col items-center",children:[f&&r.jsx("img",{src:f,alt:s.name||"Logo",style:{maxWidth:120,maxHeight:80,objectFit:"contain",borderRadius:0}}),r.jsx("span",{style:{fontWeight:600,color:"#1976d2"},children:s.name}),i&&r.jsx("button",{className:`mt-2 px-2 py-1 text-xs rounded ${d?"bg-green-500 text-white":"bg-blue-500 text-white"}`,onClick:()=>{n(y=>({...y,[s.id]:!y[s.id]}))},children:"More info"})]})})},`${s.id}-${s.coreLocked}-${s.appearanceLocked}-${s.contentLocked}-${s.adminLocked}`)})})}function Ke({safeMarkers:e,infoButtonToggled:t,setInfoButtonToggled:n,isMobile:i,updateMarker:l,isMarkerDraggable:c,iconCreateFunction:s}){const d=E.useRef({});return r.jsx(Ie,{chunkedLoading:!0,showCoverageOnHover:!0,spiderfyOnMaxZoom:!1,removeOutsideVisibleBounds:!0,disableClusteringAtZoom:18,maxClusterRadius:400,iconCreateFunction:s,children:e.filter(o=>o.id<1001).map(o=>{t[o.id];let a=[o.lat,o.lng],x=o.iconUrl;x||(x=`${o.type||"default"}.svg`),x=ue(x);const f=Q({className:o.type?`marker-icon marker-type-${o.type}`:"marker-icon",prefix:o.prefix,iconUrl:x,iconSize:Array.isArray(o.iconSize)?o.iconSize:[15,25],glyph:o.glyph||"",glyphColor:o.glyphColor||"white",glyphSize:o.glyphSize||"9px",glyphAnchor:o.glyphAnchor||[0,-4]}),u=o.logo?J(o.logo):null,b=c(o),y={...b?{dragend:v=>{const{lat:p,lng:L}=v.target.getLatLng();l(o.id,{lat:p,lng:L})}}:{}};return d.current[o.id]||(d.current[o.id]=E.createRef()),r.jsxs(pe,{position:a,icon:f,draggable:b,eventHandlers:y,ref:d.current[o.id],children:[i?r.jsx(K,{direction:"top",offset:[0,-32],opacity:1,permanent:!1,interactive:!0,children:r.jsxs("div",{className:"flex flex-col items-center",children:[u&&r.jsx("img",{src:u,alt:o.name||"Logo",style:{maxWidth:120,maxHeight:80,objectFit:"contain",borderRadius:0}}),r.jsx("span",{style:{fontWeight:600,color:"#1976d2"},children:o.name}),r.jsx("button",{className:"mt-2 px-2 py-1 text-xs rounded bg-blue-500 text-white",onClick:v=>{v.stopPropagation();const p=d.current[o.id]?.current;p&&p.openPopup&&p.openPopup()},children:"More info"})]})}):r.jsx(K,{direction:"top",offset:[0,-32],opacity:1,permanent:!1,interactive:!0,children:r.jsxs("div",{className:"flex flex-col items-center",children:[u&&r.jsx("img",{src:u,alt:o.name||"Logo",style:{maxWidth:120,maxHeight:80,objectFit:"contain",borderRadius:0}}),r.jsx("span",{style:{fontWeight:600,color:"#1976d2"},children:o.name})]})}),i?r.jsx(re,{children:r.jsxs("div",{className:"p-2",children:[u&&r.jsx("img",{src:u,alt:o.name||"Logo",style:{maxWidth:120,maxHeight:80,objectFit:"contain",borderRadius:0,marginBottom:8}}),r.jsx("h3",{className:"font-semibold mb-2",style:{color:"#1976d2"},children:o.name}),o.description&&r.jsx("p",{className:"text-sm text-gray-600",children:o.description})]})}):r.jsx(re,{children:r.jsxs("div",{className:"p-2",children:[u&&r.jsx("img",{src:u,alt:o.name||"Logo",style:{maxWidth:120,maxHeight:80,objectFit:"contain",borderRadius:0,marginBottom:8}}),r.jsx("h3",{className:"font-semibold mb-2",style:{color:"#1976d2"},children:o.name}),o.description&&r.jsx("p",{className:"text-sm text-gray-600",children:o.description})]})})]},`${o.id}-${o.coreLocked}-${o.appearanceLocked}-${o.contentLocked}-${o.adminLocked}`)})})}function Je({isAdminView:e,mapInstance:t,updateMarker:n}){const{t:i}=ge(),[l,c]=m.useState(!1),[s,d]=m.useState(!1),[o,a]=m.useState(""),[x,f]=m.useState(""),u=()=>{d(!0),a(""),f("")},b=async()=>{if(!o||isNaN(Number(o))){f("Please enter a valid numeric ID.");return}if(await v(o)){f("ID already exists. Please choose another.");return}d(!1),c(!0),f("")},y=()=>{d(!1),a(""),f("")};m.useEffect(()=>{if(!l||!t||!o)return;const p=L=>{const N=L.latlng,g={...Qe({lat:N.lat,lng:N.lng}),id:Number(o)};typeof n=="function"&&n(g.id,g,{add:!0}),c(!1),a(""),t.off("click",p)};return t.on("click",p),()=>{t.off("click",p)}},[l,t,n,o]);async function v(p){try{const{supabase:L}=await Pe(async()=>{const{supabase:g}=await import("./index-B-Zf2SX2.js").then(w=>w.s);return{supabase:g}},__vite__mapDeps([0,1])),N=["Markers_Core","Markers_Appearance","Markers_Content","Markers_Admin"];for(const g of N){const{data:w,error:j}=await L.from(g).select("id").eq("id",Number(p));if(j)return!1;if(w&&w.length>0)return!0}return!1}catch{return!1}}return e?r.jsxs(r.Fragment,{children:[r.jsxs("button",{onClick:u,"aria-label":"Add marker",className:"bg-white rounded-full shadow p-2 flex items-center justify-center",style:{position:"absolute",left:10,top:60,zIndex:1001,width:44,height:44,border:"none",cursor:l?"crosshair":"pointer",background:l?"#e3f2fd":"white"},title:l?"Click on map to place marker":"Add marker",children:[r.jsx(ze.Icon,{path:Oe,size:1.5,color:"#1976d2","aria-hidden":"true",style:{width:"42px",height:"42px"}}),r.jsx("span",{className:"sr-only",children:"Add marker"})]}),s&&r.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.3)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs("div",{style:{background:"white",borderRadius:8,boxShadow:"0 2px 16px rgba(25,118,210,0.15)",padding:32,minWidth:320,display:"flex",flexDirection:"column",alignItems:"center"},children:[r.jsx("h2",{style:{color:"#1976d2",fontWeight:700,marginBottom:16},children:"Enter Marker ID"}),r.jsx("input",{type:"number",value:o,onChange:p=>a(p.target.value),style:{fontSize:18,padding:"8px 12px",border:"2px solid #1976d2",borderRadius:4,marginBottom:12,width:"100%"},placeholder:"Marker ID (integer)",min:1}),x&&r.jsx("div",{style:{color:"red",marginBottom:8},children:x}),r.jsxs("div",{style:{display:"flex",gap:12},children:[r.jsx("button",{onClick:b,style:{background:"#1976d2",color:"white",border:"none",borderRadius:4,padding:"8px 20px",fontWeight:600,cursor:"pointer"},children:"Confirm"}),r.jsx("button",{onClick:y,style:{background:"#eee",color:"#1976d2",border:"none",borderRadius:4,padding:"8px 20px",fontWeight:600,cursor:"pointer"},children:"Cancel"})]})]})})]}):null}function Qe({lat:e,lng:t}){return{id:null,lat:e,lng:t,name:"",label:"",logo:"",boothNumber:"",coreLocked:!1}}function et(e){return e.getChildCount(),Q({iconUrl:"/Map/assets/icons/glyph-marker-icon-orange.svg",iconSize:[50,82],glyph:`<div style='display:flex;align-items:center;justify-content:center;width:100%;height:100%;'>
  <img src='/Map/assets/logos/4x4Vakantiebeurs.png' alt='logo' style='width:40px;height:40px;object-fit:contain;display:block;margin:auto;position:relative;left:1px;top:10px;' />
      </div>`,glyphColor:"white",glyphSize:"40px",className:"custom-cluster-icon"})}var ye={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},se=E.createContext&&E.createContext(ye),tt=["attr","size","title"];function nt(e,t){if(e==null)return{};var n=ot(e,t),i,l;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(l=0;l<c.length;l++)i=c[l],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}function ot(e,t){if(e==null)return{};var n={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;n[i]=e[i]}return n}function F(){return F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},F.apply(this,arguments)}function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),n.push.apply(n,i)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?le(Object(n),!0).forEach(function(i){it(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function it(e,t,n){return t=at(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function at(e){var t=rt(e,"string");return typeof t=="symbol"?t:t+""}function rt(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function me(e){return e&&e.map((t,n)=>E.createElement(t.tag,B({key:n},t.attr),me(t.child)))}function ee(e){return t=>E.createElement(st,F({attr:B({},e.attr)},t),me(e.child))}function st(e){var t=n=>{var{attr:i,size:l,title:c}=e,s=nt(e,tt),d=l||n.size||"1em",o;return n.className&&(o=n.className),e.className&&(o=(o?o+" ":"")+e.className),E.createElement("svg",F({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,i,s,{className:o,style:B(B({color:e.color||n.color},n.style),e.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),c&&E.createElement("title",null,c),e.children)};return se!==void 0?E.createElement(se.Consumer,null,n=>t(n)):t(ye)}function lt(e){return ee({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"},child:[]}]})(e)}function ct(e){return ee({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"},child:[]}]})(e)}function dt(e){return ee({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 13H5v-2h14v2z"},child:[]}]})(e)}function ut(e){return e.angle||0}function P(e,t,n){const i=n*Math.PI/180,l=e*Math.cos(i)-t*Math.sin(i),c=e*Math.sin(i)+t*Math.cos(i);return[l,c]}function R(e){return e/111320}function k(e,t){return e/(40075e3*Math.cos(t*Math.PI/180)/360)}function ft(e){return e*111320}function ht(e,t){return e*(40075e3*Math.cos(t*Math.PI/180)/360)}function gt({mapInstance:e,markers:t,rectangleSize:n,isAdminView:i,showRectanglesAndHandles:l,updateMarker:c,rectangleLayerRef:s}){if(!e)return;s.current||(s.current=C.layerGroup(),s.current.addTo(e));const d=s.current;d._markerLayers||(d._markerLayers={}),Object.keys(d._markerLayers).forEach(o=>{t.find(a=>a.id===o)||(d.removeLayer(d._markerLayers[o].rectangle),d.removeLayer(d._markerLayers[o].handle),delete d._markerLayers[o])}),t.forEach(o=>{if(o.lat&&o.lng){const a=C.latLng(o.lat,o.lng),x=Array.isArray(o.rectangle)&&o.rectangle.length===2?o.rectangle:n,f=Number(x[0])/2,u=Number(x[1])/2,b=ut(o),y="#1976d2",v=[P(-f,-u,b),P(f,-u,b),P(f,u,b),P(-f,u,b)],p=v.map(([g,w])=>C.latLng(a.lat+R(w),a.lng+k(g,a.lat)));let L,N;if(d._markerLayers[o.id]){L=d._markerLayers[o.id].rectangle,L.setLatLngs(p),N=d._markerLayers[o.id].handle;const[g,w]=v[2],j=C.latLng(a.lat+R(w),a.lng+k(g,a.lat));N.setLatLng(j)}else{L=C.polygon(p,{color:y,weight:1});const[g,w]=v[2],j=C.latLng(a.lat+R(w),a.lng+k(g,a.lat));let M;if(i&&!o.coreLocked){const z=C.divIcon({className:"rotation-handle-icon",html:'<div style="width:8px;height:8px;background:#1976d2;border-radius:50%;"></div>',iconSize:[8,8],iconAnchor:[4,4]});M=C.marker(j,{icon:z,draggable:!0,interactive:!0,keyboard:!0,title:"Drag to rotate"}),M.on("dragstart",function(){e&&e.dragging.disable()});let I=b;M.on("drag",function(D){const $=D.target.getLatLng(),Z=ht($.lng-a.lng,a.lat),q=ft($.lat-a.lat);let _=Math.atan2(q,Z)*180/Math.PI;_<0&&(_+=360),I=_;const W=[P(-f,-u,I),P(f,-u,I),P(f,u,I),P(-f,u,I)],h=W.map(([xe,be])=>C.latLng(a.lat+R(be),a.lng+k(xe,a.lat)));L.setLatLngs(h);const[S,O]=W[2],T=C.latLng(a.lat+R(O),a.lng+k(S,a.lat));M.setLatLng(T)}),M.on("dragend",function(){e&&e.dragging.enable(),c(o.id,{angle:I})})}else{const z=C.divIcon({className:"rotation-handle-icon",html:'<div style="width:8px;height:8px;background:#1976d2;border-radius:50%;opacity:0.5;"></div>',iconSize:[8,8],iconAnchor:[4,4]});M=C.marker(j,{icon:z,draggable:!1,interactive:!1,keyboard:!1,title:"Locked"})}d.addLayer(L),d.addLayer(M),d._markerLayers[o.id]={rectangle:L,handle:M}}}}),Object.values(d._markerLayers).forEach(({rectangle:o,handle:a})=>{l?(d.addLayer(o),d.addLayer(a)):(d.removeLayer(o),d.removeLayer(a))})}function pt(e){e&&e.zoomIn()}function yt(e){e&&e.zoomOut()}function mt(e,t,n){e&&e.setView(t,n)}function ce(e,t){console.log("Analytics event:",e,t)}function xt(){const e=m.useCallback(n=>{ce("marker_view",{markerId:n,timestamp:Date.now()})},[]),t=m.useCallback(n=>{ce("map_interaction",{type:n,timestamp:Date.now()})},[]);return{trackMarkerView:e,trackMapInteraction:t}}const bt={appearance:"none",WebkitAppearance:"none",MozAppearance:"none",outline:"none",background:"#fff",border:"2px solid #1976d2",borderRadius:4,width:18,height:18,display:"inline-block",position:"relative",marginRight:8,cursor:"pointer",verticalAlign:"middle"},U=[{key:"carto",name:"Carto Voyager",attribution:'&copy; <a href="https://carto.com/attributions">Carto</a>',url:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager_nolabels/{z}/{x}/{y}.png"},{key:"esri",name:"Esri World Imagery",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"}];function wt({isAdminView:e,markersState:t,updateMarker:n}){const[i,l]=m.useState({}),c=typeof window<"u"&&/Mobi|Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(window.navigator.userAgent),s=E.useRef(null),{t:d}=ge(),[o,a]=m.useState(!1),[x,f]=m.useState(U[0].key),[u,b]=m.useState(!1),[y,v]=m.useState(null),[p,L]=m.useState(null),N=[51.898095078807025,5.772961378097534],g=17;xt();const w=E.useMemo(()=>Array.isArray(t)?t:[],[t]),j=[6,6],M=E.useRef(null);E.useEffect(()=>{w.forEach(h=>{if(h.logo){const S=new window.Image;S.src=J(h.logo)}})},[w]);function z(h){return e&&h&&h.coreLocked===!1}m.useEffect(()=>{gt({mapInstance:y,markers:w,rectangleSize:j,isAdminView:e,showRectanglesAndHandles:u,updateMarker:n,rectangleLayerRef:M})},[y,t,j,e,u]),m.useEffect(()=>{if(!y)return;let h=p;h||(h=C.layerGroup(),L(h)),h.clearLayers(),w.forEach(S=>{if(S.lat&&S.lng){const O=[S.name,S.boothNumber,S.label].filter(Boolean).join(" | "),T=C.marker([S.lat,S.lng],{opacity:0,interactive:!1});T.feature={type:"Feature",properties:{searchText:O}},T.bindPopup(S.name||S.label||""),h.addLayer(T)}})},[y,w,p]),m.useEffect(()=>{if(y&&p){const h=new C.Control.Search({layer:p,propertyName:"searchText",initial:!1,zoom:21,marker:{icon:!1,animate:!0},textPlaceholder:"Search for name or booth...",position:"topleft"});if(y.addControl(h),s.current=h,!y._minimapControl){const S=C.tileLayer(U[0].url,{attribution:"",minZoom:0,maxZoom:16}),O=new C.Control.MiniMap(S,{position:"bottomright",width:120,height:120,zoomLevelFixed:15,toggleDisplay:!0,centerFixed:N,aimingRectOptions:{color:"#1976d2",weight:2,opacity:.9,fillOpacity:.1,fill:!0},shadowRectOptions:{color:"#90caf9",weight:1,opacity:.5,fillOpacity:.05,fill:!0},strings:{hideText:"Hide MiniMap",showText:"Show MiniMap"}});O.addTo(y),y._minimapControl=O}return h.on("search:locationfound",function(S){if(S&&S.layer&&S.layer.getLatLng){const O=S.layer.getLatLng();y.flyTo(O,21,{animate:!0}),h._input&&h._input.blur(),h.hideAlert&&h.hideAlert(),h.collapse&&h.collapse()}}),()=>{y.removeControl(h),s.current=null}}},[y,p]);const I=N,D=g,$=14,Z=22,q=h=>{h&&h.target?v(h.target):v(h)},te=()=>pt(y),_=()=>yt(y),W=()=>mt(y,I,D);return r.jsxs("div",{style:{height:"100svh",height:"100dvh",height:"100vh",width:"100vw",position:"fixed",inset:0,zIndex:0,touchAction:"pan-x pan-y",overflow:"hidden"},tabIndex:0,"aria-label":"Event Map",role:"region",children:[r.jsxs("div",{style:{position:"absolute",top:10,right:10,zIndex:1e3,display:"flex",flexDirection:"column",gap:"10px"},children:[r.jsxs("button",{onClick:W,"aria-label":"Home",className:"bg-white rounded-full shadow p-2 flex items-center justify-center",style:{width:44,height:44},children:[r.jsx(lt,{size:28,color:"#1976d2","aria-hidden":"true"}),r.jsx("span",{className:"sr-only",children:"Home"})]}),r.jsxs("button",{onClick:te,"aria-label":"Zoom in",className:"bg-white rounded-full shadow p-2 mb-2 flex items-center justify-center",style:{width:44,height:44},children:[r.jsx(ct,{size:28,color:"#1976d2","aria-hidden":"true"}),r.jsx("span",{className:"sr-only",children:"Zoom in"})]}),r.jsxs("button",{onClick:_,"aria-label":"Zoom out",className:"bg-white rounded-full shadow p-2 mb-2 flex items-center justify-center",style:{width:44,height:44},children:[r.jsx(dt,{size:28,color:"#1976d2","aria-hidden":"true"}),r.jsx("span",{className:"sr-only",children:"Zoom out"})]}),e&&r.jsxs("div",{style:{position:"relative"},children:[r.jsxs("button",{"aria-label":"Map layers",className:"bg-white rounded-full shadow p-2 flex items-center justify-center mt-0 hover:bg-gray-100 focus:outline-none",style:{width:44,height:44},onClick:()=>a(h=>!h),children:[r.jsx(Ae,{path:_e,size:1.2,color:"#1976d2"}),r.jsx("span",{className:"sr-only",children:"Map layers"})]}),o&&r.jsxs("div",{className:"absolute right-0 mt-2 bg-white rounded shadow-lg border z-50",style:{minWidth:200,padding:8,color:"#1976d2"},role:"menu","aria-label":"Layer selection",children:[r.jsx("div",{className:"font-semibold mb-2",children:"Base Layers"}),U.map(h=>r.jsx("button",{className:`w-full text-left px-2 py-1 rounded hover:bg-blue-50 ${x===h.key?"bg-blue-50 font-bold":""}`,onClick:()=>f(h.key),role:"menuitem",style:{color:"#1976d2"},children:h.name},h.key)),r.jsx("div",{className:"font-semibold mt-4 mb-2",children:"Map Features"}),r.jsxs("label",{className:"flex items-center px-2 py-1 cursor-pointer hover:bg-blue-50 rounded",style:{color:"#1976d2"},children:[r.jsx("input",{type:"checkbox",checked:u,onChange:h=>b(h.target.checked),style:bt}),r.jsx("span",{style:{position:"relative",left:-26,width:18,height:18,pointerEvents:"none",display:u?"inline-block":"none"},children:r.jsx("svg",{width:"18",height:"18",viewBox:"0 0 18 18",style:{position:"absolute",top:0,left:0},children:r.jsx("polyline",{points:"4,9 8,13 14,5",stroke:"#1976d2",strokeWidth:"2.5",fill:"none"})})}),r.jsx("span",{style:{marginLeft:u?-8:0},children:"Booth Surface"})]})]})]})]}),e&&r.jsx(Je,{isAdminView:e,mapInstance:y,updateMarker:n}),r.jsx("div",{id:"map-container",className:"fixed inset-0 w-full h-full",style:{zIndex:1,height:"100svh",height:"100dvh",height:"100vh",touchAction:"pan-x pan-y",overflow:"hidden"},"aria-label":d("map.ariaLabel"),children:r.jsxs(Xe,{center:I,zoom:D,minZoom:$,maxZoom:Z,zoomDelta:.5,zoomSnap:.5,zoomControl:!1,style:{width:"100vw",height:"100vh"},className:"focus:outline-none focus:ring-2 focus:ring-primary",whenReady:q,attributionControl:!1,children:[U.filter(h=>h.key===x).map(h=>r.jsx(Ye,{attribution:h.attribution,url:h.url,maxZoom:22},h.key)),r.jsx(Ke,{safeMarkers:w,infoButtonToggled:i,setInfoButtonToggled:l,isMobile:c,updateMarker:n,isMarkerDraggable:z,iconCreateFunction:et}),r.jsx(Ve,{safeMarkers:w,infoButtonToggled:i,setInfoButtonToggled:l,isMobile:c,updateMarker:n,isMarkerDraggable:z})]})})]})}export{wt as default};
