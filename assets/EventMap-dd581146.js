import{r as c,c as Ee,a as lt,j as n,I as le,R as He,_ as ct,g as dt}from"./vendor-react-3437b308.js";import{aF as Ie,ae as ut,ak as ht,ad as y,aV as pt,aW as gt}from"./vendor-3047817a.js";import{L as M,u as ft,T as mt,P as we,M as We,a as yt,b as xt,c as bt}from"./vendor-map-5f90c4cc.js";import{j as Ke,k as q,u as Se,c as Me,d as Le,a as Ce,b as Ne,i as qe,s as je,l as At,g as wt,m as St,n as Mt,B as Lt}from"./index-a5e29154.js";import{F as Xe,u as vt}from"./useTranslatedCompanyInfo-f6109462.js";import{u as Qe}from"./useCategories-823e3140.js";import{A as _t,m as Ge,M as It,a as jt,b as Ct}from"./vendor-ui-b93d185b.js";import{u as Je}from"./useEventSubscriptions-316b369c.js";import{u as Ve}from"./useAssignments-0bf0bb9c.js";import"./vendor-canvas-85f1a6b6.js";import{u as Nt}from"./useEventMapSettings-a3d0b3f2.js";function ye(e){if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://"))return e;const t=Ke();return e.startsWith("/assets/icons/")?`${t}${e.slice(1)}`:e.startsWith("icons/")?`${t}assets/icons/${e.slice(6)}`:`${t}assets/icons/${e}`}L.Icon.Glyph=L.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],className:"",prefix:"",glyph:"home",glyphColor:"white",glyphSize:"11px",glyphAnchor:[0,0]},createIcon:function(){var e=document.createElement("div"),t=this.options;return t.glyph&&e.appendChild(this._createGlyph()),e.style.position="relative",this._setIconStyles(e,t.className),e},_createGlyph:function(){var e,t,o=this.options;o.prefix?o.prefix==="fab"||o.prefix==="fal"||o.prefix==="far"||o.prefix==="fas"?e="fa-"+o.glyph:o.glyph.slice(0,o.prefix.length+1)===o.prefix+"-"?e=o.glyph:e=o.prefix+"-"+o.glyph:(e="",t=o.glyph);var a=L.DomUtil.create("span",o.prefix+" "+e);return a.style.position="absolute",a.style.fontSize=o.glyphSize,a.style.color=o.glyphColor,a.style.width=o.iconSize[0]+"px",a.style.lineHeight=o.iconSize[1]+"px",a.style.textAlign="center",a.style.left=o.glyphAnchor[0]+"px",a.style.top=o.glyphAnchor[1]+"px",a.style.pointerEvents="none",a.style.display="inline-block",t&&(a.innerHTML=t),a},_setIconStyles:function(e,t){if(t==="shadow")return L.Icon.prototype._setIconStyles.call(this,e,t);var o=this.options,a=L.point(o.iconSize),l=L.point(o.iconAnchor);!l&&a&&(l=a.divideBy(2,!0)),e.className="leaflet-marker-icon leaflet-glyph-icon "+t;var d=this._getIconUrl("icon");d&&(e.style.backgroundImage="url('"+d+"')"),o.bgPos&&(e.style.backgroundPosition=-o.bgPos.x+"px "+-o.bgPos.y+"px"),o.bgSize&&(e.style.backgroundSize=o.bgSize.x+"px "+o.bgSize.y+"px"),l&&(e.style.marginLeft=-l.x+"px",e.style.marginTop=-l.y+"px"),a&&(e.style.width=a.x+"px",e.style.height=a.y+"px");try{const f=e.querySelectorAll&&e.querySelectorAll("span");f&&f.length&&f.forEach(i=>{i.style.fontSize=o.glyphSize||i.style.fontSize||"",i.style.color=o.glyphColor||i.style.color||"",o.iconSize&&(i.style.width=o.iconSize[0]+"px",i.style.lineHeight=o.iconSize[1]+"px"),o.glyphAnchor&&o.glyphAnchor.length>=2&&(i.style.left=o.glyphAnchor[0]+"px",i.style.top=o.glyphAnchor[1]+"px")})}catch(f){console.warn("Failed to update glyph span styles in-place",f)}}});L.icon.glyph=function(e){return new L.Icon.Glyph(e)};L.Icon.Glyph.prototype.options.iconUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAUlSURBVFjDrZdLiBxVFIb/e289uqt6kkx6zIiIoKgLRReKuMhCcaOIAUEIiCCE4CIPggZ8kBjooPgM0TiYEUUjqBGchZqAQlyYRTA+kJiJQiJGMjN5zYzT3dP1rrr3HBeTjDGTSfc8Dvyruud89Z9z6kIJdBj31763MivsJXKuZYF6dak5++2mh7NOcsXVHq6sHbhOK/24kOJJMO4AE1vKygwZhxlKSHGKiD+RSu09vOXB43OCrHz96y6T2lsh+OmKXzFdlbLne2UopSAupBhjECcZgjDMgiiSxPhcK/nCr1sfOtcWcm/tq9uEsL4rl0vdK67pKVu2jUwTMk0wBBAzpBCQAnAtiZIlwWQwPlHPglZQAFj1Y23VwVkh92zbd59U+Kanp+p2L12mooKQ5AbcpuclS6LiKoRhxOfHzhXMcs3PtVV7Z0DufXH/LSzpSG9vr1/p6kIz0dDUrvx/IYXAsrJCkWc4e/Z0Zpgf+KX26A/TkNtrXziesY9Xq8tvWNZdVfVYg7hzwKVv3O3ZiKMWj46OTrq5fdOh1x5pSADwjdzo2nbv0u6qqkca2jCIMGcZAuqRhu8vEX7ZK2V2WgMAcXdtvyeKbPS662+osCohzMycHVweniNREoShoZO5KYobpciSh23bFq7rIUgNiLFghRkBlg2v7GlpiccsCHrcryzxUk3zmsNskeYGvt/lxVH4hMWEu9xSWaQFYQ7L1B6iGZ5bBoy+zWKiHiltFHpqeIsVhWaosg1iqlgg4wAAEYEXsV3EmNppJmExMFYUxfVSuIs6E0sI5FkBBhLJzH9laQxLSjBj0WQJgSJPweDTkknvS4JGbCuxKOt7UY4lEQfNnAu9TzLxN2nUdAQTLAEw8YIlAVgAkmDCSBL75eCutSeY+GTUqqNkqUVxUbIl4qgJo4vWzecrhyQAMJldYf1MXLLl1EIsYBZgoGwpRI2zMTPtGBhYbSQAlJF9lieRzNMIriVBzPOWawvoIkYaNC0u9IcAIAHgp75NLQl8ENbPZJ6jgAU48RyFqHEuZyE+Pda/vjENAQBD5s209Y+kPJlyM4+r3lUS0AWSyVEhpHnjYu1pyO+7N4ywwPvhxHDiuwo8j1b5rkQwMZIziYHBXetPzIAAgIV8exZOSMoieI6aU5vKtgR0jqw1JtiYbZfW/R/kSN+mcWbxdtwYjn1XTd9B7cQAfNdCWB/OhBR7jvWv/3tWCAAoO3ktjyZZJ0HHbsq2AooERVQXzPKly2vOgPz29jNNBr+e1IcSz5YAM4hmFzPDtyWS+lDK4N2DfU+dbgsBAFHyd+oszE3agt/GjWcrUBEjj5sQBb96pXpXhAzueDJi4u1p41TsuQpCiFln4bkKeXMoJeadg++tG+sYAgBBXOo3RRrruAnfkWDmGfIdCeQhiiQgQbxjtlqzQk59vCZlNluL5lDiORLyMjcA4DsKeXM4AfDKxa97ThAAqPaMfaR1Nq6jOiqOAhOm5TsKJg1QZGGRedY7V6tzVcjBWk1D0JZ8cigt2RJSimkXnqOgW8MxQLUTb6wN5g0BgGPV0c9BekTH41xx5YXrQ8FkTRgdpxU7ea9djbYQ1GokmJ43wUhWtgRcS04tQjAcw9CWw29tThYOAXD03XVfMps/TTTOy30blDZgiqxFK6p7OsnvCDJ1UD9LyUjORoPDkUQyPfdHbXW+qJCjfRsOwOAoNY4z6Xz01rHq3k5zO4ZMHTabYSIhJD87MLB64f8Ys8WdG/tfBljMJedfwY+s/2P4Pv8AAAAASUVORK5CYII=";function ze({glyph:e,glyphColor:t="white",bgColor:o="white",glyphSize:a="8px",iconUrl:l="/Mapassets/icons/glyph-marker-icon-blue.svg",className:d,iconSize:f,prefix:i,glyphAnchor:m,isActive:s}){let r=a;if(typeof r=="number")r=`${r.toFixed(2)}px`;else if(typeof r=="string"&&!r.endsWith("px")){const N=parseFloat(r.replace(/[^0-9.-]/g,""));Number.isFinite(N)?r=`${N.toFixed(2)}px`:r=`${r}px`}else r||(r="8px");const x=f||[25,41],_=Math.round(x[0]*(41/25)),S=Math.round(x[1]*(41/41)),b=Math.round(_*12/41),v=S,E=Ke();return M.icon.glyph({iconUrl:l||`${E}assets/icons/glyph-marker-icon-blue.svg`,iconSize:x,iconAnchor:[Math.round(x[0]/2),x[1]],popupAnchor:[1,-34],tooltipAnchor:[0,0],shadowUrl:`${E}assets/icons/marker-shadow.png`,shadowSize:[_,S],shadowAnchor:[b,v],prefix:i||"",glyph:e||"",glyphColor:t||"white",bgColor:o,glyphSize:r,glyphAnchor:m||[0,0],className:s?`${d} marker-active`:d||""})}function et(e,t,o=!1,a=!1){const l=q.MARKER_SIZING;if(!l||!l.ENABLED||a&&!l.APPLY_IN_ADMIN)return t||(l?l.DEFAULT_SIZE:[25,41]);const d=l.ZOOM_BUCKETS.find(i=>e>=i.minZoom&&e<=i.maxZoom);let f=d?d.size:l.DEFAULT_SIZE;try{if(Array.isArray(t)&&t.length===2&&l.DEFAULT_SIZE&&Array.isArray(l.DEFAULT_SIZE)){const i=l.DEFAULT_SIZE[1]||l.DEFAULT_SIZE[0]||41,s=(t[1]||t[0]||i)/i;f=[Math.round(f[0]*s),Math.round(f[1]*s)]}}catch(i){console.warn("[markerSizing] failed to compute scaled size from baseSize",i)}return o&&l.SPECIAL_MARKER_MULTIPLIER&&(f=[Math.round(f[0]*l.SPECIAL_MARKER_MULTIPLIER),Math.round(f[1]*l.SPECIAL_MARKER_MULTIPLIER)]),f}function Et(e){const t=q.MARKER_SIZING;if(!t.ENABLED)return"default";const o=t.ZOOM_BUCKETS.find(a=>e>=a.minZoom&&e<=a.maxZoom);return o?`${o.minZoom}-${o.maxZoom}`:"default"}function ge(e,t=[25,41]){if(!Array.isArray(e)||e.length===0)return t;const o=e[0]||t[0],a=e[1]||Math.round(o*(t[1]/t[0]));return[o,a]}function Oe(e="md"){const t={sm:"(max-width: 639px)",md:"(max-width: 767px)",lg:"(max-width: 1023px)",xl:"(max-width: 1279px)","2xl":"(max-width: 1535px)"},o=t[e]||t.md,[a,l]=c.useState(()=>typeof window<"u"?window.matchMedia(o).matches:!1);return c.useEffect(()=>{if(typeof window>"u")return;const d=window.matchMedia(o),f=()=>l(d.matches);return d.addEventListener("change",f),()=>d.removeEventListener("change",f)},[o]),a}const tt=({marker:e,onClose:t})=>{const o=ft(),{organizationLogo:a}=Se(),{isFavorite:l,toggleFavorite:d}=Me(),{i18n:f}=Ee(),{getCompanyCategories:i}=Qe(f.language),[m,s]=c.useState([]);return c.useEffect(()=>(o&&o.dragging.disable(),()=>{o&&o.dragging.enable()}),[o]),c.useEffect(()=>{e!=null&&e.companyId?i(e.companyId).then(s):s([])},[e==null?void 0:e.companyId,i]),e?lt.createPortal(n.jsxs(_t,{children:[n.jsx(Ge.div,{className:"bottom-sheet-backdrop",onClick:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.25}},"backdrop"),n.jsxs(Ge.div,{className:"bottom-sheet",drag:"y",dragConstraints:{top:0,bottom:0},dragElastic:.25,onDragEnd:(r,x)=>{x.offset.y>100&&t()},initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",stiffness:180,damping:22},children:[n.jsx("div",{className:"handle"}),n.jsxs("div",{className:"content",children:[n.jsx("div",{className:"w-20 h-20 mx-auto mb-3 flex items-center justify-center bg-white rounded-md border border-gray-300 overflow-hidden",children:n.jsx("img",{src:Le(e.logo,a),alt:e.name||"Logo",className:"max-w-[80%] max-h-[80%] object-contain"})}),n.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[n.jsx("div",{className:"text-base font-semibold text-gray-900",children:e.name}),e.companyId&&n.jsx(Xe,{isFavorite:l(e.companyId),onToggle:()=>d(e.companyId),size:"md"})]}),e.glyph&&n.jsxs("div",{className:"text-sm text-gray-700 mb-1",children:["Booth ",e.glyph]}),m&&m.length>0&&n.jsx("div",{className:"mb-2 flex flex-wrap gap-1.5",children:m.map(r=>n.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-white rounded",style:{backgroundColor:r.color},title:r.name,children:[n.jsx(le,{path:r.icon,size:.5}),r.name]},r.id))}),e.website&&n.jsx("div",{className:"text-sm mb-1",children:n.jsx("a",{href:e.website.startsWith("http")?e.website:`https://${e.website}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:e.website})}),e.info&&n.jsx("div",{className:"text-sm text-gray-600 mt-2 pt-2 border-t border-gray-200",children:e.info}),n.jsx("button",{onClick:t,className:"mt-4 w-full bg-gray-200 py-2 rounded-md text-gray-700 font-medium hover:bg-gray-300",children:"Close"})]})]},"sheet")]}),document.body):null},zt=({marker:e,organizationLogo:t,showBoothNumber:o=!0})=>{const a=e.name||e.companyId;return n.jsxs("div",{className:"flex items-center gap-2 p-1",children:[a&&n.jsx("div",{className:"w-8 h-8 flex items-center justify-center bg-white rounded-sm border border-gray-200 overflow-hidden",children:n.jsx("img",{src:Le(e.logo,t),alt:"",className:"max-w-[70%] max-h-[70%] object-contain"})}),n.jsxs("div",{className:"flex flex-col min-w-0",children:[o&&e.glyph&&n.jsxs("div",{className:"text-xs font-semibold text-gray-700",children:["Booth ",e.glyph]}),e.name?n.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}):n.jsx("div",{className:"text-xs font-medium text-gray-500 italic",children:"Unassigned"})]})]})},Ot=({marker:e,organizationLogo:t,showBoothNumber:o=!0})=>{const a=e.name||e.companyId,{isFavorite:l,toggleFavorite:d}=Me(),f=vt(e),{i18n:i}=Ee(),{getCompanyCategories:m}=Qe(i.language),[s,r]=c.useState([]);return c.useEffect(()=>{e.companyId?m(e.companyId).then(r):r([])},[e.companyId,m]),n.jsx(we,{closeButton:!0,className:"marker-popup-scrollable",autoPan:!0,maxWidth:320,minWidth:240,children:n.jsx("div",{className:"popup-scroll-container",children:n.jsxs("div",{className:"popup-scroll-content",children:[a&&n.jsx("div",{className:"w-24 h-24 mx-auto mb-3 flex items-center justify-center bg-white rounded-md border border-gray-300 overflow-hidden flex-shrink-0",children:n.jsx("img",{src:Le(e.logo,t),alt:e.name||"Logo",className:"max-w-[80%] max-h-[80%] object-contain"})}),e.name?n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsx("div",{className:"text-base font-semibold text-gray-900",children:e.name}),e.companyId&&n.jsx(Xe,{isFavorite:l(e.companyId),onToggle:()=>d(e.companyId),size:"sm"})]}):n.jsx("div",{className:"text-base font-semibold text-gray-500 italic mb-1",children:"Unassigned Booth"}),o&&e.glyph&&n.jsxs("div",{className:"text-sm text-gray-700 mb-2",children:["Booth ",e.glyph]}),s&&s.length>0&&n.jsx("div",{className:"mb-2 flex flex-wrap gap-1.5",children:s.map(x=>n.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-white rounded",style:{backgroundColor:x.color},title:x.name,children:[n.jsx(le,{path:x.icon,size:.5}),x.name]},x.id))}),e.website&&n.jsx("div",{className:"text-sm mb-2",children:n.jsx("a",{href:e.website.startsWith("http")?e.website:`https://${e.website}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",style:{wordBreak:"break-all"},children:e.website})}),f&&n.jsx("div",{className:"text-sm text-gray-600 mt-2 pt-2 border-t border-gray-200",style:{wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap"},children:f})]})})})},Pt=({marker:e,onMoreInfo:t,organizationLogo:o,showBoothNumber:a=!0})=>{const l=e.name||e.companyId;return n.jsx(we,{closeButton:!0,className:"marker-popup",autoPan:!0,children:n.jsxs("div",{className:"p-2 text-center",children:[l&&n.jsx("div",{className:"w-12 h-12 mx-auto mb-2 flex items-center justify-center bg-white rounded-md border border-gray-300 overflow-hidden",children:n.jsx("img",{src:Le(e.logo,o),alt:"",className:"max-w-[80%] max-h-[80%] object-contain"})}),e.name?n.jsx("div",{className:"font-semibold text-gray-900 text-sm",children:e.name}):n.jsx("div",{className:"font-semibold text-gray-500 italic text-sm",children:"Unassigned Booth"}),a&&e.glyph&&n.jsxs("div",{className:"text-xs text-gray-700 mb-2",children:["Booth ",e.glyph]}),l&&n.jsx("button",{onClick:t,className:"bg-blue-500/90 text-white text-xs px-3 py-1 rounded-full hover:bg-blue-600",children:"More Info"})]})})},nt=({marker:e,onMoreInfo:t,isMobile:o,organizationLogo:a,showBoothNumber:l=!0})=>{const d=e&&(e.glyph!==void 0&&e.glyph!==null&&e.glyph!==""||e.name);return n.jsxs(n.Fragment,{children:[!o&&n.jsxs(n.Fragment,{children:[d&&n.jsx(mt,{direction:"top",offset:[0,-10],opacity:.95,children:n.jsx(zt,{marker:e,organizationLogo:a,showBoothNumber:l})}),n.jsx(Ot,{marker:e,organizationLogo:a,showBoothNumber:l})]}),o&&n.jsx(Pt,{marker:e,onMoreInfo:t,organizationLogo:a,showBoothNumber:l})]})};function ot({marker:e,subscriptions:t,assignments:o,onAssign:a,onUnassign:l,isLoading:d,onClose:f}){const[i,m]=c.useState(""),s=c.useRef(null),r=o.find(b=>b.marker_id===e.id),x=t.filter(b=>{const v=o.filter(O=>O.company_id===b.company_id),E=v.length,N=b.booth_count||1;return!v.some(O=>O.marker_id===e.id)&&E<N}).map(b=>{var O,p,D;const E=o.filter(R=>R.company_id===b.company_id).length,N=b.booth_count||1,H=N-E;return{id:b.company_id,name:((O=b.company)==null?void 0:O.name)||"Unknown Company",logo:((p=b.company)==null?void 0:p.logo)||null,website:((D=b.company)==null?void 0:D.website)||null,assignedBooths:E,totalBooths:N,remainingBooths:H}}).filter(b=>b.name.toLowerCase().includes(i.toLowerCase()));c.useEffect(()=>{s.current&&s.current.focus()},[]);const _=async b=>{await a(e.id,b),f()},S=async()=>{r&&(await l(e.id,r.company_id),f())};return n.jsxs("div",{className:"p-2",children:[n.jsx("div",{className:"flex items-center justify-between mb-3 pb-2 border-b border-gray-300",children:n.jsxs("h3",{className:"text-sm font-semibold text-gray-800 flex items-center gap-2",children:[n.jsx(le,{path:Ie,size:.8,className:"text-blue-600"}),e.name||`Marker ${e.id}`]})}),r&&(()=>{var H,O;const v=o.filter(p=>p.company_id===r.company_id).length,E=t.find(p=>p.company_id===r.company_id),N=(E==null?void 0:E.booth_count)||1;return n.jsx("div",{className:"mb-3 p-2 bg-blue-50 rounded border border-blue-200",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(H=r.company)!=null&&H.logo?n.jsx("img",{...(()=>{const p=Ce(r.company.logo);return p?{src:p.src,srcSet:p.srcSet,sizes:p.sizes}:{src:Ne(r.company.logo)}})(),alt:r.company.name,className:"w-8 h-8 object-contain flex-shrink-0"}):n.jsx(le,{path:Ie,size:1.2,className:"text-gray-400 flex-shrink-0"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm font-medium text-gray-800 truncate",children:((O=r.company)==null?void 0:O.name)||"Unknown"}),n.jsxs("div",{className:"text-xs text-gray-600",children:["Using ",v," of ",N," booth",N!==1?"s":""]})]})]}),n.jsx("button",{onClick:S,disabled:d,className:"ml-2 px-2 py-1 text-xs bg-red-500 hover:bg-red-600 text-white rounded disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",title:"Unassign company",children:n.jsx(le,{path:ut,size:.55,className:"inline"})})]})})})(),x.length>5&&n.jsxs("div",{className:"mb-2 relative",children:[n.jsx(le,{path:ht,size:.65,className:"absolute left-2 top-2 text-gray-400"}),n.jsx("input",{ref:s,type:"text",value:i,onChange:b=>m(b.target.value),placeholder:"Search companies...",className:"w-full pl-8 pr-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),n.jsx("div",{className:"max-h-64 overflow-y-auto",children:x.length===0?n.jsx("div",{className:"text-sm text-gray-500 text-center py-4",children:i?"No companies match your search":r?"No other companies available":"No subscribed companies available"}):n.jsx("div",{className:"space-y-1",children:x.map(b=>n.jsxs("button",{onClick:()=>_(b.id),disabled:d,className:"w-full flex items-center gap-2 p-2 hover:bg-gray-100 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-left",title:`Assign ${b.name} (${b.remainingBooths} booth${b.remainingBooths!==1?"s":""} available)`,children:[b.logo?n.jsx("img",{...(()=>{const v=Ce(b.logo);return v?{src:v.src,srcSet:v.srcSet,sizes:v.sizes}:{src:Ne(b.logo)}})(),alt:b.name,className:"w-8 h-8 object-contain flex-shrink-0"}):n.jsx(le,{path:Ie,size:1.2,className:"text-gray-400 flex-shrink-0"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm text-gray-800 truncate",children:b.name}),n.jsxs("div",{className:"text-xs text-gray-500",children:[b.remainingBooths," of ",b.totalBooths," booth",b.totalBooths!==1?"s":""," available"]})]})]},b.id))})}),d&&n.jsx("div",{className:"mt-2 text-xs text-center text-blue-600",children:"Processing..."})]})}function Pe({safeMarkers:e,updateMarker:t,isMarkerDraggable:o,selectedYear:a,isAdminView:l,selectedMarkerId:d,onMarkerSelect:f,currentZoom:i,applyVisitorSizing:m=!1,onMarkerDrag:s=null}){const r=Oe("md"),[x,_]=c.useState(null),S=l&&d!==void 0?e.find(g=>g.id===d):x,b=l&&f?g=>f(g?g.id:null):_,{organizationLogo:v}=Se(),[E,N]=c.useState({isOpen:!1,position:null,marker:null}),[H,O]=c.useState(!1),{subscriptions:p}=Je(a||new Date().getFullYear()),{assignments:D,assignCompanyToMarker:R,unassignCompanyFromMarker:X}=Ve(a||new Date().getFullYear()),{confirm:G}=qe(),ce=c.useCallback(g=>T=>{const{lat:P,lng:V}=T.target.getLatLng();t(g,{lat:P,lng:V}),s&&s(g,P,V)},[t,s]),te=c.useCallback(g=>T=>{l&&(M.DomEvent.preventDefault(T),N({isOpen:!0,position:T.latlng,marker:g,timestamp:Date.now()}))},[l]),Q=c.useCallback(async(g,T)=>{var V,W;const P=D.filter(F=>F.marker_id===g);if(P.length>0){const F=(V=p.find($=>$.company_id===T))==null?void 0:V.company,U=(F==null?void 0:F.name)||"this company",K=e.find($=>$.id===g),Z=(K==null?void 0:K.glyph)||(K==null?void 0:K.id)||"this booth";let B;if(P.length===1){const $=((W=P[0].company)==null?void 0:W.name)||"another company";B=`Booth ${Z} is already assigned to ${$}.

Assign ${U} as an additional company for this booth?`}else{const $=P.map(ne=>{var ie;return(ie=ne.company)==null?void 0:ie.name}).filter(Boolean).join(", ");B=`Booth ${Z} is already assigned to ${P.length} companies: ${$}.

Assign ${U} as another company for this booth?`}if(!await G({title:"Multiple Assignments",message:B,confirmText:"Assign",variant:"warning"}))return}O(!0);try{await R(g,T)}catch(F){console.error("Error assigning company:",F)}finally{O(!1)}},[R,D,p,e,G]),Y=c.useCallback(async(g,T)=>{O(!0);try{await X(g,T)}catch(P){console.error("Error unassigning company:",P)}finally{O(!1)}},[X]);return n.jsxs(n.Fragment,{children:[e.filter(g=>g.id>=1001).map(g=>{const T=[g.lat,g.lng],P=ge(Array.isArray(g.iconSize)?g.iconSize:[17,28],[17,28]),W=et(i,P,!0,l&&!m),F=ze({className:g.type?`marker-icon marker-type-${g.type}`:"marker-icon",prefix:g.prefix,iconUrl:ye(g.iconUrl||`${g.type||"default"}.svg`),iconSize:W,glyph:g.glyph||"?",glyphColor:g.glyphColor||"white",glyphSize:(()=>{if(g.glyphSize){let Z=null;typeof g.glyphSize=="number"?Z=g.glyphSize:typeof g.glyphSize=="string"&&(Z=parseFloat(g.glyphSize.replace(/[^0-9.-]/g,"")));const B=ge(Array.isArray(g.iconSize)?g.iconSize:[17,28],[17,28]),se=B&&B[1]?B[1]:28;if(Z&&se)return`${(W[1]*Z/se).toFixed(2)}px`;if(typeof g.glyphSize=="number")return`${g.glyphSize.toFixed(2)}px`;if(typeof g.glyphSize=="string"){const $=parseFloat(g.glyphSize.replace(/[^0-9.-]/g,""));return Number.isFinite($)?`${$.toFixed(2)}px`:g.glyphSize}return""}return`${Math.round(W[1]*.36)}px`})(),glyphAnchor:(()=>{const Z=ge(Array.isArray(g.iconSize)?g.iconSize:[17,28],[17,28]),B=Z[0]||17,se=Z[1]||28,$=B?W[0]/B:1,ne=se?W[1]/se:1;if(Array.isArray(g.glyphAnchor)&&g.glyphAnchor.length>=2){const ie=parseFloat(g.glyphAnchor[0])||0,ae=parseFloat(g.glyphAnchor[1])||0;return[parseFloat((ie*$).toFixed(2)),parseFloat((ae*ne).toFixed(2))]}return[parseFloat((0*$).toFixed(2)),parseFloat((-5*ne).toFixed(2))]})(),isActive:(S==null?void 0:S.id)===g.id}),U=o(g),K={popupopen:Z=>Z.target.closeTooltip(),...U&&{dragend:ce(g.id)},...l&&{contextmenu:te(g)}};return n.jsx(We,{position:T,icon:F,draggable:U,eventHandlers:K,children:n.jsx(nt,{marker:g,isMobile:r,organizationLogo:v,showBoothNumber:!1,onMoreInfo:()=>{b(g)}})},g.id)}),E.isOpen&&E.marker&&n.jsx(we,{position:E.position,onClose:()=>N({isOpen:!1,position:null,marker:null}),closeButton:!0,closeOnClick:!0,closeOnEscapeKey:!0,autoClose:!1,maxWidth:300,minWidth:250,children:n.jsx(ot,{marker:E.marker,subscriptions:p,assignments:D,onAssign:Q,onUnassign:Y,isLoading:H,onClose:()=>N({isOpen:!1,position:null,marker:null})})},`context-${E.marker.id}-${E.timestamp||Date.now()}`),r&&S&&n.jsx(tt,{marker:S,onClose:()=>b(null)})]})}Pe.propTypes={safeMarkers:y.array,updateMarker:y.func,isMarkerDraggable:y.func,selectedYear:y.number,isAdminView:y.bool,selectedMarkerId:y.number,onMarkerSelect:y.func,currentZoom:y.number,applyVisitorSizing:y.bool,onMarkerDrag:y.func};Pe.defaultProps={applyVisitorSizing:!1};const he={CHUNKED_LOADING:!0,SHOW_COVERAGE_ON_HOVER:!0,SPIDERFY_ON_MAX_ZOOM:!1,REMOVE_OUTSIDE_VISIBLE_BOUNDS:!0,DISABLE_CLUSTERING_AT_ZOOM:17,MAX_CLUSTER_RADIUS:400,MAX_MARKER_ID:1001},ee={FILE:"default.svg",SIZE:[15,25],GLYPH_COLOR:"white",GLYPH_SIZE:"9px",GLYPH_ANCHOR:[0,-4]},Ft=(e,t=!1,o=null,a=null)=>{var f;if(t)return ye("glyph-marker-icon-yellow.svg");if(e.iconUrl)return ye(e.iconUrl);const d=((f=e.assignments)==null?void 0:f.length)>0?o:a;return d!=null&&d.iconUrl?ye(d.iconUrl):ye(`${e.type||"default"}.svg`)},Tt=(e,t=!1,o=!1,a=17,l=!1,d=null,f=null)=>{let i=e.type?`marker-icon marker-type-${e.type}`:"marker-icon";t&&(i+=" marker-active"),o&&(i+=" marker-favorited");const m=ge(Array.isArray(e.iconSize)?e.iconSize:ee.SIZE,ee.SIZE),s=et(a,m,!1,l);return ze({className:i,prefix:e.prefix,iconUrl:Ft(e,o,d,f),iconSize:s,glyph:e.glyph||"",glyphColor:e.glyphColor||ee.GLYPH_COLOR,glyphSize:(()=>{if(e.glyphSize){let r=null;typeof e.glyphSize=="number"?r=e.glyphSize:typeof e.glyphSize=="string"&&(r=parseFloat(e.glyphSize.replace(/[^0-9.-]/g,"")));const x=ge(Array.isArray(e.iconSize)?e.iconSize:ee.SIZE,ee.SIZE),_=x&&x[1]?x[1]:ee.SIZE[1];if(r&&_)return`${(s[1]*r/_).toFixed(2)}px`;if(typeof e.glyphSize=="number")return`${e.glyphSize.toFixed(2)}px`;if(typeof e.glyphSize=="string"){const S=parseFloat(e.glyphSize.replace(/[^0-9.-]/g,""));return Number.isFinite(S)?`${S.toFixed(2)}px`:e.glyphSize}return""}return`${Math.round(s[1]*.33)}px`})(),glyphAnchor:(()=>{const r=ge(Array.isArray(e.iconSize)?e.iconSize:ee.SIZE,ee.SIZE),x=r[0]||ee.SIZE[0],_=r[1]||ee.SIZE[1],S=x?s[0]/x:1,b=_?s[1]/_:1;if(Array.isArray(e.glyphAnchor)&&e.glyphAnchor.length>=2){const v=parseFloat(e.glyphAnchor[0])||0,E=parseFloat(e.glyphAnchor[1])||0;return[parseFloat((v*S).toFixed(2)),parseFloat((E*b).toFixed(2))]}return[parseFloat((ee.GLYPH_ANCHOR[0]*S).toFixed(2)),parseFloat((ee.GLYPH_ANCHOR[1]*b).toFixed(2))]})()})},Dt=e=>`${e.id}-${e.lat}-${e.lng}-${e.iconUrl||""}-${e.glyph||""}`,Rt=c.memo(({marker:e,isDraggable:t,icon:o,eventHandlers:a,markerRef:l,isMobile:d,organizationLogo:f,onMarkerSelect:i})=>n.jsx(We,{position:[e.lat,e.lng],icon:o,draggable:t,eventHandlers:a,ref:l,children:n.jsx(nt,{marker:e,isMobile:d,organizationLogo:f,onMoreInfo:()=>i(e)})}),(e,t)=>{const o=e.icon===t.icon,a=e.isDraggable===t.isDraggable,l=e.eventHandlers===t.eventHandlers;return o&&a&&l?!(e.marker.name!==t.marker.name||e.marker.logo!==t.marker.logo||e.marker.website!==t.marker.website||e.marker.info!==t.marker.info):!1});function Fe({safeMarkers:e,updateMarker:t,isMarkerDraggable:o,iconCreateFunction:a,selectedYear:l,isAdminView:d,selectedMarkerId:f,onMarkerSelect:i,focusMarkerId:m,onFocusHandled:s,currentZoom:r,applyVisitorSizing:x=!1,onMarkerDrag:_=null}){const S=c.useRef({}),b=Oe("md"),[v,E]=c.useState(null),N=d&&f!==void 0?e.find(u=>u.id===f):v,H=d&&i?u=>i(u?u.id:null):E,{organizationLogo:O,loading:p}=Se();let D=null;try{D=Me()}catch{}const R=He.useMemo(()=>D!=null&&D.isFavorite?D.isFavorite:()=>!1,[D]),[X,G]=c.useState({isOpen:!1,position:null,marker:null}),[ce,te]=c.useState(!1),{subscriptions:Q}=Je(l||new Date().getFullYear()),{assignments:Y,assignCompanyToMarker:g,unassignCompanyFromMarker:T}=Ve(l||new Date().getFullYear()),[P,V]=c.useState({assigned:null,unassigned:null});c.useEffect(()=>{const u=async()=>{try{const{data:C,error:k}=await je.from("markers_appearance").select("*").in("id",[-1,-2]).eq("event_year",0);if(k)throw k;const h=C.find(A=>A.id===-1)||{},w=C.find(A=>A.id===-2)||{};V({assigned:h,unassigned:w})}catch(C){console.error("Error loading default markers:",C)}};u();const I=je.channel("default-markers-changes").on("postgres_changes",{event:"*",schema:"public",table:"markers_appearance",filter:"event_year=eq.0"},()=>{u()}).subscribe();return()=>{je.removeChannel(I)}},[]);const{confirm:W,toastError:F}=qe(),U=c.useMemo(()=>e.filter(u=>u.id<he.MAX_MARKER_ID),[e]),K=c.useCallback(u=>I=>{const{lat:C,lng:k}=I.target.getLatLng();t(u,{lat:C,lng:k}),_&&_(u,C,k)},[t,_]),Z=c.useCallback(u=>(S.current[u]||(S.current[u]=He.createRef()),S.current[u]),[]),B=c.useCallback(u=>I=>{d&&(M.DomEvent.preventDefault(I),G({isOpen:!0,position:I.latlng,marker:u,timestamp:Date.now()}))},[d]),se=c.useCallback(async(u,I)=>{var h,w;if(!e.some(A=>A.id===u)){F(`Cannot assign to marker ${u} - marker does not exist`);return}const k=Y.filter(A=>A.marker_id===u);if(k.length>0){const A=(h=Q.find(J=>J.company_id===I))==null?void 0:h.company,j=(A==null?void 0:A.name)||"this company",z=e.find(J=>J.id===u),oe=(z==null?void 0:z.glyph)||(z==null?void 0:z.id)||"this booth";let de;if(k.length===1){const J=((w=k[0].company)==null?void 0:w.name)||"another company";de=`Booth ${oe} is already assigned to ${J}.

Assign ${j} as an additional company for this booth?`}else{const J=k.map(ve=>{var be;return(be=ve.company)==null?void 0:be.name}).filter(Boolean).join(", ");de=`Booth ${oe} is already assigned to ${k.length} companies: ${J}.

Assign ${j} as another company for this booth?`}if(!await W({title:"Multiple Assignments",message:de,confirmText:"Assign",variant:"warning"}))return}te(!0);try{await g(u,I)}catch(A){console.error("Error assigning company:",A)}finally{te(!1)}},[g,Y,Q,e,F,W]),$=c.useCallback(async(u,I)=>{te(!0);try{await T(u,I)}catch(C){console.error("Error unassigning company:",C)}finally{te(!1)}},[T]),ne=c.useRef({}),ie=c.useCallback(u=>{const I=`${u.id}-${o?"draggable":"static"}-${d?"admin":"visitor"}`;if(!ne.current[I]){const C={popupopen:k=>k.target.closeTooltip()};o&&(C.dragend=K(u.id)),d&&(C.contextmenu=B(u)),ne.current[I]=C}return ne.current[I]},[o,K,d,B]),ae=c.useRef({}),xe=c.useCallback((u,I)=>{var A,j,z;const C=u.companyId?R(u.companyId):!1,k=Et(r),h=d&&!x,w=`${u.id}-${u.iconUrl||""}-${u.glyph||""}-${u.glyphColor||""}-${I}-${C}-${k}-${JSON.stringify(u.iconSize||ee.SIZE)}-${u.glyphSize}-${h}-${((A=P.assigned)==null?void 0:A.iconUrl)||""}-${((j=P.unassigned)==null?void 0:j.iconUrl)||""}-${((z=u.assignments)==null?void 0:z.length)||0}`;return ae.current[w]||(ae.current[w]=Tt(u,I,C,r,h,P.assigned,P.unassigned)),ae.current[w]},[R,r,d,x,P]);return c.useEffect(()=>{const u=new Set(U.map(I=>I.id));Object.keys(ne.current).forEach(I=>{const C=parseInt(I.split("-")[0],10);u.has(C)||delete ne.current[I]}),Object.keys(ae.current).forEach(I=>{const C=parseInt(I.split("-")[0],10);u.has(C)||delete ae.current[I]})},[U]),c.useEffect(()=>{if(!m)return;const I=setTimeout(()=>{const C=S.current[m];C!=null&&C.current&&(C.current.openPopup(),s&&s())},1200);return()=>clearTimeout(I)},[m,U,s]),p?null:n.jsxs(n.Fragment,{children:[n.jsx(yt,{chunkedLoading:he.CHUNKED_LOADING,showCoverageOnHover:he.SHOW_COVERAGE_ON_HOVER,spiderfyOnMaxZoom:he.SPIDERFY_ON_MAX_ZOOM,removeOutsideVisibleBounds:he.REMOVE_OUTSIDE_VISIBLE_BOUNDS,disableClusteringAtZoom:he.DISABLE_CLUSTERING_AT_ZOOM,maxClusterRadius:he.MAX_CLUSTER_RADIUS,iconCreateFunction:a,children:U.map(u=>{const I=(N==null?void 0:N.id)===u.id,C=xe(u,I),k=o(u),h=Dt(u);return n.jsx(Rt,{marker:u,isDraggable:k,icon:C,eventHandlers:ie(u),markerRef:Z(u.id),isMobile:b,organizationLogo:O,onMarkerSelect:H},h)})},"cluster-group"),X.isOpen&&X.marker&&n.jsx(we,{position:X.position,onClose:()=>G({isOpen:!1,position:null,marker:null}),closeButton:!0,closeOnClick:!0,closeOnEscapeKey:!0,autoClose:!1,maxWidth:300,minWidth:250,children:n.jsx(ot,{marker:X.marker,subscriptions:Q,assignments:Y,onAssign:se,onUnassign:$,isLoading:ce,onClose:()=>G({isOpen:!1,position:null,marker:null})})},`context-${X.marker.id}-${X.timestamp||Date.now()}`),b&&N&&n.jsx(tt,{marker:N,onClose:()=>H(null)})]})}Fe.propTypes={safeMarkers:y.arrayOf(y.shape({id:y.number.isRequired,lat:y.number.isRequired,lng:y.number.isRequired,type:y.string,iconUrl:y.string,iconSize:y.arrayOf(y.number),glyph:y.string,glyphColor:y.string,glyphSize:y.oneOfType([y.string,y.number]),glyphAnchor:y.arrayOf(y.number),prefix:y.string,name:y.string,logo:y.string,website:y.string,info:y.string,companyId:y.number})).isRequired,updateMarker:y.func.isRequired,isMarkerDraggable:y.func.isRequired,iconCreateFunction:y.func.isRequired,selectedYear:y.number,isAdminView:y.bool,selectedMarkerId:y.number,onMarkerSelect:y.func,focusMarkerId:y.number,onFocusHandled:y.func,currentZoom:y.number,applyVisitorSizing:y.bool,onMarkerDrag:y.func};Fe.defaultProps={selectedYear:new Date().getFullYear(),isAdminView:!1,selectedMarkerId:null,onMarkerSelect:null,focusMarkerId:null,onFocusHandled:null,currentZoom:17,applyVisitorSizing:!1};function Ae(e){return At(e)}function st(e){var f,i,m,s;if(((f=e==null?void 0:e.options)==null?void 0:f.opacity)===0||((i=e==null?void 0:e.options)==null?void 0:i.interactive)===!1)return null;const t=(s=(m=e==null?void 0:e.options)==null?void 0:m.icon)==null?void 0:s.options,o=e.getLatLng();let a;if(t&&(t.glyph!==void 0||t.prefix!==void 0)&&M.icon&&M.icon.glyph){const r={iconUrl:Ae(t.iconUrl),iconSize:t.iconSize||[25,41],iconAnchor:t.iconAnchor||[12,41],popupAnchor:t.popupAnchor||[1,-34],shadowUrl:Ae(t.shadowUrl),shadowSize:t.shadowSize,shadowAnchor:t.shadowAnchor,prefix:t.prefix||"",glyph:t.glyph||"",glyphColor:t.glyphColor||"white",bgColor:t.bgColor,glyphSize:t.glyphSize||"11px",glyphAnchor:t.glyphAnchor||[0,0],className:t.className||""};a=M.icon.glyph(r)}else t!=null&&t.iconUrl?a=M.icon({iconUrl:Ae(t.iconUrl),iconSize:t.iconSize,iconAnchor:t.iconAnchor,popupAnchor:t.popupAnchor,shadowUrl:Ae(t.shadowUrl),shadowSize:t.shadowSize,shadowAnchor:t.shadowAnchor,className:t.className||""}):a=new M.Icon.Default;const d=M.marker(o,{...e.options,icon:a});return e.getPopup&&e.getPopup()&&d.bindPopup(e.getPopup().getContent()),d}function Ut(e){const t=[],o=e._group||e;try{o.eachLayer(d=>{if(d instanceof M.Marker){const f=st(d);f&&t.push(f)}})}catch(d){console.warn("[PrintCloner] Failed to iterate cluster markers:",d)}const a=o.options||{};let l;return typeof M.markerClusterGroup=="function"?l=M.markerClusterGroup(a):l=M.layerGroup(),typeof l.addLayers=="function"?l.addLayers(t):t.forEach(d=>l.addLayer(d)),l}function Zt(e){e&&e.zoomIn()}function Bt(e){e&&e.zoomOut()}function $t(e,t,o){e&&e.setView(t,o)}const kt={appearance:"none",WebkitAppearance:"none",MozAppearance:"none",outline:"none",background:"#fff",border:"2px solid #1976d2",borderRadius:4,width:18,height:18,display:"inline-block",position:"relative",marginRight:8,cursor:"pointer",verticalAlign:"middle"};function Ht({mapInstance:e,mapCenter:t,mapZoom:o,searchControlRef:a,isAdminView:l,showLayersMenu:d,setShowLayersMenu:f,activeLayer:i,setActiveLayer:m,showRectanglesAndHandles:s,setShowRectanglesAndHandles:r,MAP_LAYERS:x}){const _=()=>Zt(e),S=()=>Bt(e),b=()=>$t(e,t,o);return n.jsxs("div",{className:"map-controls-print-hide",style:{position:"absolute",top:10,right:10,zIndex:1e3,display:"flex",flexDirection:"column",gap:"10px"},children:[n.jsxs("button",{onClick:b,"aria-label":"Home",className:"bg-white rounded-full shadow p-2 flex items-center justify-center",style:{width:44,height:44},children:[n.jsx(It,{size:28,color:"#1976d2","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Home"})]}),n.jsxs("button",{onClick:_,"aria-label":"Zoom in",className:"bg-white rounded-full shadow p-2 mb-2 flex items-center justify-center",style:{width:44,height:44},children:[n.jsx(jt,{size:28,color:"#1976d2","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Zoom in"})]}),n.jsxs("button",{onClick:S,"aria-label":"Zoom out",className:"bg-white rounded-full shadow p-2 mb-2 flex items-center justify-center",style:{width:44,height:44},children:[n.jsx(Ct,{size:28,color:"#1976d2","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Zoom out"})]}),!1,l&&n.jsxs("div",{style:{position:"relative"},children:[n.jsxs("button",{"aria-label":"Map layers",className:"bg-white rounded-full shadow p-2 flex items-center justify-center mt-0 hover:bg-gray-100 focus:outline-none",style:{width:44,height:44},onClick:()=>f(v=>!v),children:[n.jsx(le,{path:pt,size:1.2,color:"#1976d2"}),n.jsx("span",{className:"sr-only",children:"Map layers"})]}),d&&n.jsxs("div",{className:"absolute right-0 mt-2 bg-white rounded shadow-lg border z-50",style:{minWidth:200,padding:8,color:"#1976d2"},role:"menu","aria-label":"Layer selection",children:[n.jsx("div",{className:"font-semibold mb-2",children:"Base Layers"}),x.map(v=>n.jsx("button",{className:`w-full text-left px-2 py-1 rounded hover:bg-blue-50 ${i===v.key?"bg-blue-50 font-bold":""}`,onClick:()=>m(v.key),role:"menuitem",style:{color:"#1976d2"},children:v.name},v.key)),n.jsx("div",{className:"font-semibold mt-4 mb-2",children:"Map Features"}),n.jsxs("label",{className:"flex items-center px-2 py-1 cursor-pointer hover:bg-blue-50 rounded",style:{color:"#1976d2"},children:[n.jsx("input",{type:"checkbox",checked:s,onChange:v=>r(v.target.checked),style:kt}),n.jsx("span",{style:{position:"relative",left:-26,width:18,height:18,pointerEvents:"none",display:s?"inline-block":"none"},children:n.jsx("svg",{width:"18",height:"18",viewBox:"0 0 18 18",style:{position:"absolute",top:0,left:0},children:n.jsx("polyline",{points:"4,9 8,13 14,5",stroke:"#1976d2",strokeWidth:"2.5",fill:"none"})})}),n.jsx("span",{style:{marginLeft:s?-8:0},children:"Booth Surface"})]})]})]})]})}function it({isActive:e,onClick:t,favoritesCount:o,isAdminView:a}){return n.jsx("button",{onClick:t,className:`
        rounded-full shadow-md
        flex items-center justify-center
        transition-all duration-200
        ${e?"bg-yellow-100 border-2 border-yellow-300":"bg-white border-2 border-transparent hover:bg-gray-50"}
      `,style:{position:"absolute",top:a?"110px":"60px",left:"10px",zIndex:1002,width:"44px",height:"44px"},title:e?`Showing ${o} favorite${o!==1?"s":""} only`:`Show ${o} favorite${o!==1?"s":""} only`,"aria-label":e?"Show all exhibitors":"Show favorites only","aria-pressed":e,children:n.jsx(le,{path:gt,size:1,className:e?"text-yellow-600":"text-gray-400"})})}it.propTypes={isActive:y.bool.isRequired,onClick:y.func.isRequired,favoritesCount:y.number.isRequired};function Gt(e){return function(o){const a=wt(e),l="/Map".endsWith("/")?"/Map":"/Map/";return ze({iconUrl:`${l}assets/icons/glyph-marker-icon-orange.svg`,iconSize:[25,41],iconAnchor:[25,41],glyph:`<div style='display:flex;align-items:center;justify-content:center;width:100%;height:100%;'>
  <img src='${a}' alt='logo' style='width:20px;height:20px;object-fit:contain;display:block;margin:auto;position:relative;left:1px;top:10px;' />
      </div>`,glyphColor:"white",glyphSize:"20px",glyphAnchor:[-1,-7],className:"custom-cluster-icon"})}}function Yt(e){return e.angle||0}function ue(e,t,o){const a=o*Math.PI/180,l=e*Math.cos(a)-t*Math.sin(a),d=e*Math.sin(a)+t*Math.cos(a);return[l,d]}function fe(e){return e/111320}function me(e,t){return e/(40075e3*Math.cos(t*Math.PI/180)/360)}function Wt(e){return e*111320}function Kt(e,t){return e*(40075e3*Math.cos(t*Math.PI/180)/360)}function qt({mapInstance:e,markers:t,rectangleSize:o,isAdminView:a,showRectanglesAndHandles:l,updateMarker:d,rectangleLayerRef:f}){if(!e)return;f.current||(f.current=M.layerGroup(),f.current.addTo(e));const i=f.current;i._markerLayers||(i._markerLayers={}),Object.keys(i._markerLayers).forEach(m=>{t.find(s=>s.id===m)||(i.removeLayer(i._markerLayers[m].rectangle),i.removeLayer(i._markerLayers[m].handle),delete i._markerLayers[m])}),t.forEach(m=>{if(m.lat&&m.lng){const s=M.latLng(m.lat,m.lng),r=Array.isArray(m.rectangle)&&m.rectangle.length===2?m.rectangle:o,x=Number(r[0])/2,_=Number(r[1])/2,S=Yt(m),b="#1976d2",v=[ue(-x,-_,S),ue(x,-_,S),ue(x,_,S),ue(-x,_,S)],E=v.map(([O,p])=>M.latLng(s.lat+fe(p),s.lng+me(O,s.lat)));let N,H;if(i._markerLayers[m.id]){N=i._markerLayers[m.id].rectangle,N.setLatLngs(E),H=i._markerLayers[m.id].handle;const[O,p]=v[2],D=M.latLng(s.lat+fe(p),s.lng+me(O,s.lat));H.setLatLng(D)}else{N=M.polygon(E,{color:b,weight:1});const[O,p]=v[2],D=M.latLng(s.lat+fe(p),s.lng+me(O,s.lat));let R;if(a&&!m.coreLocked){const X=M.divIcon({className:"rotation-handle-icon",html:'<div style="width:8px;height:8px;background:#1976d2;border-radius:50%;"></div>',iconSize:[8,8],iconAnchor:[4,4]});R=M.marker(D,{icon:X,draggable:!0,interactive:!0,keyboard:!0,title:"Drag to rotate"}),R.on("dragstart",function(){e&&e.dragging.disable()});let G=S;R.on("drag",function(ce){const te=ce.target.getLatLng(),Q=Kt(te.lng-s.lng,s.lat),Y=Wt(te.lat-s.lat);let T=Math.atan2(Y,Q)*180/Math.PI;T<0&&(T+=360),G=T;const P=[ue(-x,-_,G),ue(x,-_,G),ue(x,_,G),ue(-x,_,G)],V=P.map(([K,Z])=>M.latLng(s.lat+fe(Z),s.lng+me(K,s.lat)));N.setLatLngs(V);const[W,F]=P[2],U=M.latLng(s.lat+fe(F),s.lng+me(W,s.lat));R.setLatLng(U)}),R.on("dragend",function(){e&&e.dragging.enable(),d(m.id,{angle:G})})}else{const X=M.divIcon({className:"rotation-handle-icon",html:'<div style="width:8px;height:8px;background:#1976d2;border-radius:50%;opacity:0.5;"></div>',iconSize:[8,8],iconAnchor:[4,4]});R=M.marker(D,{icon:X,draggable:!1,interactive:!1,keyboard:!1,title:"Locked"})}i.addLayer(N),i.addLayer(R),i._markerLayers[m.id]={rectangle:N,handle:R}}}}),Object.values(i._markerLayers).forEach(({rectangle:m,handle:s})=>{l?(i.addLayer(m),i.addLayer(s)):(i.removeLayer(m),i.removeLayer(s))})}const at=e=>[e.name,e.glyph,e.label].filter(Boolean).join(" | "),Ye=(e,t)=>t&&e&&e.coreLocked===!1;function Xt(){const e=c.useCallback(o=>{},[]),t=c.useCallback(o=>{},[]);return{trackMarkerView:e,trackMapInteraction:t}}function Qt(e,t,o={}){const a=c.useRef(null),[l,d]=c.useState(null),f=c.useMemo(()=>JSON.stringify(o),[o]);return c.useEffect(()=>{if(!e)return;if(t&&typeof t.addLayer=="function"){d(t);return}const i=M.layerGroup();(Array.isArray(t)?t:[]).forEach(s=>{if(s&&s.lat&&s.lng){const r=at(s),x=M.marker([s.lat,s.lng],{opacity:0,interactive:!1});x.feature={type:"Feature",properties:{searchText:r}},x.bindPopup(s.name||s.label||""),i.addLayer(x)}}),d(i)},[e,t]),c.useEffect(()=>{if(!e||!l)return;const i={layer:l,propertyName:"searchText",initial:!1,zoom:q.SEARCH_ZOOM,marker:{icon:!1,animate:!0,circle:{radius:8,color:"#d32f2fff",weight:2,fillOpacity:.15}},textPlaceholder:"Search for name or booth...",position:"topleft"},m=Object.assign({},i,o||{});o&&o.marker&&(m.marker=Object.assign({},i.marker,o.marker),o.marker.circle&&(m.marker.circle=Object.assign({},i.marker.circle,o.marker.circle)));const s=new M.Control.Search(m);return e.addControl(s),a.current=s,s.on("search:locationfound",r=>{var x;if((x=r==null?void 0:r.layer)!=null&&x.getLatLng){const _=r.layer.getLatLng();e.flyTo(_,m.zoom,{animate:!0});const S=()=>{try{s._markerSearch?e.hasLayer&&e.hasLayer(s._markerSearch)?e.removeLayer(s._markerSearch):typeof s._markerSearch.remove=="function"&&s._markerSearch.remove():s._marker&&(e.hasLayer&&e.hasLayer(s._marker)?e.removeLayer(s._marker):typeof s._marker.remove=="function"&&s._marker.remove())}catch{}},b=()=>S();e.on&&e.on("zoomstart",b),s._input&&s._input.blur(),s.hideAlert&&s.hideAlert(),s.collapse&&s.collapse()}}),()=>{try{e&&typeof e.off=="function"&&e.off("zoomstart",zoomStartHandler)}catch{}e&&s&&(e.removeControl(s),a.current=null)}},[e,l,f,o]),a}function Jt(e){const{settings:t,loading:o}=St(),{settings:a,loading:l}=Nt(e),d=o||l;return{MAP_CONFIG:c.useMemo(()=>{if(o)return q;const i=a||t;return{DEFAULT_POSITION:[(i==null?void 0:i.map_center_lat)??q.DEFAULT_POSITION[0],(i==null?void 0:i.map_center_lng)??q.DEFAULT_POSITION[1]],ADMIN_DEFAULT_POSITION:q.ADMIN_DEFAULT_POSITION,DEFAULT_ZOOM:(i==null?void 0:i.map_default_zoom)??q.DEFAULT_ZOOM,ADMIN_DEFAULT_ZOOM:q.ADMIN_DEFAULT_ZOOM,MIN_ZOOM:(i==null?void 0:i.map_min_zoom)??q.MIN_ZOOM,MAX_ZOOM:(i==null?void 0:i.map_max_zoom)??q.MAX_ZOOM,SEARCH_ZOOM:(i==null?void 0:i.map_search_zoom)??q.SEARCH_ZOOM,ZOOM_DELTA:q.ZOOM_DELTA,ZOOM_SNAP:q.ZOOM_SNAP,RECTANGLE_SIZE:q.RECTANGLE_SIZE,MINIMAP:q.MINIMAP}},[t,a,o]),MAP_LAYERS:Mt,BRANDING_CONFIG:Lt,loading:d,usingEventSettings:!!a}}const Vt=c.lazy(()=>ct(()=>import("./AdminMarkerPlacement-8f481bfd.js"),["assets/AdminMarkerPlacement-8f481bfd.js","assets/vendor-react-3437b308.js","assets/vendor-3047817a.js","assets/vendor-4b398481.css","assets/vendor-i18n-2e1fa53c.js"]));delete M.Icon.Default.prototype._getIconUrl;M.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});function Te({isAdminView:e,markersState:t,updateMarker:o,selectedYear:a,selectedMarkerId:l,onMarkerSelect:d,previewUseVisitorSizing:f=!1,editMode:i=!1,onMarkerDrag:m=null,onMapReady:s=null}){const{MAP_CONFIG:r,MAP_LAYERS:x}=Jt(a),[_,S]=c.useState({}),[b,v]=c.useState(!1),[E,N]=c.useState(x[0].key),[H,O]=c.useState(!1),[p,D]=c.useState(null),[R,X]=c.useState(null),{organizationLogo:G}=Se(),[ce,te]=dt(),Q=`exhibitors_showFavoritesOnly_${a}`,[Y,g]=c.useState(()=>{try{return localStorage.getItem(Q)==="true"}catch{return!1}}),[T,P]=c.useState(r.DEFAULT_ZOOM),[V,W]=c.useState(null);let F=null;try{F=Me()}catch{}const U=(F==null?void 0:F.favorites)||[],K=(F==null?void 0:F.isFavorite)||(()=>!1),{t:Z}=Ee(),B=Qt(p,R,{textPlaceholder:Z("map.searchPlaceholder")}),se=c.useRef(null),$=c.useRef(!1),[ne,ie]=c.useState(null),ae=c.useMemo(()=>Gt(G),[G]),xe=Oe();Xt();const u=c.useMemo(()=>Array.isArray(t)?t:[],[t]),I=c.useMemo(()=>!Y||U.length===0?u:u.filter(h=>h.companyId&&K(h.companyId)),[u,Y,U,K]);c.useEffect(()=>{u.forEach(h=>{if(h.logo){const w=new window.Image,A=Ce(h.logo);A&&"srcSet"in A?(w.src=A.src,w.srcset=A.srcSet):w.src=Ne(h.logo)}})},[u]),c.useEffect(()=>{try{localStorage.setItem(Q,Y?"true":"false")}catch{}},[Q,Y]),c.useEffect(()=>{try{const h=localStorage.getItem(Q);g(h==="true")}catch{}},[Q]),c.useEffect(()=>{if(U&&U.length===0&&Y){try{localStorage.setItem(Q,"false")}catch{}g(!1)}},[U,Q,Y]),c.useEffect(()=>{if(!p)return;let h=null;const w=()=>{h&&cancelAnimationFrame(h),h=requestAnimationFrame(()=>{try{const j=p.getZoom();W(j)}catch{}})},A=()=>{const j=p.getZoom();W(null),P(j);try{}catch{}};return P(p.getZoom()),p.on("zoom",w),p.on("zoomanim",w),p.on("zoomend",A),()=>{h&&cancelAnimationFrame(h),p.off("zoom",w),p.off("zoomanim",w),p.off("zoomend",A)}},[p]),c.useEffect(()=>{p&&qt({mapInstance:p,markers:u,rectangleSize:r.RECTANGLE_SIZE,isAdminView:e,showRectanglesAndHandles:H,updateMarker:o,rectangleLayerRef:se})},[p,u,e,H,o]),c.useEffect(()=>{if(!p)return;const h=M.layerGroup();u.forEach(w=>{if(w.lat&&w.lng){const A=at(w),j=M.marker([w.lat,w.lng],{opacity:0,interactive:!1});j.feature={type:"Feature",properties:{searchText:A}},j.bindPopup(w.name||w.label||""),j._markerId=w.id,h.addLayer(j)}}),X(h)},[p,u]),c.useEffect(()=>{const h=B&&B.current;if(!p||!R||!h)return;const w=A=>{if(A!=null&&A.layer){const j=A.layer._markerId;j&&setTimeout(()=>ie(j),800),h._input&&h._input.blur(),h.hideAlert&&h.hideAlert(),h.collapse&&h.collapse()}};return h.on("search:locationfound",w),()=>{h.off("search:locationfound",w)}},[p,R,!!(B&&B.current)]),c.useEffect(()=>{if(p&&!p._minimapControl){const h=M.tileLayer(x[0].url,{attribution:"",minZoom:0,maxZoom:16}),w=new M.Control.MiniMap(h,{position:"bottomright",width:r.MINIMAP.WIDTH,height:r.MINIMAP.HEIGHT,zoomLevelFixed:r.MINIMAP.ZOOM_LEVEL,toggleDisplay:!0,centerFixed:r.DEFAULT_POSITION,aimingRectOptions:{color:r.MINIMAP.AIMING_COLOR,weight:2,opacity:.9,fillOpacity:.1,fill:!0},shadowRectOptions:{color:r.MINIMAP.SHADOW_COLOR,weight:1,opacity:.5,fillOpacity:.05,fill:!0},strings:{hideText:"Hide MiniMap",showText:"Show MiniMap"}});w.addTo(p),p._minimapControl=w}},[p]),c.useEffect(()=>{if(!p||!u.length||$.current)return;const h=ce.get("focus");if(h){const w=parseInt(h,10),A=u.find(j=>j.id===w);A&&A.lat&&A.lng&&(setTimeout(()=>{p.flyTo([A.lat,A.lng],r.SEARCH_ZOOM,{animate:!0,duration:1}),ie(w)},300),$.current=!0,te({},{replace:!0}))}},[p,u,ce,te]);const C=h=>{const w=(h==null?void 0:h.target)||h;if(!w._browserPrintInitialized)if(window.L&&window.L.BrowserPrint&&window.L.BrowserPrint.Mode&&window.L.browserPrint){const A=window.L.BrowserPrint.Mode,j=[A.Landscape("A2",{title:"A2 — Landscape (large floor plan)"}),A.Portrait("A2",{title:"A2 — Portrait (large floor plan)"}),A.Landscape("A3",{title:"A3 — Landscape"}),A.Portrait("A3",{title:"A3 — Portrait"}),A.Landscape("A4",{title:"A4 — Landscape"}),A.Portrait("A4",{title:"A4 — Portrait"}),A.Landscape("A4",{title:"Current view — landscape"}),A.Auto("A4",{title:"Auto fit"}),A.Custom("A4",{title:"Select area",customArea:!0})];window.L.BrowserPrint&&window.L.BrowserPrint.Utils&&(window.L.BrowserPrint.Utils.registerLayer(M.Marker,"L.Marker",st),window.L.MarkerClusterGroup&&(window.L.BrowserPrint.Utils.registerLayer(window.L.MarkerClusterGroup,"L.MarkerClusterGroup",Ut),console.log("[Print] ✓ Registered MarkerClusterGroup cloner")),console.log("[Print] ✓ Registered custom marker cloner (absolute URLs + font preservation)"));try{const z=window.L.browserPrint(w,{printModes:j,closePopupsOnPrint:!1});w.printControl={browserPrint:z,options:{printModes:j}},w._browserPrintInitialized=!0,console.log("✓ BrowserPrint plugin initialized successfully with",j.length,"modes");let oe=null;z._map.on(window.L.BrowserPrint.Event.PrePrint,de=>{var De,Re,Ue,Ze,Be,$e;const pe=de.pageOrientation,J=((Re=(De=de.mode)==null?void 0:De.options)==null?void 0:Re.title)||"unknown";console.log("[Print] PrePrint event - mode:",J,"| orientation:",pe);try{const re=((Ze=(Ue=de.printLayer)==null?void 0:Ue._container)==null?void 0:Ze.ownerDocument)||(($e=(Be=de.printMap)==null?void 0:Be._container)==null?void 0:$e.ownerDocument);if(re&&re.head&&!re.querySelector('link[href*="materialdesignicons"]')){const _e=re.createElement("link");_e.rel="stylesheet",_e.href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css",re.head.appendChild(_e),console.log("[Print] ✓ Injected Material Design Icons stylesheet")}}catch(re){console.warn("[Print] Could not inject MDI stylesheet:",re)}const ve=J.toLowerCase().includes("current view"),be=J.toLowerCase().includes("auto"),rt=J.toLowerCase().includes("select area")||J.toLowerCase().includes("custom");if(ve||be||rt){console.log("[Print] ✓ Using current map position (no center change)");return}if(pe==="Portrait"||pe==="Landscape"){console.log("[Print] Setting fixed home center for:",J),oe={center:z._map.getCenter(),zoom:z._map.getZoom()};const re=pe==="Portrait"?[51.89664504222346,5.7749867622508875]:r.DEFAULT_POSITION,ke=pe==="Portrait"?18:r.DEFAULT_ZOOM;z._map.setView(re,ke,{animate:!1})}}),z._map.on(window.L.BrowserPrint.Event.PrintEnd,()=>{console.log("PrintEnd event fired!"),oe&&(console.log("Restoring original view after printing"),z._map.setView(oe.center,oe.zoom,{animate:!1}),oe=null)}),z._map.on(window.L.BrowserPrint.Event.PrintCancel,()=>{console.log("PrintCancel event fired!"),oe&&(console.log("Restoring original view after print cancel"),z._map.setView(oe.center,oe.zoom,{animate:!1}),oe=null)})}catch(z){console.error("Failed to initialize L.browserPrint backend:",z)}}else console.warn("BrowserPrint not available, print functionality will fallback to snapshot");if(D(w),typeof s=="function")try{s(w)}catch{}setTimeout(()=>{w&&w.invalidateSize()},100)};c.useEffect(()=>{if(!p)return;let h=null;const w=()=>{try{p._invalidateTimeout&&clearTimeout(p._invalidateTimeout),p._invalidateTimeout=setTimeout(()=>{try{p.invalidateSize()}catch{}p._invalidateTimeout=null},120)}catch{}};try{const j=p.getContainer&&p.getContainer();if(j&&typeof ResizeObserver<"u"){const z=new ResizeObserver(()=>w());z.observe(j),h=()=>z.disconnect()}}catch{}const A=()=>w();return window.addEventListener("resize",A),()=>{try{window.removeEventListener("resize",A)}catch{}h&&h()}},[p]);const k=e?{height:"100%",width:"100%",minHeight:"400px",position:"relative",touchAction:"pan-x pan-y",overflow:"hidden",zIndex:1}:{height:"100svh",width:"100vw",position:"fixed",inset:0,zIndex:0,touchAction:"pan-x pan-y",overflow:"hidden"};return n.jsxs("div",{style:k,tabIndex:0,"aria-label":"Event Map",role:"region",children:[n.jsx(Ht,{mapInstance:p,mapCenter:r.DEFAULT_POSITION,mapZoom:r.DEFAULT_ZOOM,searchControlRef:B,isAdminView:e,showLayersMenu:b,setShowLayersMenu:v,activeLayer:E,setActiveLayer:N,showRectanglesAndHandles:H,setShowRectanglesAndHandles:O,MAP_LAYERS:x,markersState:u}),e&&n.jsx(c.Suspense,{fallback:null,children:n.jsx(Vt,{mapInstance:p,isAdminView:e,updateMarker:o})}),U.length>0&&n.jsx(it,{isActive:Y,onClick:()=>g(!Y),favoritesCount:U.length,isAdminView:e}),n.jsx("div",{id:"map-container",className:e?"w-full h-full":"fixed inset-0 w-full h-full",style:{zIndex:1,height:e?"100%":"100svh",touchAction:"pan-x pan-y",overflow:"hidden"},"aria-label":Z("map.ariaLabel"),children:n.jsxs(xt,{center:e?r.ADMIN_DEFAULT_POSITION:r.DEFAULT_POSITION,zoom:e?r.ADMIN_DEFAULT_ZOOM:r.DEFAULT_ZOOM,minZoom:r.MIN_ZOOM,maxZoom:r.MAX_ZOOM,zoomDelta:r.ZOOM_DELTA,zoomSnap:r.ZOOM_SNAP,zoomControl:!1,style:{width:e?"100%":"100vw",height:e?"100%":"100svh",minHeight:e?"400px":"100svh"},className:"focus:outline-none focus:ring-2 focus:ring-primary",whenReady:C,attributionControl:!1,children:[x.filter(h=>h.key===E).map(h=>n.jsx(bt,{attribution:h.attribution,url:h.url,crossOrigin:"anonymous",maxZoom:r.MAX_ZOOM},h.key)),n.jsx(Fe,{safeMarkers:I,infoButtonToggled:_,setInfoButtonToggled:S,isMobile:xe,updateMarker:o,isMarkerDraggable:h=>Ye(h,e)||i&&h.id===l,iconCreateFunction:ae,selectedYear:a,isAdminView:e,applyVisitorSizing:f,selectedMarkerId:l,onMarkerSelect:d,focusMarkerId:ne,onFocusHandled:()=>ie(null),currentZoom:T,zoomAnimating:V,onMarkerDrag:m}),n.jsx(Pe,{safeMarkers:u,infoButtonToggled:_,setInfoButtonToggled:S,isMobile:xe,updateMarker:o,isMarkerDraggable:h=>Ye(h,e)||i&&h.id===l,selectedMarkerId:l,onMarkerSelect:d,isAdminView:e,applyVisitorSizing:f,selectedYear:a,currentZoom:T,zoomAnimating:V,onMarkerDrag:m})]})})]})}Te.propTypes={isAdminView:y.bool,previewUseVisitorSizing:y.bool,markersState:y.array,updateMarker:y.func.isRequired,selectedYear:y.number,selectedMarkerId:y.number,onMarkerSelect:y.func,editMode:y.bool,onMarkerDrag:y.func};Te.defaultProps={isAdminView:!1,markersState:[],selectedYear:new Date().getFullYear(),selectedMarkerId:null,onMarkerSelect:null,previewUseVisitorSizing:!1,editMode:!1,onMarkerDrag:null};const hn=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{Te as E,hn as a,ye as g};
