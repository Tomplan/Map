import{u as ce,b as me,r as m,a1 as ie,R as e,I as b,m as pe,a2 as be,a3 as ue,ak as de,aj as q,h as F,d as U,e as G,g as xe,al as he,am as ge}from"./index-1e4c7e6c.js";import{u as ye}from"./useEventSubscriptions-6efe7c48.js";import{u as Ee}from"./useCompanies-49571dae.js";import{u as fe}from"./useAssignments-4f6fb97f.js";import{u as Ne}from"./useMarkerGlyphs-bf81b2ba.js";import{P as ve,g as we,f as Ce}from"./PhoneInput-847f9104.js";import"./phone-376c158e.js";function Le({selectedYear:o}){const{t:l}=ce(),{organizationLogo:R}=me(),{subscriptions:g,loading:W,error:$,subscribeCompany:O,updateSubscription:V,unsubscribeCompany:H,archiveCurrentYear:J,copyFromPreviousYear:K}=ye(o),{companies:z}=Ee(),{assignments:A}=fe(o),{markers:I,loading:_e}=Ne(o),[y,Q]=m.useState(""),[X,C]=m.useState(null),[r,i]=m.useState({}),[Z,_]=m.useState(!1),[k,S]=m.useState(""),[d,Y]=m.useState("company"),[E,L]=m.useState("asc"),{confirm:P,toastError:w,toastSuccess:T,toastWarning:ee}=ie(),M=m.useMemo(()=>{const t=new Set(g.map(a=>a.company_id));return z.filter(a=>!t.has(a.id))},[z,g]),B=m.useMemo(()=>{const t={};return A.forEach(a=>{t[a.company_id]||(t[a.company_id]=[]),t[a.company_id].push(a)}),t},[A]),D=m.useMemo(()=>{const t={};return I.forEach(a=>{t[a.id]=a.glyph}),t},[I]),f=m.useCallback(t=>{const a=B[t]||[];if(a.length===0)return"-";const s=a.sort((c,n)=>c.marker_id-n.marker_id).map(c=>D[c.marker_id]||c.marker_id.toString()).filter(Boolean);return s.length>0?s.join(", "):"-"},[B,D]),N=m.useMemo(()=>{let t=g;if(y){const s=y.toLowerCase();t=t.filter(c=>{var n,p;return(p=(n=c.company)==null?void 0:n.name)==null?void 0:p.toLowerCase().includes(s)})}return[...t].sort((s,c)=>{var p,v;let n=0;if(d==="company"){const x=(((p=s.company)==null?void 0:p.name)||"").toLowerCase(),h=(((v=c.company)==null?void 0:v.name)||"").toLowerCase();n=x.localeCompare(h)}else if(d==="booths"){const x=f(s.company_id),h=f(c.company_id);if(x==="-"&&h!=="-")return 1;if(x!=="-"&&h==="-")return-1;if(x==="-"&&h==="-")return 0;n=x.localeCompare(h,void 0,{numeric:!0})}return E==="asc"?n:-n})},[g,y,d,E,f]),u=m.useMemo(()=>N.reduce((t,a)=>(t.booth_count+=a.booth_count||0,t.breakfast_sat+=a.breakfast_sat||0,t.lunch_sat+=a.lunch_sat||0,t.bbq_sat+=a.bbq_sat||0,t.breakfast_sun+=a.breakfast_sun||0,t.lunch_sun+=a.lunch_sun||0,t.coins+=a.coins||0,t),{booth_count:0,breakfast_sat:0,lunch_sat:0,bbq_sat:0,breakfast_sun:0,lunch_sun:0,coins:0}),[N]),te=t=>{C(t.id),i({...t})},ae=async()=>{const{id:t,company:a,...s}=r;await V(t,s),C(null),i({})},ne=()=>{C(null),i({})},se=async t=>{var v;const a=((v=t.company)==null?void 0:v.name)||"this company",s=f(t.company_id),c=s?` and their booth assignments (${s})`:"";if(!await P({title:"Unsubscribe Company",message:`Unsubscribe ${a} from ${o}? This will delete their subscription${c}.`,confirmText:"Unsubscribe",variant:"danger"}))return;const{error:p}=await H(t.id);p&&w(`Error unsubscribing company: ${p}`)},re=async()=>{if(!k){ee("Please select a company");return}const{error:t}=await O(parseInt(k));t?w(`Error subscribing company: ${t}`):(_(!1),S(""))},le=async()=>{if(!await P({title:"Archive Subscriptions",message:`Archive all subscriptions for ${o}? This will move them to the archive and clear the active list.`,confirmText:"Archive",variant:"warning"}))return;const{data:a,error:s}=await J();s?w(`Error archiving: ${s}`):T(`Archived ${a} subscriptions for ${o}`)},oe=async()=>{const t=o-1;if(!await P({title:"Copy Subscriptions",message:`Copy all subscriptions from ${t} to ${o}?`,confirmText:"Copy",variant:"default"}))return;const{error:s}=await K(t);s?w(`Error copying subscriptions: ${s}`):T(`Subscriptions copied from ${t} to ${o}`)},j=t=>{d===t?L(E==="asc"?"desc":"asc"):(Y(t),L("asc"))};return W?e.createElement("div",{className:"p-4"},"Loading subscriptions..."):$?e.createElement("div",{className:"p-4 text-red-600"},"Error: ",$):e.createElement("div",{className:"h-full flex flex-col p-4"},e.createElement("div",{className:"flex items-center justify-between mb-4 flex-shrink-0"},e.createElement("div",{className:"flex items-center gap-2"},e.createElement(b,{path:pe,size:1,className:"text-gray-500"}),e.createElement("input",{type:"text",placeholder:l("helpPanel.subscriptions.searchPlaceholder"),value:y,onChange:t=>Q(t.target.value),className:"px-3 py-2 border rounded-lg"}),e.createElement("span",{className:"text-sm text-gray-600"},N.length," of ",g.length)),e.createElement("div",{className:"flex gap-2"},e.createElement("button",{onClick:oe,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",title:`Copy from ${o-1}`},e.createElement(b,{path:be,size:.8}),"Copy from ",o-1),e.createElement("button",{onClick:le,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700"},e.createElement(b,{path:ue,size:.8}),"Archive ",o),e.createElement("button",{onClick:()=>_(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"},e.createElement(b,{path:de,size:.8}),"Subscribe Company"))),Z&&e.createElement("div",{className:"mb-4 p-4 border rounded-lg bg-blue-50 flex-shrink-0"},e.createElement("h3",{className:"font-bold mb-3"},"Subscribe Company to ",o),e.createElement("div",{className:"flex items-center gap-3"},e.createElement("select",{value:k,onChange:t=>S(t.target.value),className:"flex-1 px-3 py-2 border rounded"},e.createElement("option",{value:""},"Select a company..."),M.map(t=>e.createElement("option",{key:t.id,value:t.id},t.name))),e.createElement("button",{onClick:re,className:"flex items-center gap-1 px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700"},e.createElement(b,{path:q,size:.7}),"Subscribe"),e.createElement("button",{onClick:()=>{_(!1),S("")},className:"flex items-center gap-1 px-3 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"},e.createElement(b,{path:F,size:.7}),"Cancel")),M.length===0&&e.createElement("p",{className:"text-sm text-gray-600 mt-2"},"All companies are already subscribed to ",o)),e.createElement("div",{className:"flex-1 overflow-auto border rounded-lg"},e.createElement("table",{className:"w-full",style:{fontSize:"11px"}},e.createElement("thead",{className:"bg-gray-100 text-gray-900 sticky top-0 z-10"},e.createElement("tr",null,e.createElement("th",{className:"p-2 text-left border-b cursor-pointer hover:bg-gray-200 select-none bg-gray-100",onClick:()=>j("booths"),title:"Click to sort by booth labels",rowSpan:3},e.createElement("div",{className:"flex items-center gap-1"},e.createElement("span",null,"Booths"),d==="booths"&&e.createElement(b,{path:E==="asc"?U:G,size:.6,className:"text-blue-600"}))),e.createElement("th",{className:"p-2 text-left border-b cursor-pointer hover:bg-gray-200 select-none bg-gray-100",onClick:()=>j("company"),title:"Click to sort by company name",rowSpan:3},e.createElement("div",{className:"flex items-center gap-1"},e.createElement("span",null,"Company"),d==="company"&&e.createElement(b,{path:E==="asc"?U:G,size:.6,className:"text-blue-600"}))),e.createElement("th",{className:"p-2 text-left border-b bg-gray-100",rowSpan:3},l("helpPanel.subscriptions.contact")),e.createElement("th",{className:"p-2 text-left border-b bg-gray-100",rowSpan:3},l("helpPanel.subscriptions.phone")),e.createElement("th",{className:"p-2 text-left border-b bg-gray-100",rowSpan:3},l("helpPanel.subscriptions.email")),e.createElement("th",{className:"p-2 text-center border-b bg-gray-100"},l("helpPanel.subscriptions.boothCount")),e.createElement("th",{className:"p-2 text-left border-b bg-gray-100",rowSpan:3},l("helpPanel.subscriptions.area")),e.createElement("th",{className:"p-2 text-center border-b bg-blue-50",colSpan:3},e.createElement("span",{className:"font-bold text-blue-700"},l("helpPanel.subscriptions.saturday"))),e.createElement("th",{className:"p-2 text-center border-b bg-gray-100",colSpan:2},e.createElement("span",{className:"font-bold text-green-700"},l("helpPanel.subscriptions.sunday"))),e.createElement("th",{className:"p-2 text-center border-b bg-gray-100"},l("helpPanel.subscriptions.coins")),e.createElement("th",{className:"p-2 text-left border-b bg-gray-100",rowSpan:3},l("helpPanel.subscriptions.notes")),e.createElement("th",{className:"p-2 text-center border-b bg-gray-100",rowSpan:3,style:{minWidth:"80px"}},l("helpPanel.subscriptions.actions"))),e.createElement("tr",null,e.createElement("th",{className:"p-1 text-center border-b bg-gray-100 text-xs",style:{width:"60px"}}),e.createElement("th",{className:"p-1 text-center border-b bg-blue-50 text-xs",style:{width:"60px"}},l("helpPanel.subscriptions.breakfast")),e.createElement("th",{className:"p-1 text-center border-b bg-blue-50 text-xs",style:{width:"60px"}},l("helpPanel.subscriptions.lunch")),e.createElement("th",{className:"p-1 text-center border-b bg-blue-50 text-xs",style:{width:"60px"}},l("helpPanel.subscriptions.bbq")),e.createElement("th",{className:"p-1 text-center border-b bg-green-50 text-xs",style:{width:"60px"}},l("helpPanel.subscriptions.breakfast")),e.createElement("th",{className:"p-1 text-center border-b bg-green-50 text-xs",style:{width:"60px"}},l("helpPanel.subscriptions.lunch")),e.createElement("th",{className:"p-1 text-center border-b bg-gray-100 text-xs",style:{width:"60px"}})),e.createElement("tr",null,e.createElement("th",{className:"p-1 text-center border-b bg-gray-200 text-xs font-bold",style:{width:"60px"}},u.booth_count),e.createElement("th",{className:"p-1 text-center border-b bg-blue-100 text-xs font-bold text-blue-800",style:{width:"60px"}},u.breakfast_sat),e.createElement("th",{className:"p-1 text-center border-b bg-blue-100 text-xs font-bold text-blue-800",style:{width:"60px"}},u.lunch_sat),e.createElement("th",{className:"p-1 text-center border-b bg-blue-100 text-xs font-bold text-blue-800",style:{width:"60px"}},u.bbq_sat),e.createElement("th",{className:"p-1 text-center border-b bg-green-100 text-xs font-bold text-green-800",style:{width:"60px"}},u.breakfast_sun),e.createElement("th",{className:"p-1 text-center border-b bg-green-100 text-xs font-bold text-green-800",style:{width:"60px"}},u.lunch_sun),e.createElement("th",{className:"p-1 text-center border-b bg-gray-200 text-xs font-bold",style:{width:"60px"}},u.coins))),e.createElement("tbody",null,N.map(t=>{const a=X===t.id,s=t.company,c=f(t.company_id);return e.createElement("tr",{key:t.id,className:"bg-white hover:bg-gray-50 border-b"},e.createElement("td",{className:"p-2 text-left"},e.createElement("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded font-medium"},c)),e.createElement("td",{className:"p-2 text-left"},e.createElement("div",{className:"flex items-center gap-2"},e.createElement("img",{src:xe((s==null?void 0:s.logo)||R),alt:s==null?void 0:s.name,className:"w-8 h-8 object-contain"}),e.createElement("span",{className:"font-semibold text-gray-700"},s==null?void 0:s.name))),e.createElement("td",{className:"p-2 text-left"},a?e.createElement("input",{type:"text",value:r.contact||"",onChange:n=>i({...r,contact:n.target.value}),className:"w-full px-2 py-1 border rounded text-xs bg-white text-gray-900"}):e.createElement("span",{className:"text-xs text-gray-700"},t.contact||"-")),e.createElement("td",{className:"p-2 text-left"},a?e.createElement(ve,{value:r.phone||"",onChange:n=>i({...r,phone:n}),placeholder:"+31612345678",className:"text-xs"}):t.phone?e.createElement("span",{className:"text-xs text-gray-700 flex items-center gap-1"},e.createElement("span",null,we(t.phone)),e.createElement("span",null,Ce(t.phone))):e.createElement("span",{className:"text-xs text-gray-400"},"-")),e.createElement("td",{className:"p-2 text-left"},a?e.createElement("input",{type:"email",value:r.email||"",onChange:n=>i({...r,email:n.target.value.toLowerCase()}),className:"w-full px-2 py-1 border rounded text-xs bg-white text-gray-900"}):e.createElement("span",{className:"text-xs text-gray-700"},t.email||"-")),e.createElement("td",{className:"p-2 text-center"},a?e.createElement("input",{type:"number",min:"1",value:r.booth_count||1,onChange:n=>i({...r,booth_count:parseInt(n.target.value)}),className:"w-16 px-2 py-1 border rounded text-xs text-center bg-white text-gray-900"}):e.createElement("span",{className:"text-xs text-gray-700"},t.booth_count)),e.createElement("td",{className:"p-2"},a?e.createElement("input",{type:"text",value:r.area||"",onChange:n=>i({...r,area:n.target.value}),className:"w-full px-2 py-1 border rounded text-xs bg-white text-gray-900",placeholder:l("helpPanel.subscriptions.areaPlaceholder")}):e.createElement("span",{className:"text-xs text-gray-700"},t.area||"-")),["breakfast_sat","lunch_sat","bbq_sat"].map(n=>e.createElement("td",{key:n,className:"p-2 text-center bg-blue-50"},a?e.createElement("input",{type:"number",min:"0",value:r[n]||0,onChange:p=>i({...r,[n]:parseInt(p.target.value)||0}),className:"w-12 px-1 py-1 border rounded text-xs text-center text-gray-900 bg-white"}):e.createElement("span",{className:"text-xs text-gray-700"},t[n]))),["breakfast_sun","lunch_sun"].map(n=>e.createElement("td",{key:n,className:"p-2 text-center bg-green-50"},a?e.createElement("input",{type:"number",min:"0",value:r[n]||0,onChange:p=>i({...r,[n]:parseInt(p.target.value)||0}),className:"w-12 px-1 py-1 border rounded text-xs text-center text-gray-900 bg-white"}):e.createElement("span",{className:"text-xs text-gray-700"},t[n]))),e.createElement("td",{className:"p-2 text-center"},a?e.createElement("input",{type:"number",min:"0",value:r.coins||0,onChange:n=>i({...r,coins:parseInt(n.target.value)||0}),className:"w-12 px-1 py-1 border rounded text-xs text-center bg-white text-gray-900"}):e.createElement("span",{className:"text-xs text-gray-700"},t.coins)),e.createElement("td",{className:"p-2 text-left"},a?e.createElement("textarea",{value:r.notes||"",onChange:n=>i({...r,notes:n.target.value}),className:"w-full px-2 py-1 border rounded text-xs bg-white text-gray-900",rows:2}):e.createElement("span",{className:"text-xs text-gray-700"},t.notes||"-")),e.createElement("td",{className:"p-2 text-center"},a?e.createElement("div",{className:"flex gap-1 justify-center"},e.createElement("button",{onClick:ae,className:"p-1 bg-green-600 text-white rounded hover:bg-green-700",title:"Save"},e.createElement(b,{path:q,size:.6})),e.createElement("button",{onClick:ne,className:"p-1 bg-gray-500 text-white rounded hover:bg-gray-600",title:"Cancel"},e.createElement(b,{path:F,size:.6}))):e.createElement("div",{className:"flex gap-1 justify-center"},e.createElement("button",{onClick:()=>te(t),className:"p-1 bg-blue-600 text-white rounded hover:bg-blue-700",title:"Edit"},e.createElement(b,{path:he,size:.6})),e.createElement("button",{onClick:()=>se(t),className:"p-1 bg-red-600 text-white rounded hover:bg-red-700",title:"Unsubscribe"},e.createElement(b,{path:ge,size:.6})))))}))),N.length===0&&e.createElement("div",{className:"text-center py-8 text-gray-500"},y?"No subscriptions found matching your search":`No companies subscribed to ${o} yet. Click "Subscribe Company" to add one.`)))}export{Le as default};
