import{r as w,j as e,_ as E}from"./index-ac3d0a13.js";import{F as S}from"./dataExportImport-c676a4e3.js";function C(){const[t,v]=w.useState([]),[d,u]=w.useState(!1),[k,n]=w.useState(""),_=async l=>{var x;const a=(x=l.target.files)==null?void 0:x[0];if(a){u(!0),n("Reading file..."),v([]);try{n("Parsing Excel data...");const r=await a.arrayBuffer();n("Processing workbook...");const c=await E(()=>import("./xlsx-6ed613d4.js"),[]),m=c&&c.default?c.default:c,h=m.read(r,{type:"array"});n("Extracting data...");const f=h.Sheets[h.SheetNames[0]],g=m.utils.sheet_to_json(f,{defval:""});v(g),u(!1),n("")}catch(r){console.error("Error parsing Excel file:",r),u(!1),n("Error loading file"),setTimeout(()=>n(""),3e3)}}},N=async()=>{if(!(t!=null&&t.length))return;const l=Object.keys(t[0]||{}).map(a=>({key:a,header:a,type:typeof(t[0]&&t[0][a])=="number"?"number":"text"}));try{let a;typeof process<"u"&&process.env;{const s=await E(()=>import("./exceljs.min-d72522c9.js").then(o=>o.e),["assets/exceljs.min-d72522c9.js","assets/index-ac3d0a13.js","assets/index-a24218fe.css"]);a=s&&s.default?s.default:s}const x=new a.Workbook,r=x.addWorksheet("Data");l.length&&(r.columns=l.map(s=>({header:s.header,key:s.key}))),r.addRows(t);const c=10,m=60,h=l.map(s=>{let i=String(s.header||"").length;for(const y of t){const b=y[s.key],j=b==null?"":String(b);j.length>i&&(i=j.length)}return{width:Math.min(Math.max(i+2,c),m)}});r.columns.forEach((s,o)=>{h[o]&&(s.width=h[o].width)}),r.views=[{state:"frozen",xSplit:1,ySplit:1,topLeftCell:"B2"}];try{const s=r.getRow(1);for(let o=1;o<=l.length;o++)try{s.getCell(o).protection={locked:!0}}catch{}for(let o=2;o<=(r.rowCount||t.length+1);o++){const i=r.getRow(o);for(let p=1;p<=l.length;p++)try{i.getCell(p).protection={locked:p===1}}catch{}}try{r.protect&&r.protect("",{})}catch{}}catch{}const f=await x.xlsx.writeBuffer(),g=new Blob([f],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});S.saveAs(g,"export.xlsx")}catch(a){console.error("Export error (component):",a)}};return e.jsxs("div",{className:"p-4 space-y-4 bg-white rounded shadow-sm",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Excel"}),e.jsx("input",{"data-testid":"file-input",className:"block w-full text-sm text-gray-900 border rounded p-2",type:"file",accept:".xlsx,.xls,.csv",onChange:_,disabled:d}),d&&e.jsxs("div",{className:"flex items-center space-x-2 p-3 bg-blue-50 rounded border border-blue-200",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm text-blue-700",children:k})]}),t.length>0&&!d&&e.jsx("div",{className:"flex gap-3 pt-2",children:e.jsx("button",{"data-testid":"export-btn",onClick:N,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Export to Excel"})}),t.length>0&&!d&&e.jsxs("div",{className:"transition-all duration-300 ease-in-out",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-2",children:["Preview (",t.length," rows)"]}),e.jsx("div",{className:"bg-gray-50 rounded border",children:e.jsx("pre",{"data-testid":"preview",className:"text-xs p-3 max-h-48 overflow-auto",style:{maxHeight:"12rem",transition:"max-height 0.3s ease-in-out"},children:JSON.stringify(t.slice(0,20),null,2)})}),t.length>20&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Showing first 20 rows of ",t.length," total"]})]}),t.length===0&&!d&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:e.jsx("path",{d:"M34 40h10v-4a6 6 0 00-10.712-3.714M34 40H14m20 0v-4a9.971 9.971 0 00-.712-3.714M14 40H4v-4a6 6 0 0110.713-3.714M14 40v-4a9.971 9.971 0 01.712-3.714M34 40v-4c0-1.313.253-2.566.713-3.714m0 0A10.003 10.003 0 0124 36c-2.186 0-4.216.682-5.713 1.843",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2"})}),e.jsx("p",{className:"mt-2",children:"Upload an Excel file to see preview"})]})]})}export{C as default};
