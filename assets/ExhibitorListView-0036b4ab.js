import{a as U,d as Y,u as J,r as n,e as Q,j as t,I as d,m as Z,f as ee,h as te,i as B,k as se,l as ae,n as oe,o as re}from"./index-c3c9ac92.js";import{F as ne,g as ie}from"./useTranslatedCompanyInfo-77e23049.js";import{u as le}from"./useCategories-5ce23293.js";const ce=[],de=()=>!1,me=()=>{};function pe({markersState:T,selectedYear:$}){var R;const D=U(),{organizationLogo:V}=Y(),{t:i,i18n:I}=J(),[j,G]=n.useState(""),g=`exhibitors_showFavoritesOnly_${$}`,[m,C]=n.useState(()=>{try{return localStorage.getItem(g)==="true"}catch{return!1}}),[l,E]=n.useState(null),[f,K]=n.useState("name"),[u,W]=n.useState("asc"),[b,y]=n.useState(!1),F=n.useRef(null),z=n.useRef(null),P={name:i("exhibitorPage.sortName")||"Name",booth:i("exhibitorPage.sortBooth")||"Booth",favorites:i("exhibitorPage.sortFavoritesBase")||"Favorites"},c=Q(),h=(c==null?void 0:c.favorites)||ce,x=(c==null?void 0:c.isFavorite)||de,X=(c==null?void 0:c.toggleFavorite)||me,{categories:S,loading:N,getAllCompanyCategories:L}=le(I.language),M=n.useMemo(()=>T.filter(e=>e.id<1e3&&e.name),[T]),w=n.useMemo(()=>{const e={};return M.forEach(s=>{s.companyId&&(e[s.companyId]?(e[s.companyId].boothNumbers.push(s.glyph),e[s.companyId].markerIds.push(s.id)):e[s.companyId]={...s,boothNumbers:[s.glyph],markerIds:[s.id],categories:[]})}),Object.values(e).forEach(s=>{s.boothNumbers.sort((a,o)=>(parseInt(a)||0)-(parseInt(o)||0))}),Object.values(e)},[M]),[O,_]=n.useState([]),[ge,k]=n.useState(!1);n.useEffect(()=>{if(N)return;if(w.length===0){_([]),k(!1);return}(async()=>{const s=w.map(r=>r.companyId),a=await L(s),o=w.map(r=>({...r,categories:a[r.companyId]||[]}));_(o),k(!0)})()},[w,N,L,I.language]),n.useEffect(()=>{if(!b)return;const e=s=>{const a=F.current,o=z.current;!a||!o||!a.contains(s.target)&&!o.contains(s.target)&&(y(!1),setTimeout(()=>a&&a.focus(),0))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[b]);const v=n.useMemo(()=>{let e=O;if(m&&(e=e.filter(s=>s.companyId&&x(s.companyId))),l&&(e=e.filter(s=>!s.categories||s.categories.length===0?!1:s.categories.some(a=>a.id===l))),j){const s=j.toLowerCase();e=e.filter(a=>{var o,r;return((o=a.name)==null?void 0:o.toLowerCase().includes(s))||((r=a.boothNumbers)==null?void 0:r.some(p=>p==null?void 0:p.toLowerCase().includes(s)))})}return e},[O,m,l,j,x]);n.useEffect(()=>{try{localStorage.setItem(g,m?"true":"false")}catch{}},[g,m]),n.useEffect(()=>{if(h&&h.length===0&&m){try{localStorage.setItem(g,"false")}catch{}C(!1)}},[h,g,m]),n.useEffect(()=>{try{const e=localStorage.getItem(g);C(e==="true")}catch{}},[g]);const q=n.useMemo(()=>{const e=[...v],s=a=>{if(!a.boothNumbers||a.boothNumbers.length===0)return Number.MAX_SAFE_INTEGER;const o=a.boothNumbers.map(r=>parseInt(r)).filter(r=>!isNaN(r));return o.length?Math.min(...o):Number.MAX_SAFE_INTEGER};return f==="favorites"?(e.sort((a,o)=>{const r=a.companyId&&x(a.companyId)?0:1,p=o.companyId&&x(o.companyId)?0:1;if(r!==p)return r-p;const A=(a.name||"").localeCompare(o.name||"");return u==="asc"?A:-A}),e):f==="name"?(e.sort((a,o)=>{const r=(a.name||"").localeCompare(o.name||"");return u==="asc"?r:-r}),e):(f==="booth"&&e.sort((a,o)=>{const r=s(a)-s(o);return u==="asc"?r:-r}),e)},[v,f,u,x]),H=e=>D(`/map?focus=${e[0]}`);return t.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 md:pb-0",children:[t.jsx("div",{className:"bg-white border-b sticky top-0 z-10",children:t.jsxs("div",{className:"max-w-screen-xl mx-auto px-4 py-4",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:i("exhibitorPage.title")}),t.jsxs("div",{className:"relative",children:[t.jsx(d,{path:Z,size:1,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),t.jsx("input",{type:"text",placeholder:i("exhibitorPage.searchPlaceholder"),value:j,onChange:e=>G(e.target.value),className:"w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]}),t.jsxs("div",{className:"mt-3 flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[i("exhibitorPage.showing")," ",v.length," ",i("exhibitorPage.of")," ",M.length," ",i("exhibitorPage.exhibitors"),h.length>0&&` â€¢ ${h.length} ${i("exhibitorPage.favorited")}`]}),t.jsxs("div",{className:"flex flex-wrap gap-2 items-center relative",children:[t.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md shadow-sm bg-white",children:[t.jsxs("select",{value:f,onChange:e=>K(e.target.value),className:"flex-1 pl-3 pr-3 py-1.5 border-0 rounded-l-md bg-white text-gray-900 text-sm focus:ring-0 appearance-none","aria-label":i("exhibitorPage.sortBy"),children:[t.jsx("option",{value:"name",children:P.name}),t.jsx("option",{value:"booth",children:P.booth}),h.length>0&&t.jsx("option",{value:"favorites",children:P.favorites})]}),t.jsx("button",{type:"button",onClick:()=>W(u==="asc"?"desc":"asc"),"aria-label":`Toggle sort direction to ${u==="asc"?"descending":"ascending"}`,className:"px-2 py-1.5 border-l border-gray-300 text-gray-500 hover:bg-gray-50 rounded-r-md",children:t.jsx(d,{path:u==="asc"?ee:te,size:.8})})]}),!N&&S.length>0&&t.jsxs("div",{className:"relative flex items-center gap-1",onKeyDown:e=>{if(e.key==="Escape"){y(!1);const s=F.current;s&&s.focus()}},children:[t.jsxs("button",{type:"button",ref:F,onClick:()=>y(!b),className:`px-3 py-1.5 rounded-lg border text-sm flex items-center gap-1.5 select-none transition-colors ${l?"bg-orange-50 border-orange-300 text-orange-700 hover:bg-orange-100":"bg-white border-gray-300 text-gray-700 hover:bg-gray-100"}`,"aria-haspopup":"listbox","aria-expanded":b,"aria-label":i("exhibitorPage.filterByCategory"),children:[t.jsx(d,{path:B,size:.7}),t.jsx("span",{className:"font-medium",children:l?(R=S.find(e=>e.id===l))==null?void 0:R.name:i("exhibitorPage.allCategories")})]}),l&&t.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),E(null)},"aria-label":i("exhibitorPage.clearFilters"),className:"px-2 py-1.5 rounded-lg border text-sm flex items-center justify-center transition-colors bg-white border-gray-300 text-gray-700 hover:bg-gray-100",children:t.jsx(d,{path:se,size:.6})}),b&&t.jsxs("ul",{role:"listbox",ref:z,tabIndex:-1,className:"absolute left-0 mt-1 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-20 py-1 max-h-80 overflow-y-auto",style:{top:"100%"},children:[t.jsx("li",{children:t.jsxs("button",{type:"button",role:"option","aria-selected":!l,onClick:()=>{E(null),y(!1)},className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-100 flex items-center gap-2 ${l?"text-gray-700":"font-semibold text-blue-700 bg-blue-50"}`,children:[t.jsx(d,{path:B,size:.7,className:"opacity-50"}),i("exhibitorPage.allCategories")]})}),t.jsx("div",{className:"border-t border-gray-200 my-1"}),S.map(e=>t.jsx("li",{children:t.jsxs("button",{type:"button",role:"option","aria-selected":l===e.id,onClick:()=>{E(e.id),y(!1)},className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-100 flex items-center gap-2 ${l===e.id?"font-semibold text-blue-700 bg-blue-50":"text-gray-700"}`,children:[t.jsx(d,{path:e.icon,size:.7,style:{color:e.color}}),e.name]})},e.id))]})]}),h.length>0&&t.jsxs("button",{onClick:()=>C(!m),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${m?"bg-yellow-100 text-yellow-800 border border-yellow-300":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}`,children:[t.jsx(d,{path:ae,size:.7}),i("exhibitorPage.favoritesOnly")]})]})]}),!N&&l&&v.length===0&&t.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg text-center text-sm text-gray-600",children:i("exhibitorPage.noCategoryMatch")})]})}),t.jsx("div",{className:"max-w-screen-xl mx-auto px-4 py-4",children:v.length===0?t.jsx("div",{className:"text-center py-12",children:t.jsx("p",{className:"text-gray-500",children:i("exhibitorPage.noExhibitors")})}):t.jsx("div",{className:"space-y-3",children:q.map(e=>t.jsx("div",{onClick:()=>H(e.markerIds),className:"bg-white rounded-lg shadow hover:shadow-md transition-shadow cursor-pointer p-4",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-20 h-20 flex-shrink-0 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden border border-gray-200",children:t.jsx("img",{src:oe(e.logo,V),alt:e.name,className:"max-w-full max-h-full object-contain p-2"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsx("h3",{className:"font-semibold text-gray-900 text-lg break-words",children:e.name}),e.companyId&&t.jsx(ne,{isFavorite:x(e.companyId),onToggle:()=>X(e.companyId),size:"md",className:"flex-shrink-0"})]}),e.boothNumbers&&e.boothNumbers.length>0&&t.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[t.jsx(d,{path:re,size:.7,className:"text-orange-600"}),t.jsxs("span",{className:"text-sm font-medium text-orange-600",children:[i("exhibitorPage.booth")," ",e.boothNumbers.join(", ")]})]}),e.categories&&e.categories.length>0&&t.jsx("div",{className:"mt-2 flex flex-wrap gap-1.5",children:e.categories.map(s=>t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-white rounded",style:{backgroundColor:s.color},title:s.name,children:[t.jsx(d,{path:s.icon,size:.5}),s.name]},s.id))}),(()=>{const s=ie(e.company_translations,I.language,e.info);return s?t.jsx("p",{className:"text-sm text-gray-600 mt-2 line-clamp-2",children:s}):null})()]})]})},e.companyId||e.id))})})]})}export{pe as default};
