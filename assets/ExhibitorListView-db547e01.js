import{a as U,b as H,u as J,r as n,c as Q,R as t,I as i,m as Y,d as Z,e as ee,f as O,h as te,i as ae,j as oe}from"./index-1e4c7e6c.js";import{g as re,F as se,a as ne}from"./useTranslatedCompanyInfo-91e3b8ae.js";import{u as le}from"./useCategories-30773e88.js";function de({markersState:z,selectedYear:_}){var $;const A=U(),{organizationLogo:D}=H(),{t:l,i18n:w}=J(),[E,W]=n.useState(""),g=`exhibitors_showFavoritesOnly_${_}`,[m,C]=n.useState(()=>{try{return localStorage.getItem(g)==="true"}catch{return!1}}),[c,I]=n.useState(null),[b,G]=n.useState("name"),[d,K]=n.useState("asc"),[h,y]=n.useState(!1),P=n.useRef(null),k=n.useRef(null),S={name:l("exhibitorPage.sortName")||"Name",booth:l("exhibitorPage.sortBooth")||"Booth",favorites:l("exhibitorPage.sortFavoritesBase")||"Favorites"},{favorites:u,isFavorite:p,toggleFavorite:V}=Q(),{categories:F,loading:v,getAllCompanyCategories:L}=le(w.language),M=n.useMemo(()=>z.filter(e=>e.id<1e3&&e.name),[z]),N=n.useMemo(()=>{const e={};return M.forEach(a=>{a.companyId&&(e[a.companyId]?(e[a.companyId].boothNumbers.push(a.glyph),e[a.companyId].markerIds.push(a.id)):e[a.companyId]={...a,boothNumbers:[a.glyph],markerIds:[a.id],categories:[]})}),Object.values(e).forEach(a=>{a.boothNumbers.sort((o,r)=>(parseInt(o)||0)-(parseInt(r)||0))}),Object.values(e)},[M]),[T,j]=n.useState([]),[ce,B]=n.useState(!1);n.useEffect(()=>{if(v)return;if(N.length===0){j([]),B(!1);return}(async()=>{const a=N.map(s=>s.companyId),o=await L(a),r=N.map(s=>({...s,categories:o[s.companyId]||[]}));j(r),B(!0)})()},[N,v,L,w.language]),n.useEffect(()=>{if(!h)return;const e=a=>{const o=P.current,r=k.current;!o||!r||!o.contains(a.target)&&!r.contains(a.target)&&(y(!1),setTimeout(()=>o&&o.focus(),0))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[h]);const x=n.useMemo(()=>{let e=T;if(m&&(e=e.filter(a=>a.companyId&&p(a.companyId))),c&&(e=e.filter(a=>!a.categories||a.categories.length===0?!1:a.categories.some(o=>o.id===c))),E){const a=E.toLowerCase();e=e.filter(o=>{var r,s;return((r=o.name)==null?void 0:r.toLowerCase().includes(a))||((s=o.boothNumbers)==null?void 0:s.some(f=>f==null?void 0:f.toLowerCase().includes(a)))})}return e},[T,m,c,E,p]);n.useEffect(()=>{try{localStorage.setItem(g,m?"true":"false")}catch{}},[g,m]),n.useEffect(()=>{if(u&&u.length===0&&m){try{localStorage.setItem(g,"false")}catch{}C(!1)}},[u,g,m]),n.useEffect(()=>{try{const e=localStorage.getItem(g);C(e==="true")}catch{}},[g]);const X=n.useMemo(()=>{const e=[...x],a=o=>{if(!o.boothNumbers||o.boothNumbers.length===0)return Number.MAX_SAFE_INTEGER;const r=o.boothNumbers.map(s=>parseInt(s)).filter(s=>!isNaN(s));return r.length?Math.min(...r):Number.MAX_SAFE_INTEGER};return b==="favorites"?(e.sort((o,r)=>{const s=o.companyId&&p(o.companyId)?0:1,f=r.companyId&&p(r.companyId)?0:1;if(s!==f)return s-f;const R=(o.name||"").localeCompare(r.name||"");return d==="asc"?R:-R}),e):b==="name"?(e.sort((o,r)=>{const s=(o.name||"").localeCompare(r.name||"");return d==="asc"?s:-s}),e):(b==="booth"&&e.sort((o,r)=>{const s=a(o)-a(r);return d==="asc"?s:-s}),e)},[x,b,d,p]),q=e=>A(`/map?focus=${e[0]}`);return t.createElement("div",{className:"min-h-screen bg-gray-50 pb-20 md:pb-0"},t.createElement("div",{className:"bg-white border-b sticky top-0 z-10"},t.createElement("div",{className:"max-w-screen-xl mx-auto px-4 py-4"},t.createElement("h1",{className:"text-2xl font-bold text-gray-900 mb-4"},l("exhibitorPage.title")),t.createElement("div",{className:"relative"},t.createElement(i,{path:Y,size:1,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),t.createElement("input",{type:"text",placeholder:l("exhibitorPage.searchPlaceholder"),value:E,onChange:e=>W(e.target.value),className:"w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})),t.createElement("div",{className:"mt-3 flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},t.createElement("div",{className:"text-sm text-gray-600"},l("exhibitorPage.showing")," ",x.length," ",l("exhibitorPage.of")," ",M.length," ",l("exhibitorPage.exhibitors"),u.length>0&&` â€¢ ${u.length} ${l("exhibitorPage.favorited")}`),t.createElement("div",{className:"flex flex-wrap gap-2 items-center relative"},t.createElement("div",{className:"flex items-center border border-gray-300 rounded-md shadow-sm bg-white"},t.createElement("select",{value:b,onChange:e=>G(e.target.value),className:"flex-1 pl-3 pr-3 py-1.5 border-0 rounded-l-md bg-white text-gray-900 text-sm focus:ring-0 appearance-none","aria-label":l("exhibitorPage.sortBy")},t.createElement("option",{value:"name"},S.name),t.createElement("option",{value:"booth"},S.booth),u.length>0&&t.createElement("option",{value:"favorites"},S.favorites)),t.createElement("button",{type:"button",onClick:()=>K(d==="asc"?"desc":"asc"),"aria-label":`Toggle sort direction to ${d==="asc"?"descending":"ascending"}`,className:"px-2 py-1.5 border-l border-gray-300 text-gray-500 hover:bg-gray-50 rounded-r-md"},t.createElement(i,{path:d==="asc"?Z:ee,size:.8}))),!v&&F.length>0&&t.createElement("div",{className:"relative flex items-center gap-1",onKeyDown:e=>{if(e.key==="Escape"){y(!1);const a=P.current;a&&a.focus()}}},t.createElement("button",{type:"button",ref:P,onClick:()=>y(!h),className:`px-3 py-1.5 rounded-lg border text-sm flex items-center gap-1.5 select-none transition-colors ${c?"bg-orange-50 border-orange-300 text-orange-700 hover:bg-orange-100":"bg-white border-gray-300 text-gray-700 hover:bg-gray-100"}`,"aria-haspopup":"listbox","aria-expanded":h,"aria-label":l("exhibitorPage.filterByCategory")},t.createElement(i,{path:O,size:.7}),t.createElement("span",{className:"font-medium"},c?($=F.find(e=>e.id===c))==null?void 0:$.name:l("exhibitorPage.allCategories"))),c&&t.createElement("button",{type:"button",onClick:e=>{e.stopPropagation(),I(null)},"aria-label":l("exhibitorPage.clearFilters"),className:"px-2 py-1.5 rounded-lg border text-sm flex items-center justify-center transition-colors bg-white border-gray-300 text-gray-700 hover:bg-gray-100"},t.createElement(i,{path:te,size:.6})),h&&t.createElement("ul",{role:"listbox",ref:k,tabIndex:-1,className:"absolute left-0 mt-1 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-20 py-1 max-h-80 overflow-y-auto",style:{top:"100%"}},t.createElement("li",null,t.createElement("button",{type:"button",role:"option","aria-selected":!c,onClick:()=>{I(null),y(!1)},className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-100 flex items-center gap-2 ${c?"text-gray-700":"font-semibold text-blue-700 bg-blue-50"}`},t.createElement(i,{path:O,size:.7,className:"opacity-50"}),l("exhibitorPage.allCategories"))),t.createElement("div",{className:"border-t border-gray-200 my-1"}),F.map(e=>t.createElement("li",{key:e.id},t.createElement("button",{type:"button",role:"option","aria-selected":c===e.id,onClick:()=>{I(e.id),y(!1)},className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-100 flex items-center gap-2 ${c===e.id?"font-semibold text-blue-700 bg-blue-50":"text-gray-700"}`},t.createElement(i,{path:e.icon,size:.7,style:{color:e.color}}),e.name))))),u.length>0&&t.createElement("button",{onClick:()=>C(!m),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${m?"bg-yellow-100 text-yellow-800 border border-yellow-300":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}`},t.createElement(i,{path:ae,size:.7}),l("exhibitorPage.favoritesOnly")))),!v&&c&&x.length===0&&t.createElement("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg text-center text-sm text-gray-600"},l("exhibitorPage.noCategoryMatch")))),t.createElement("div",{className:"max-w-screen-xl mx-auto px-4 py-4"},x.length===0?t.createElement("div",{className:"text-center py-12"},t.createElement("p",{className:"text-gray-500"},l("exhibitorPage.noExhibitors"))):t.createElement("div",{className:"space-y-3"},X.map(e=>t.createElement("div",{key:e.companyId||e.id,onClick:()=>q(e.markerIds),className:"bg-white rounded-lg shadow hover:shadow-md transition-shadow cursor-pointer p-4"},t.createElement("div",{className:"flex items-center gap-4"},t.createElement("div",{className:"w-20 h-20 flex-shrink-0 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden border border-gray-200"},t.createElement("img",{src:re(e.logo,D),alt:e.name,className:"max-w-full max-h-full object-contain p-2"})),t.createElement("div",{className:"flex-1 min-w-0"},t.createElement("div",{className:"flex items-start justify-between gap-2"},t.createElement("h3",{className:"font-semibold text-gray-900 text-lg break-words"},e.name),e.companyId&&t.createElement(se,{isFavorite:p(e.companyId),onToggle:()=>V(e.companyId),size:"md",className:"flex-shrink-0"})),e.boothNumbers&&e.boothNumbers.length>0&&t.createElement("div",{className:"flex items-center gap-1 mt-1"},t.createElement(i,{path:oe,size:.7,className:"text-orange-600"}),t.createElement("span",{className:"text-sm font-medium text-orange-600"},l("exhibitorPage.booth")," ",e.boothNumbers.join(", "))),e.categories&&e.categories.length>0&&t.createElement("div",{className:"mt-2 flex flex-wrap gap-1.5"},e.categories.map(a=>t.createElement("span",{key:a.id,className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-white rounded",style:{backgroundColor:a.color},title:a.name},t.createElement(i,{path:a.icon,size:.5}),a.name))),(()=>{const a=ne(e.company_translations,w.language,e.info);return a?t.createElement("p",{className:"text-sm text-gray-600 mt-2 line-clamp-2"},a):null})())))))))}export{de as default};
