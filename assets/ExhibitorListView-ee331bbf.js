import{a as U,b as H,u as J,r as n,d as Q,j as t,I as c,m as Y,e as Z,f as ee,h as R,i as te,k as se,l as ae}from"./index-f3aaddb5.js";import{g as oe}from"./getDefaultLogo-7dd9d292.js";import{F as re,g as ne}from"./useTranslatedCompanyInfo-bff645d3.js";import{u as ie}from"./useCategories-8e231f0a.js";function ue({markersState:M,selectedYear:_}){var $;const A=U(),{organizationLogo:D}=H(),{t:i,i18n:w}=J(),[v,W]=n.useState(""),m=`exhibitors_showFavoritesOnly_${_}`,[d,C]=n.useState(()=>{try{return localStorage.getItem(m)==="true"}catch{return!1}}),[l,I]=n.useState(null),[p,G]=n.useState("name"),[g,K]=n.useState("asc"),[f,b]=n.useState(!1),E=n.useRef(null),z=n.useRef(null),P={name:i("exhibitorPage.sortName")||"Name",booth:i("exhibitorPage.sortBooth")||"Booth",favorites:i("exhibitorPage.sortFavoritesBase")||"Favorites"},{favorites:u,isFavorite:h,toggleFavorite:V}=Q(),{categories:S,loading:j,getAllCompanyCategories:L}=ie(w.language),F=n.useMemo(()=>M.filter(e=>e.id<1e3&&e.name),[M]),N=n.useMemo(()=>{const e={};return F.forEach(s=>{s.companyId&&(e[s.companyId]?(e[s.companyId].boothNumbers.push(s.glyph),e[s.companyId].markerIds.push(s.id)):e[s.companyId]={...s,boothNumbers:[s.glyph],markerIds:[s.id],categories:[]})}),Object.values(e).forEach(s=>{s.boothNumbers.sort((a,o)=>(parseInt(a)||0)-(parseInt(o)||0))}),Object.values(e)},[F]),[k,T]=n.useState([]),[le,B]=n.useState(!1);n.useEffect(()=>{if(j)return;if(N.length===0){T([]),B(!1);return}(async()=>{const s=N.map(r=>r.companyId),a=await L(s),o=N.map(r=>({...r,categories:a[r.companyId]||[]}));T(o),B(!0)})()},[N,j,L,w.language]),n.useEffect(()=>{if(!f)return;const e=s=>{const a=E.current,o=z.current;!a||!o||!a.contains(s.target)&&!o.contains(s.target)&&(b(!1),setTimeout(()=>a&&a.focus(),0))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[f]);const y=n.useMemo(()=>{let e=k;if(d&&(e=e.filter(s=>s.companyId&&h(s.companyId))),l&&(e=e.filter(s=>!s.categories||s.categories.length===0?!1:s.categories.some(a=>a.id===l))),v){const s=v.toLowerCase();e=e.filter(a=>{var o,r;return((o=a.name)==null?void 0:o.toLowerCase().includes(s))||((r=a.boothNumbers)==null?void 0:r.some(x=>x==null?void 0:x.toLowerCase().includes(s)))})}return e},[k,d,l,v,h]);n.useEffect(()=>{try{localStorage.setItem(m,d?"true":"false")}catch{}},[m,d]),n.useEffect(()=>{if(u&&u.length===0&&d){try{localStorage.setItem(m,"false")}catch{}C(!1)}},[u,m,d]),n.useEffect(()=>{try{const e=localStorage.getItem(m);C(e==="true")}catch{}},[m]);const X=n.useMemo(()=>{const e=[...y],s=a=>{if(!a.boothNumbers||a.boothNumbers.length===0)return Number.MAX_SAFE_INTEGER;const o=a.boothNumbers.map(r=>parseInt(r)).filter(r=>!isNaN(r));return o.length?Math.min(...o):Number.MAX_SAFE_INTEGER};return p==="favorites"?(e.sort((a,o)=>{const r=a.companyId&&h(a.companyId)?0:1,x=o.companyId&&h(o.companyId)?0:1;if(r!==x)return r-x;const O=(a.name||"").localeCompare(o.name||"");return g==="asc"?O:-O}),e):p==="name"?(e.sort((a,o)=>{const r=(a.name||"").localeCompare(o.name||"");return g==="asc"?r:-r}),e):(p==="booth"&&e.sort((a,o)=>{const r=s(a)-s(o);return g==="asc"?r:-r}),e)},[y,p,g,h]),q=e=>A(`/map?focus=${e[0]}`);return t.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20 md:pb-0",children:[t.jsx("div",{className:"bg-white border-b sticky top-0 z-10",children:t.jsxs("div",{className:"max-w-screen-xl mx-auto px-4 py-4",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:i("exhibitorPage.title")}),t.jsxs("div",{className:"relative",children:[t.jsx(c,{path:Y,size:1,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),t.jsx("input",{type:"text",placeholder:i("exhibitorPage.searchPlaceholder"),value:v,onChange:e=>W(e.target.value),className:"w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]}),t.jsxs("div",{className:"mt-3 flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[i("exhibitorPage.showing")," ",y.length," ",i("exhibitorPage.of")," ",F.length," ",i("exhibitorPage.exhibitors"),u.length>0&&` â€¢ ${u.length} ${i("exhibitorPage.favorited")}`]}),t.jsxs("div",{className:"flex flex-wrap gap-2 items-center relative",children:[t.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md shadow-sm bg-white",children:[t.jsxs("select",{value:p,onChange:e=>G(e.target.value),className:"flex-1 pl-3 pr-3 py-1.5 border-0 rounded-l-md bg-white text-gray-900 text-sm focus:ring-0 appearance-none","aria-label":i("exhibitorPage.sortBy"),children:[t.jsx("option",{value:"name",children:P.name}),t.jsx("option",{value:"booth",children:P.booth}),u.length>0&&t.jsx("option",{value:"favorites",children:P.favorites})]}),t.jsx("button",{type:"button",onClick:()=>K(g==="asc"?"desc":"asc"),"aria-label":`Toggle sort direction to ${g==="asc"?"descending":"ascending"}`,className:"px-2 py-1.5 border-l border-gray-300 text-gray-500 hover:bg-gray-50 rounded-r-md",children:t.jsx(c,{path:g==="asc"?Z:ee,size:.8})})]}),!j&&S.length>0&&t.jsxs("div",{className:"relative flex items-center gap-1",onKeyDown:e=>{if(e.key==="Escape"){b(!1);const s=E.current;s&&s.focus()}},children:[t.jsxs("button",{type:"button",ref:E,onClick:()=>b(!f),className:`px-3 py-1.5 rounded-lg border text-sm flex items-center gap-1.5 select-none transition-colors ${l?"bg-orange-50 border-orange-300 text-orange-700 hover:bg-orange-100":"bg-white border-gray-300 text-gray-700 hover:bg-gray-100"}`,"aria-haspopup":"listbox","aria-expanded":f,"aria-label":i("exhibitorPage.filterByCategory"),children:[t.jsx(c,{path:R,size:.7}),t.jsx("span",{className:"font-medium",children:l?($=S.find(e=>e.id===l))==null?void 0:$.name:i("exhibitorPage.allCategories")})]}),l&&t.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),I(null)},"aria-label":i("exhibitorPage.clearFilters"),className:"px-2 py-1.5 rounded-lg border text-sm flex items-center justify-center transition-colors bg-white border-gray-300 text-gray-700 hover:bg-gray-100",children:t.jsx(c,{path:te,size:.6})}),f&&t.jsxs("ul",{role:"listbox",ref:z,tabIndex:-1,className:"absolute left-0 mt-1 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-20 py-1 max-h-80 overflow-y-auto",style:{top:"100%"},children:[t.jsx("li",{children:t.jsxs("button",{type:"button",role:"option","aria-selected":!l,onClick:()=>{I(null),b(!1)},className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-100 flex items-center gap-2 ${l?"text-gray-700":"font-semibold text-blue-700 bg-blue-50"}`,children:[t.jsx(c,{path:R,size:.7,className:"opacity-50"}),i("exhibitorPage.allCategories")]})}),t.jsx("div",{className:"border-t border-gray-200 my-1"}),S.map(e=>t.jsx("li",{children:t.jsxs("button",{type:"button",role:"option","aria-selected":l===e.id,onClick:()=>{I(e.id),b(!1)},className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-100 flex items-center gap-2 ${l===e.id?"font-semibold text-blue-700 bg-blue-50":"text-gray-700"}`,children:[t.jsx(c,{path:e.icon,size:.7,style:{color:e.color}}),e.name]})},e.id))]})]}),u.length>0&&t.jsxs("button",{onClick:()=>C(!d),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${d?"bg-yellow-100 text-yellow-800 border border-yellow-300":"bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200"}`,children:[t.jsx(c,{path:se,size:.7}),i("exhibitorPage.favoritesOnly")]})]})]}),!j&&l&&y.length===0&&t.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg text-center text-sm text-gray-600",children:i("exhibitorPage.noCategoryMatch")})]})}),t.jsx("div",{className:"max-w-screen-xl mx-auto px-4 py-4",children:y.length===0?t.jsx("div",{className:"text-center py-12",children:t.jsx("p",{className:"text-gray-500",children:i("exhibitorPage.noExhibitors")})}):t.jsx("div",{className:"space-y-3",children:X.map(e=>t.jsx("div",{onClick:()=>q(e.markerIds),className:"bg-white rounded-lg shadow hover:shadow-md transition-shadow cursor-pointer p-4",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-20 h-20 flex-shrink-0 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden border border-gray-200",children:t.jsx("img",{src:oe(e.logo,D),alt:e.name,className:"max-w-full max-h-full object-contain p-2"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsx("h3",{className:"font-semibold text-gray-900 text-lg break-words",children:e.name}),e.companyId&&t.jsx(re,{isFavorite:h(e.companyId),onToggle:()=>V(e.companyId),size:"md",className:"flex-shrink-0"})]}),e.boothNumbers&&e.boothNumbers.length>0&&t.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[t.jsx(c,{path:ae,size:.7,className:"text-orange-600"}),t.jsxs("span",{className:"text-sm font-medium text-orange-600",children:[i("exhibitorPage.booth")," ",e.boothNumbers.join(", ")]})]}),e.categories&&e.categories.length>0&&t.jsx("div",{className:"mt-2 flex flex-wrap gap-1.5",children:e.categories.map(s=>t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-white rounded",style:{backgroundColor:s.color},title:s.name,children:[t.jsx(c,{path:s.icon,size:.5}),s.name]},s.id))}),(()=>{const s=ne(e.company_translations,w.language,e.info);return s?t.jsx("p",{className:"text-sm text-gray-600 mt-2 line-clamp-2",children:s}):null})()]})]})},e.companyId||e.id))})})]})}export{ue as default};
