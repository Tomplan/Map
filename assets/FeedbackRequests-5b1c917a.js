import{r as a,s as x,u as re,K as be,j as e,M as fe,I as k,bf as te,bg as se,bh as ae,bi as ne,aj as xe,bj as ge,bk as ie,at as oe,bl as ce,L as le,ag as pe,l as he}from"./index-12ba77bc.js";import{u as de}from"./useUserRole-cf3c7d99.js";function ue(){const[t,N]=a.useState([]),[F,i]=a.useState(!0),[U,$]=a.useState(null),[C,L]=a.useState(null),[V,R]=a.useState(new Set);a.useEffect(()=>{(async()=>{try{const{data:{user:r}}=await x.auth.getUser();L((r==null?void 0:r.id)||null)}catch(r){console.error("[useFeedbackRequests] getUser error",r),L(null)}})()},[]);const p=a.useCallback(async(o={})=>{try{i(!0),$(null);let r=x.from("feedback_requests").select("*").order("created_at",{ascending:!1});o.type&&(r=r.eq("type",o.type)),o.status&&(r=r.eq("status",o.status)),o.userId&&(r=r.eq("user_id",o.userId));const{data:c,error:l}=await r;if(l)throw l;if(N(c||[]),C){const{data:n}=await x.from("feedback_votes").select("request_id").eq("user_id",C);R(new Set((n==null?void 0:n.map(u=>u.request_id))||[]))}}catch(r){console.error("Error loading feedback requests:",r),$(r.message)}finally{i(!1)}},[C]),T=a.useCallback(async o=>{try{const{data:{user:r}}=await x.auth.getUser();if(!r)throw new Error("User not authenticated");const{data:c,error:l}=await x.from("feedback_requests").insert({user_id:r.id,user_email:r.email,type:o.type,title:o.title,description:o.description||""}).select().single();if(l)throw l;return await p(),{data:c,error:null}}catch(r){return console.error("Error creating request:",r),{data:null,error:r.message}}},[p]),B=a.useCallback(async(o,r)=>{try{const{data:c,error:l}=await x.from("feedback_requests").update(r).eq("id",o).select().single();if(l)throw l;return await p(),{data:c,error:null}}catch(c){return console.error("Error updating request:",c),{data:null,error:c.message}}},[p]),H=a.useCallback(async o=>{try{const{error:r}=await x.from("feedback_requests").delete().eq("id",o);if(r)throw r;return await p(),{error:null}}catch(r){return console.error("Error deleting request:",r),{error:r.message}}},[p]),K=a.useCallback(async o=>{try{const{data:{user:r}}=await x.auth.getUser();if(!r)throw new Error("User not authenticated");const{error:c}=await x.from("feedback_votes").insert({request_id:o,user_id:r.id});if(c)throw c;return R(l=>new Set([...l,o])),N(l=>l.map(n=>n.id===o?{...n,votes:n.votes+1}:n)),{error:null}}catch(r){return console.error("Error adding vote:",r),{error:r.message}}},[R]),z=a.useCallback(async o=>{try{const{data:{user:r}}=await x.auth.getUser();if(!r)throw new Error("User not authenticated");const{error:c}=await x.from("feedback_votes").delete().eq("request_id",o).eq("user_id",r.id);if(c)throw c;return R(l=>{const n=new Set(l);return n.delete(o),n}),N(l=>l.map(n=>n.id===o?{...n,votes:Math.max(0,n.votes-1)}:n)),{error:null}}catch(r){return console.error("Error removing vote:",r),{error:r.message}}},[R]),j=a.useCallback(async o=>{try{const{data:r,error:c}=await x.from("feedback_comments").select("*").eq("request_id",o).order("created_at",{ascending:!0});if(c)throw c;return{data:r||[],error:null}}catch(r){return console.error("Error loading comments:",r),{data:[],error:r.message}}},[]),w=a.useCallback(async(o,r)=>{try{const{data:{user:c}}=await x.auth.getUser();if(!c)throw new Error("User not authenticated");const{data:l,error:n}=await x.from("feedback_comments").insert({request_id:o,user_id:c.id,user_email:c.email,comment:r}).select().single();if(n)throw n;return N(u=>u.map(m=>m.id===o?{...m,comments_count:m.comments_count+1}:m)),{data:l,error:null}}catch(c){return console.error("Error adding comment:",c),{data:null,error:c.message}}},[]),h=a.useCallback(async(o,r)=>{try{const{error:c}=await x.from("feedback_comments").delete().eq("id",o);if(c)throw c;return N(l=>l.map(n=>n.id===r?{...n,comments_count:Math.max(0,n.comments_count-1)}:n)),{error:null}}catch(c){return console.error("Error deleting comment:",c),{error:c.message}}},[]);return a.useEffect(()=>{let o=null,r=null,c=null;return(!(typeof navigator<"u")||navigator.onLine)&&(o=x.channel("feedback_requests_changes").on("postgres_changes",{event:"*",schema:"public",table:"feedback_requests"},l=>{l&&N(n=>{const u=[...n],m=l.new,y=l.old,b=(m==null?void 0:m.id)||(y==null?void 0:y.id),D=u.findIndex(S=>S.id===b);return m&&!y?[m,...u]:m&&y?(D!==-1&&(u[D]={...u[D],...m}),u):y&&!m?u.filter(S=>S.id!==y.id):u})}).subscribe(),r=x.channel("feedback_votes_changes").on("postgres_changes",{event:"*",schema:"public",table:"feedback_votes"},l=>{if(!l)return;const n=l.new,u=l.old,m=(n==null?void 0:n.request_id)||(u==null?void 0:u.request_id);m&&N(y=>y.map(b=>b.id!==m?b:n&&!u?{...b,votes:(b.votes||0)+1}:!n&&u?{...b,votes:Math.max(0,(b.votes||0)-1)}:b))}).subscribe(),c=x.channel("feedback_comments_changes").on("postgres_changes",{event:"*",schema:"public",table:"feedback_comments"},l=>{if(!l)return;const n=l.new,u=l.old,m=(n==null?void 0:n.request_id)||(u==null?void 0:u.request_id);m&&N(y=>y.map(b=>b.id!==m?b:n&&!u?{...b,comments_count:(b.comments_count||0)+1}:!n&&u?{...b,comments_count:Math.max(0,(b.comments_count||0)-1)}:b))}).subscribe()),()=>{o&&x.removeChannel(o),r&&x.removeChannel(r),c&&x.removeChannel(c)}},[p]),a.useEffect(()=>{console.debug("[useFeedbackRequests] initial load effect running"),p()},[p]),{requests:t,loading:F,error:U,userVotes:V,currentUserId:C,loadRequests:p,createRequest:T,updateRequest:B,deleteRequest:H,addVote:K,removeVote:z,loadComments:j,addComment:w,deleteComment:h}}function ye({request:t,onClose:N,onUpdate:F}){const{t:i}=re(),{role:U}=de(),{confirm:$}=be(),C=U==="super_admin",{userVotes:L,currentUserId:V,addVote:R,removeVote:p,loadComments:T,addComment:B,deleteComment:H,updateRequest:K}=ue(),[z,j]=a.useState([]),[w,h]=a.useState(""),[o,r]=a.useState(!0),[c,l]=a.useState(!1),[n,u]=a.useState(!1),[m,y]=a.useState(t.status),[b,D]=a.useState(t.priority||""),[S,O]=a.useState(t.version_completed||""),[M,I]=a.useState(!1),[Z,P]=a.useState(t.votes),[Q,q]=a.useState(t.comments_count||0);a.useEffect(()=>{P(t.votes),q(t.comments_count||0)},[t.id,t.votes,t.comments_count]),a.useEffect(()=>{(async()=>{r(!0);const{data:g}=await T(t.id);j(g||[]),r(!1)})()},[t.id,T]);const W=async()=>{if(L.has(t.id)){const{error:d}=await p(t.id);d||P(g=>Math.max(0,g-1))}else{const{error:d}=await R(t.id);d||P(g=>g+1)}},G=async d=>{if(d.preventDefault(),!w.trim())return;l(!0);const{data:g,error:_}=await B(t.id,w.trim());!_&&g&&(j([...z,g]),h(""),q(v=>v+1)),l(!1)},J=async d=>{if(!await $({title:i("settings.feedbackRequests.detail.deleteComment"),message:i("common.confirmDelete"),confirmText:i("common.delete"),variant:"danger"}))return;const{error:_}=await H(d,t.id);_||(j(z.filter(v=>v.id!==d)),q(v=>Math.max(0,v-1)))},X=async()=>{I(!0);const d={status:m,priority:b||null,version_completed:S||null};m==="completed"&&t.status!=="completed"&&(d.completed_at=new Date().toISOString(),d.completed_by=V);const{error:g,data:_}=await K(t.id,d);g||(u(!1),F&&F(_)),I(!1)},A=d=>{if(!d)return"open";switch(d.toLowerCase()){case"in_progress":case"inprogress":case"in progress":return"in_progress";case"completed":return"completed";case"archived":return"archived";case"open":default:return"open"}},Y=d=>{switch(A(d),d){case"completed":return le;case"in_progress":return ce;case"archived":return oe;default:return ie}},ee=d=>{switch(A(d)){case"completed":return"text-green-600";case"in_progress":return"text-blue-600";case"archived":return"text-gray-400";default:return"text-yellow-600"}};return e.jsxs(fe,{isOpen:!0,onClose:N,size:"lg",showCloseButton:!1,children:[e.jsx("div",{className:"bg-gray-50 border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${t.type==="issue"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:[e.jsx(k,{path:t.type==="issue"?te:se,size:.5,className:"mr-1"}),i(`settings.feedbackRequests.types.${t.type}`)]})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:t.title}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 mt-2",children:[e.jsx("span",{children:t.user_email}),e.jsx("span",{children:new Date(t.created_at).toLocaleDateString()}),t.version_completed&&!n&&e.jsxs("span",{className:"text-green-600 font-medium",children:["v",t.version_completed]})]})]})}),e.jsxs("div",{className:"px-6 py-4",children:[t.description&&e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:t.description})}),C&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg text-left flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:i("settings.feedbackRequests.detail.status")}),n?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u(!1),className:"text-sm text-gray-600 hover:text-gray-700",children:i("common.cancel")}),e.jsx("button",{onClick:X,disabled:M,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:i(M?"common.saving":"common.save")})]}):e.jsx("button",{onClick:()=>u(!0),className:"text-sm text-blue-600 hover:text-blue-700",children:i("common.edit")})]}),(()=>{const d={open:"open",in_progress:"inProgress",completed:"completed",archived:"archived"},g=A(t.status),_=d[g]||"open";return e.jsxs("div",{className:"mt-2 space-y-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"feedback-status-select",className:"text-sm font-medium text-gray-700 mb-1",children:i("settings.feedbackRequests.detail.statusCurrent")||i("settings.feedbackRequests.detail.status")||"Status"}),n?e.jsxs("select",{id:"feedback-status-select","aria-label":i("settings.feedbackRequests.detail.statusAriaEdit")||"Edit status",value:m,onChange:v=>y(v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"open",children:i("settings.feedbackRequests.statuses.open")}),e.jsx("option",{value:"in_progress",children:i("settings.feedbackRequests.statuses.inProgress")}),e.jsx("option",{value:"completed",children:i("settings.feedbackRequests.statuses.completed")}),e.jsx("option",{value:"archived",children:i("settings.feedbackRequests.statuses.archived")})]}):e.jsxs("span",{role:"status","data-testid":"feedback-status-badge","aria-label":`Current status: ${i(`settings.feedbackRequests.statuses.${_}`)}`,className:`inline-flex items-center gap-2 px-2 py-1 rounded-md border text-sm font-medium ${ee(g)}`,children:[e.jsx(k,{path:Y(g),size:.8}),i(`settings.feedbackRequests.statuses.${_}`)]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:i("settings.feedbackRequests.detail.priority")}),n?e.jsxs("select",{value:b,onChange:v=>D(v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm","aria-label":i("settings.feedbackRequests.detail.priorityAriaEdit")||"Edit priority",children:[e.jsx("option",{value:"",children:i("settings.feedbackRequests.priorities.none")||"No priority"}),e.jsx("option",{value:"low",children:i("settings.feedbackRequests.priorities.low")}),e.jsx("option",{value:"medium",children:i("settings.feedbackRequests.priorities.medium")}),e.jsx("option",{value:"high",children:i("settings.feedbackRequests.priorities.high")})]}):e.jsx("span",{className:`inline-flex items-center gap-2 px-2 py-1 rounded-md border text-sm font-medium ${t.priority==="high"?"border-red-300 bg-red-50 text-red-700":t.priority==="medium"?"border-yellow-300 bg-yellow-50 text-yellow-700":t.priority==="low"?"border-green-300 bg-green-50 text-green-700":"border-gray-300 bg-white text-gray-600"}`,"data-testid":"feedback-priority-badge",role:"status","aria-label":`Current priority: ${t.priority?i(`settings.feedbackRequests.priorities.${t.priority}`):i("settings.feedbackRequests.priorities.none")||"No priority"}`,children:t.priority?i(`settings.feedbackRequests.priorities.${t.priority}`):i("settings.feedbackRequests.priorities.none")||"No priority"})]}),n&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:i("settings.feedbackRequests.detail.version")}),e.jsx("input",{type:"text",value:S,onChange:v=>O(v.target.value),placeholder:"e.g., 1.2.0",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]})})()]}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:W,className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors ${L.has(t.id)?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(k,{path:ae,size:.8}),e.jsx("span",{className:"font-medium",children:L.has(t.id)?i("common.voted"):i("common.vote")}),e.jsxs("span",{className:"text-sm","aria-label":`Total votes: ${Z}`,children:["(",Z,")"]})]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(k,{path:ne,size:.8}),i("settings.feedbackRequests.detail.comments")," (",Q,")"]}),o?e.jsx("div",{className:"text-center py-4 text-gray-500",children:i("common.loading")}):z.length===0?e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:i("settings.feedbackRequests.detail.noComments")}):e.jsx("div",{className:"space-y-3 mb-4",children:z.map(d=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-900",children:d.user_email}),e.jsx("span",{className:"text-gray-500 ml-2",children:new Date(d.created_at).toLocaleDateString()})]}),(d.user_id===V||C)&&e.jsx("button",{onClick:()=>J(d.id),className:"text-red-600 hover:text-red-700",children:e.jsx(k,{path:xe,size:.6})})]}),e.jsx("p",{className:"text-gray-700 text-sm whitespace-pre-wrap",children:d.comment})]},d.id))}),e.jsxs("form",{onSubmit:G,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:w,onChange:d=>h(d.target.value),placeholder:i("settings.feedbackRequests.detail.addComment"),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("button",{type:"submit",disabled:c||!w.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(k,{path:ge,size:.7}),i("settings.feedbackRequests.detail.postComment")]})]})]})]})]})}function Ne(){const{t}=re(),{role:N}=de(),F=N==="super_admin",i=null,U=!1,$=a.useCallback(()=>{},[]),{requests:C,loading:L,error:V,userVotes:R,currentUserId:p,loadRequests:T,createRequest:B,updateRequest:H,addVote:K,removeVote:z}=ue(),[j,w]=a.useState("all"),[h,o]=a.useState([]),[r,c]=a.useState([]),[l,n]=a.useState(""),[u,m]=a.useState(null),[y,b]=a.useState(!1),[D,S]=a.useState(!1),O=a.useRef(null),M=a.useRef(null),[I,Z]=a.useState(!1);a.useEffect(()=>{const s=f=>{O.current&&!O.current.contains(f.target)&&b(!1),M.current&&!M.current.contains(f.target)&&S(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const[P,Q]=a.useState("feature"),[q,W]=a.useState(""),[G,J]=a.useState(""),[X,A]=a.useState(!1);a.useEffect(()=>{const s={};j==="my"&&p&&(s.userId=p),T(s)},[j,p,T]),a.useEffect(()=>{},[j,i,U,I,$]),a.useEffect(()=>{},[h,i,U,I,$]),a.useEffect(()=>{},[r,i,U,I,$]);const Y=C.filter(s=>{var f;if(l){const E=l.toLowerCase();if(!(s.title.toLowerCase().includes(E)||((f=s.description)==null?void 0:f.toLowerCase().includes(E))||s.user_email.toLowerCase().includes(E)))return!1}if(h.length>0&&!h.includes(s.type))return!1;if(r.length>0){const E=s.status||"open";if(!r.includes(E))return!1}return!0}),ee=async s=>{R.has(s)?await z(s):await K(s)},d=async s=>{if(s.preventDefault(),!q.trim())return;A(!0);const{error:f}=await B({type:P,title:q.trim(),description:G.trim()});f||(W(""),J(""),w("all")),A(!1)},g=s=>{switch(s){case"completed":return le;case"in_progress":return ce;case"archived":return oe;default:return ie}},_=s=>{switch(s){case"completed":return"text-green-600";case"in_progress":return"text-blue-600";case"archived":return"text-gray-400";default:return"text-yellow-600"}},v=s=>{if(!s)return"open";const f=s.toLowerCase();return f==="in_progress"||f==="inprogress"||f==="in progress"?"inProgress":f==="completed"?"completed":f==="archived"?"archived":"open"},me=s=>s==="issue"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800";return L&&C.length===0?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"text-gray-500",children:t("common.loading")})}):e.jsxs("div",{className:"space-y-6","data-testid":"feedback-requests-container",children:[e.jsxs("div",{"data-testid":"feedback-header",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t("settings.feedbackRequests.title")}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:t("settings.feedbackRequests.description")})]}),e.jsx("div",{className:"border-b border-gray-200","data-testid":"feedback-tabs",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>w("all"),"data-testid":"feedback-tab-all",className:`py-4 px-1 border-b-2 font-medium text-sm ${j==="all"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:t("settings.feedbackRequests.tabs.all")}),e.jsx("button",{onClick:()=>w("my"),"data-testid":"feedback-tab-my",className:`py-4 px-1 border-b-2 font-medium text-sm ${j==="my"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:t("settings.feedbackRequests.tabs.myRequests")}),e.jsxs("button",{onClick:()=>w("submit"),"data-testid":"feedback-tab-submit",className:`py-4 px-1 border-b-2 font-medium text-sm ${j==="submit"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(k,{path:pe,size:.7,className:"inline mr-1"}),t("settings.feedbackRequests.tabs.submit")]})]})}),(j==="all"||j==="my")&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-4","data-testid":"feedback-filters",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(k,{path:he,size:.8}),e.jsx("span",{className:"font-medium",children:t("settings.feedbackRequests.filters.title")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("input",{type:"text",placeholder:t("settings.feedbackRequests.filters.search"),value:l,onChange:s=>n(s.target.value),"data-testid":"feedback-search",className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"relative",ref:O,"data-testid":"feedback-type-filter",children:[e.jsxs("button",{type:"button",onClick:()=>b(!y),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-left flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-900",children:h.length===0?t("settings.feedbackRequests.filters.allTypes"):h.length===1?t(`settings.feedbackRequests.types.${h[0]}`):`${h.length} ${t("settings.feedbackRequests.filters.selectedTypes")||"selected types"}`}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),y&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg",children:e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center px-2 py-1 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.length===0,onChange:()=>o([]),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:t("settings.feedbackRequests.filters.allTypes")})]}),["issue","feature"].map(s=>e.jsxs("label",{className:"flex items-center px-2 py-1 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.includes(s),onChange:f=>{f.target.checked?o([...h,s]):o(h.filter(E=>E!==s))},className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:t(`settings.feedbackRequests.types.${s}`)})]},s))]})})]}),e.jsxs("div",{className:"relative",ref:M,"data-testid":"feedback-status-filter",children:[e.jsxs("button",{type:"button",onClick:()=>S(!D),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-left flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-900",children:r.length===0?t("settings.feedbackRequests.filters.allStatuses"):r.length===1?t(`settings.feedbackRequests.statuses.${v(r[0])}`):`${r.length} ${t("settings.feedbackRequests.filters.selectedStatuses")}`}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),D&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg",children:e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center px-2 py-1 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.length===0,onChange:()=>c([]),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:t("settings.feedbackRequests.filters.allStatuses")})]}),["open","in_progress","completed","archived"].map(s=>e.jsxs("label",{className:"flex items-center px-2 py-1 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.includes(s),onChange:f=>{f.target.checked?c([...r,s]):c(r.filter(E=>E!==s))},className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:t(`settings.feedbackRequests.statuses.${v(s)}`)})]},s))]})})]})]})]}),j==="submit"?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6","data-testid":"feedback-submit-form",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:t("settings.feedbackRequests.submit.title")}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("settings.feedbackRequests.submit.type")}),e.jsxs("div",{className:"flex gap-4","data-testid":"feedback-submit-type",children:[e.jsxs("label",{className:"flex items-center","data-testid":"feedback-type-feature",children:[e.jsx("input",{type:"radio",value:"feature",checked:P==="feature",onChange:s=>Q(s.target.value),className:"mr-2"}),e.jsx(k,{path:se,size:.8,className:"mr-1 text-blue-600"}),t("settings.feedbackRequests.types.feature")]}),e.jsxs("label",{className:"flex items-center","data-testid":"feedback-type-issue",children:[e.jsx("input",{type:"radio",value:"issue",checked:P==="issue",onChange:s=>Q(s.target.value),className:"mr-2"}),e.jsx(k,{path:te,size:.8,className:"mr-1 text-red-600"}),t("settings.feedbackRequests.types.issue")]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t("settings.feedbackRequests.submit.title")," *"]}),e.jsx("input",{type:"text",value:q,onChange:s=>W(s.target.value),placeholder:t("settings.feedbackRequests.submit.titlePlaceholder"),"data-testid":"feedback-submit-title",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("settings.feedbackRequests.submit.description")}),e.jsx("textarea",{value:G,onChange:s=>J(s.target.value),placeholder:t("settings.feedbackRequests.submit.descriptionPlaceholder"),rows:5,"data-testid":"feedback-submit-description",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),q&&e.jsxs("div",{className:"text-sm text-gray-600 bg-blue-50 p-3 rounded",children:["ðŸ’¡ ",t("settings.feedbackRequests.submit.duplicateHint")]}),e.jsx("button",{type:"submit",disabled:X||!q.trim(),"data-testid":"feedback-submit-button",className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:t(X?"common.saving":"settings.feedbackRequests.submit.button")})]})]}):e.jsxs("div",{className:"space-y-3","data-testid":"feedback-requests-list",children:[V&&e.jsx("div",{className:"bg-red-50 text-red-800 p-4 rounded-lg",children:V}),Y.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:t("settings.feedbackRequests.noRequests")}):Y.map(s=>e.jsx("div",{"data-testid":`feedback-request-${s.id}`,className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:f=>{f.preventDefault(),f.stopPropagation(),setTimeout(()=>{m(s)},0)},children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${me(s.type)}`,children:[e.jsx(k,{path:s.type==="issue"?te:se,size:.5,className:"mr-1"}),t(`settings.feedbackRequests.types.${s.type}`)]}),e.jsxs("span",{className:`inline-flex items-center gap-1 text-sm ${_(s.status)}`,role:"status","data-testid":"feedback-status-list-badge","aria-label":`Status: ${t(`settings.feedbackRequests.statuses.${v(s.status)}`)}`,children:[e.jsx(k,{path:g(s.status),size:.6}),t(`settings.feedbackRequests.statuses.${v(s.status)}`)]}),s.priority&&F&&e.jsx("span",{className:"text-xs text-gray-500",children:t(`settings.feedbackRequests.priorities.${s.priority}`)})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsx("span",{children:s.user_email}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()}),s.version_completed&&e.jsxs("span",{className:"text-green-600 font-medium",children:["v",s.version_completed]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 ml-4",children:[e.jsxs("button",{onClick:f=>{f.stopPropagation(),ee(s.id)},"data-testid":"feedback-vote-button",className:`flex items-center gap-1 px-3 py-1 rounded-full border ${R.has(s.id)?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(k,{path:ae,size:.6}),e.jsx("span",{className:"font-medium",children:s.votes})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-600","data-testid":"feedback-comments-count",children:[e.jsx(k,{path:ne,size:.6}),e.jsx("span",{className:"text-sm",children:s.comments_count})]})]})]})},s.id))]}),u&&e.jsx(ye,{request:u,onClose:()=>m(null),onUpdate:s=>{m(null),T()}})]})}export{Ne as default};
