import{r as i,c as re,j as e,I as v}from"./vendor-react-600751b5.js";import{s as m,i as fe,M as be,m as xe}from"./index-c9551a19.js";import{u as ae}from"./useUserRole-783d1ca7.js";import{br as te,bs as se,bt as ne,bu as ie,a$ as ge,bv as pe,bw as ce,aT as oe,bx as le,at as de,aZ as he,ao as ye}from"./vendor-57b332a3.js";import"./vendor-i18n-2e1fa53c.js";import"./vendor-supabase-a724a182.js";import"./vendor-map-53abdaff.js";function ue(){const[s,R]=i.useState([]),[I,a]=i.useState(!0),[k,_]=i.useState(null),[j,L]=i.useState(null),[D,$]=i.useState(new Set);i.useEffect(()=>{(async()=>{const{data:{user:r}}=await m.auth.getUser();L((r==null?void 0:r.id)||null)})()},[]);const y=i.useCallback(async(c={})=>{try{a(!0),_(null);let r=m.from("feedback_requests").select("*").order("created_at",{ascending:!1});c.type&&(r=r.eq("type",c.type)),c.status&&(r=r.eq("status",c.status)),c.userId&&(r=r.eq("user_id",c.userId));const{data:o,error:n}=await r;if(n)throw n;if(R(o||[]),j){const{data:l}=await m.from("feedback_votes").select("request_id").eq("user_id",j);$(new Set((l==null?void 0:l.map(g=>g.request_id))||[]))}}catch(r){console.error("Error loading feedback requests:",r),_(r.message)}finally{a(!1)}},[j]),T=async c=>{try{const{data:{user:r}}=await m.auth.getUser();if(!r)throw new Error("User not authenticated");const{data:o,error:n}=await m.from("feedback_requests").insert({user_id:r.id,user_email:r.email,type:c.type,title:c.title,description:c.description||""}).select().single();if(n)throw n;return await y(),{data:o,error:null}}catch(r){return console.error("Error creating request:",r),{data:null,error:r.message}}},A=async(c,r)=>{try{const{data:o,error:n}=await m.from("feedback_requests").update(r).eq("id",c).select().single();if(n)throw n;return await y(),{data:o,error:null}}catch(o){return console.error("Error updating request:",o),{data:null,error:o.message}}},K=async c=>{try{const{error:r}=await m.from("feedback_requests").delete().eq("id",c);if(r)throw r;return await y(),{error:null}}catch(r){return console.error("Error deleting request:",r),{error:r.message}}},B=async c=>{try{const{data:{user:r}}=await m.auth.getUser();if(!r)throw new Error("User not authenticated");const{error:o}=await m.from("feedback_votes").insert({request_id:c,user_id:r.id});if(o)throw o;return $(n=>new Set([...n,c])),R(n=>n.map(l=>l.id===c?{...l,votes:l.votes+1}:l)),{error:null}}catch(r){return console.error("Error adding vote:",r),{error:r.message}}},z=async c=>{try{const{data:{user:r}}=await m.auth.getUser();if(!r)throw new Error("User not authenticated");const{error:o}=await m.from("feedback_votes").delete().eq("request_id",c).eq("user_id",r.id);if(o)throw o;return $(n=>{const l=new Set(n);return l.delete(c),l}),R(n=>n.map(l=>l.id===c?{...l,votes:Math.max(0,l.votes-1)}:l)),{error:null}}catch(r){return console.error("Error removing vote:",r),{error:r.message}}},x=async c=>{try{const{data:r,error:o}=await m.from("feedback_comments").select("*").eq("request_id",c).order("created_at",{ascending:!0});if(o)throw o;return{data:r||[],error:null}}catch(r){return console.error("Error loading comments:",r),{data:[],error:r.message}}},w=async(c,r)=>{try{const{data:{user:o}}=await m.auth.getUser();if(!o)throw new Error("User not authenticated");const{data:n,error:l}=await m.from("feedback_comments").insert({request_id:c,user_id:o.id,user_email:o.email,comment:r}).select().single();if(l)throw l;return R(g=>g.map(p=>p.id===c?{...p,comments_count:p.comments_count+1}:p)),{data:n,error:null}}catch(o){return console.error("Error adding comment:",o),{data:null,error:o.message}}},f=async(c,r)=>{try{const{error:o}=await m.from("feedback_comments").delete().eq("id",c);if(o)throw o;return R(n=>n.map(l=>l.id===r?{...l,comments_count:Math.max(0,l.comments_count-1)}:l)),{error:null}}catch(o){return console.error("Error deleting comment:",o),{error:o.message}}};return i.useEffect(()=>{const c=m.channel("feedback_requests_changes").on("postgres_changes",{event:"*",schema:"public",table:"feedback_requests"},()=>{y()}).subscribe(),r=m.channel("feedback_votes_changes").on("postgres_changes",{event:"*",schema:"public",table:"feedback_votes"},n=>{(n!=null&&n.new||n!=null&&n.old)&&R(l=>{var N,P;const g=[...l],p=((N=n.new)==null?void 0:N.request_id)||((P=n.old)==null?void 0:P.request_id);return g.findIndex(V=>V.id===p)!==-1&&y(),g})}).subscribe(),o=m.channel("feedback_comments_changes").on("postgres_changes",{event:"*",schema:"public",table:"feedback_comments"},n=>{var l,g;if(n!=null&&n.new||n!=null&&n.old){const p=((l=n.new)==null?void 0:l.request_id)||((g=n.old)==null?void 0:g.request_id);R(U=>U.map(N=>N.id===p?{...N}:N)),y()}}).subscribe();return()=>{m.removeChannel(c),m.removeChannel(r),m.removeChannel(o)}},[y]),{requests:s,loading:I,error:k,userVotes:D,currentUserId:j,loadRequests:y,createRequest:T,updateRequest:A,deleteRequest:K,addVote:B,removeVote:z,loadComments:x,addComment:w,deleteComment:f}}function ve({request:s,onClose:R,onUpdate:I}){const{t:a}=re(),{role:k}=ae(),{confirm:_}=fe(),j=k==="super_admin",{userVotes:L,currentUserId:D,addVote:$,removeVote:y,loadComments:T,addComment:A,deleteComment:K,updateRequest:B}=ue(),[z,x]=i.useState([]),[w,f]=i.useState(""),[c,r]=i.useState(!0),[o,n]=i.useState(!1),[l,g]=i.useState(!1),[p,U]=i.useState(s.status),[N,P]=i.useState(s.priority||""),[V,J]=i.useState(s.version_completed||""),[M,q]=i.useState(!1),[H,F]=i.useState(s.votes),[Q,E]=i.useState(s.comments_count||0);i.useEffect(()=>{F(s.votes),E(s.comments_count||0)},[s.id,s.votes,s.comments_count]),i.useEffect(()=>{(async()=>{r(!0);const{data:b}=await T(s.id);x(b||[]),r(!1)})()},[s.id,T]);const W=async()=>{if(L.has(s.id)){const{error:d}=await y(s.id);d||F(b=>Math.max(0,b-1))}else{const{error:d}=await $(s.id);d||F(b=>b+1)}},Z=async d=>{if(d.preventDefault(),!w.trim())return;n(!0);const{data:b,error:S}=await A(s.id,w.trim());!S&&b&&(x([...z,b]),f(""),E(h=>h+1)),n(!1)},G=async d=>{if(!await _({title:a("settings.feedbackRequests.detail.deleteComment"),message:a("common.confirmDelete"),confirmText:a("common.delete"),variant:"danger"}))return;const{error:S}=await K(d,s.id);S||(x(z.filter(h=>h.id!==d)),E(h=>Math.max(0,h-1)))},X=async()=>{q(!0);const d={status:p,priority:N||null,version_completed:V||null};p==="completed"&&s.status!=="completed"&&(d.completed_at=new Date().toISOString(),d.completed_by=D);const{error:b,data:S}=await B(s.id,d);b||(g(!1),I&&I(S)),q(!1)},O=d=>{if(!d)return"open";switch(d.toLowerCase()){case"in_progress":case"inprogress":case"in progress":return"in_progress";case"completed":return"completed";case"archived":return"archived";case"open":default:return"open"}},Y=d=>{switch(O(d),d){case"completed":return de;case"in_progress":return le;case"archived":return oe;default:return ce}},ee=d=>{switch(O(d)){case"completed":return"text-green-600";case"in_progress":return"text-blue-600";case"archived":return"text-gray-400";default:return"text-yellow-600"}};return e.jsxs(be,{isOpen:!0,onClose:R,size:"lg",showCloseButton:!1,children:[e.jsx("div",{className:"bg-gray-50 border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${s.type==="issue"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:[e.jsx(v,{path:s.type==="issue"?te:se,size:.5,className:"mr-1"}),a(`settings.feedbackRequests.types.${s.type}`)]})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 mt-2",children:[e.jsx("span",{children:s.user_email}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()}),s.version_completed&&!l&&e.jsxs("span",{className:"text-green-600 font-medium",children:["v",s.version_completed]})]})]})}),e.jsxs("div",{className:"px-6 py-4",children:[s.description&&e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:s.description})}),j&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg text-left flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:a("settings.feedbackRequests.detail.status")}),l?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g(!1),className:"text-sm text-gray-600 hover:text-gray-700",children:a("common.cancel")}),e.jsx("button",{onClick:X,disabled:M,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:a(M?"common.saving":"common.save")})]}):e.jsx("button",{onClick:()=>g(!0),className:"text-sm text-blue-600 hover:text-blue-700",children:a("common.edit")})]}),(()=>{const d={open:"open",in_progress:"inProgress",completed:"completed",archived:"archived"},b=O(s.status),S=d[b]||"open";return e.jsxs("div",{className:"mt-2 space-y-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"feedback-status-select",className:"text-sm font-medium text-gray-700 mb-1",children:a("settings.feedbackRequests.detail.statusCurrent")||a("settings.feedbackRequests.detail.status")||"Status"}),l?e.jsxs("select",{id:"feedback-status-select","aria-label":a("settings.feedbackRequests.detail.statusAriaEdit")||"Edit status",value:p,onChange:h=>U(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"open",children:a("settings.feedbackRequests.statuses.open")}),e.jsx("option",{value:"in_progress",children:a("settings.feedbackRequests.statuses.inProgress")}),e.jsx("option",{value:"completed",children:a("settings.feedbackRequests.statuses.completed")}),e.jsx("option",{value:"archived",children:a("settings.feedbackRequests.statuses.archived")})]}):e.jsxs("span",{role:"status","data-testid":"feedback-status-badge","aria-label":`Current status: ${a(`settings.feedbackRequests.statuses.${S}`)}`,className:`inline-flex items-center gap-2 px-2 py-1 rounded-md border text-sm font-medium ${ee(b)}`,children:[e.jsx(v,{path:Y(b),size:.8}),a(`settings.feedbackRequests.statuses.${S}`)]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:a("settings.feedbackRequests.detail.priority")}),l?e.jsxs("select",{value:N,onChange:h=>P(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm","aria-label":a("settings.feedbackRequests.detail.priorityAriaEdit")||"Edit priority",children:[e.jsx("option",{value:"",children:a("settings.feedbackRequests.priorities.none")||"No priority"}),e.jsx("option",{value:"low",children:a("settings.feedbackRequests.priorities.low")}),e.jsx("option",{value:"medium",children:a("settings.feedbackRequests.priorities.medium")}),e.jsx("option",{value:"high",children:a("settings.feedbackRequests.priorities.high")})]}):e.jsx("span",{className:`inline-flex items-center gap-2 px-2 py-1 rounded-md border text-sm font-medium ${s.priority==="high"?"border-red-300 bg-red-50 text-red-700":s.priority==="medium"?"border-yellow-300 bg-yellow-50 text-yellow-700":s.priority==="low"?"border-green-300 bg-green-50 text-green-700":"border-gray-300 bg-white text-gray-600"}`,"data-testid":"feedback-priority-badge",role:"status","aria-label":`Current priority: ${s.priority?a(`settings.feedbackRequests.priorities.${s.priority}`):a("settings.feedbackRequests.priorities.none")||"No priority"}`,children:s.priority?a(`settings.feedbackRequests.priorities.${s.priority}`):a("settings.feedbackRequests.priorities.none")||"No priority"})]}),l&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:a("settings.feedbackRequests.detail.version")}),e.jsx("input",{type:"text",value:V,onChange:h=>J(h.target.value),placeholder:"e.g., 1.2.0",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]})})()]}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:W,className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors ${L.has(s.id)?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(v,{path:ne,size:.8}),e.jsx("span",{className:"font-medium",children:L.has(s.id)?a("common.voted"):a("common.vote")}),e.jsxs("span",{className:"text-sm","aria-label":`Total votes: ${H}`,children:["(",H,")"]})]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(v,{path:ie,size:.8}),a("settings.feedbackRequests.detail.comments")," (",Q,")"]}),c?e.jsx("div",{className:"text-center py-4 text-gray-500",children:a("common.loading")}):z.length===0?e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:a("settings.feedbackRequests.detail.noComments")}):e.jsx("div",{className:"space-y-3 mb-4",children:z.map(d=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-900",children:d.user_email}),e.jsx("span",{className:"text-gray-500 ml-2",children:new Date(d.created_at).toLocaleDateString()})]}),(d.user_id===D||j)&&e.jsx("button",{onClick:()=>G(d.id),className:"text-red-600 hover:text-red-700",children:e.jsx(v,{path:ge,size:.6})})]}),e.jsx("p",{className:"text-gray-700 text-sm whitespace-pre-wrap",children:d.comment})]},d.id))}),e.jsxs("form",{onSubmit:Z,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:w,onChange:d=>f(d.target.value),placeholder:a("settings.feedbackRequests.detail.addComment"),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("button",{type:"submit",disabled:o||!w.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(v,{path:pe,size:.7}),a("settings.feedbackRequests.detail.postComment")]})]})]})]})]})}function qe(){const{t:s}=re(),{role:R}=ae(),I=R==="super_admin",{preferences:a,loading:k,updatePreference:_}=xe(),{requests:j,loading:L,error:D,userVotes:$,currentUserId:y,loadRequests:T,createRequest:A,updateRequest:K,addVote:B,removeVote:z}=ue(),[x,w]=i.useState("all"),[f,c]=i.useState([]),[r,o]=i.useState([]),[n,l]=i.useState(""),[g,p]=i.useState(null),[U,N]=i.useState(!1),[P,V]=i.useState(!1),J=i.useRef(null),M=i.useRef(null),[q,H]=i.useState(!1);i.useEffect(()=>{a&&!k&&(w(a.feedback_active_tab||"all"),c(a.feedback_filter_types||[]),o(a.feedback_filter_statuses||[]),H(!0),console.log("FeedbackRequests: Preferences loaded and applied (sync)"))},[a,k]),i.useEffect(()=>{const t=u=>{J.current&&!J.current.contains(u.target)&&N(!1),M.current&&!M.current.contains(u.target)&&V(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const[F,Q]=i.useState("feature"),[E,W]=i.useState(""),[Z,G]=i.useState(""),[X,O]=i.useState(!1);i.useEffect(()=>{const t={};x==="my"&&y&&(t.userId=y),T(t)},[x,y,T]),i.useEffect(()=>{if(a&&!k&&q&&x!==a.feedback_active_tab){console.log("FeedbackRequests: Saving activeTab",x);const t=setTimeout(()=>{_("feedback_active_tab",x),console.log("FeedbackRequests: activeTab saved")},500);return()=>clearTimeout(t)}},[x,a,k,q,_]),i.useEffect(()=>{if(a&&!k&&q&&JSON.stringify(f)!==JSON.stringify(a.feedback_filter_types)){console.log("FeedbackRequests: Saving filterTypes",f);const t=setTimeout(()=>{_("feedback_filter_types",f),console.log("FeedbackRequests: filterTypes saved")},500);return()=>clearTimeout(t)}},[f,a,k,q,_]),i.useEffect(()=>{if(a&&!k&&q&&JSON.stringify(r)!==JSON.stringify(a.feedback_filter_statuses)){console.log("FeedbackRequests: Saving filterStatuses",r);const t=setTimeout(()=>{_("feedback_filter_statuses",r),console.log("FeedbackRequests: filterStatuses saved")},500);return()=>clearTimeout(t)}},[r,a,k,q,_]);const Y=j.filter(t=>{var u;if(n){const C=n.toLowerCase();if(!(t.title.toLowerCase().includes(C)||((u=t.description)==null?void 0:u.toLowerCase().includes(C))||t.user_email.toLowerCase().includes(C)))return!1}if(f.length>0&&!f.includes(t.type))return!1;if(r.length>0){const C=t.status||"open";if(!r.includes(C))return!1}return!0}),ee=async t=>{$.has(t)?await z(t):await B(t)},d=async t=>{if(t.preventDefault(),!E.trim())return;O(!0);const{error:u}=await A({type:F,title:E.trim(),description:Z.trim()});u||(W(""),G(""),w("all")),O(!1)},b=t=>{switch(t){case"completed":return de;case"in_progress":return le;case"archived":return oe;default:return ce}},S=t=>{switch(t){case"completed":return"text-green-600";case"in_progress":return"text-blue-600";case"archived":return"text-gray-400";default:return"text-yellow-600"}},h=t=>{if(!t)return"open";const u=t.toLowerCase();return u==="in_progress"||u==="inprogress"||u==="in progress"?"inProgress":u==="completed"?"completed":u==="archived"?"archived":"open"},me=t=>t==="issue"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800";return L&&j.length===0?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"text-gray-500",children:s("common.loading")})}):e.jsxs("div",{className:"space-y-6","data-testid":"feedback-requests-container",children:[e.jsxs("div",{"data-testid":"feedback-header",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s("settings.feedbackRequests.title")}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:s("settings.feedbackRequests.description")})]}),e.jsx("div",{className:"border-b border-gray-200","data-testid":"feedback-tabs",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>w("all"),"data-testid":"feedback-tab-all",className:`py-4 px-1 border-b-2 font-medium text-sm ${x==="all"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:s("settings.feedbackRequests.tabs.all")}),e.jsx("button",{onClick:()=>w("my"),"data-testid":"feedback-tab-my",className:`py-4 px-1 border-b-2 font-medium text-sm ${x==="my"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:s("settings.feedbackRequests.tabs.myRequests")}),e.jsxs("button",{onClick:()=>w("submit"),"data-testid":"feedback-tab-submit",className:`py-4 px-1 border-b-2 font-medium text-sm ${x==="submit"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(v,{path:he,size:.7,className:"inline mr-1"}),s("settings.feedbackRequests.tabs.submit")]})]})}),(x==="all"||x==="my")&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-4","data-testid":"feedback-filters",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(v,{path:ye,size:.8}),e.jsx("span",{className:"font-medium",children:s("settings.feedbackRequests.filters.title")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("input",{type:"text",placeholder:s("settings.feedbackRequests.filters.search"),value:n,onChange:t=>l(t.target.value),"data-testid":"feedback-search",className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"relative",ref:J,"data-testid":"feedback-type-filter",children:[e.jsxs("button",{type:"button",onClick:()=>N(!U),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-left flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-900",children:f.length===0?s("settings.feedbackRequests.filters.allTypes"):f.length===1?s(`settings.feedbackRequests.types.${f[0]}`):`${f.length} ${s("settings.feedbackRequests.filters.selectedTypes")||"selected types"}`}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),U&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg",children:e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center px-2 py-1 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f.length===0,onChange:()=>c([]),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:s("settings.feedbackRequests.filters.allTypes")})]}),["issue","feature"].map(t=>e.jsxs("label",{className:"flex items-center px-2 py-1 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f.includes(t),onChange:u=>{u.target.checked?c([...f,t]):c(f.filter(C=>C!==t))},className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:s(`settings.feedbackRequests.types.${t}`)})]},t))]})})]}),e.jsxs("div",{className:"relative",ref:M,"data-testid":"feedback-status-filter",children:[e.jsxs("button",{type:"button",onClick:()=>V(!P),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-left flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-900",children:r.length===0?s("settings.feedbackRequests.filters.allStatuses"):r.length===1?s(`settings.feedbackRequests.statuses.${h(r[0])}`):`${r.length} ${s("settings.feedbackRequests.filters.selectedStatuses")}`}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),P&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg",children:e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center px-2 py-1 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.length===0,onChange:()=>o([]),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:s("settings.feedbackRequests.filters.allStatuses")})]}),["open","in_progress","completed","archived"].map(t=>e.jsxs("label",{className:"flex items-center px-2 py-1 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.includes(t),onChange:u=>{u.target.checked?o([...r,t]):o(r.filter(C=>C!==t))},className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:s(`settings.feedbackRequests.statuses.${h(t)}`)})]},t))]})})]})]})]}),x==="submit"?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6","data-testid":"feedback-submit-form",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:s("settings.feedbackRequests.submit.title")}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("settings.feedbackRequests.submit.type")}),e.jsxs("div",{className:"flex gap-4","data-testid":"feedback-submit-type",children:[e.jsxs("label",{className:"flex items-center","data-testid":"feedback-type-feature",children:[e.jsx("input",{type:"radio",value:"feature",checked:F==="feature",onChange:t=>Q(t.target.value),className:"mr-2"}),e.jsx(v,{path:se,size:.8,className:"mr-1 text-blue-600"}),s("settings.feedbackRequests.types.feature")]}),e.jsxs("label",{className:"flex items-center","data-testid":"feedback-type-issue",children:[e.jsx("input",{type:"radio",value:"issue",checked:F==="issue",onChange:t=>Q(t.target.value),className:"mr-2"}),e.jsx(v,{path:te,size:.8,className:"mr-1 text-red-600"}),s("settings.feedbackRequests.types.issue")]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s("settings.feedbackRequests.submit.title")," *"]}),e.jsx("input",{type:"text",value:E,onChange:t=>W(t.target.value),placeholder:s("settings.feedbackRequests.submit.titlePlaceholder"),"data-testid":"feedback-submit-title",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("settings.feedbackRequests.submit.description")}),e.jsx("textarea",{value:Z,onChange:t=>G(t.target.value),placeholder:s("settings.feedbackRequests.submit.descriptionPlaceholder"),rows:5,"data-testid":"feedback-submit-description",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),E&&e.jsxs("div",{className:"text-sm text-gray-600 bg-blue-50 p-3 rounded",children:["ðŸ’¡ ",s("settings.feedbackRequests.submit.duplicateHint")]}),e.jsx("button",{type:"submit",disabled:X||!E.trim(),"data-testid":"feedback-submit-button",className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:s(X?"common.saving":"settings.feedbackRequests.submit.button")})]})]}):e.jsxs("div",{className:"space-y-3","data-testid":"feedback-requests-list",children:[D&&e.jsx("div",{className:"bg-red-50 text-red-800 p-4 rounded-lg",children:D}),Y.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:s("settings.feedbackRequests.noRequests")}):Y.map(t=>e.jsx("div",{"data-testid":`feedback-request-${t.id}`,className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>p(t),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${me(t.type)}`,children:[e.jsx(v,{path:t.type==="issue"?te:se,size:.5,className:"mr-1"}),s(`settings.feedbackRequests.types.${t.type}`)]}),e.jsxs("span",{className:`inline-flex items-center gap-1 text-sm ${S(t.status)}`,role:"status","data-testid":"feedback-status-list-badge","aria-label":`Status: ${s(`settings.feedbackRequests.statuses.${h(t.status)}`)}`,children:[e.jsx(v,{path:b(t.status),size:.6}),s(`settings.feedbackRequests.statuses.${h(t.status)}`)]}),t.priority&&I&&e.jsx("span",{className:"text-xs text-gray-500",children:s(`settings.feedbackRequests.priorities.${t.priority}`)})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:t.title}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsx("span",{children:t.user_email}),e.jsx("span",{children:new Date(t.created_at).toLocaleDateString()}),t.version_completed&&e.jsxs("span",{className:"text-green-600 font-medium",children:["v",t.version_completed]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 ml-4",children:[e.jsxs("button",{onClick:u=>{u.stopPropagation(),ee(t.id)},"data-testid":"feedback-vote-button",className:`flex items-center gap-1 px-3 py-1 rounded-full border ${$.has(t.id)?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(v,{path:ne,size:.6}),e.jsx("span",{className:"font-medium",children:t.votes})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-600","data-testid":"feedback-comments-count",children:[e.jsx(v,{path:ie,size:.6}),e.jsx("span",{className:"text-sm",children:t.comments_count})]})]})]})},t.id))]}),g&&e.jsx(ve,{request:g,onClose:()=>p(null),onUpdate:t=>{if(t){const u=j.findIndex(C=>C.id===t.id);u!==-1&&(j[u]={...j[u],...t})}p(null),T()}})]})}export{qe as default};
