import{r,s as x,u as ae,K as be,j as e,M as fe,I as k,be as te,bf as se,bg as re,bh as ne,ai as xe,bi as pe,bj as ie,ar as oe,bk as ce,L as le,af as ge,l as he}from"./index-c3c9ac92.js";import{u as de}from"./useUserRole-acbbb5e6.js";function ue(){const[t,N]=r.useState([]),[M,i]=r.useState(!0),[D,$]=r.useState(null),[C,U]=r.useState(null),[V,R]=r.useState(new Set);r.useEffect(()=>{(async()=>{const{data:{user:a}}=await x.auth.getUser();U((a==null?void 0:a.id)||null)})()},[]);const j=r.useCallback(async(c={})=>{try{i(!0),$(null);let a=x.from("feedback_requests").select("*").order("created_at",{ascending:!1});c.type&&(a=a.eq("type",c.type)),c.status&&(a=a.eq("status",c.status)),c.userId&&(a=a.eq("user_id",c.userId));const{data:l,error:o}=await a;if(o)throw o;if(N(l||[]),C){const{data:n}=await x.from("feedback_votes").select("request_id").eq("user_id",C);R(new Set((n==null?void 0:n.map(u=>u.request_id))||[]))}}catch(a){console.error("Error loading feedback requests:",a),$(a.message)}finally{i(!1)}},[C]),L=r.useCallback(async c=>{try{const{data:{user:a}}=await x.auth.getUser();if(!a)throw new Error("User not authenticated");const{data:l,error:o}=await x.from("feedback_requests").insert({user_id:a.id,user_email:a.email,type:c.type,title:c.title,description:c.description||""}).select().single();if(o)throw o;return await j(),{data:l,error:null}}catch(a){return console.error("Error creating request:",a),{data:null,error:a.message}}},[j]),B=r.useCallback(async(c,a)=>{try{const{data:l,error:o}=await x.from("feedback_requests").update(a).eq("id",c).select().single();if(o)throw o;return await j(),{data:l,error:null}}catch(l){return console.error("Error updating request:",l),{data:null,error:l.message}}},[j]),H=r.useCallback(async c=>{try{const{error:a}=await x.from("feedback_requests").delete().eq("id",c);if(a)throw a;return await j(),{error:null}}catch(a){return console.error("Error deleting request:",a),{error:a.message}}},[j]),K=r.useCallback(async c=>{try{const{data:{user:a}}=await x.auth.getUser();if(!a)throw new Error("User not authenticated");const{error:l}=await x.from("feedback_votes").insert({request_id:c,user_id:a.id});if(l)throw l;return R(o=>new Set([...o,c])),N(o=>o.map(n=>n.id===c?{...n,votes:n.votes+1}:n)),{error:null}}catch(a){return console.error("Error adding vote:",a),{error:a.message}}},[R]),T=r.useCallback(async c=>{try{const{data:{user:a}}=await x.auth.getUser();if(!a)throw new Error("User not authenticated");const{error:l}=await x.from("feedback_votes").delete().eq("request_id",c).eq("user_id",a.id);if(l)throw l;return R(o=>{const n=new Set(o);return n.delete(c),n}),N(o=>o.map(n=>n.id===c?{...n,votes:Math.max(0,n.votes-1)}:n)),{error:null}}catch(a){return console.error("Error removing vote:",a),{error:a.message}}},[R]),v=r.useCallback(async c=>{try{const{data:a,error:l}=await x.from("feedback_comments").select("*").eq("request_id",c).order("created_at",{ascending:!0});if(l)throw l;return{data:a||[],error:null}}catch(a){return console.error("Error loading comments:",a),{data:[],error:a.message}}},[]),w=r.useCallback(async(c,a)=>{try{const{data:{user:l}}=await x.auth.getUser();if(!l)throw new Error("User not authenticated");const{data:o,error:n}=await x.from("feedback_comments").insert({request_id:c,user_id:l.id,user_email:l.email,comment:a}).select().single();if(n)throw n;return N(u=>u.map(m=>m.id===c?{...m,comments_count:m.comments_count+1}:m)),{data:o,error:null}}catch(l){return console.error("Error adding comment:",l),{data:null,error:l.message}}},[]),g=r.useCallback(async(c,a)=>{try{const{error:l}=await x.from("feedback_comments").delete().eq("id",c);if(l)throw l;return N(o=>o.map(n=>n.id===a?{...n,comments_count:Math.max(0,n.comments_count-1)}:n)),{error:null}}catch(l){return console.error("Error deleting comment:",l),{error:l.message}}},[]);return r.useEffect(()=>{const c=x.channel("feedback_requests_changes").on("postgres_changes",{event:"*",schema:"public",table:"feedback_requests"},o=>{o&&N(n=>{const u=[...n],m=o.new,h=o.old,b=(m==null?void 0:m.id)||(h==null?void 0:h.id),z=u.findIndex(S=>S.id===b);return m&&!h?[m,...u]:m&&h?(z!==-1&&(u[z]={...u[z],...m}),u):h&&!m?u.filter(S=>S.id!==h.id):u})}).subscribe(),a=x.channel("feedback_votes_changes").on("postgres_changes",{event:"*",schema:"public",table:"feedback_votes"},o=>{if(!o)return;const n=o.new,u=o.old,m=(n==null?void 0:n.request_id)||(u==null?void 0:u.request_id);m&&N(h=>h.map(b=>b.id!==m?b:n&&!u?{...b,votes:(b.votes||0)+1}:!n&&u?{...b,votes:Math.max(0,(b.votes||0)-1)}:b))}).subscribe(),l=x.channel("feedback_comments_changes").on("postgres_changes",{event:"*",schema:"public",table:"feedback_comments"},o=>{if(!o)return;const n=o.new,u=o.old,m=(n==null?void 0:n.request_id)||(u==null?void 0:u.request_id);m&&N(h=>h.map(b=>b.id!==m?b:n&&!u?{...b,comments_count:(b.comments_count||0)+1}:!n&&u?{...b,comments_count:Math.max(0,(b.comments_count||0)-1)}:b))}).subscribe();return()=>{x.removeChannel(c),x.removeChannel(a),x.removeChannel(l)}},[j]),{requests:t,loading:M,error:D,userVotes:V,currentUserId:C,loadRequests:j,createRequest:L,updateRequest:B,deleteRequest:H,addVote:K,removeVote:T,loadComments:v,addComment:w,deleteComment:g}}function ye({request:t,onClose:N,onUpdate:M}){const{t:i}=ae(),{role:D}=de(),{confirm:$}=be(),C=D==="super_admin",{userVotes:U,currentUserId:V,addVote:R,removeVote:j,loadComments:L,addComment:B,deleteComment:H,updateRequest:K}=ue(),[T,v]=r.useState([]),[w,g]=r.useState(""),[c,a]=r.useState(!0),[l,o]=r.useState(!1),[n,u]=r.useState(!1),[m,h]=r.useState(t.status),[b,z]=r.useState(t.priority||""),[S,O]=r.useState(t.version_completed||""),[F,I]=r.useState(!1),[Z,P]=r.useState(t.votes),[Q,q]=r.useState(t.comments_count||0);r.useEffect(()=>{P(t.votes),q(t.comments_count||0)},[t.id,t.votes,t.comments_count]),r.useEffect(()=>{(async()=>{a(!0);const{data:p}=await L(t.id);v(p||[]),a(!1)})()},[t.id,L]);const W=async()=>{if(U.has(t.id)){const{error:d}=await j(t.id);d||P(p=>Math.max(0,p-1))}else{const{error:d}=await R(t.id);d||P(p=>p+1)}},G=async d=>{if(d.preventDefault(),!w.trim())return;o(!0);const{data:p,error:_}=await B(t.id,w.trim());!_&&p&&(v([...T,p]),g(""),q(y=>y+1)),o(!1)},J=async d=>{if(!await $({title:i("settings.feedbackRequests.detail.deleteComment"),message:i("common.confirmDelete"),confirmText:i("common.delete"),variant:"danger"}))return;const{error:_}=await H(d,t.id);_||(v(T.filter(y=>y.id!==d)),q(y=>Math.max(0,y-1)))},X=async()=>{I(!0);const d={status:m,priority:b||null,version_completed:S||null};m==="completed"&&t.status!=="completed"&&(d.completed_at=new Date().toISOString(),d.completed_by=V);const{error:p,data:_}=await K(t.id,d);p||(u(!1),M&&M(_)),I(!1)},A=d=>{if(!d)return"open";switch(d.toLowerCase()){case"in_progress":case"inprogress":case"in progress":return"in_progress";case"completed":return"completed";case"archived":return"archived";case"open":default:return"open"}},Y=d=>{switch(A(d),d){case"completed":return le;case"in_progress":return ce;case"archived":return oe;default:return ie}},ee=d=>{switch(A(d)){case"completed":return"text-green-600";case"in_progress":return"text-blue-600";case"archived":return"text-gray-400";default:return"text-yellow-600"}};return e.jsxs(fe,{isOpen:!0,onClose:N,size:"lg",showCloseButton:!1,children:[e.jsx("div",{className:"bg-gray-50 border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${t.type==="issue"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:[e.jsx(k,{path:t.type==="issue"?te:se,size:.5,className:"mr-1"}),i(`settings.feedbackRequests.types.${t.type}`)]})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:t.title}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 mt-2",children:[e.jsx("span",{children:t.user_email}),e.jsx("span",{children:new Date(t.created_at).toLocaleDateString()}),t.version_completed&&!n&&e.jsxs("span",{className:"text-green-600 font-medium",children:["v",t.version_completed]})]})]})}),e.jsxs("div",{className:"px-6 py-4",children:[t.description&&e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:t.description})}),C&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg text-left flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:i("settings.feedbackRequests.detail.status")}),n?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u(!1),className:"text-sm text-gray-600 hover:text-gray-700",children:i("common.cancel")}),e.jsx("button",{onClick:X,disabled:F,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:i(F?"common.saving":"common.save")})]}):e.jsx("button",{onClick:()=>u(!0),className:"text-sm text-blue-600 hover:text-blue-700",children:i("common.edit")})]}),(()=>{const d={open:"open",in_progress:"inProgress",completed:"completed",archived:"archived"},p=A(t.status),_=d[p]||"open";return e.jsxs("div",{className:"mt-2 space-y-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"feedback-status-select",className:"text-sm font-medium text-gray-700 mb-1",children:i("settings.feedbackRequests.detail.statusCurrent")||i("settings.feedbackRequests.detail.status")||"Status"}),n?e.jsxs("select",{id:"feedback-status-select","aria-label":i("settings.feedbackRequests.detail.statusAriaEdit")||"Edit status",value:m,onChange:y=>h(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"open",children:i("settings.feedbackRequests.statuses.open")}),e.jsx("option",{value:"in_progress",children:i("settings.feedbackRequests.statuses.inProgress")}),e.jsx("option",{value:"completed",children:i("settings.feedbackRequests.statuses.completed")}),e.jsx("option",{value:"archived",children:i("settings.feedbackRequests.statuses.archived")})]}):e.jsxs("span",{role:"status","data-testid":"feedback-status-badge","aria-label":`Current status: ${i(`settings.feedbackRequests.statuses.${_}`)}`,className:`inline-flex items-center gap-2 px-2 py-1 rounded-md border text-sm font-medium ${ee(p)}`,children:[e.jsx(k,{path:Y(p),size:.8}),i(`settings.feedbackRequests.statuses.${_}`)]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:i("settings.feedbackRequests.detail.priority")}),n?e.jsxs("select",{value:b,onChange:y=>z(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm","aria-label":i("settings.feedbackRequests.detail.priorityAriaEdit")||"Edit priority",children:[e.jsx("option",{value:"",children:i("settings.feedbackRequests.priorities.none")||"No priority"}),e.jsx("option",{value:"low",children:i("settings.feedbackRequests.priorities.low")}),e.jsx("option",{value:"medium",children:i("settings.feedbackRequests.priorities.medium")}),e.jsx("option",{value:"high",children:i("settings.feedbackRequests.priorities.high")})]}):e.jsx("span",{className:`inline-flex items-center gap-2 px-2 py-1 rounded-md border text-sm font-medium ${t.priority==="high"?"border-red-300 bg-red-50 text-red-700":t.priority==="medium"?"border-yellow-300 bg-yellow-50 text-yellow-700":t.priority==="low"?"border-green-300 bg-green-50 text-green-700":"border-gray-300 bg-white text-gray-600"}`,"data-testid":"feedback-priority-badge",role:"status","aria-label":`Current priority: ${t.priority?i(`settings.feedbackRequests.priorities.${t.priority}`):i("settings.feedbackRequests.priorities.none")||"No priority"}`,children:t.priority?i(`settings.feedbackRequests.priorities.${t.priority}`):i("settings.feedbackRequests.priorities.none")||"No priority"})]}),n&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1",children:i("settings.feedbackRequests.detail.version")}),e.jsx("input",{type:"text",value:S,onChange:y=>O(y.target.value),placeholder:"e.g., 1.2.0",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]})})()]}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:W,className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors ${U.has(t.id)?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(k,{path:re,size:.8}),e.jsx("span",{className:"font-medium",children:U.has(t.id)?i("common.voted"):i("common.vote")}),e.jsxs("span",{className:"text-sm","aria-label":`Total votes: ${Z}`,children:["(",Z,")"]})]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(k,{path:ne,size:.8}),i("settings.feedbackRequests.detail.comments")," (",Q,")"]}),c?e.jsx("div",{className:"text-center py-4 text-gray-500",children:i("common.loading")}):T.length===0?e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:i("settings.feedbackRequests.detail.noComments")}):e.jsx("div",{className:"space-y-3 mb-4",children:T.map(d=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-900",children:d.user_email}),e.jsx("span",{className:"text-gray-500 ml-2",children:new Date(d.created_at).toLocaleDateString()})]}),(d.user_id===V||C)&&e.jsx("button",{onClick:()=>J(d.id),className:"text-red-600 hover:text-red-700",children:e.jsx(k,{path:xe,size:.6})})]}),e.jsx("p",{className:"text-gray-700 text-sm whitespace-pre-wrap",children:d.comment})]},d.id))}),e.jsxs("form",{onSubmit:G,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:w,onChange:d=>g(d.target.value),placeholder:i("settings.feedbackRequests.detail.addComment"),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("button",{type:"submit",disabled:l||!w.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(k,{path:pe,size:.7}),i("settings.feedbackRequests.detail.postComment")]})]})]})]})]})}function Ne(){const{t}=ae(),{role:N}=de(),M=N==="super_admin",i=null,D=!1,$=r.useCallback(()=>{},[]),{requests:C,loading:U,error:V,userVotes:R,currentUserId:j,loadRequests:L,createRequest:B,updateRequest:H,addVote:K,removeVote:T}=ue(),[v,w]=r.useState("all"),[g,c]=r.useState([]),[a,l]=r.useState([]),[o,n]=r.useState(""),[u,m]=r.useState(null),[h,b]=r.useState(!1),[z,S]=r.useState(!1),O=r.useRef(null),F=r.useRef(null),[I,Z]=r.useState(!1);r.useEffect(()=>{const s=f=>{O.current&&!O.current.contains(f.target)&&b(!1),F.current&&!F.current.contains(f.target)&&S(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const[P,Q]=r.useState("feature"),[q,W]=r.useState(""),[G,J]=r.useState(""),[X,A]=r.useState(!1);r.useEffect(()=>{const s={};v==="my"&&j&&(s.userId=j),L(s)},[v,j,L]),r.useEffect(()=>{},[v,i,D,I,$]),r.useEffect(()=>{},[g,i,D,I,$]),r.useEffect(()=>{},[a,i,D,I,$]);const Y=C.filter(s=>{var f;if(o){const E=o.toLowerCase();if(!(s.title.toLowerCase().includes(E)||((f=s.description)==null?void 0:f.toLowerCase().includes(E))||s.user_email.toLowerCase().includes(E)))return!1}if(g.length>0&&!g.includes(s.type))return!1;if(a.length>0){const E=s.status||"open";if(!a.includes(E))return!1}return!0}),ee=async s=>{R.has(s)?await T(s):await K(s)},d=async s=>{if(s.preventDefault(),!q.trim())return;A(!0);const{error:f}=await B({type:P,title:q.trim(),description:G.trim()});f||(W(""),J(""),w("all")),A(!1)},p=s=>{switch(s){case"completed":return le;case"in_progress":return ce;case"archived":return oe;default:return ie}},_=s=>{switch(s){case"completed":return"text-green-600";case"in_progress":return"text-blue-600";case"archived":return"text-gray-400";default:return"text-yellow-600"}},y=s=>{if(!s)return"open";const f=s.toLowerCase();return f==="in_progress"||f==="inprogress"||f==="in progress"?"inProgress":f==="completed"?"completed":f==="archived"?"archived":"open"},me=s=>s==="issue"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800";return U&&C.length===0?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"text-gray-500",children:t("common.loading")})}):e.jsxs("div",{className:"space-y-6","data-testid":"feedback-requests-container",children:[e.jsxs("div",{"data-testid":"feedback-header",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t("settings.feedbackRequests.title")}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:t("settings.feedbackRequests.description")})]}),e.jsx("div",{className:"border-b border-gray-200","data-testid":"feedback-tabs",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>w("all"),"data-testid":"feedback-tab-all",className:`py-4 px-1 border-b-2 font-medium text-sm ${v==="all"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:t("settings.feedbackRequests.tabs.all")}),e.jsx("button",{onClick:()=>w("my"),"data-testid":"feedback-tab-my",className:`py-4 px-1 border-b-2 font-medium text-sm ${v==="my"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:t("settings.feedbackRequests.tabs.myRequests")}),e.jsxs("button",{onClick:()=>w("submit"),"data-testid":"feedback-tab-submit",className:`py-4 px-1 border-b-2 font-medium text-sm ${v==="submit"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(k,{path:ge,size:.7,className:"inline mr-1"}),t("settings.feedbackRequests.tabs.submit")]})]})}),(v==="all"||v==="my")&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-4","data-testid":"feedback-filters",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(k,{path:he,size:.8}),e.jsx("span",{className:"font-medium",children:t("settings.feedbackRequests.filters.title")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("input",{type:"text",placeholder:t("settings.feedbackRequests.filters.search"),value:o,onChange:s=>n(s.target.value),"data-testid":"feedback-search",className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"relative",ref:O,"data-testid":"feedback-type-filter",children:[e.jsxs("button",{type:"button",onClick:()=>b(!h),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-left flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-900",children:g.length===0?t("settings.feedbackRequests.filters.allTypes"):g.length===1?t(`settings.feedbackRequests.types.${g[0]}`):`${g.length} ${t("settings.feedbackRequests.filters.selectedTypes")||"selected types"}`}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),h&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg",children:e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center px-2 py-1 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g.length===0,onChange:()=>c([]),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:t("settings.feedbackRequests.filters.allTypes")})]}),["issue","feature"].map(s=>e.jsxs("label",{className:"flex items-center px-2 py-1 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g.includes(s),onChange:f=>{f.target.checked?c([...g,s]):c(g.filter(E=>E!==s))},className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:t(`settings.feedbackRequests.types.${s}`)})]},s))]})})]}),e.jsxs("div",{className:"relative",ref:F,"data-testid":"feedback-status-filter",children:[e.jsxs("button",{type:"button",onClick:()=>S(!z),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-left flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-900",children:a.length===0?t("settings.feedbackRequests.filters.allStatuses"):a.length===1?t(`settings.feedbackRequests.statuses.${y(a[0])}`):`${a.length} ${t("settings.feedbackRequests.filters.selectedStatuses")}`}),e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),z&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg",children:e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("label",{className:"flex items-center px-2 py-1 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.length===0,onChange:()=>l([]),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:t("settings.feedbackRequests.filters.allStatuses")})]}),["open","in_progress","completed","archived"].map(s=>e.jsxs("label",{className:"flex items-center px-2 py-1 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.includes(s),onChange:f=>{f.target.checked?l([...a,s]):l(a.filter(E=>E!==s))},className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-900",children:t(`settings.feedbackRequests.statuses.${y(s)}`)})]},s))]})})]})]})]}),v==="submit"?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6","data-testid":"feedback-submit-form",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:t("settings.feedbackRequests.submit.title")}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("settings.feedbackRequests.submit.type")}),e.jsxs("div",{className:"flex gap-4","data-testid":"feedback-submit-type",children:[e.jsxs("label",{className:"flex items-center","data-testid":"feedback-type-feature",children:[e.jsx("input",{type:"radio",value:"feature",checked:P==="feature",onChange:s=>Q(s.target.value),className:"mr-2"}),e.jsx(k,{path:se,size:.8,className:"mr-1 text-blue-600"}),t("settings.feedbackRequests.types.feature")]}),e.jsxs("label",{className:"flex items-center","data-testid":"feedback-type-issue",children:[e.jsx("input",{type:"radio",value:"issue",checked:P==="issue",onChange:s=>Q(s.target.value),className:"mr-2"}),e.jsx(k,{path:te,size:.8,className:"mr-1 text-red-600"}),t("settings.feedbackRequests.types.issue")]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t("settings.feedbackRequests.submit.title")," *"]}),e.jsx("input",{type:"text",value:q,onChange:s=>W(s.target.value),placeholder:t("settings.feedbackRequests.submit.titlePlaceholder"),"data-testid":"feedback-submit-title",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("settings.feedbackRequests.submit.description")}),e.jsx("textarea",{value:G,onChange:s=>J(s.target.value),placeholder:t("settings.feedbackRequests.submit.descriptionPlaceholder"),rows:5,"data-testid":"feedback-submit-description",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),q&&e.jsxs("div",{className:"text-sm text-gray-600 bg-blue-50 p-3 rounded",children:["ðŸ’¡ ",t("settings.feedbackRequests.submit.duplicateHint")]}),e.jsx("button",{type:"submit",disabled:X||!q.trim(),"data-testid":"feedback-submit-button",className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:t(X?"common.saving":"settings.feedbackRequests.submit.button")})]})]}):e.jsxs("div",{className:"space-y-3","data-testid":"feedback-requests-list",children:[V&&e.jsx("div",{className:"bg-red-50 text-red-800 p-4 rounded-lg",children:V}),Y.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:t("settings.feedbackRequests.noRequests")}):Y.map(s=>e.jsx("div",{"data-testid":`feedback-request-${s.id}`,className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:f=>{f.preventDefault(),f.stopPropagation(),setTimeout(()=>{m(s)},0)},children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${me(s.type)}`,children:[e.jsx(k,{path:s.type==="issue"?te:se,size:.5,className:"mr-1"}),t(`settings.feedbackRequests.types.${s.type}`)]}),e.jsxs("span",{className:`inline-flex items-center gap-1 text-sm ${_(s.status)}`,role:"status","data-testid":"feedback-status-list-badge","aria-label":`Status: ${t(`settings.feedbackRequests.statuses.${y(s.status)}`)}`,children:[e.jsx(k,{path:p(s.status),size:.6}),t(`settings.feedbackRequests.statuses.${y(s.status)}`)]}),s.priority&&M&&e.jsx("span",{className:"text-xs text-gray-500",children:t(`settings.feedbackRequests.priorities.${s.priority}`)})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsx("span",{children:s.user_email}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()}),s.version_completed&&e.jsxs("span",{className:"text-green-600 font-medium",children:["v",s.version_completed]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 ml-4",children:[e.jsxs("button",{onClick:f=>{f.stopPropagation(),ee(s.id)},"data-testid":"feedback-vote-button",className:`flex items-center gap-1 px-3 py-1 rounded-full border ${R.has(s.id)?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(k,{path:re,size:.6}),e.jsx("span",{className:"font-medium",children:s.votes})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-600","data-testid":"feedback-comments-count",children:[e.jsx(k,{path:ne,size:.6}),e.jsx("span",{className:"text-sm",children:s.comments_count})]})]})]})},s.id))]}),u&&e.jsx(ye,{request:u,onClose:()=>m(null),onUpdate:s=>{m(null),L()}})]})}export{Ne as default};
