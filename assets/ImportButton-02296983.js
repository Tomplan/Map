import{r as F,j as t,a3 as Ne,I as ee,aq as ke,as as Le,f as Re,s as X,R as $e,at as Ae,au as Pe,am as Be,av as Te,n as Fe,aw as Me,M as Oe,ar as Ve}from"./index-f3aaddb5.js";import{p as he,n as de}from"./phone-376c158e.js";import{u as Ue}from"./useCategories-8e231f0a.js";import{E as De,F as xe,u as fe,r as we}from"./exceljs.min-df4f794b.js";async function ze(e,o,s,i={}){try{let a=function(n){let h=n,g="";for(;h>0;){let C=(h-1)%26;g=String.fromCharCode(65+C)+g,h=Math.floor((h-C)/26)}return g};const r=e.map(n=>{const h={};return o.forEach(g=>{const C=n[g.key];if(g&&g.key&&String(g.key).startsWith("category:")){const v=C==null?"":String(C).trim().toUpperCase(),D=v==="TRUE"||v==="1"||v==="YES"||v==="+"||v==="X"||v==="âœ“";h[g.header]=D?"+":"-"}else h[g.header]=je(C,g.type)}),h}),c=new De.Workbook,d=c.addWorksheet("Data"),f=o.map(n=>({header:n.header,key:n.header,origKey:n.key,origType:n.type}));f.length&&(d.columns=f),d.addRows(r);const p=10,u=60,l=o.map(n=>{let g=String(n.header||"").length;for(const v of r){const D=v[n.header],O=D==null?"":String(D);O.length>g&&(g=O.length)}return{width:Math.min(Math.max(g+2,p),u)}});d.columns.forEach((n,h)=>{l[h]&&(n.width=l[h].width)}),o.forEach((n,h)=>{if(n.wrapText){const g=h+1;for(let C=2;C<=(d.rowCount||r.length+1);C++){const v=d.getRow(C).getCell(g);v.alignment={wrapText:!0,vertical:"top",horizontal:"left"}}}});for(let n=2;n<=(d.rowCount||r.length+1);n++){const h=d.getRow(n);for(let g=1;g<=o.length;g++){const C=h.getCell(g);C.alignment={...C.alignment,vertical:"top"}}}const x=r.length+1,T=o.length,R=a(T);d.addTable({name:`Data_${Date.now()}`,ref:`A1:${R}${x}`,headerRow:!0,totalsRow:!1,style:{theme:"TableStyleMedium2",showRowStripes:!0,showColumnStripes:!1},columns:o.map(n=>({name:n.header})),rows:r.map(n=>o.map(h=>n[h.header]))});const N=d.columns.map((n,h)=>({c:n,i:h})).filter(n=>!!(n.c&&n.c.origKey&&String(n.c.origKey).startsWith("category:")||n.c&&n.c.origType==="boolean"||n.c&&n.c.header&&String(n.c.header).toLowerCase().includes("category"))).map(n=>n.i+1);for(let n=2;n<=(d.rowCount||r.length+1);n++){const h=d.getRow(n);for(const g of N){const C=h.getCell(g);try{C.dataValidation={type:"list",allowBlank:!0,formulae:['"+,-"'],showErrorMessage:!0,errorStyle:"stop",errorTitle:"Invalid value",error:"Please select either + or - from the list."}}catch{}}}for(let n=2;n<=(d.rowCount||r.length+1);n++){const h=d.getRow(n);for(const g of N){const C=h.getCell(g);try{C.alignment={vertical:"top",horizontal:"centre"}}catch{}}}const b=i&&Number.isInteger(i.freezeColumns)&&i.freezeColumns>0?i.freezeColumns:1,E=b+1;d.views=[{state:"frozen",xSplit:b,ySplit:1,topLeftCell:`${a(E)}2`}];try{const n=c.addWorksheet("__export_metadata"),h={columns:o.map(C=>({key:C.key,header:C.header}))},g=Object.assign({},h,i.metadata||{});n.getCell("A1").value=JSON.stringify(g);try{n.state="veryHidden"}catch{}}catch{}const $=await c.xlsx.writeBuffer(),q=new Blob([$],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});return xe.saveAs(q,`${s}.xlsx`),{success:!0}}catch(r){return console.error("Excel export error:",r),{success:!1,error:r.message}}}async function qe(e,o,s){try{const i=e.map(f=>{const p={};return o.forEach(u=>{const l=f[u.key];p[u.header]=je(l,u.type)}),p}),r=fe.json_to_sheet(i),c=fe.sheet_to_csv(r),d=new Blob([c],{type:"text/csv;charset=utf-8;"});return xe.saveAs(d,`${s}.csv`),{success:!0}}catch(i){return console.error("CSV export error:",i),{success:!1,error:i.message}}}async function We(e,o){try{const s=JSON.stringify(e,null,2),i=new Blob([s],{type:"application/json"});return xe.saveAs(i,`${o}.json`),{success:!0}}catch(s){return console.error("JSON export error:",s),{success:!1,error:s.message}}}function je(e,o){if(e==null)return"";switch(o){case"number":return typeof e=="number"?e:"";case"boolean":if(typeof e=="boolean")return e?"TRUE":"FALSE";const s=String(e).trim().toUpperCase();return s==="TRUE"||s==="1"||s==="YES"||s==="+"||s==="X"?"TRUE":"FALSE";default:return String(e)}}async function Ge(e){return new Promise(o=>{const s=new FileReader;s.onload=i=>{try{const r=new Uint8Array(i.target.result),c=we(r,{type:"array"});let d=null;try{const l=c.Sheets.__export_metadata;l&&l.A1&&l.A1.v&&(d=JSON.parse(String(l.A1.v)))}catch{}const f=c.SheetNames[0],p=c.Sheets[f],u=fe.sheet_to_json(p,{defval:"",raw:!1});if(d&&d.format==="long"&&Array.isArray(d.columns)){const l=d.columns.find(n=>n.key==="category_slug"),a=d.columns.find(n=>n.key==="category_selected"),x=l?l.header:(d.columns.find(n=>String(n.header).toLowerCase().includes("category slug"))||{}).header,T=a?a.header:(d.columns.find(n=>String(n.header).toLowerCase().includes("selected"))||{}).header,R=d.columns.find(n=>n.key==="id"),N=R?R.header:(d.columns.find(n=>String(n.header).toLowerCase()==="id")||{}).header,b=d.columns.find(n=>n.key==="name"),E=b?b.header:(d.columns.find(n=>String(n.header).toLowerCase().includes("company name"))||{}).header,$={};u.forEach((n,h)=>{const g=N?String(n[N]):"",C=E?String(n[E]):"",v=g&&g!=="undefined"&&g!=="null"?`id:${g}`:C?`name:${C}`:`row:${h}`;if(!$[v]){const W={};Object.keys(n).forEach(Q=>{Q===x||Q===T||(W[Q]=n[Q])}),W.__aggregatedCategories=new Set,$[v]=W}const D=x?n[x]:void 0,O=T?n[T]:void 0,M=O==null?"":String(O).trim().toUpperCase();D&&(M==="TRUE"||M==="1"||M==="YES"||M==="+"||M==="X")&&$[v].__aggregatedCategories.add(String(D).trim())});const q=Object.values($).map(n=>{const h=Array.from(n.__aggregatedCategories);return delete n.__aggregatedCategories,n.Categories=h.join(", "),n});u.length=0,q.forEach(n=>u.push(n))}if(d&&Array.isArray(d.columns)){const l=d.columns.filter(a=>a.key&&String(a.key).startsWith("category:"));l.length&&u.forEach(a=>{const x=[];l.forEach(T=>{const R=T.header,N=String(T.key).split(":")[1],b=a[R];if(b!=null){const E=String(b).trim().toUpperCase();(E==="TRUE"||E==="1"||E==="YES"||E==="+"||E==="X"||E==="âœ“")&&x.push(N)}}),a.Categories=x.join(", ")})}o({data:u,error:null,metadata:d})}catch(r){console.error("Error parsing Excel file:",r),o({data:null,error:r.message})}},s.onerror=()=>{o({data:null,error:"Failed to read file"})},s.readAsArrayBuffer(e)})}async function Je(e){return new Promise(o=>{const s=new FileReader;s.onload=i=>{try{const r=i.target.result,c=we(r,{type:"string"}),d=c.SheetNames[0],f=c.Sheets[d],p=fe.sheet_to_json(f,{defval:"",raw:!1});o({data:p,error:null})}catch(r){console.error("Error parsing CSV file:",r),o({data:null,error:r.message})}},s.onerror=()=>{o({data:null,error:"Failed to read file"})},s.readAsText(e)})}async function Ye(e){return new Promise(o=>{const s=new FileReader;s.onload=i=>{try{const r=JSON.parse(i.target.result);if(!Array.isArray(r)){o({data:null,error:"JSON must be an array of objects"});return}o({data:r,error:null})}catch(r){console.error("Error parsing JSON file:",r),o({data:null,error:"Invalid JSON format"})}},s.onerror=()=>{o({data:null,error:"Failed to read file"})},s.readAsText(e)})}async function He(e){const o=e.name.split(".").pop().toLowerCase();switch(o){case"xlsx":case"xls":return Ge(e);case"csv":return Je(e);case"json":return Ye(e);default:return{data:null,error:`Unsupported file type: .${o}`}}}function ye(e){if(Array.isArray(e))return e.map(s=>ye(s));if(!e||typeof e!="object")return e;const o={};return Object.keys(e).forEach(s=>{String(s).startsWith("_")||(o[s]=e[s])}),o}function be(e){if(!e||e.trim()==="")return{valid:!0,value:null,error:null};const o=e.toLowerCase().trim();return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)?{valid:!0,value:o,error:null}:{valid:!1,value:null,error:`Invalid email format: "${e}"`}}function Ce(e,o){if(!e||e.trim()==="")return{valid:!0,value:null,error:null};const s=o(e);return s?{valid:!0,value:s,error:null}:{valid:!1,value:null,error:`Invalid phone format: "${e}"`}}function pe(e,o){return e==null||e===""?{valid:!1,error:`${o} is required`}:typeof e=="string"&&e.trim()===""?{valid:!1,error:`${o} cannot be empty`}:{valid:!0,error:null}}function ve(e,o,s,i=!1){const r={};return e.forEach(c=>{let d=c[o];!i&&typeof d=="string"&&(d=d.toLowerCase().trim()),r[d]=c[s]}),r}function Ee(e){if(!e||e.trim()==="")return"";const o=he(e);if(!o||!o.isValid())return e;const s=o.countryCallingCode,i=o.nationalNumber;if(o.country==="NL"){const r=i.replace(/^(\d)(\d{8})$/,"(0)$1-$2");return`+${s} ${r}`}else if(o.country==="BE"){const r=i.replace(/^(\d{1,3})(\d{2})(\d{2})(\d{2})$/,"(0)$1-$2-$3-$4");return`+${s} ${r}`}else if(o.country==="DE"){const r=i.replace(/^(\d{2,4})(\d+)$/,"(0)$1-$2");return`+${s} ${r}`}return`+${s} ${i}`}function at(e){const o={NL:"ðŸ‡³ðŸ‡±",BE:"ðŸ‡§ðŸ‡ª",DE:"ðŸ‡©ðŸ‡ª",FR:"ðŸ‡«ðŸ‡·",GB:"ðŸ‡¬ðŸ‡§",US:"ðŸ‡ºðŸ‡¸",ES:"ðŸ‡ªðŸ‡¸",IT:"ðŸ‡®ðŸ‡¹"};if(!e)return"";const s=he(e);return s&&s.country?o[s.country]||"ðŸŒ":""}const Se={NL:"ðŸ‡³ðŸ‡±",BE:"ðŸ‡§ðŸ‡ª",DE:"ðŸ‡©ðŸ‡ª",FR:"ðŸ‡«ðŸ‡·",GB:"ðŸ‡¬ðŸ‡§",US:"ðŸ‡ºðŸ‡¸",ES:"ðŸ‡ªðŸ‡¸",IT:"ðŸ‡®ðŸ‡¹"};function rt({value:e="",onChange:o,placeholder:s="Phone number (e.g., +31 (0)6-21165748)",className:i="",defaultCountry:r="NL"}){const[c,d]=F.useState(""),[f,p]=F.useState(null),[u,l]=F.useState(null);F.useEffect(()=>{if(e&&e.trim()!==""){const b=Ee(e);d(b)}else d("")},[e]),F.useEffect(()=>{if(!c||c.trim()===""){p(null),l(null);return}const b=c.trim();let E=he(b,r);if(!E||!E.isValid()){let $=b.replace(/[()\s.-]+/g,"");$.startsWith("00")&&($="+"+$.slice(2)),E=he($,r)}E&&E.isValid()?(p(!0),l(E)):(p(!1),l(null))},[c,r]);const a=b=>{const E=b.target.value;d(E)},x=()=>{if(c&&c.trim()!==""){const b=de(c,r);if(b&&b!==e){o(b);const E=Ee(b);d(E)}}else c===""&&e!==""&&o("")},T=()=>f===null?"border-gray-300":f===!0?"border-green-500":f===!1?"border-red-500":"border-gray-300",R=()=>f===null?"bg-white":f===!0?"bg-green-50":f===!1?"bg-red-50":"bg-white",N=()=>u&&u.country?Se[u.country]||"ðŸŒ":Se[r]||"ðŸŒ";return t.jsxs("div",{className:"w-full",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("span",{className:"text-xl",children:N()})}),t.jsx("input",{type:"text",value:c,onChange:a,onBlur:x,placeholder:s,className:`w-full pl-12 pr-3 py-2 border rounded transition-colors ${T()} ${R()} text-gray-900 ${i}`})]}),u&&f&&t.jsxs("div",{className:"text-xs mt-1 text-green-600 flex items-center gap-1",children:[t.jsx("span",{children:"âœ“"}),t.jsx("span",{children:u.country||"International"}),u.getType()&&t.jsxs("span",{className:"text-gray-500",children:["(",u.getType()==="MOBILE"?"Mobile":"Landline",")"]})]}),f===!1&&c&&t.jsx("div",{className:"text-xs mt-1 text-red-600",children:"âœ— Invalid phone number"}),!c&&t.jsx("div",{className:"text-xs mt-1 text-gray-500",children:"Format: +31 (0)6-12345678"})]})}const Xe={companies:{label:"Companies",table:"companies",exportColumns:[{key:"id",header:"ID",type:"number"},{key:"name",header:"Company Name",type:"string",required:!0},{key:"categories",header:"Categories",type:"string"},{key:"contact",header:"Contact Person",type:"string"},{key:"phone",header:"Phone",type:"phone"},{key:"email",header:"Email",type:"email"},{key:"website",header:"Website",type:"string"},{key:"info_nl",header:"Info (Nederlands)",type:"string",wrapText:!0},{key:"info_en",header:"Info (English)",type:"string",wrapText:!0},{key:"info_de",header:"Info (Deutsch)",type:"string",wrapText:!0},{key:"logo",header:"Logo URL",type:"string"}],transformImport:e=>{var f,p,u,l,a,x,T,R;const o={name:((f=e["Company Name"])==null?void 0:f.trim())||"",contact:((p=e["Contact Person"])==null?void 0:p.trim())||"",website:((u=e.Website)==null?void 0:u.trim())||"",logo:((l=e["Logo URL"])==null?void 0:l.trim())||""},s=e.Phone;s&&s.trim()?o.phone=de(s.trim()):o.phone=null;const i=e.Email;i&&i.trim()?o.email=i.toLowerCase().trim():o.email=null;const r={nl:((a=e["Info (Nederlands)"])==null?void 0:a.trim())||"",en:((x=e["Info (English)"])==null?void 0:x.trim())||"",de:((T=e["Info (Deutsch)"])==null?void 0:T.trim())||""},c=((R=e.Categories)==null?void 0:R.trim())||"",d=c?c.split(",").map(N=>N.trim()).filter(N=>N.length>0):[];return o._translations=r,o._categorySlugs=d,o},transformExport:async(e,o)=>{const{supabase:s}=o||{};if(!s||e.length===0)return e.map(l=>({id:l.id,name:l.name||"",categories:"",contact:l.contact||"",phone:l.phone||"",email:l.email||"",website:l.website||"",info_nl:l.info||"",info_en:"",info_de:"",logo:l.logo||""}));const i=e.map(l=>l.id),{data:r,error:c}=await s.from("company_translations").select("company_id, language_code, info").in("company_id",i);c&&console.error("Error fetching translations:",c);const{data:d,error:f}=await s.from("company_categories").select(`
          company_id,
          categories(slug)
        `).in("company_id",i);f&&console.error("Error fetching categories:",f);const p={};r&&r.forEach(l=>{p[l.company_id]||(p[l.company_id]={}),p[l.company_id][l.language_code]=l.info||""});const u={};return d&&d.forEach(l=>{var a;u[l.company_id]||(u[l.company_id]=[]),(a=l.categories)!=null&&a.slug&&u[l.company_id].push(l.categories.slug)}),e.map(l=>{const a=p[l.id]||{},x=u[l.id]||[];return{id:l.id,name:l.name||"",categories:x.join(", "),contact:l.contact||"",phone:l.phone||"",email:l.email||"",website:l.website||"",info_nl:a.nl||l.info||"",info_en:a.en||"",info_de:a.de||"",logo:l.logo||""}})},validateRow:(e,o)=>{const s=[],i=pe(e["Company Name"],"Company Name");if(i.valid||s.push({field:"Company Name",message:i.error}),e.Email&&e.Email.trim()){const r=be(e.Email);r.valid||s.push({field:"Email",message:r.error})}if(e.Phone&&e.Phone.trim()){const r=Ce(e.Phone,de);r.valid||s.push({field:"Phone",message:r.error})}return Object.keys(e).forEach(r=>{if((r.toLowerCase().includes("category")||r.toLowerCase().includes("cat:")||r.startsWith("category:"))&&e[r]){const d=String(e[r]).trim().toUpperCase();["TRUE","FALSE","+","-","X","âœ“","1","0","YES","NO"].includes(d)||s.push({field:r,message:`Invalid category value "${e[r]}". Use +, -, TRUE, FALSE, X, or âœ“`})}}),{valid:s.length===0,errors:s}},matchStrategy:{matchFields:["name"],matchMode:"first"},labels:{singular:"Company",plural:"Companies",exportButton:"Export Companies",importButton:"Import Companies",modalTitle:"Import Companies",exportFilename:"companies-export"}},event_subscriptions:{label:"Event Subscriptions",table:"event_subscriptions",yearDependent:!0,exportColumns:[{key:"id",header:"Subscription ID",type:"number"},{key:"company_name",header:"Company Name",type:"string",required:!0},{key:"event_year",header:"Event Year",type:"number",required:!0},{key:"contact",header:"Contact Person",type:"string"},{key:"phone",header:"Phone",type:"phone"},{key:"email",header:"Email",type:"email"},{key:"booth_count",header:"Booth Count",type:"number"},{key:"booth_labels",header:"Booth Labels",type:"string",wrapText:!0},{key:"area",header:"Area",type:"string",wrapText:!0},{key:"breakfast_sat",header:"Breakfast (Sat)",type:"number"},{key:"lunch_sat",header:"Lunch (Sat)",type:"number"},{key:"bbq_sat",header:"BBQ (Sat)",type:"number"},{key:"breakfast_sun",header:"Breakfast (Sun)",type:"number"},{key:"lunch_sun",header:"Lunch (Sun)",type:"number"},{key:"coins",header:"Coins",type:"number"},{key:"notes",header:"Notes",type:"string",wrapText:!0}],transformExport:async(e,o)=>{const{supabase:s,eventYear:i}=o||{};if(!s||!i)return e.map(r=>{var c;return{id:r.id,company_name:((c=r.company)==null?void 0:c.name)||"",event_year:r.event_year,contact:r.contact||"",phone:r.phone||"",email:r.email||"",booth_count:r.booth_count||1,booth_labels:"",area:r.area||"",breakfast_sat:r.breakfast_sat||0,lunch_sat:r.lunch_sat||0,bbq_sat:r.bbq_sat||0,breakfast_sun:r.breakfast_sun||0,lunch_sun:r.lunch_sun||0,coins:r.coins||0,notes:r.notes||""}});try{const{data:r,error:c}=await s.from("markers_appearance").select("id, glyph").eq("event_year",i);if(c)return console.error("Error fetching marker appearances:",c),e.map(a=>{var x;return{id:a.id,company_name:((x=a.company)==null?void 0:x.name)||"",event_year:a.event_year,contact:a.contact||"",phone:a.phone||"",email:a.email||"",booth_count:a.booth_count||1,booth_labels:"",area:a.area||"",breakfast_sat:a.breakfast_sat||0,lunch_sat:a.lunch_sat||0,bbq_sat:a.bbq_sat||0,breakfast_sun:a.breakfast_sun||0,lunch_sun:a.lunch_sun||0,coins:a.coins||0,notes:a.notes||""}});const d={};r==null||r.forEach(a=>{d[a.id]=a.glyph||a.id.toString()});const f=e.map(a=>a.company_id).filter(Boolean);if(f.length===0)return e.map(a=>{var x;return{id:a.id,company_name:((x=a.company)==null?void 0:x.name)||"",event_year:a.event_year,contact:a.contact||"",phone:a.phone||"",email:a.email||"",booth_count:a.booth_count||1,booth_labels:"",area:a.area||"",breakfast_sat:a.breakfast_sat||0,lunch_sat:a.lunch_sat||0,bbq_sat:a.bbq_sat||0,breakfast_sun:a.breakfast_sun||0,lunch_sun:a.lunch_sun||0,coins:a.coins||0,notes:a.notes||""}});const{data:p,error:u}=await s.from("assignments").select("company_id, marker_id").eq("event_year",i).in("company_id",f);if(u)return console.error("Error fetching assignments:",u),e.map(a=>{var x;return{id:a.id,company_name:((x=a.company)==null?void 0:x.name)||"",event_year:a.event_year,contact:a.contact||"",phone:a.phone||"",email:a.email||"",booth_count:a.booth_count||1,booth_labels:"",area:a.area||"",breakfast_sat:a.breakfast_sat||0,lunch_sat:a.lunch_sat||0,bbq_sat:a.bbq_sat||0,breakfast_sun:a.breakfast_sun||0,lunch_sun:a.lunch_sun||0,coins:a.coins||0,notes:a.notes||""}});const l={};return p==null||p.forEach(a=>{const x=d[a.marker_id];x&&(l[a.company_id]||(l[a.company_id]=[]),l[a.company_id].push(x))}),Object.keys(l).forEach(a=>{l[a].sort()}),e.map(a=>{var T,R;const x=((T=l[a.company_id])==null?void 0:T.join(", "))||"";return{id:a.id,company_name:((R=a.company)==null?void 0:R.name)||"",event_year:a.event_year,contact:a.contact||"",phone:a.phone||"",email:a.email||"",booth_count:a.booth_count||1,booth_labels:x,area:a.area||"",breakfast_sat:a.breakfast_sat||0,lunch_sat:a.lunch_sat||0,bbq_sat:a.bbq_sat||0,breakfast_sun:a.breakfast_sun||0,lunch_sun:a.lunch_sun||0,coins:a.coins||0,notes:a.notes||""}})}catch(r){return console.error("Error in transformExport:",r),e.map(c=>{var d;return{id:c.id,company_name:((d=c.company)==null?void 0:d.name)||"",event_year:c.event_year,contact:c.contact||"",phone:c.phone||"",email:c.email||"",booth_count:c.booth_count||1,booth_labels:"",area:c.area||"",breakfast_sat:c.breakfast_sat||0,lunch_sat:c.lunch_sat||0,bbq_sat:c.bbq_sat||0,breakfast_sun:c.breakfast_sun||0,lunch_sun:c.lunch_sun||0,coins:c.coins||0,notes:c.notes||""}})}},transformImport:(e,o,s)=>{var p,u,l,a;const i=(p=e["Company Name"])==null?void 0:p.trim(),r=o[i==null?void 0:i.toLowerCase()];if(!r)throw new Error(`Company "${i}" not found in database`);const c={company_id:r,event_year:parseInt(e["Event Year"])||s,contact:((u=e["Contact Person"])==null?void 0:u.trim())||"",area:((l=e.Area)==null?void 0:l.trim())||"",notes:((a=e.Notes)==null?void 0:a.trim())||""},d=e.Phone;c.phone=d&&d.trim()?de(d.trim()):null;const f=e.Email;return c.email=f&&f.trim()?f.toLowerCase().trim():null,c.booth_count=parseInt(e["Booth Count"])||1,c.breakfast_sat=parseInt(e["Breakfast (Sat)"])||0,c.lunch_sat=parseInt(e["Lunch (Sat)"])||0,c.bbq_sat=parseInt(e["BBQ (Sat)"])||0,c.breakfast_sun=parseInt(e["Breakfast (Sun)"])||0,c.lunch_sun=parseInt(e["Lunch (Sun)"])||0,c.coins=parseInt(e.Coins)||0,c},validateRow:(e,o,s)=>{var u;const i=[],r=pe(e["Company Name"],"Company Name");if(!r.valid)i.push({field:"Company Name",message:r.error});else{const l=(u=e["Company Name"])==null?void 0:u.trim().toLowerCase();s&&!s[l]&&i.push({field:"Company Name",message:`Company "${e["Company Name"]}" not found in database`})}const c=parseInt(e["Event Year"]);e["Event Year"]&&(isNaN(c)||c<2020||c>2100)&&i.push({field:"Event Year",message:"Event Year must be a valid year between 2020-2100"});const d=parseInt(e["Booth Count"]);e["Booth Count"]&&(isNaN(d)||d<1)&&i.push({field:"Booth Count",message:"Booth Count must be at least 1"}),["Breakfast (Sat)","Lunch (Sat)","BBQ (Sat)","Breakfast (Sun)","Lunch (Sun)"].forEach(l=>{const a=parseInt(e[l]);e[l]&&(isNaN(a)||a<0)&&i.push({field:l,message:`${l} must be 0 or a positive integer`})});const p=parseInt(e.Coins);if(e.Coins&&(isNaN(p)||p<0)&&i.push({field:"Coins",message:"Coins must be 0 or a positive integer"}),e.Email&&e.Email.trim()){const l=be(e.Email);l.valid||i.push({field:"Email",message:l.error})}if(e.Phone&&e.Phone.trim()){const l=Ce(e.Phone,de);l.valid||i.push({field:"Phone",message:l.error})}return{valid:i.length===0,errors:i}},matchStrategy:{matchFields:["company_id","event_year"],matchMode:"strict"},labels:{singular:"Subscription",plural:"Subscriptions",exportButton:"Export Subscriptions",importButton:"Import Subscriptions",modalTitle:"Import Subscriptions",exportFilename:"subscriptions-export"}},assignments:{label:"Booth Assignments",table:"assignments",yearDependent:!0,exportColumns:[{key:"id",header:"Assignment ID",type:"number"},{key:"company_name",header:"Company Name",type:"string",required:!0},{key:"booth_label",header:"Booth Label",type:"string",required:!0},{key:"marker_id",header:"Marker ID",type:"number",required:!0},{key:"event_year",header:"Event Year",type:"number",required:!0}],transformExport:(e,o)=>{const s={};return o.forEach(i=>{s[i.id]=i.glyph||i.id.toString()}),e.map(i=>{var r;return{id:i.id,company_name:((r=i.company)==null?void 0:r.name)||"",booth_label:s[i.marker_id]||i.marker_id.toString(),marker_id:i.marker_id,event_year:i.event_year}})},transformImport:(e,o,s,i)=>{var p,u;const r=(p=e["Company Name"])==null?void 0:p.trim(),c=o[r==null?void 0:r.toLowerCase()];if(!c)throw new Error(`Company "${r}" not found in database`);const d=(u=e["Booth Label"])==null?void 0:u.trim().toLowerCase(),f=e["Marker ID"]||s[d];if(!f)throw new Error(`Booth "${e["Booth Label"]}" not found in markers`);return{company_id:c,marker_id:parseInt(f),event_year:parseInt(e["Event Year"])||i}},validateRow:(e,o,s,i)=>{var f,p;const r=[],c=pe(e["Company Name"],"Company Name");if(!c.valid)r.push({field:"Company Name",message:c.error});else if(s){const u=(f=e["Company Name"])==null?void 0:f.trim().toLowerCase();s[u]||r.push({field:"Company Name",message:`Company "${e["Company Name"]}" not found in database`})}const d=pe(e["Booth Label"],"Booth Label");if(!d.valid)r.push({field:"Booth Label",message:d.error});else if(i){const u=(p=e["Booth Label"])==null?void 0:p.trim().toLowerCase();i[u]||r.push({field:"Booth Label",message:`Booth "${e["Booth Label"]}" not found in markers`})}return{valid:r.length===0,errors:r}},matchStrategy:{matchFields:["company_id","marker_id","event_year"],matchMode:"skip-duplicates"},labels:{singular:"Assignment",plural:"Assignments",exportButton:"Export Assignments",importButton:"Import Assignments",modalTitle:"Import Booth Assignments",exportFilename:"assignments-export"}}};function _e(e){const o=Xe[e];if(!o)throw new Error(`Unknown data type: ${e}`);return o}function nt({dataType:e,data:o,filename:s,additionalData:i,onExportStart:r,onExportComplete:c,onExportError:d,className:f=""}){const[p,u]=F.useState(!1),[l,a]=F.useState(!1),x=F.useRef(null),{toastSuccess:T,toastError:R}=Ne(),N=_e(e),{categories:b,loading:E}=Ue();F.useEffect(()=>{function n(h){x.current&&!x.current.contains(h.target)&&a(!1)}if(l)return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[l]);const $=()=>{if(s)return s;const n=new Date().toISOString().split("T")[0];return`${N.labels.exportFilename}-${n}`},q=async n=>{if(a(!1),!o||o.length===0){R("No data to export");return}u(!0),r&&r(n);try{let h=o;N.transformExport&&(h=await N.transformExport(o,i));let g=N.exportColumns.slice();const C=(i==null?void 0:i.supabase)||X;let v=null;if(N.table==="companies"&&C)try{const M=await C.from("categories").select("slug, category_translations(language, name, title)").order("sort_order");if(v=M&&M.data?M.data:null,(!Array.isArray(v)||v.length===0)&&Array.isArray(b)&&b.length>0&&(v=b.map(K=>({slug:K.slug,category_translations:K.translations||[]}))),Array.isArray(v)&&v.length>0){v.sort((I,H)=>{var Z,re,oe,me,ge,ue,_,m;const ae=((re=(Z=I.category_translations)==null?void 0:Z.find(y=>y.language==="nl"))==null?void 0:re.name)||((me=(oe=I.category_translations)==null?void 0:oe[0])==null?void 0:me.name)||I.slug||"",te=((ue=(ge=H.category_translations)==null?void 0:ge.find(y=>y.language==="nl"))==null?void 0:ue.name)||((m=(_=H.category_translations)==null?void 0:_[0])==null?void 0:m.name)||H.slug||"";return String(ae).localeCompare(String(te))});const K=g.findIndex(I=>I.key==="categories"||I.header==="Categories"),W=v.map(I=>{var ae,te,Z,re;const H=((te=(ae=I.category_translations)==null?void 0:ae.find(oe=>oe.language==="nl"))==null?void 0:te.name)||((re=(Z=I.category_translations)==null?void 0:Z[0])==null?void 0:re.name)||I.slug;return{key:`category:${I.slug}`,header:H,type:"boolean"}});K>=0&&g.splice(K,1),g.push(...W);const Q=o.map(I=>I.id).filter(Boolean),{data:le}=Q.length?await C.from("company_categories").select("company_id, categories(slug)").in("company_id",Q):{data:[]},A={};le&&le.forEach(I=>{var H;A[I.company_id]||(A[I.company_id]=[]),(H=I.categories)!=null&&H.slug&&A[I.company_id].push(I.categories.slug)}),h=h.map(I=>{const H=I.id,ae=A[H]||[],te={...I};return v.forEach(Z=>{te[`category:${Z.slug}`]=ae.includes(Z.slug)?"+":"-"}),te})}}catch(M){console.error("Error expanding company categories for export:",M)}let D;const O=$();switch(n){case"excel":const M=Array.isArray(v)&&v.length>0?i!=null&&i.supabase?"supabase":b&&b.length?"in-memory":"unknown":"none",K=Array.isArray(v)?v.map(W=>W.slug):[];D=await ze(h,g,O,{metadata:{category_source:M,category_slugs:K,format:"wide"},freezeColumns:2});break;case"csv":D=await qe(h,N.exportColumns,O);break;case"json":D=await We(h,O);break;default:throw new Error(`Unknown export format: ${n}`)}if(D.success)T(`Successfully exported ${o.length} ${N.labels.plural.toLowerCase()} to ${n.toUpperCase()}`),c&&c(n,O);else throw new Error(D.error||"Export failed")}catch(h){console.error("Export error:",h),R(`Export failed: ${h.message}`),d&&d(h)}finally{u(!1)}};return t.jsxs("div",{className:`relative ${f}`,ref:x,children:[t.jsx("button",{onClick:()=>a(!l),disabled:p||!o||o.length===0,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:N.labels.exportButton,children:p?t.jsxs(t.Fragment,{children:[t.jsx(ee,{path:ke,size:.8,spin:!0}),t.jsx("span",{children:"Exporting..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(ee,{path:Le,size:.8}),t.jsx("span",{children:"Export"}),t.jsx(ee,{path:Re,size:.6})]})}),l&&!p&&t.jsx("div",{className:"absolute right-0 mt-1 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:t.jsxs("div",{className:"py-1",children:[t.jsxs("button",{onClick:()=>q("excel"),disabled:N.table==="companies"&&E,title:N.table==="companies"&&E?"Categories are still loading â€” please wait to export Excel so category columns are included":void 0,className:`w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2 ${N.table==="companies"&&E?"opacity-50 cursor-not-allowed":""}`,"aria-disabled":N.table==="companies"&&E,children:[t.jsx("span",{children:"ðŸ“Š"}),t.jsx("span",{children:"Export as Excel (.xlsx)"})]}),t.jsxs("button",{onClick:()=>q("csv"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[t.jsx("span",{children:"ðŸ“„"}),t.jsx("span",{children:"Export as CSV"})]}),t.jsxs("button",{onClick:()=>q("json"),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[t.jsx("span",{children:"ðŸ”§"}),t.jsx("span",{children:"Export as JSON"})]})]})})]})}const z={FILE_SELECT:"file_select",PARSING:"parsing",PREVIEW:"preview",IMPORTING:"importing",COMPLETE:"complete"};function Ke({isOpen:e,onClose:o,dataType:s,eventYear:i,existingData:r=[],additionalData:c={},onImportComplete:d,onImportError:f}){const[p,u]=F.useState(z.FILE_SELECT),[l,a]=F.useState(null),[x,T]=F.useState([]),[R,N]=F.useState(null),[b,E]=F.useState([]),[$,q]=F.useState(new Set),[n,h]=F.useState(null),[g,C]=F.useState(null),[v,D]=F.useState(!1),[O,M]=F.useState({current:0,total:0,message:""}),K=F.useRef(null),{toastError:W,toastSuccess:Q,toastWarning:le}=Ne(),A=_e(s),I=()=>{u(z.FILE_SELECT),a(null),T([]),E([]),q(new Set),h(null),C(null),D(!1),M({current:0,total:0,message:""}),o()},H=async _=>{var S;const m=(S=_.target.files)==null?void 0:S[0];if(!m)return;a(m),C(null),u(z.PARSING);const{data:y,error:w,metadata:P}=await He(m);if(w||!y){C(w||"Failed to parse file"),u(z.FILE_SELECT),v||W(`Failed to parse file: ${w}`);return}if(y.length===0){C("File is empty or has no valid data"),u(z.FILE_SELECT),v||W("File is empty");return}T(y),N(P||null),await ae(y)},ae=async _=>{try{let m=null,y=null;if(A.yearDependent){const{data:S,error:G}=await X.from("companies").select("id, name");if(G)throw G;if(m=ve(S,"name","id",!1),s==="assignments"){const{data:B,error:ne}=await X.from("markers_core").select("id, glyph").eq("event_year",i);if(ne)throw ne;y={},B.forEach(V=>{V.glyph&&(y[V.glyph.toLowerCase()]=V.id),y[V.id.toString()]=V.id})}}const w=_.map((S,G)=>{var ce,J,se;const B=A.validateRow(S,G,m,y);let ne="ERROR",V=null;if(B.valid)try{const Y=A.transformImport(S,m,y||c.markerMap,i);if(A.matchStrategy.matchFields.includes("name")){const k=(ce=S["Company Name"])==null?void 0:ce.toLowerCase().trim();V=r.find(L=>{var j;return((j=L.name)==null?void 0:j.toLowerCase().trim())===k})}else if(A.yearDependent&&m){const k=(J=S["Company Name"])==null?void 0:J.toLowerCase().trim(),L=m[k];if(s==="event_subscriptions")V=r.find(j=>j.company_id===L&&j.event_year===i);else if(s==="assignments"){const j=(se=S["Booth Label"])==null?void 0:se.toLowerCase().trim(),ie=y[j];V=r.find(U=>U.company_id===L&&U.marker_id===ie&&U.event_year===i)}}ne=V?"UPDATE":"CREATE"}catch(Y){B.valid=!1,B.errors.push({field:"General",message:Y.message})}return{index:G,originalRow:S,validation:B,action:ne,matchedRecord:V,selected:B.valid}});E(w);const P=w.filter(S=>S.validation.valid).map(S=>S.index);if(q(new Set(P)),u(z.PREVIEW),!v){const S=w.filter(B=>B.validation.valid).length,G=w.filter(B=>!B.validation.valid).length;G>0?le(`Parsed ${_.length} rows: ${S} valid, ${G} errors`):Q(`Parsed ${_.length} rows - all valid`)}}catch(m){console.error("Validation error:",m),C(m.message),u(z.FILE_SELECT),W(`Validation failed: ${m.message}`)}},te=_=>{const m=new Set($);m.has(_)?m.delete(_):m.add(_),q(m)},Z=()=>{if($.size===b.filter(_=>_.validation.valid).length)q(new Set);else{const _=b.filter(m=>m.validation.valid).map(m=>m.index);q(new Set(_))}},re=async(_,m,y,w)=>{if(!(!m||m.length===0))try{const P=m.map(B=>y[B.toLowerCase()]).filter(B=>B!==void 0);if(P.length===0)return;await X.from("company_categories").delete().eq("company_id",_);const S=P.map(B=>({company_id:_,category_id:B})),{error:G}=await X.from("company_categories").insert(S);G&&w.push({type:"CATEGORY",companyId:_,message:`Failed to assign categories: ${G.message}`})}catch(P){w.push({type:"CATEGORY",companyId:_,message:`Failed to assign categories: ${P.message}`})}},oe=async(_,m,y)=>{if(!m)return;const w=[];if(m.nl&&m.nl.trim()&&w.push({company_id:_,language_code:"nl",info:m.nl.trim(),updated_at:new Date().toISOString()}),m.en&&m.en.trim()&&w.push({company_id:_,language_code:"en",info:m.en.trim(),updated_at:new Date().toISOString()}),m.de&&m.de.trim()&&w.push({company_id:_,language_code:"de",info:m.de.trim(),updated_at:new Date().toISOString()}),w.length>0){const{error:P}=await X.from("company_translations").upsert(w,{onConflict:"company_id,language_code"});P&&y.push({type:"TRANSLATION",companyId:_,message:`Failed to save translations: ${P.message}`})}},me=async()=>{var m;const _=b.filter(y=>$.has(y.index));if(_.length===0){W("No rows selected for import");return}u(z.IMPORTING),M({current:0,total:_.length,message:"Starting import..."});try{let y=null,w=null;if(A.yearDependent){const{data:k}=await X.from("companies").select("id, name");if(y=ve(k,"name","id",!1),s==="assignments"){const{data:L}=await X.from("markers_core").select("id, glyph").eq("event_year",i);w={},L.forEach(j=>{j.glyph&&(w[j.glyph.toLowerCase()]=j.id),w[j.id.toString()]=j.id})}}let P={};if(s==="companies"){const{data:k,error:L}=await X.from("categories").select("id, slug");!L&&k&&k.forEach(j=>{P[j.slug.toLowerCase()]=j.id})}const{data:{user:S}}=await X.auth.getUser(),G=(S==null?void 0:S.email)||"unknown",B=[],ne=[],V=[],ce=[];for(const k of _){const L=A.transformImport(k.originalRow,y,w,i);if(k.action==="CREATE"){A.yearDependent&&!L.event_year&&(L.event_year=i),A.yearDependent&&(L.created_by=G);const j=ye(L);B.push(j),ne.push(L)}else if(k.action==="UPDATE"){const j=ye(L);V.push({id:k.matchedRecord.id,data:j}),ce.push({id:k.matchedRecord.id,original:L})}}let J=0,se=0;const Y=[];if(B.length>0){M({current:0,total:_.length,message:`Creating ${B.length} new records...`});const{data:k,error:L}=await X.from(A.table).insert(B).select();if(L)Y.push({type:"CREATE_BATCH",message:L.message});else if(J=(k==null?void 0:k.length)||0,M({current:J,total:_.length,message:`Created ${J} records. Processing additional data...`}),s==="companies"&&k)for(let j=0;j<k.length;j++){const ie=k[j],U=ne[j];U&&U._translations&&await oe(ie.id,U._translations,Y),U&&U._categorySlugs&&await re(ie.id,U._categorySlugs,P,Y)}}M({current:J,total:_.length,message:`Updating ${V.length} existing records...`});for(let k=0;k<V.length;k++){const L=V[k],j=Math.round((J+k)/_.length*100);M({current:J+k,total:_.length,message:`Updating record ${k+1} of ${V.length}... (${j}%)`});const{error:ie}=await X.from(A.table).update(L.data).eq("id",L.id);if(ie)Y.push({type:"UPDATE",id:L.id,message:ie.message});else if(se++,s==="companies"){const U=((m=ce.find(Ie=>Ie.id===L.id))==null?void 0:m.original)||null;U&&U._translations&&await oe(L.id,U._translations,Y),U&&U._categorySlugs&&await re(L.id,U._categorySlugs,P,Y)}}h({created:J,updated:se,failed:Y.length,errors:Y}),u(z.COMPLETE),Y.length===0?(Q(`Import complete: ${J} created, ${se} updated`),d&&d({created:J,updated:se})):le(`Import partial: ${J} created, ${se} updated, ${Y.length} failed`)}catch(y){console.error("Import error:",y),C(y.message),W(`Import failed: ${y.message}`),f&&f(y),u(z.PREVIEW)}},ue=$e.useMemo(()=>function(){switch(p){case z.FILE_SELECT:return t.jsx("div",{className:"p-6 transition-all duration-200 ease-in-out",children:t.jsxs("div",{className:"text-center",children:[t.jsx(ee,{path:Me,size:3,className:"mx-auto text-gray-400 mb-4 transition-transform duration-200"}),t.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a file to import"}),t.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Supported formats: Excel (.xlsx), CSV (.csv), JSON (.json)"}),t.jsx("input",{ref:K,type:"file",accept:".xlsx,.xls,.csv,.json",onChange:H,className:"hidden"}),t.jsx("button",{onClick:()=>{var m;return(m=K.current)==null?void 0:m.click()},className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-150",children:"Choose File"}),g&&t.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm animate-pulse",children:g})]})});case z.PARSING:return t.jsx("div",{className:"p-6 transition-all duration-200 ease-in-out",children:t.jsxs("div",{className:"text-center",children:[t.jsx(ee,{path:ke,size:3,className:"mx-auto text-blue-600 mb-4 transition-transform duration-200",spin:!0}),t.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Parsing file..."}),t.jsx("p",{className:"text-sm text-gray-600",children:"Please wait while we process your file"})]})});case z.PREVIEW:return t.jsxs("div",{className:"flex flex-col h-full transition-all duration-200 ease-in-out",children:[t.jsx("div",{className:"p-6 border-b border-gray-200 flex-shrink-0",children:t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Import Preview"}),t.jsxs("p",{className:"text-sm text-gray-600",children:[b.length," rows parsed,"," ",b.filter(m=>m.validation.valid).length," valid,"," ",b.filter(m=>!m.validation.valid).length," errors"]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",checked:$.size===b.filter(m=>m.validation.valid).length&&$.size>0,onChange:Z,className:"rounded"}),t.jsxs("span",{children:["Select All (",$.size," selected)"]})]})})]})}),t.jsx("div",{className:"flex-1 overflow-auto p-6",children:t.jsx("div",{className:"transition-all duration-200 ease-in-out",children:t.jsxs("table",{className:"w-full text-sm border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-200",children:[t.jsx("th",{className:"text-left p-2 font-medium text-gray-700",children:"Select"}),t.jsx("th",{className:"text-left p-2 font-medium text-gray-700",children:"Row"}),t.jsx("th",{className:"text-left p-2 font-medium text-gray-700",children:"Status"}),(()=>{let m;s==="event_subscriptions"?m=A.exportColumns:m=A.exportColumns.slice(0,6);const y=R&&Array.isArray(R.columns)?R.columns.filter(P=>P.key&&String(P.key).startsWith("category:")):[];return[...m,...y].map(P=>t.jsx("th",{className:"text-left p-2 font-medium text-gray-700",children:P.header},P.key))})(),t.jsx("th",{className:"text-left p-2 font-medium text-gray-700",children:"Errors"})]})}),t.jsx("tbody",{children:b.map(m=>t.jsxs("tr",{className:`border-b border-gray-100 transition-colors duration-150 ${m.validation.valid?"hover:bg-gray-50":"bg-red-50"}`,children:[t.jsx("td",{className:"p-2",children:t.jsx("input",{type:"checkbox",checked:$.has(m.index),onChange:()=>te(m.index),disabled:!m.validation.valid,className:"rounded"})}),t.jsx("td",{className:"p-2 text-gray-600",children:m.index+1}),t.jsx("td",{className:"p-2",children:m.validation.valid?t.jsxs("span",{className:`inline-flex items-center gap-1 text-xs px-2 py-1 rounded ${m.action==="CREATE"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:[t.jsx(ee,{path:m.action==="CREATE"?Be:Te,size:.5}),m.action]}):t.jsxs("span",{className:"inline-flex items-center gap-1 text-xs px-2 py-1 rounded bg-red-100 text-red-700",children:[t.jsx(ee,{path:Fe,size:.5}),"ERROR"]})}),(()=>{let y;s==="event_subscriptions"?y=A.exportColumns:y=A.exportColumns.slice(0,6);const w=R&&Array.isArray(R.columns)?R.columns.filter(S=>S.key&&String(S.key).startsWith("category:")):[];return[...y,...w].map(S=>t.jsx("td",{className:"p-2 text-gray-900 truncate max-w-xs",children:m.originalRow[S.header]||"-"},S.key))})(),t.jsx("td",{className:"p-2",children:m.validation.errors.length>0&&t.jsx("div",{className:"text-xs text-red-600",children:m.validation.errors.map((y,w)=>t.jsxs("div",{children:["â€¢ ",y.message]},w))})})]},m.index))})]})})}),t.jsxs("div",{className:"p-6 border-t border-gray-200 flex justify-between flex-shrink-0",children:[t.jsx("button",{onClick:I,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-150",children:"Cancel"}),t.jsxs("button",{onClick:me,disabled:$.size===0,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-150",children:["Import Selected (",$.size,")"]})]})]});case z.IMPORTING:const _=O.total>0?Math.round(O.current/O.total*100):0;return t.jsx("div",{className:"p-6 transition-all duration-200 ease-in-out",children:t.jsx("div",{className:"text-center",children:t.jsxs("div",{className:"w-full max-w-md mx-auto",children:[t.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Importing data..."}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 mb-4",children:t.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-300 ease-out",style:{width:`${_}%`}})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm text-gray-600",children:O.message||`Processing ${$.size} records`}),t.jsxs("p",{className:"text-xs text-gray-500",children:[O.current," of ",O.total," records (",_,"%)"]})]})]})})});case z.COMPLETE:return t.jsx("div",{className:"p-6 transition-all duration-200 ease-in-out",children:t.jsxs("div",{className:"text-center",children:[n.failed===0?t.jsx(ee,{path:Ae,size:3,className:"mx-auto text-green-600 mb-4 transition-transform duration-200"}):t.jsx(ee,{path:Pe,size:3,className:"mx-auto text-orange-600 mb-4 transition-transform duration-200"}),t.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Import Complete"}),t.jsxs("div",{className:"mt-6 space-y-2 text-sm",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2 transition-colors duration-200",children:[t.jsx("span",{className:"text-green-600",children:"âœ“ Created:"}),t.jsx("span",{className:"font-medium",children:n.created})]}),t.jsxs("div",{className:"flex items-center justify-center gap-2 transition-colors duration-200",children:[t.jsx("span",{className:"text-blue-600",children:"âŸ³ Updated:"}),t.jsx("span",{className:"font-medium",children:n.updated})]}),n.failed>0&&t.jsxs("div",{className:"flex items-center justify-center gap-2 transition-colors duration-200",children:[t.jsx("span",{className:"text-red-600",children:"âœ— Failed:"}),t.jsx("span",{className:"font-medium",children:n.failed})]})]}),n.errors.length>0&&t.jsxs("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-left text-sm transition-colors duration-200",children:[t.jsx("div",{className:"font-medium text-red-900 mb-2",children:"Errors:"}),n.errors.map((m,y)=>t.jsxs("div",{className:"text-red-700",children:["â€¢ ",m.message]},y))]}),t.jsx("button",{onClick:I,className:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-150",children:"Close"})]})});default:return null}},[p,A,$,b,R,l,g,n,O])();return t.jsx(Oe,{isOpen:e,onClose:I,title:A.labels.modalTitle,size:"lg",closeOnBackdrop:p!==z.IMPORTING,className:"transition-all duration-200 ease-in-out",children:t.jsx("div",{className:"transition-all duration-200 ease-in-out",children:ue})})}function st({dataType:e,eventYear:o,existingData:s=[],additionalData:i={},onImportComplete:r,onImportError:c,className:d=""}){const[f,p]=F.useState(!1),u=_e(e),l=x=>{p(!1),r&&r(x)},a=x=>{c&&c(x)};return t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>p(!0),className:`flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors ${d}`,title:u.labels.importButton,children:[t.jsx(ee,{path:Ve,size:.8}),t.jsx("span",{children:"Import"})]}),t.jsx(Ke,{isOpen:f,onClose:()=>p(!1),dataType:e,eventYear:o,existingData:s,additionalData:i,onImportComplete:l,onImportError:a})]})}export{nt as E,st as I,rt as P,Ee as f,at as g};
