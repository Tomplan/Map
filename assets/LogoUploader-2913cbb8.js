import{s as v,r as d,j as e,g as L,I as u,an as F,ao as z,ap as A,ak as I,l as M,P as i}from"./index-8fb29835.js";const m="Logos",E=5*1024*1024,B=["image/png","image/jpeg","image/jpg","image/webp","image/avif","image/svg+xml"];async function C(s,a="companies"){try{const r=P(s);if(!r.valid)return{error:r.error};const t=s.name.split(".").pop(),f=Date.now(),x=Math.random().toString(36).substring(2,8),p=`${f}_${x}.${t}`,n=a?`${a}/${p}`:p,{data:h,error:o}=await v.storage.from(m).upload(n,s,{cacheControl:"3600",upsert:!1});if(o)return console.error("Upload error:",o),{error:`Upload failed: ${o.message}`};const{data:{publicUrl:l}}=v.storage.from(m).getPublicUrl(n);return{url:l,path:n,error:null}}catch(r){return console.error("Upload service error:",r),{error:`Upload failed: ${r.message}`}}}function P(s){return s?B.includes(s.type)?s.size>E?{valid:!1,error:`File too large. Maximum size: ${E/1024/1024}MB`}:{valid:!0,error:null}:{valid:!1,error:"Invalid file type. Allowed: PNG, JPG, WEBP, AVIF, SVG"}:{valid:!1,error:"No file selected"}}async function D(){try{const{data:s,error:a}=await v.storage.listBuckets();return a?{exists:!1,error:`Error accessing storage: ${a.message}`}:(s==null?void 0:s.some(t=>t.name===m))?{exists:!0,error:null}:{exists:!1,error:`Storage bucket "${m}" not found. Available buckets: ${(s==null?void 0:s.map(t=>t.name).join(", "))||"none"}`}}catch(s){return{exists:!1,error:`Error checking storage bucket: ${s.message}`}}}function U({currentLogo:s="",onUploadComplete:a,onDelete:r,folder:t="companies",label:f="Upload Logo",showPreview:x=!0,allowDelete:p=!1}){const[n,h]=d.useState(!1),[o,l]=d.useState(null),[w,c]=d.useState(""),b=d.useRef(null),$=async k=>{var S;const j=(S=k.target.files)==null?void 0:S[0];if(!j)return;l(null),c("");const N=P(j);if(!N.valid){l("error"),c(N.error);return}h(!0);const g=await C(j,t);h(!1),g.error?(l("error"),c(g.error)):(l("success"),c("Upload successful!"),a&&a(g.url,g.path),setTimeout(()=>{l(null),c("")},3e3)),b.current&&(b.current.value="")},y=()=>{r&&r()};return e.jsxs("div",{className:"flex flex-col gap-2",children:[x&&s&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("img",{src:L(s),alt:"Current logo",className:"h-12 w-12 object-contain border rounded p-1"}),p&&r&&e.jsx("button",{type:"button",onClick:y,className:"p-2 text-red-600 hover:bg-red-50 rounded",title:"Remove logo",children:e.jsx(u,{path:F,size:.7})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:b,type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp,image/avif,image/svg+xml",onChange:$,className:"hidden",id:`logo-upload-${t}`}),e.jsx("label",{htmlFor:`logo-upload-${t}`,className:`
            flex items-center gap-1 px-2 py-1 rounded cursor-pointer text-xs
            ${n?"bg-gray-400":"bg-blue-600 hover:bg-blue-700"}
            text-white transition-colors whitespace-nowrap
          `,children:n?e.jsxs(e.Fragment,{children:[e.jsx(u,{path:z,size:.8,spin:!0}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{path:A,size:.8}),f]})}),o&&e.jsxs("div",{className:"flex items-center gap-2",children:[o==="success"&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(u,{path:I,size:.8}),e.jsx("span",{className:"text-sm",children:w})]}),o==="error"&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(u,{path:M,size:.8}),e.jsx("span",{className:"text-sm",children:w})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Supported: PNG, JPG, WEBP, AVIF, SVG â€¢ Max size: 5MB"})]})}U.propTypes={currentLogo:i.string,onUploadComplete:i.func.isRequired,onDelete:i.func,folder:i.string,label:i.string,showPreview:i.bool,allowDelete:i.bool};U.defaultProps={currentLogo:"",onDelete:null,folder:"companies",label:"Upload Logo",showPreview:!0,allowDelete:!1};export{U as L,D as c};
