import{s as S,r as m,j as e,b as k,c as z,I as p,ai as F,aL as M,aM as A,aF as I,p as B,P as i}from"./index-c3c9ac92.js";const f="Logos",P=5*1024*1024,C=["image/png","image/jpeg","image/jpg","image/webp","image/avif","image/svg+xml"];async function G(s,a="companies"){try{const r=U(s);if(!r.valid)return{error:r.error};const t=s.name.split(".").pop(),x=Date.now(),h=Math.random().toString(36).substring(2,8),g=`${x}_${h}.${t}`,n=a?`${a}/${g}`:g,{data:b,error:o}=await S.storage.from(f).upload(n,s,{cacheControl:"3600",upsert:!1});if(o)return console.error("Upload error:",o),{error:`Upload failed: ${o.message}`};const{data:{publicUrl:l}}=S.storage.from(f).getPublicUrl(n);return{url:l,path:n,error:null}}catch(r){return console.error("Upload service error:",r),{error:`Upload failed: ${r.message}`}}}function U(s){return s?C.includes(s.type)?s.size>P?{valid:!1,error:`File too large. Maximum size: ${P/1024/1024}MB`}:{valid:!0,error:null}:{valid:!1,error:"Invalid file type. Allowed: PNG, JPG, WEBP, AVIF, SVG"}:{valid:!1,error:"No file selected"}}async function D(){try{const{data:s,error:a}=await S.storage.listBuckets();return a?{exists:!1,error:`Error accessing storage: ${a.message}`}:(s==null?void 0:s.some(t=>t.name===f))?{exists:!0,error:null}:{exists:!1,error:`Storage bucket "${f}" not found. Available buckets: ${(s==null?void 0:s.map(t=>t.name).join(", "))||"none"}`}}catch(s){return{exists:!1,error:`Error checking storage bucket: ${s.message}`}}}function $({currentLogo:s="",onUploadComplete:a,onDelete:r,folder:t="companies",label:x="Upload Logo",showPreview:h=!0,allowDelete:g=!1}){const[n,b]=m.useState(!1),[o,l]=m.useState(null),[w,u]=m.useState(""),v=m.useRef(null),y=async c=>{var E;const j=(E=c.target.files)==null?void 0:E[0];if(!j)return;l(null),u("");const N=U(j);if(!N.valid){l("error"),u(N.error);return}b(!0);const d=await G(j,t);b(!1),d.error?(l("error"),u(d.error)):(l("success"),u("Upload successful!"),a&&a(d.url,d.path),setTimeout(()=>{l(null),u("")},3e3)),v.current&&(v.current.value="")},L=()=>{r&&r()};return e.jsxs("div",{className:"flex flex-col gap-2",children:[h&&s&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("img",{...(()=>{const c=k(s);return c?{src:c.src,srcSet:c.srcSet,sizes:c.sizes}:{src:z(s)}})(),alt:"Current logo",className:"h-12 w-12 object-contain border rounded p-1"}),g&&r&&e.jsx("button",{type:"button",onClick:L,className:"p-2 text-red-600 hover:bg-red-50 rounded",title:"Remove logo",children:e.jsx(p,{path:F,size:.7})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:v,type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp,image/avif,image/svg+xml",onChange:y,className:"hidden",id:`logo-upload-${t}`}),e.jsx("label",{htmlFor:`logo-upload-${t}`,className:`
            flex items-center gap-1 px-2 py-1 rounded cursor-pointer text-xs
            ${n?"bg-gray-400":"bg-blue-600 hover:bg-blue-700"}
            text-white transition-colors whitespace-nowrap
          `,children:n?e.jsxs(e.Fragment,{children:[e.jsx(p,{path:M,size:.8,spin:!0}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{path:A,size:.8}),x]})}),o&&e.jsxs("div",{className:"flex items-center gap-2",children:[o==="success"&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(p,{path:I,size:.8}),e.jsx("span",{className:"text-sm",children:w})]}),o==="error"&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(p,{path:B,size:.8}),e.jsx("span",{className:"text-sm",children:w})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Supported: PNG, JPG, WEBP, AVIF, SVG â€¢ Max size: 5MB"})]})}$.propTypes={currentLogo:i.string,onUploadComplete:i.func.isRequired,onDelete:i.func,folder:i.string,label:i.string,showPreview:i.bool,allowDelete:i.bool};$.defaultProps={currentLogo:"",onDelete:null,folder:"companies",label:"Upload Logo",showPreview:!0,allowDelete:!1};export{$ as L,D as c};
