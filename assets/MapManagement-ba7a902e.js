import{r as i,K as Ze,s as C,u as Ye,j as e,M as Lt,I as x,af as Dt,ag as De,q as Rt,ah as Pt,ai as At,aj as $t,ak as kt,al as It,f as ze,h as _e,am as Bt,an as Ut,ao as Ee,ap as Ft,k as ge,aq as Tt,a3 as Xe,W as Ke,m as Qe,c as Le,ar as Wt,b as qt,as as Ot}from"./index-c3c9ac92.js";import{P as Ht}from"./ProtectedSection-f0b31bfe.js";import{g as Re,E as Gt,h as Vt}from"./EventMap-3cc3d586.js";import{u as Jt}from"./useUserRole-acbbb5e6.js";import{u as Xt}from"./useEventSubscriptions-f300fdbd.js";import{u as Kt}from"./useOrganizationProfile-e2fde381.js";import"./useTranslatedCompanyInfo-77e23049.js";import"./useCategories-5ce23293.js";import"./index-93ad2f14.js";import"./useEventMapSettings-2f04b57b.js";import"./phone-376c158e.js";function Qt(s){const[g,w]=i.useState([]),[_,m]=i.useState(!1),[d,M]=i.useState(null),{confirm:f,toastError:P,toastSuccess:o}=Ze(),Q=i.useCallback(async()=>{try{m(!0),M(null);const{data:A,error:J}=await C.from("map_snapshots").select("id, name, description, created_at, created_by, event_year").eq("event_year",s).order("created_at",{ascending:!1});if(J)throw J;w(A||[])}catch(A){console.error("Error loading snapshots:",A),M(A.message),P("Failed to load snapshots")}finally{m(!1)}},[s,P]),te=i.useCallback(async(A,J)=>{try{m(!0);const[y,L,D,q]=await Promise.all([C.from("markers_core").select("*").eq("event_year",s),C.from("markers_appearance").select("*").eq("event_year",s),C.from("markers_content").select("*").eq("event_year",s),C.from("assignments").select("*").eq("event_year",s)]);if(y.error)throw y.error;if(L.error)throw L.error;if(D.error)throw D.error;if(q.error)throw q.error;const p={markers_core:y.data,markers_appearance:L.data,markers_content:D.data,assignments:q.data},{error:$}=await C.from("map_snapshots").insert({event_year:s,name:A,description:J,data:p});if($)throw $;return o("Snapshot created successfully"),await Q(),!0}catch(y){return console.error("Error creating snapshot:",y),P(`Failed to create snapshot: ${y.message}`),!1}finally{m(!1)}},[s,Q,P,o]),V=i.useCallback(async A=>{if(await f({title:"Restore Snapshot?",message:`This action will completely overwrite the current map state with the saved snapshot data.

All current marker positions, styles, and company assignments for this year will be replaced.

Are you sure you want to proceed?`,confirmText:"Yes, Restore Snapshot",cancelText:"Cancel",variant:"danger"}))try{m(!0);const{data:y,error:L}=await C.from("map_snapshots").select("data").eq("id",A).single();if(L)throw L;if(!(y!=null&&y.data))throw new Error("Snapshot data is empty");const{markers_core:D,markers_appearance:q,markers_content:p,assignments:$}=y.data,{error:se}=await C.from("assignments").delete().eq("event_year",s);if(se)throw se;const{error:Z}=await C.from("markers_content").delete().eq("event_year",s);if(Z)throw Z;const{error:u}=await C.from("markers_appearance").delete().eq("event_year",s);if(u)throw u;const{error:Y}=await C.from("markers_core").delete().eq("event_year",s);if(Y)throw Y;if(D!=null&&D.length){const{error:k}=await C.from("markers_core").insert(D);if(k)throw k}if(q!=null&&q.length){const{error:k}=await C.from("markers_appearance").insert(q);if(k)throw k}if(p!=null&&p.length){const{error:k}=await C.from("markers_content").insert(p);if(k)throw k}if($!=null&&$.length){const{error:k}=await C.from("assignments").insert($);if(k)throw k}return o("Map state restored successfully"),!0}catch(y){return console.error("Error restoring snapshot:",y),P(`Failed to restore snapshot: ${y.message}`),!1}finally{m(!1)}},[s,f,P,o]),N=i.useCallback(async A=>{if(await f("Delete this snapshot permanently?"))try{m(!0);const{error:y}=await C.from("map_snapshots").delete().eq("id",A);if(y)throw y;o("Snapshot deleted"),await Q()}catch(y){console.error("Error deleting snapshot:",y),P("Failed to delete snapshot")}finally{m(!1)}},[Q,f,P,o]);return{snapshots:g,loading:_,error:d,loadSnapshots:Q,createSnapshot:te,restoreSnapshot:V,deleteSnapshot:N}}function Zt({isOpen:s,onClose:g,eventYear:w,onRestore:_}){const{t:m}=Ye(),{snapshots:d,loading:M,error:f,loadSnapshots:P,createSnapshot:o,restoreSnapshot:Q,deleteSnapshot:te}=Qt(w),[V,N]=i.useState(""),[A,J]=i.useState(""),[y,L]=i.useState(!1);i.useEffect(()=>{s&&P()},[s,P]);const D=async()=>{if(!V.trim())return;await o(V,A)&&(N(""),J(""),L(!1))},q=async p=>{await Q(p)&&(_&&_(),g())};return e.jsx(Lt,{isOpen:s,onClose:g,title:m("snapshots.manageSnapshots","Manage Map Snapshots"),className:"max-w-2xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h3",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(x,{path:Dt,size:.8}),m("snapshots.createNew","Create New Snapshot")]})}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:m("snapshots.name","Snapshot Name")}),e.jsx("input",{type:"text",value:V,onChange:p=>N(p.target.value),placeholder:"e.g. Layout V1 - Initial Draft",className:"w-full px-3 py-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:m("snapshots.description","Description (Optional)")}),e.jsx("textarea",{value:A,onChange:p=>J(p.target.value),placeholder:"Brief notes about this version...",className:"w-full px-3 py-2 border rounded-md",rows:2})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:D,disabled:M||!V.trim(),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(x,{path:De,size:.8}),m("snapshots.saveCurrentState","Save Current State")]})})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(x,{path:Rt,size:.8}),m("snapshots.history","Snapshot History")]}),M&&!d.length?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading..."}):d.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500 bg-gray-50 rounded border border-dashed",children:m("snapshots.noSnapshots","No saved snapshots found for this year.")}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:d.map(p=>e.jsxs("div",{className:"flex items-start justify-between p-4 bg-white border rounded-lg hover:border-blue-300 transition-colors shadow-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:p.name}),p.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:p.description}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 flex items-center gap-2",children:[e.jsx("span",{children:new Date(p.created_at).toLocaleString()}),p.created_by&&e.jsx("span",{children:"• by User"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>q(p.id),disabled:M,className:"p-2 text-blue-600 hover:bg-blue-50 rounded tooltip-trigger",title:m("snapshots.restore","Restore this version"),children:e.jsx(x,{path:Pt,size:1})}),e.jsx("button",{onClick:()=>te(p.id),disabled:M,className:"p-2 text-red-600 hover:bg-red-50 rounded tooltip-trigger",title:m("common.delete","Delete"),children:e.jsx(x,{path:At,size:1})})]})]},p.id))})]})]})})}function us({markersState:s,setMarkersState:g,updateMarker:w,undo:_,canUndo:m,redo:d,canRedo:M,selectedYear:f,archiveMarkers:P,copyMarkers:o,assignmentsState:Q,markerHistoryStack:te=[],markerRedoStack:V=[]}){var Ve,Je;const{t:N}=Ye(),{isEventManager:A,isSystemManager:J,isSuperAdmin:y}=Jt(),{profile:L}=Kt(),[D,q]=i.useState(""),[p,$]=i.useState(null),[se,Z]=i.useState(!1),[u,Y]=i.useState(null),[k,et]=i.useState("id"),[de,tt]=i.useState("asc"),[oe,Pe]=i.useState([]),{confirm:st,toastError:fe,toastSuccess:at}=Ze(),[X,nt]=i.useState(null);i.useState(!1);const[be,le]=i.useState(!1),[Ae,rt]=i.useState([]),[ot,pe]=i.useState(!1),[lt,$e]=i.useState(!1),[ee,ye]=i.useState(!1),[ae,ke]=i.useState(!0),[it,ct]=i.useState(384),[dt,ht]=i.useState(384),[Ie,pt]=i.useState(.5),[Be,ut]=i.useState(.4),[I,he]=i.useState(null),{subscriptions:z,loading:xt}=Xt(f),mt=$t(f),Ue=Q||mt,{assignments:S,undo:Fe,canUndo:gt,redo:Te,canRedo:ft,historyStack:je=[],redoStack:ve=[]}=Ue,We=m||gt,qe=M||ft,bt=()=>{const t=te.length>0?te[te.length-1]:null,n=je.length>0?je[je.length-1]:null,a=(t==null?void 0:t.timestamp)||0,r=(n==null?void 0:n.timestamp)||0;a===0&&r===0||(a>=r?_&&_():Fe&&Fe())},yt=()=>{const t=V.length>0?V[V.length-1]:null,n=ve.length>0?ve[ve.length-1]:null,a=(t==null?void 0:t.timestamp)||0,r=(n==null?void 0:n.timestamp)||0;a===0&&r===0||(a>=r?d&&d():Te&&Te())},[ue,jt]=i.useState(""),[we,vt]=i.useState("assigned"),[ne,wt]=i.useState("asc"),[ie,K]=i.useState(null),xe=i.useMemo(()=>{if(!z)return[];let t=[...z];if(ue){const n=ue.toLowerCase();t=t.filter(a=>{var l;return(((l=a.company)==null?void 0:l.name)||"").toLowerCase().includes(n)})}return t.sort((n,a)=>{var c,h,b,j;let r,l;switch(we){case"name":return r=((c=n.company)==null?void 0:c.name)||"",l=((h=a.company)==null?void 0:h.name)||"",ne==="asc"?(r||"").localeCompare(l||""):(l||"").localeCompare(r||"");case"booths":return r=n.booth_count||0,l=a.booth_count||0,ne==="asc"?r-l:l-r;case"assigned":{const T=H=>{const F=S==null?void 0:S.find(Me=>{var W;return Me.company_id===((W=H.company)==null?void 0:W.id)});return F?F.marker_id||999999:-1},O=T(n),U=T(a);return O===U?(((b=n.company)==null?void 0:b.name)||"").localeCompare(((j=a.company)==null?void 0:j.name)||""):ne==="asc"?O-U:U-O}}})},[z,S,ue,we,ne]),G=i.useMemo(()=>z==null?void 0:z.find(t=>t.id===ie),[z,ie]);i.useEffect(()=>{const t=a=>{if(I){if(a.preventDefault(),I==="left"){const r=Math.max(250,Math.min(800,a.clientX));ct(r)}else if(I==="right"){const r=Math.max(200,Math.min(600,window.innerWidth-a.clientX));ht(r)}else if(I==="split-left"){const l=window.innerHeight-144,h=(a.clientY-144)/l,b=Math.max(.2,Math.min(.8,h));pt(b)}else if(I==="split-right"){const l=window.innerHeight-144,h=(a.clientY-144)/l,b=Math.max(.2,Math.min(.8,h));ut(b)}}},n=()=>{I&&(he(null),document.body.style.cursor="default",document.body.style.userSelect="")};return I&&(window.addEventListener("mousemove",t),window.addEventListener("mouseup",n),document.body.style.userSelect="none",document.body.style.cursor=I.startsWith("split")?"row-resize":"col-resize"),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",n),document.body.style.userSelect="",document.body.style.cursor="default"}},[I]);const B=A;i.useEffect(()=>{async function t(){try{const[n,a]=await Promise.all([C.from("markers_core").select("*").in("id",[-1,-2]).eq("event_year",0),C.from("markers_appearance").select("*").in("id",[-1,-2]).eq("event_year",0)]);if(n.error)throw n.error;if(a.error)throw a.error;const r=(n.data||[]).map(l=>{const c=(a.data||[]).find(h=>h.id===l.id)||{};return{...l,...c}});Pe(r)}catch(n){console.error("Error fetching default markers:",n)}}t()},[]);const Oe=i.useMemo(()=>{if(!s)return oe;const n=[...s.filter(a=>{var l,c;const r=D.toLowerCase();return a.id.toString().includes(r)||((l=a.glyph)==null?void 0:l.toLowerCase().includes(r))||((c=a.name)==null?void 0:c.toLowerCase().includes(r))})].sort((a,r)=>{let l=0;switch(k){case"id":l=a.id-r.id;break;case"name":l=(a.glyph||a.name||"").localeCompare(r.glyph||r.name||"");break;case"type":a.id>=1e3!=r.id>=1e3?l=a.id>=1e3?-1:1:l=a.id-r.id;break;default:l=a.id-r.id}return de==="desc"?-l:l});return D?n:[...[...oe].sort((r,l)=>l.id-r.id),...n]},[s,oe,D,k,de]),E=i.useMemo(()=>{if(!p)return null;const t=oe.find(n=>n.id===p);return t||(s==null?void 0:s.find(n=>n.id===p))},[p,s,oe]),Nt=t=>{if(p===t.id)$(null),K(null);else{$(t.id);const n=S==null?void 0:S.find(a=>a.marker_id===t.id);if(n){const a=z==null?void 0:z.find(r=>r.company_id===n.company_id);K(a?a.id:null)}else K(null)}Z(!1)},St=()=>{E&&(Y({...E}),Z(!0))},Ct=()=>{Y(null),Z(!1)},Mt=async()=>{if(!u)return;const t=u.id===-1||u.id===-2;try{if(t){const n={rectWidth:u.rectWidth,rectHeight:u.rectHeight},a={iconUrl:u.iconUrl,iconSize:u.iconSize,glyphColor:u.glyphColor,glyphSize:u.glyphSize,fontWeight:u.fontWeight,fontStyle:u.fontStyle,textDecoration:u.textDecoration,fontFamily:u.fontFamily,shadowScale:u.shadowScale},[r,l]=await Promise.all([C.from("markers_core").update(n).eq("id",u.id).eq("event_year",0),C.from("markers_appearance").update(a).eq("id",u.id).eq("event_year",0)]);if(r.error)throw r.error;if(l.error)throw l.error;Pe(c=>c.map(h=>h.id===u.id?{...h,...u}:h))}else{const n={};if(Object.keys(u).forEach(a=>{u[a]!==E[a]&&(n[a]=u[a])}),Object.keys(n).length===0){Z(!1),Y(null);return}g(a=>a.map(r=>r.id===u.id?{...r,...u}:r)),await w(u.id,n)}Z(!1),Y(null)}catch(n){console.error("Error saving marker:",n),fe("Failed to save marker. Please try again.")}},zt=(t,n)=>{Y(a=>({...a,[t]:n}))},He=async()=>{if(B)return;const t=f-1;if(!await st({title:"Copy Markers",message:`Copy all markers from ${t} to ${f}?`,confirmText:"Copy",variant:"default"}))return;const{error:a}=await o(t);a?fe(`Error copying markers: ${a}`):at(`Markers copied from ${t} to ${f}`)},_t=async t=>{var O,U,H;if(!X||!X.printControl||!t)return;pe(!0);const n=X.printControl,a=(n==null?void 0:n.browserPrint)||n;let r=null,l=!1,c=!1;const h=()=>{if(!X||!(window.L&&window.L.BrowserPrint&&window.L.BrowserPrint.Event))return;const F=window.L.BrowserPrint.Event;try{X.off(F.PrintStart,b),X.off(F.PrintEnd,j),X.off(F.PrintCancel,T)}catch{}r&&(clearTimeout(r),r=null)},b=()=>{l=!0},j=()=>{c=!0,h()},T=()=>{c=!0,h()};try{if(window.L&&window.L.BrowserPrint&&window.L.BrowserPrint.Event){const W=window.L.BrowserPrint.Event;X.on(W.PrintStart,b),X.on(W.PrintEnd,j),X.on(W.PrintCancel,T)}try{if(typeof a.print=="function")a.print(t);else if(typeof(n==null?void 0:n._printMode)=="function")n._printMode(t);else throw new Error("No browser print API available")}catch(W){console.warn("Header BrowserPrint call failed:",W),h();const re=((O=t==null?void 0:t.title)==null?void 0:O.toLowerCase().includes("landscape"))||((U=t==null?void 0:t.name)==null?void 0:U.toLowerCase().includes("landscape"));console.info(`[MapPrint] Fallback triggered. Configuration: ${re?"Landscape":"Portrait"}`),alert("Browser print failed. Falling back to snapshot print (popup window). Verify the orientation in the dialog."),await Ne({orientation:re?"landscape":"portrait"});return}if(await(()=>new Promise(W=>{if(l)return W("started");r=setTimeout(()=>W("timeout"),8e3);const re=setInterval(()=>{(l||c)&&(clearInterval(re),r&&(clearTimeout(r),r=null),W(l?"started":"finished"))},80)}))()==="timeout"){console.warn("Header BrowserPrint did not start; falling back to snapshot export"),h();const re=((t==null?void 0:t.title)||((H=t==null?void 0:t.options)==null?void 0:H.title)||(t==null?void 0:t.name)||"").toLowerCase().includes("landscape");console.info(`[MapPrint] Fallback triggered. Configuration: ${re?"Landscape":"Portrait"}`),alert("Browser print timed out. Falling back to snapshot print (popup window). Verify the orientation in the dialog."),await Ne({orientation:re?"landscape":"portrait"})}}finally{pe(!1)}},Ne=async(t={})=>{if(!ot){pe(!0);try{const n=document.querySelector("#map-container")||document.querySelector(".leaflet-container");if(!n)return;await new Promise(H=>setTimeout(H,400));const r=(await Vt(n,{useCORS:!0,allowTaint:!0,logging:!1,backgroundColor:"#ffffff",scale:2,ignoreElements:H=>{var F;return(F=H.classList)==null?void 0:F.contains("map-controls-print-hide")}})).toDataURL("image/png",1),l=window.open("","_blank","width=900,height=700");if(!l){alert("Popup blocked! Please allow popups for map printing.");return}const c=l.document;c.open();const h=c.createElement("head"),b=c.createElement("title");b.textContent="Map Print";const j=c.createElement("style"),T=t.orientation==="landscape"?"landscape":"portrait";j.textContent=`
        * { margin: 0; padding: 0 }
        body { 
          display: flex; 
          justify-content: center; 
          align-items: center; 
          min-height: 100vh; 
          background: white 
        }
        img { 
          max-width: 100%; 
          max-height: 100vh; 
          object-fit: contain 
        }
        @media print { 
          @page { size: ${T}; margin: 0; }
          img { width: 100%; height: auto } 
          body { 
            display: block !important; 
            margin: 0 !important;
            padding: 0 !important;
            height: 100% !important;
          }
        }
      `,h.appendChild(b),h.appendChild(j);const O=c.createElement("body"),U=c.createElement("img");for(U.src=r,U.alt="Map",U.onload=()=>setTimeout(()=>{try{l.print()}catch{}},100),O.appendChild(U),c.documentElement||c.appendChild(c.createElement("html"));c.documentElement.firstChild;)c.documentElement.removeChild(c.documentElement.firstChild);c.documentElement.appendChild(h),c.documentElement.appendChild(O),c.close(),l.document.close(),l.onafterprint=()=>l.close()}catch(n){console.error("Snapshot print failed:",n);try{fe("Snapshot failed — map tiles may be blocked by CORS or the service worker. Use the Print Map plugin preset or enable CORS for your tile provider.")}catch{}window.print()}finally{pe(!1)}}},Et=()=>{if(!S||!z||!s)return;const t=S.map(h=>{var T,O,U,H;const b=z.find(F=>F.company_id===h.company_id),j=s.find(F=>F.id===h.marker_id);return!b||!j?null:{booth:((T=j.id)==null?void 0:T.toString())||"?",company:((O=b.company)==null?void 0:O.name)||"Unknown",contact:((U=b.company)==null?void 0:U.contact)||"-",phone:((H=b.company)==null?void 0:H.phone)||"-"}}).filter(Boolean).sort((h,b)=>{const j=parseInt(h.booth,10),T=parseInt(b.booth,10);return!isNaN(j)&&!isNaN(T)?j-T:h.booth.localeCompare(b.booth,void 0,{numeric:!0})}),n=window.open("","_blank");if(!n){alert("Allow popups to print assignments.");return}const a=N("mapManagement.print.assignmentsList","Assignments List"),r=(L==null?void 0:L.name)||"Event Map";let l=L!=null&&L.logo?Le(L.logo):null;l&&l.startsWith("/")&&(l=window.location.origin+l);const c=n.document;c.open(),c.write(`
      <html>
      <head>
        <title>${a} - ${f}</title>
        <style>
          body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 40px; }
          .header { display: flex; align-items: center; gap: 24px; margin-bottom: 32px; border-bottom: 2px solid #f3f4f6; padding-bottom: 24px; }
          .logo { max-height: 80px; width: auto; object-fit: contain; }
          .titles { display: flex; flex-direction: column; gap: 4px; }
          .org-name { font-size: 24px; font-weight: 700; color: #111827; margin: 0; line-height: 1.2; }
          .doc-title { font-size: 18px; color: #4b5563; margin: 0; font-weight: 500; }
          table { width: 100%; border-collapse: collapse; font-size: 14px; }
          th, td { text-align: left; padding: 12px 16px; border-bottom: 1px solid #e5e7eb; }
          th { background-color: #f9fafb; font-weight: 600; color: #374151; white-space: nowrap; }
          tr:nth-child(even) { background-color: #fff; }
          tr:nth-child(odd) { background-color: #fcfcfd; }
          @media print {
            body { padding: 0; }
            button { display: none; }
            .header { border-bottom-color: #000; }
            th { background-color: #eee !important; color: #000; -webkit-print-color-adjust: exact; }
          }
        </style>
      </head>
      <body>
        <div class="header">
          ${l?`<img src="${l}" class="logo" alt="Logo" />`:""}
          <div class="titles">
            <h1 class="org-name">${r}</h1>
            <h2 class="doc-title">${a} - ${f}</h2>
          </div>
        </div>
        <table>
          <thead>
            <tr>
              <th>${N("mapManagement.print.columns.booth","Booth")}</th>
              <th>${N("mapManagement.print.columns.company","Company")}</th>
              <th>${N("mapManagement.print.columns.contact","Contact")}</th>
              <th>${N("mapManagement.print.columns.phone","Phone")}</th>
            </tr>
          </thead>
          <tbody>
            ${t.map(h=>`
              <tr>
                <td style="font-weight: 600;">${h.booth}</td>
                <td>${h.company}</td>
                <td>${h.contact}</td>
                <td style="font-family: monospace;">${h.phone}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
        <script>
          // Wait for logo to load if present before printing
          window.onload = () => {
             // Small delay to ensure rendering is complete
            setTimeout(() => {
              window.print();
            }, 500);
          }
        <\/script>
      </body>
      </html>
    `),c.close()},me=E&&(E.id===-1||E.id===-2),Se=E&&E.id>=1e3,Ce=E&&E.id>0&&E.id<1e3,Ge=t=>{const n=oe.find(r=>r.id===(t?-1:-2));if(!(n!=null&&n.iconUrl))return t?"Blue (assigned)":"Gray (unassigned)";const a=n.iconUrl.match(/glyph-marker-icon-(\w+)\.svg/);return a?`${a[1].charAt(0).toUpperCase()+a[1].slice(1)} (${t?"assigned":"unassigned"})`:t?"Blue (assigned)":"Gray (unassigned)"};return e.jsxs(Ht,{requiredRole:["super_admin","system_manager","event_manager"],children:[e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"p-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:B?"Event Map Viewer":N("mapManagement.title")}),e.jsx("div",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:f}),!B&&e.jsx("div",{className:"flex gap-1 items-center",children:e.jsxs("div",{className:"flex bg-gray-100 rounded-full p-0.5 ml-2",title:N("mapManagement.undoRedo","Undo / Redo Actions"),children:[e.jsxs("button",{type:"button",onClick:bt,disabled:!We,className:`p-1.5 rounded-full transition-colors flex items-center justify-center ${We?"text-gray-700 hover:bg-white hover:text-gray-900 hover:shadow-sm":"text-gray-300 cursor-not-allowed"}`,title:N("mapManagement.undo","Undo last action"),children:[e.jsx(x,{path:kt,size:.7}),e.jsx("span",{className:"sr-only",children:"Undo"})]}),e.jsx("div",{className:"w-px h-4 bg-gray-200 self-center mx-0.5"}),e.jsxs("button",{type:"button",onClick:yt,disabled:!qe,className:`p-1.5 rounded-full transition-colors flex items-center justify-center ${qe?"text-gray-700 hover:bg-white hover:text-gray-900 hover:shadow-sm":"text-gray-300 cursor-not-allowed"}`,title:N("mapManagement.redo","Redo last action"),children:[e.jsx(x,{path:It,size:.7}),e.jsx("span",{className:"sr-only",children:"Redo"})]})]})})]}),e.jsxs("div",{className:"flex gap-2 items-center relative z-50",children:[e.jsxs("button",{type:"button",onClick:()=>le(!be),className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium bg-white text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 shadow-sm transition-all",title:"Actions Menu",children:[e.jsx("span",{children:"Actions"}),e.jsx(x,{path:be?ze:_e,size:.7})]}),be&&e.jsxs("div",{className:"absolute top-full right-0 mt-1 w-64 bg-white rounded-lg shadow-xl border border-gray-200 z-[60] overflow-hidden py-1",children:[e.jsx("div",{className:"px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider bg-gray-50 border-b border-gray-100",children:"Tools"}),!B&&e.jsxs("button",{onClick:()=>{$e(!0),le(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(x,{path:Bt,size:.7,className:"text-gray-400"}),e.jsx("span",{children:"Manage Snapshots"})]}),!B&&e.jsxs("button",{onClick:()=>{He(),le(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(x,{path:Ut,size:.7,className:"text-gray-400"}),e.jsxs("span",{children:["Copy from ",f-1]})]}),e.jsx("div",{className:"px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider bg-gray-50 border-y border-gray-100 mt-1",children:"Print"}),Ae.length>0?Ae.map((t,n)=>{var a,r;return e.jsxs("button",{type:"button",onClick:async()=>{le(!1),await _t(t)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(x,{path:Ee,size:.7,className:"text-gray-400"}),e.jsx("span",{children:((a=t==null?void 0:t.options)==null?void 0:a.title)||((r=t==null?void 0:t.options)==null?void 0:r.pageSize)||`Preset ${n+1}`})]},n)}):e.jsxs("button",{type:"button",onClick:async()=>{le(!1),await Ne()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(x,{path:Ee,size:.7,className:"text-gray-400"}),e.jsx("span",{children:"Snapshot (PNG)"})]}),((S==null?void 0:S.length)||0)>0&&e.jsxs("button",{type:"button",onClick:()=>{le(!1),Et()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(x,{path:Ee,size:.7,className:"text-gray-400"}),e.jsx("span",{children:"Assignments List"})]}),e.jsx("div",{className:"px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider bg-gray-50 border-y border-gray-100 mt-1",children:"View"}),e.jsxs("button",{onClick:()=>{ye(!ee)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{path:Ft,size:.7,className:"text-gray-400"}),e.jsx("span",{children:"Markers Sidebar"})]}),ee&&e.jsx(x,{path:ge,size:.6,className:"text-blue-500"})]}),e.jsxs("button",{onClick:()=>{ke(!ae)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{path:Tt,size:.7,className:"text-gray-400"}),e.jsx("span",{children:"Subscriptions Sidebar"})]}),ae&&e.jsx(x,{path:ge,size:.6,className:"text-blue-500"})]})]})]})]}),Oe.length===0&&!D&&e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:["No Markers Found for ",f]}),e.jsx("p",{className:"text-blue-700 mb-4",children:B?`There are no markers configured for ${f}. Please contact your system administrator.`:`There are no markers configured for ${f}. You can copy markers from the previous year or create new ones.`}),!B&&e.jsxs("button",{onClick:He,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:["Copy from ",f-1]})]})}),!B&&e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("button",{onClick:()=>ye(!ee),className:"p-1 rounded-md text-gray-400 hover:text-gray-900 hover:bg-gray-100 transition-colors",title:ee?"Hide Markers & Details":"Show Markers & Details",children:e.jsx(x,{path:ee?Xe:Ke,size:.8})}),e.jsx("button",{onClick:()=>ke(!ae),className:"p-1 rounded-md text-gray-400 hover:text-gray-900 hover:bg-gray-100 transition-colors",title:ae?"Hide Subscriptions List":"Show Subscriptions List",children:e.jsx(x,{path:ae?Ke:Xe,size:.8})})]})]}),e.jsxs("div",{className:"flex h-[calc(100vh-120px)] relative",children:[!B&&e.jsxs("div",{className:`border-r border-gray-200 overflow-hidden flex-shrink-0 bg-white flex flex-col relative ${!ee&&"border-r-0"}`,style:{width:ee?it:0,transition:I==="left"?"none":"width 0.3s ease-in-out"},children:[e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-400 z-50 active:bg-blue-600 transition-colors",onMouseDown:()=>he("left")}),e.jsx("div",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider px-3 py-2 bg-white sticky top-0 z-10",children:"Markers List"}),e.jsxs("div",{className:"p-3 border-b border-gray-200 bg-gray-50 flex flex-col gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(x,{path:Qe,size:.8,className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:N("mapManagement.searchPlaceholder"),value:D,onChange:t=>q(t.target.value),className:"w-full pl-8 pr-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md shadow-sm bg-white",children:[e.jsxs("select",{value:k,onChange:t=>et(t.target.value),className:"flex-1 pl-2 pr-2 py-1.5 border-0 rounded-l-md bg-white text-gray-900 text-xs focus:ring-0 appearance-none min-w-0","aria-label":N("mapManagement.sortBy"),children:[e.jsx("option",{value:"id",children:N("mapManagement.sortId")}),e.jsx("option",{value:"name",children:N("mapManagement.sortName")}),e.jsx("option",{value:"type",children:N("mapManagement.sortType")})]}),e.jsxs("button",{type:"button",onClick:()=>tt(de==="asc"?"desc":"asc"),"aria-label":`Toggle sort direction to ${de==="asc"?"descending":"ascending"}`,className:"px-2 py-1.5 border-l border-gray-300 text-gray-500 hover:bg-gray-50 rounded-r-md text-xs",children:[e.jsx(x,{path:de==="asc"?ze:_e,size:.7}),e.jsx("span",{className:"sr-only",children:"Sort"})]})]})]}),e.jsx("div",{className:"w-full overflow-y-auto p-2 border-b border-gray-200 relative scrollbar-hide",style:{height:p?`calc(${Ie*100}% - 146px)`:"calc(100% - 146px)",transition:I?"none":"height 0.3s ease-in-out"},children:Oe.map(t=>{const n=t.id===p,a=t.id===-1||t.id===-2;return t.id>=1e3,e.jsx("button",{onClick:()=>Nt(t),className:`w-full text-left p-2 rounded-lg mb-1 transition-colors ${n?"bg-blue-50 border-2 border-blue-500":a?"bg-amber-50 border-2 border-amber-300 hover:bg-amber-100":"bg-white border border-gray-200 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.iconUrl?e.jsx("div",{className:"relative",children:e.jsx("img",{src:Re(t.iconUrl),alt:"icon",className:"w-5 h-5"})}):e.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded flex items-center justify-center text-[10px] text-gray-600",children:"D"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-sm text-gray-900 truncate",children:a?t.id===-1?"Assigned Booth":"Unassigned Booth":t.glyph||`Marker ${t.id}`}),e.jsxs("span",{className:"text-xs text-gray-400 font-mono ml-2",children:["#",t.id]})]}),t.name&&e.jsx("div",{className:"text-xs text-gray-500 truncate",children:t.name})]})]})},t.id)})}),p&&e.jsx("div",{className:"w-full h-1 cursor-row-resize bg-gray-200 hover:bg-blue-400 z-50 active:bg-blue-600 transition-colors",onMouseDown:()=>he("split-left")}),p&&e.jsx("div",{className:"w-full overflow-y-auto p-6 bg-gray-50/50 flex-shrink-0",style:{height:`${(1-Ie)*100}%`,transition:I?"none":"height 0.3s ease-in-out"},children:E?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:me?E.id===-1?"Assigned Booth Default":"Unassigned Booth Default":E.glyph||`Marker ${E.id}`}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",E.id,me&&" ⚙️ Global Default for Booth Markers",Se&&" (Special Marker)",Ce&&" (Booth - Content managed via Companies/Assignments)"]})]}),!se&&!B&&e.jsx("button",{onClick:St,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Edit"})]}),se?e.jsx(es,{marker:u,isDefaultMarker:me,isSpecialMarker:Se,isBoothMarker:Ce,getDefaultColorName:Ge,onChange:zt,onSave:Mt,onCancel:Ct}):e.jsx(Yt,{marker:E,isSpecialMarker:Se,isDefaultMarker:me,isBoothMarker:Ce,getDefaultColorName:Ge})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:N("mapManagement.selectMarker")})})]}),e.jsx("div",{className:"flex-1 relative bg-gray-50 flex flex-col",children:e.jsx(Gt,{isAdminView:!0,previewUseVisitorSizing:!0,markersState:s,assignmentsState:Ue,updateMarker:B?null:w,selectedYear:f,selectedMarkerId:p,editMode:!B&&se,onMarkerSelect:t=>{if($(t),B||Z(!1),ee||ye(!0),t){const n=S==null?void 0:S.find(a=>a.marker_id===t);if(n){const a=z==null?void 0:z.find(r=>r.company_id===n.company_id);K(a?a.id:null)}else K(null)}else K(null)},onMarkerDrag:(t,n,a)=>{!B&&se&&p===t&&Y(r=>({...r,lat:n,lng:a}))},onMapReady:t=>{var a,r;nt(t);const n=((r=(a=t==null?void 0:t.printControl)==null?void 0:a.options)==null?void 0:r.printModes)||[];rt(Array.isArray(n)?n:[])}})}),!B&&e.jsxs("div",{className:`border-l border-gray-200 overflow-hidden flex-shrink-0 bg-white relative flex flex-col ${!ae&&"border-l-0"}`,style:{width:ae?dt:0,transition:I==="right"?"none":"width 0.3s ease-in-out"},children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-400 z-50 active:bg-blue-600 transition-colors",onMouseDown:()=>he("right")}),e.jsxs("div",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider px-3 py-2 bg-white sticky top-0 z-10 flex justify-between items-center",children:[e.jsx("span",{children:"Subscription List"}),e.jsx("span",{className:"text-[10px] font-normal",children:(()=>!z||!S?"0 / 0":`${z.filter(n=>S.some(a=>a.company_id===n.company_id)).length} / ${z.length}`)()})]}),e.jsxs("div",{className:"p-3 border-b border-gray-200 bg-gray-50 flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx(x,{path:Qe,size:.8,className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search company...",value:ue,onChange:t=>jt(t.target.value),className:"w-full pl-8 pr-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md shadow-sm bg-white",children:[e.jsxs("select",{value:we,onChange:t=>vt(t.target.value),className:"flex-1 pl-2 pr-2 py-1.5 border-0 rounded-l-md bg-white text-gray-900 text-xs focus:ring-0 appearance-none min-w-0","aria-label":"Sort subscriptions by",children:[e.jsx("option",{value:"name",children:"Sort by Company"}),e.jsx("option",{value:"booths",children:"Sort by Booths"}),e.jsx("option",{value:"assigned",children:"Sort by Assigned"})]}),e.jsxs("button",{type:"button",onClick:()=>wt(ne==="asc"?"desc":"asc"),"aria-label":`Toggle sort direction to ${ne==="asc"?"descending":"ascending"}`,className:"px-2 py-1.5 border-l border-gray-300 text-gray-500 hover:bg-gray-50 rounded-r-md text-xs",children:[e.jsx(x,{path:ne==="asc"?ze:_e,size:.7}),e.jsx("span",{className:"sr-only",children:"Sort"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 relative",children:[e.jsx("div",{className:"overflow-y-auto w-full",style:{height:ie?`${Be*100}%`:"100%",transition:I?"none":"height 0.3s ease-in-out"},children:xt?e.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:"Loading..."}):(xe==null?void 0:xe.length)===0?e.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:"No subscriptions"}):xe.map(t=>{const n=ie===t.id,a=t.company||{},r=S==null?void 0:S.find(j=>j.company_id===a.id),l=!!r,c=r==null?void 0:r.marker_id,h=s==null?void 0:s.find(j=>j.id===c),b=h?`Booth ${h.id}`:"Assigned";return e.jsxs("button",{onClick:()=>{const j=n?null:t.id;K(j),$(j&&c?c:null)},className:`w-full text-left p-3 border-b border-gray-100 hover:bg-gray-50 transition-colors flex items-center gap-3 ${n?"bg-blue-50 border-l-4 border-l-blue-500 pl-[11px]":""}`,children:[e.jsx("div",{className:"w-8 h-8 flex-shrink-0 bg-white border border-gray-200 rounded flex items-center justify-center overflow-hidden",children:a.logo?e.jsx("img",{src:Le(a.logo),alt:a.name,className:"w-full h-full object-contain"}):e.jsx(x,{path:Wt,size:.6,className:"text-gray-300"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:a.name||"Unknown Company"}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[l?e.jsxs("span",{className:"text-green-600 flex items-center gap-0.5",children:[e.jsx(x,{path:De,size:.5})," ",b]}):e.jsx("span",{className:"text-orange-500",children:"Unassigned"}),t.booth_count>0&&e.jsxs("span",{children:["• ",t.booth_count," ",t.booth_count===1?"booth":"booths"]})]})]})]},t.id)})}),ie&&e.jsx("div",{className:"w-full h-1 cursor-row-resize bg-gray-200 hover:bg-blue-400 z-50 active:bg-blue-600 transition-colors flex-shrink-0",onMouseDown:()=>he("split-right")}),ie&&e.jsx("div",{className:"w-full overflow-y-auto p-4 bg-gray-50/50 border-t border-gray-200",style:{height:`${(1-Be)*100}%`,transition:I?"none":"height 0.3s ease-in-out"},children:G?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Subscription Details"}),e.jsx("button",{onClick:()=>{K(null),$(null)},className:"text-gray-400 hover:text-gray-600",title:"Close details",children:e.jsx(x,{path:ge,size:.8})})]}),e.jsx("div",{className:"bg-white p-3 rounded border border-gray-200 shadow-sm text-left",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-left",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-0.5 text-left",children:"Company"}),e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate text-left",title:(Ve=G.company)==null?void 0:Ve.name,children:((Je=G.company)==null?void 0:Je.name)||"Unknown"})]}),e.jsxs("div",{className:"col-span-2 text-left",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-0.5 text-left",children:"Booths"}),e.jsx("div",{className:"text-sm text-gray-900 text-left",children:G.booth_count||0})]}),e.jsxs("div",{className:"col-span-2 text-left",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-0.5 text-left",children:"Coins"}),e.jsx("div",{className:"text-sm text-gray-900 text-left",children:G.coins||0})]}),e.jsxs("div",{className:"col-span-2 text-left",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-0.5 text-left",children:"Meals (Saturday)"}),e.jsxs("div",{className:"text-xs text-gray-700 flex gap-3 text-left",children:[e.jsxs("span",{children:["Breakfast:"," ",e.jsx("span",{className:"font-medium text-gray-900",children:G.breakfast_sat||0})]}),e.jsxs("span",{children:["Lunch:"," ",e.jsx("span",{className:"font-medium text-gray-900",children:G.lunch_sat||0})]}),e.jsxs("span",{children:["BBQ:"," ",e.jsx("span",{className:"font-medium text-gray-900",children:G.bbq_sat||0})]})]})]}),e.jsxs("div",{className:"col-span-2 text-left",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-0.5 text-left",children:"Meals (Sunday)"}),e.jsxs("div",{className:"text-xs text-gray-700 flex gap-3 text-left",children:[e.jsxs("span",{children:["Breakfast:"," ",e.jsx("span",{className:"font-medium text-gray-900",children:G.breakfast_sun||0})]}),e.jsxs("span",{children:["Lunch:"," ",e.jsx("span",{className:"font-medium text-gray-900",children:G.lunch_sun||0})]})]})]}),e.jsxs("div",{className:"col-span-2 text-left",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-0.5 text-left",children:"Notes"}),e.jsx("div",{className:"text-xs bg-gray-50 p-2 rounded text-gray-600 whitespace-pre-wrap min-h-[3rem] border border-gray-100 text-left",children:G.notes||e.jsx("span",{className:"text-gray-400 italic",children:"No notes"})})]})]})})]}):e.jsx("div",{className:"text-center text-gray-400 py-4",children:"Select a subscription"})})]})]})]})]}),e.jsx(Zt,{isOpen:lt,onClose:()=>$e(!1),eventYear:f,onRestore:()=>{window.location.reload()}})]})}function Yt({marker:s,isSpecialMarker:g,isDefaultMarker:w,isBoothMarker:_,getDefaultColorName:m}){var d;return e.jsxs("div",{className:"space-y-6",children:[w&&e.jsxs("div",{className:"bg-amber-50 border-2 border-amber-300 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-amber-900 mb-2",children:"ℹ️ About Default Markers"}),e.jsx("p",{className:"text-sm text-amber-800 mb-2",children:s.id===-1?"This defines the default appearance for booth markers (ID < 1000) that have a company assigned.":"This defines the default appearance for booth markers (ID < 1000) that have no company assigned."}),e.jsx("p",{className:"text-sm text-amber-800",children:"Individual booth markers can override these defaults by having their own values in the Appearance table."})]}),!w&&e.jsxs(ce,{title:"Position & Structure",children:[e.jsx(v,{label:"Latitude",value:s.lat}),e.jsx(v,{label:"Longitude",value:s.lng}),e.jsx(v,{label:"Rectangle",value:JSON.stringify(s.rectangle)}),e.jsx(v,{label:"Angle",value:s.angle||0})]}),e.jsxs(ce,{title:w?"Default Visual Styling":"Visual Styling",children:[e.jsx(v,{label:"Icon",children:s.iconUrl?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:Re(s.iconUrl),alt:"icon",className:"w-8 h-8"}),e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"Custom Color"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded flex items-center justify-center text-[9px] text-gray-600 font-medium leading-none",children:"Default"}),e.jsx("span",{className:"text-xs text-blue-600 font-medium",children:_?m(((d=s.assignments)==null?void 0:d.length)>0):"Based on marker type"})]})}),e.jsx(v,{label:"Icon Size",value:JSON.stringify(s.iconSize)}),!w&&e.jsx(v,{label:"Glyph (Booth Label)",value:s.glyph}),e.jsx(v,{label:"Glyph Color",value:s.glyphColor}),e.jsx(v,{label:"Glyph Size",value:s.glyphSize}),s.fontWeight&&e.jsx(v,{label:"Weight",value:s.fontWeight}),s.fontStyle&&e.jsx(v,{label:"Style",value:s.fontStyle}),s.textDecoration&&e.jsx(v,{label:"Decoration",value:s.textDecoration}),s.fontFamily&&e.jsx(v,{label:"Font Family",value:s.fontFamily}),e.jsx(v,{label:"Glyph Anchor",value:s.glyphAnchor?JSON.stringify(s.glyphAnchor):"—"}),e.jsx(v,{label:"Shadow Scale",value:s.shadowScale??"1.0"}),w&&e.jsxs(e.Fragment,{children:[e.jsx(v,{label:"Rectangle Width",value:s.rectWidth}),e.jsx(v,{label:"Rectangle Height",value:s.rectHeight})]})]}),g&&e.jsxs(ce,{title:"Content (Special Marker)",children:[e.jsx(v,{label:"Name",value:s.name}),e.jsx(v,{label:"Logo",children:s.logo&&e.jsx("img",{...(()=>{const M=qt(s.logo);return M?{src:M.src,srcSet:M.srcSet,sizes:M.sizes}:{src:Le(s.logo)}})(),alt:"logo",className:"w-12 h-12"})}),e.jsx(v,{label:"Website",value:s.website}),e.jsx(v,{label:"Info",value:s.info})]})]})}function es({marker:s,isDefaultMarker:g,isSpecialMarker:w,isBoothMarker:_,getDefaultColorName:m,onChange:d,onSave:M,onCancel:f}){var P;return e.jsxs("div",{className:"space-y-6",children:[g&&e.jsxs("div",{className:"bg-amber-50 border-2 border-amber-300 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-amber-900 mb-2",children:"⚙️ Editing Global Defaults"}),e.jsx("p",{className:"text-sm text-amber-800 mb-2",children:s.id===-1?"Changes here will affect all booth markers (ID < 1000) that have a company assigned, unless they have individual overrides.":"Changes here will affect all booth markers (ID < 1000) that have no company assigned, unless they have individual overrides."})]}),!g&&e.jsxs(ce,{title:"Position & Structure",children:[e.jsx(R,{label:"Latitude",type:"number",step:"0.0001",value:s.lat,onChange:o=>d("lat",parseFloat(o))}),e.jsx(R,{label:"Longitude",type:"number",step:"0.0001",value:s.lng,onChange:o=>d("lng",parseFloat(o))}),e.jsx(R,{label:"Angle",type:"number",step:"0.1",value:s.angle||0,onChange:o=>d("angle",parseFloat(o))})]}),e.jsxs(ce,{title:g?"Default Visual Styling":"Visual Styling",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Icon"}),e.jsxs("div",{className:"grid grid-cols-6 gap-2",children:[e.jsx("button",{onClick:()=>d("iconUrl",null),className:`w-10 h-10 border-2 rounded-lg transition-all flex items-center justify-center ${s.iconUrl?"border-gray-200 hover:border-gray-400":"border-blue-500 bg-blue-50"}`,title:"Use default color based on assignment status",children:e.jsx("div",{className:"text-[9px] text-gray-600 font-medium leading-none",children:"Default"})}),Ot.map(o=>e.jsx("button",{onClick:()=>d("iconUrl",o),className:`p-2 border-2 rounded-lg transition-all ${s.iconUrl===o?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-400"}`,children:e.jsx("img",{src:Re(o),alt:o,className:"w-8 h-8"})},o))]}),s.iconUrl?e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Using custom color override"}):e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Using default color:"," ",_?m(((P=s.assignments)==null?void 0:P.length)>0):"Based on marker type"]})]}),!g&&e.jsx(R,{label:"Glyph (Booth Label)",value:s.glyph,onChange:o=>d("glyph",o)}),e.jsx(R,{label:"Glyph Color",type:"color",value:s.glyphColor,onChange:o=>d("glyphColor",o)}),e.jsx(R,{label:"Glyph Size",type:"number",step:"0.01",value:s.glyphSize,onChange:o=>d("glyphSize",parseFloat(o))}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Weight"}),e.jsxs("select",{value:s.fontWeight||"",onChange:o=>d("fontWeight",o.target.value||null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Default"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"bold",children:"Bold"}),e.jsx("option",{value:"bolder",children:"Bolder"}),e.jsx("option",{value:"lighter",children:"Lighter"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Style"}),e.jsxs("select",{value:s.fontStyle||"",onChange:o=>d("fontStyle",o.target.value||null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Default"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"italic",children:"Italic"}),e.jsx("option",{value:"oblique",children:"Oblique"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Decor"}),e.jsxs("select",{value:s.textDecoration||"",onChange:o=>d("textDecoration",o.target.value||null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Default"}),e.jsx("option",{value:"none",children:"None"}),e.jsx("option",{value:"underline",children:"Underline"}),e.jsx("option",{value:"overline",children:"Overline"}),e.jsx("option",{value:"line-through",children:"Strike"})]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Font Family"}),e.jsxs("select",{value:s.fontFamily||"",onChange:o=>d("fontFamily",o.target.value||null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"",children:"Default"}),e.jsx("option",{value:"sans-serif",children:"Sans Serif"}),e.jsx("option",{value:"serif",children:"Serif"}),e.jsx("option",{value:"monospace",children:"Monospace"}),e.jsx("option",{value:"Arial, sans-serif",children:"Arial"}),e.jsx("option",{value:"'Times New Roman', serif",children:"Times New Roman"}),e.jsx("option",{value:"'Courier New', monospace",children:"Courier New"}),e.jsx("option",{value:"Georgia, serif",children:"Georgia"}),e.jsx("option",{value:"Verdana, sans-serif",children:"Verdana"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(R,{label:"Glyph Anchor X",type:"number",step:"0.01",value:s.glyphAnchor?s.glyphAnchor[0]:"",onChange:o=>d("glyphAnchor",[parseFloat(o)||0,s.glyphAnchor&&s.glyphAnchor[1]||0])}),e.jsx(R,{label:"Glyph Anchor Y",type:"number",step:"0.01",value:s.glyphAnchor?s.glyphAnchor[1]:"",onChange:o=>d("glyphAnchor",[s.glyphAnchor&&s.glyphAnchor[0]||0,parseFloat(o)||0])})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(R,{label:"Icon Width",type:"number",step:"0.01",value:s.iconSize?s.iconSize[0]:"",onChange:o=>d("iconSize",[parseFloat(o)||null,s.iconSize?s.iconSize[1]:null])}),e.jsx(R,{label:"Icon Height",type:"number",step:"0.01",value:s.iconSize?s.iconSize[1]:"",onChange:o=>d("iconSize",[s.iconSize?s.iconSize[0]:null,parseFloat(o)||null])})]}),e.jsx(R,{label:"Shadow Scale",type:"number",step:"0.01",value:s.shadowScale??1,onChange:o=>d("shadowScale",parseFloat(o))}),g&&e.jsxs(e.Fragment,{children:[e.jsx(R,{label:"Rectangle Width",type:"number",step:"1",value:s.rectWidth,onChange:o=>d("rectWidth",parseFloat(o))}),e.jsx(R,{label:"Rectangle Height",type:"number",step:"1",value:s.rectHeight,onChange:o=>d("rectHeight",parseFloat(o))})]})]}),w&&e.jsxs(ce,{title:"Content (Special Marker)",children:[e.jsx(R,{label:"Name",value:s.name,onChange:o=>d("name",o)}),e.jsx(R,{label:"Logo URL",value:s.logo,onChange:o=>d("logo",o)}),e.jsx(R,{label:"Website",value:s.website,onChange:o=>d("website",o)}),e.jsx(ts,{label:"Info",value:s.info,onChange:o=>d("info",o)})]}),_&&e.jsx(e.Fragment,{}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:M,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(x,{path:De,size:.9}),"Save Changes"]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:[e.jsx(x,{path:ge,size:.9}),"Cancel"]})]})]})}function ce({title:s,children:g}){return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:s}),e.jsx("div",{className:"space-y-3",children:g})]})}function v({label:s,value:g,children:w}){return e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:s}),w||e.jsx("div",{className:"text-gray-900",children:g||"—"})]})}function R({label:s,value:g,onChange:w,type:_="text",...m}){const d=_==="color"&&!g?"#000000":g||"";return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s}),e.jsx("input",{type:_,value:d,"aria-label":s,onChange:M=>w(M.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",...m})]})}function ts({label:s,value:g,onChange:w}){return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s}),e.jsx("textarea",{value:g||"",onChange:_=>w(_.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}export{us as default};
