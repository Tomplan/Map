import{u as lt,r as c,K as it,j as e,I as M,af as ot,ag as ct,ah as ze,a2 as Le,W as Pe,m as Ee,f as Ae,h as _e,c as $e,ai as Be,k as Ie,s as ne,b as dt,aj as ht}from"./index-88c468a1.js";import{P as ut}from"./ProtectedSection-687e6961.js";import{g as pe,E as pt,h as gt}from"./EventMap-88366bfb.js";import{u as xt}from"./useUserRole-726132eb.js";import{u as mt}from"./useEventSubscriptions-05109fa6.js";import{u as bt}from"./useAssignments-0e92d496.js";import"./useTranslatedCompanyInfo-76174797.js";import"./useCategories-83124c03.js";import"./index-3c91842c.js";import"./useEventMapSettings-a955d3d2.js";import"./phone-376c158e.js";function _t({markersState:s,setMarkersState:g,updateMarker:b,selectedYear:d,archiveMarkers:R,copyMarkers:h}){var Ce,Me;const{t:f}=lt(),{isEventManager:ae,isSystemManager:re,isSuperAdmin:i}=xt(),[J,Re]=c.useState(""),[L,H]=c.useState(null),[Q,W]=c.useState(!1),[p,O]=c.useState(null),[le,De]=c.useState("id"),[X,Ue]=c.useState("asc"),[k,ge]=c.useState([]),{confirm:xe,toastError:Z,toastSuccess:me}=it(),[A,Te]=c.useState(null),[be,ie]=c.useState(!1),[fe,Fe]=c.useState([]),[He,Y]=c.useState(!1),[D,ye]=c.useState(!1),[G,We]=c.useState(!0),[Oe,ke]=c.useState(384),[Ge,Ve]=c.useState(384),[ve,qe]=c.useState(.5),[je,Je]=c.useState(.4),[j,K]=c.useState(null),{subscriptions:y,loading:Xe}=mt(d),{assignments:w}=bt(d),[ee,Ke]=c.useState(""),[oe,Qe]=c.useState("assigned"),[U,Ze]=c.useState("asc"),[V,_]=c.useState(null),te=c.useMemo(()=>{if(!y)return[];let t=[...y];if(ee){const a=ee.toLowerCase();t=t.filter(n=>{var l;return(((l=n.company)==null?void 0:l.name)||"").toLowerCase().includes(a)})}return t.sort((a,n)=>{var o,u,C,S;let r,l;switch(oe){case"name":return r=((o=a.company)==null?void 0:o.name)||"",l=((u=n.company)==null?void 0:u.name)||"",U==="asc"?(r||"").localeCompare(l||""):(l||"").localeCompare(r||"");case"booths":return r=a.booth_count||0,l=n.booth_count||0,U==="asc"?r-l:l-r;case"assigned":{const T=I=>{const $=w==null?void 0:w.find(ue=>{var z;return ue.company_id===((z=I.company)==null?void 0:z.id)});return $?$.marker_id||999999:-1},B=T(a),E=T(n);return B===E?(((C=a.company)==null?void 0:C.name)||"").localeCompare(((S=n.company)==null?void 0:S.name)||""):U==="asc"?B-E:E-B}}})},[y,w,ee,oe,U]),P=c.useMemo(()=>y==null?void 0:y.find(t=>t.id===V),[y,V]);c.useEffect(()=>{const t=n=>{if(j){if(n.preventDefault(),j==="left"){const r=Math.max(250,Math.min(800,n.clientX));ke(r)}else if(j==="right"){const r=Math.max(200,Math.min(600,window.innerWidth-n.clientX));Ve(r)}else if(j==="split-left"){const l=window.innerHeight-144,u=(n.clientY-144)/l,C=Math.max(.2,Math.min(.8,u));qe(C)}else if(j==="split-right"){const l=window.innerHeight-144,u=(n.clientY-144)/l,C=Math.max(.2,Math.min(.8,u));Je(C)}}},a=()=>{j&&(K(null),document.body.style.cursor="default",document.body.style.userSelect="")};return j&&(window.addEventListener("mousemove",t),window.addEventListener("mouseup",a),document.body.style.userSelect="none",document.body.style.cursor=j.startsWith("split")?"row-resize":"col-resize"),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",a),document.body.style.userSelect="",document.body.style.cursor="default"}},[j]);const N=ae;c.useEffect(()=>{async function t(){try{const[a,n]=await Promise.all([ne.from("markers_core").select("*").in("id",[-1,-2]).eq("event_year",0),ne.from("markers_appearance").select("*").in("id",[-1,-2]).eq("event_year",0)]);if(a.error)throw a.error;if(n.error)throw n.error;const r=(a.data||[]).map(l=>{const o=(n.data||[]).find(u=>u.id===l.id)||{};return{...l,...o}});ge(r)}catch(a){console.error("Error fetching default markers:",a)}}t()},[]);const we=c.useMemo(()=>{if(!s)return k;const a=[...s.filter(n=>{var l,o;const r=J.toLowerCase();return n.id.toString().includes(r)||((l=n.glyph)==null?void 0:l.toLowerCase().includes(r))||((o=n.name)==null?void 0:o.toLowerCase().includes(r))})].sort((n,r)=>{let l=0;switch(le){case"id":l=n.id-r.id;break;case"name":l=(n.glyph||n.name||"").localeCompare(r.glyph||r.name||"");break;case"type":n.id>=1e3!=r.id>=1e3?l=n.id>=1e3?-1:1:l=n.id-r.id;break;default:l=n.id-r.id}return X==="desc"?-l:l});return J?a:[...[...k].sort((r,l)=>l.id-r.id),...a]},[s,k,J,le,X]),x=c.useMemo(()=>{if(!L)return null;const t=k.find(a=>a.id===L);return t||(s==null?void 0:s.find(a=>a.id===L))},[L,s,k]),Ye=t=>{if(L===t.id)H(null),_(null);else{H(t.id);const a=w==null?void 0:w.find(n=>n.marker_id===t.id);if(a){const n=y==null?void 0:y.find(r=>r.company_id===a.company_id);_(n?n.id:null)}else _(null)}W(!1)},et=()=>{x&&(O({...x}),W(!0))},tt=()=>{O(null),W(!1)},st=async()=>{if(!p)return;const t=p.id===-1||p.id===-2;try{if(t){const a={rectWidth:p.rectWidth,rectHeight:p.rectHeight},n={iconUrl:p.iconUrl,iconSize:p.iconSize,glyphColor:p.glyphColor,glyphSize:p.glyphSize,shadowScale:p.shadowScale},[r,l]=await Promise.all([ne.from("markers_core").update(a).eq("id",p.id).eq("event_year",0),ne.from("markers_appearance").update(n).eq("id",p.id).eq("event_year",0)]);if(r.error)throw r.error;if(l.error)throw l.error;ge(o=>o.map(u=>u.id===p.id?{...u,...p}:u))}else{const a={};if(Object.keys(p).forEach(n=>{p[n]!==x[n]&&(a[n]=p[n])}),Object.keys(a).length===0){W(!1),O(null);return}g(n=>n.map(r=>r.id===p.id?{...r,...p}:r)),await b(p.id,a)}W(!1),O(null)}catch(a){console.error("Error saving marker:",a),Z("Failed to save marker. Please try again.")}},nt=(t,a)=>{O(n=>({...n,[t]:a}))},at=async()=>{if(N||!await xe({title:"Archive Markers",message:`Archive all markers for ${d}? This will move them to the archive and clear the current year.`,confirmText:"Archive",variant:"warning"}))return;const{error:a}=await R();a?Z(`Error archiving markers: ${a}`):me(`Successfully archived markers for ${d}`)},Ne=async()=>{if(N)return;const t=d-1;if(!await xe({title:"Copy Markers",message:`Copy all markers from ${t} to ${d}?`,confirmText:"Copy",variant:"default"}))return;const{error:n}=await h(t);n?Z(`Error copying markers: ${n}`):me(`Markers copied from ${t} to ${d}`)},rt=async t=>{var B,E,I;if(!A||!A.printControl||!t)return;Y(!0);const a=A.printControl,n=(a==null?void 0:a.browserPrint)||a;let r=null,l=!1,o=!1;const u=()=>{if(!A||!(window.L&&window.L.BrowserPrint&&window.L.BrowserPrint.Event))return;const $=window.L.BrowserPrint.Event;try{A.off($.PrintStart,C),A.off($.PrintEnd,S),A.off($.PrintCancel,T)}catch{}r&&(clearTimeout(r),r=null)},C=()=>{l=!0},S=()=>{o=!0,u()},T=()=>{o=!0,u()};try{if(window.L&&window.L.BrowserPrint&&window.L.BrowserPrint.Event){const z=window.L.BrowserPrint.Event;A.on(z.PrintStart,C),A.on(z.PrintEnd,S),A.on(z.PrintCancel,T)}try{if(typeof n.print=="function")n.print(t);else if(typeof(a==null?void 0:a._printMode)=="function")a._printMode(t);else throw new Error("No browser print API available")}catch(z){console.warn("Header BrowserPrint call failed:",z),u();const F=((B=t==null?void 0:t.title)==null?void 0:B.toLowerCase().includes("landscape"))||((E=t==null?void 0:t.name)==null?void 0:E.toLowerCase().includes("landscape"));console.info(`[MapPrint] Fallback triggered. Configuration: ${F?"Landscape":"Portrait"}`),alert("Browser print failed. Falling back to snapshot print (popup window). Verify the orientation in the dialog."),await ce({orientation:F?"landscape":"portrait"});return}if(await(()=>new Promise(z=>{if(l)return z("started");r=setTimeout(()=>z("timeout"),8e3);const F=setInterval(()=>{(l||o)&&(clearInterval(F),r&&(clearTimeout(r),r=null),z(l?"started":"finished"))},80)}))()==="timeout"){console.warn("Header BrowserPrint did not start; falling back to snapshot export"),u();const F=((t==null?void 0:t.title)||((I=t==null?void 0:t.options)==null?void 0:I.title)||(t==null?void 0:t.name)||"").toLowerCase().includes("landscape");console.info(`[MapPrint] Fallback triggered. Configuration: ${F?"Landscape":"Portrait"}`),alert("Browser print timed out. Falling back to snapshot print (popup window). Verify the orientation in the dialog."),await ce({orientation:F?"landscape":"portrait"})}}finally{Y(!1)}},ce=async(t={})=>{if(!He){Y(!0);try{const a=document.querySelector("#map-container")||document.querySelector(".leaflet-container");if(!a)return;await new Promise(I=>setTimeout(I,400));const r=(await gt(a,{useCORS:!0,allowTaint:!0,logging:!1,backgroundColor:"#ffffff",scale:2,ignoreElements:I=>{var $;return($=I.classList)==null?void 0:$.contains("map-controls-print-hide")}})).toDataURL("image/png",1),l=window.open("","_blank","width=900,height=700");if(!l){alert("Popup blocked! Please allow popups for map printing.");return}const o=l.document;o.open();const u=o.createElement("head"),C=o.createElement("title");C.textContent="Map Print";const S=o.createElement("style"),T=t.orientation==="landscape"?"landscape":"portrait";S.textContent=`
        * { margin: 0; padding: 0 }
        body { 
          display: flex; 
          justify-content: center; 
          align-items: center; 
          min-height: 100vh; 
          background: white 
        }
        img { 
          max-width: 100%; 
          max-height: 100vh; 
          object-fit: contain 
        }
        @media print { 
          @page { size: ${T}; margin: 0; }
          img { width: 100%; height: auto } 
          body { 
            display: block !important; 
            margin: 0 !important;
            padding: 0 !important;
            height: 100% !important;
          }
        }
      `,u.appendChild(C),u.appendChild(S);const B=o.createElement("body"),E=o.createElement("img");for(E.src=r,E.alt="Map",E.onload=()=>setTimeout(()=>{try{l.print()}catch{}},100),B.appendChild(E),o.documentElement||o.appendChild(o.createElement("html"));o.documentElement.firstChild;)o.documentElement.removeChild(o.documentElement.firstChild);o.documentElement.appendChild(u),o.documentElement.appendChild(B),o.close(),l.document.close(),l.onafterprint=()=>l.close()}catch(a){console.error("Snapshot print failed:",a);try{Z("Snapshot failed — map tiles may be blocked by CORS or the service worker. Use the Print Map plugin preset or enable CORS for your tile provider.")}catch{}window.print()}finally{Y(!1)}}},se=x&&(x.id===-1||x.id===-2),de=x&&x.id>=1e3,he=x&&x.id>0&&x.id<1e3,Se=t=>{const a=k.find(r=>r.id===(t?-1:-2));if(!(a!=null&&a.iconUrl))return t?"Blue (assigned)":"Gray (unassigned)";const n=a.iconUrl.match(/glyph-marker-icon-(\w+)\.svg/);return n?`${n[1].charAt(0).toUpperCase()+n[1].slice(1)} (${t?"assigned":"unassigned"})`:t?"Blue (assigned)":"Gray (unassigned)"};return e.jsx(ut,{requiredRole:["super_admin","system_manager","event_manager"],children:e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"p-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:N?"Event Map Viewer":f("mapManagement.title")}),e.jsx("div",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:d})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>ie(t=>!t),className:`flex items-center gap-2 px-4 py-2 ${N?"bg-gray-600 text-white hover:bg-gray-700":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"} rounded-lg`,title:"Print map","aria-haspopup":"menu","aria-expanded":be,children:[e.jsx(M,{path:ot,size:.8}),"Print Map"]}),be&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg z-40 overflow-hidden border border-gray-200",children:fe.length>0?e.jsx("div",{className:"py-1",children:fe.map((t,a)=>{var n,r;return e.jsx("button",{type:"button",onClick:async()=>{ie(!1),await rt(t)},className:"w-full text-left px-4 py-2 text-gray-900 hover:bg-gray-50 transition-colors",children:((n=t==null?void 0:t.options)==null?void 0:n.title)||((r=t==null?void 0:t.options)==null?void 0:r.pageSize)||`Preset ${a+1}`},a)})}):e.jsx("div",{className:"py-1",children:e.jsx("button",{type:"button",onClick:async()=>{ie(!1),await ce()},className:"w-full text-left px-4 py-2 text-gray-900 hover:bg-gray-50 transition-colors",children:"Snapshot (PNG)"})})})]}),!N&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Ne,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",title:`Copy markers from ${d-1}`,children:[e.jsx(M,{path:ct,size:.8}),"Copy from ",d-1]}),e.jsxs("button",{onClick:at,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:((s==null?void 0:s.length)||0)===0,title:`Archive all markers for ${d}`,children:[e.jsx(M,{path:ze,size:.8}),"Archive ",d]})]})]})]}),we.length===0&&!J&&e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:["No Markers Found for ",d]}),e.jsx("p",{className:"text-blue-700 mb-4",children:N?`There are no markers configured for ${d}. Please contact your system administrator.`:`There are no markers configured for ${d}. You can copy markers from the previous year or create new ones.`}),!N&&e.jsxs("button",{onClick:Ne,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:["Copy from ",d-1]})]})}),!N&&e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("button",{onClick:()=>ye(!D),className:`p-1 rounded-lg border transition-colors ${D?"bg-blue-50 border-blue-200 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,title:D?"Hide Markers & Details":"Show Markers & Details",children:e.jsx(M,{path:D?Le:Pe,size:.8})}),e.jsx("button",{onClick:()=>We(!G),className:`p-1 rounded-lg border transition-colors ${G?"bg-blue-50 border-blue-200 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,title:G?"Hide Subscriptions List":"Show Subscriptions List",children:e.jsx(M,{path:G?Pe:Le,size:.8})})]})]}),e.jsxs("div",{className:"flex h-[calc(100vh-120px)] relative",children:[!N&&e.jsxs("div",{className:`border-r border-gray-200 overflow-hidden flex-shrink-0 bg-white flex flex-col relative ${!D&&"border-r-0"}`,style:{width:D?Oe:0,transition:j==="left"?"none":"width 0.3s ease-in-out"},children:[e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-400 z-50 active:bg-blue-600 transition-colors",onMouseDown:()=>K("left")}),e.jsx("div",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider px-3 py-2 bg-white sticky top-0 z-10",children:"Markers List"}),e.jsxs("div",{className:"p-3 border-b border-gray-200 bg-gray-50 flex flex-col gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(M,{path:Ee,size:.8,className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:f("mapManagement.searchPlaceholder"),value:J,onChange:t=>Re(t.target.value),className:"w-full pl-8 pr-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md shadow-sm bg-white",children:[e.jsxs("select",{value:le,onChange:t=>De(t.target.value),className:"flex-1 pl-2 pr-2 py-1.5 border-0 rounded-l-md bg-white text-gray-900 text-xs focus:ring-0 appearance-none min-w-0","aria-label":f("mapManagement.sortBy"),children:[e.jsx("option",{value:"id",children:f("mapManagement.sortId")}),e.jsx("option",{value:"name",children:f("mapManagement.sortName")}),e.jsx("option",{value:"type",children:f("mapManagement.sortType")})]}),e.jsxs("button",{type:"button",onClick:()=>Ue(X==="asc"?"desc":"asc"),"aria-label":`Toggle sort direction to ${X==="asc"?"descending":"ascending"}`,className:"px-2 py-1.5 border-l border-gray-300 text-gray-500 hover:bg-gray-50 rounded-r-md text-xs",children:[e.jsx(M,{path:X==="asc"?Ae:_e,size:.7}),e.jsx("span",{className:"sr-only",children:"Sort"})]})]})]}),e.jsx("div",{className:"w-full overflow-y-auto p-2 border-b border-gray-200 relative scrollbar-hide",style:{height:L?`calc(${ve*100}% - 146px)`:"calc(100% - 146px)",transition:j?"none":"height 0.3s ease-in-out"},children:we.map(t=>{const a=t.id===L,n=t.id===-1||t.id===-2;return t.id>=1e3,e.jsx("button",{onClick:()=>Ye(t),className:`w-full text-left p-2 rounded-lg mb-1 transition-colors ${a?"bg-blue-50 border-2 border-blue-500":n?"bg-amber-50 border-2 border-amber-300 hover:bg-amber-100":"bg-white border border-gray-200 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.iconUrl?e.jsx("div",{className:"relative",children:e.jsx("img",{src:pe(t.iconUrl),alt:"icon",className:"w-5 h-5"})}):e.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded flex items-center justify-center text-[10px] text-gray-600",children:"D"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-sm text-gray-900 truncate",children:n?t.id===-1?"Assigned Booth":"Unassigned Booth":t.glyph||`Marker ${t.id}`}),e.jsxs("span",{className:"text-xs text-gray-400 font-mono ml-2",children:["#",t.id]})]}),t.name&&e.jsx("div",{className:"text-xs text-gray-500 truncate",children:t.name})]})]})},t.id)})}),L&&e.jsx("div",{className:"w-full h-1 cursor-row-resize bg-gray-200 hover:bg-blue-400 z-50 active:bg-blue-600 transition-colors",onMouseDown:()=>K("split-left")}),L&&e.jsx("div",{className:"w-full overflow-y-auto p-6 bg-gray-50/50 flex-shrink-0",style:{height:`${(1-ve)*100}%`,transition:j?"none":"height 0.3s ease-in-out"},children:x?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:se?x.id===-1?"Assigned Booth Default":"Unassigned Booth Default":x.glyph||`Marker ${x.id}`}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",x.id,se&&" ⚙️ Global Default for Booth Markers",de&&" (Special Marker)",he&&" (Booth - Content managed via Companies/Assignments)"]})]}),!Q&&!N&&e.jsx("button",{onClick:et,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Edit"})]}),Q?e.jsx(yt,{marker:p,isDefaultMarker:se,isSpecialMarker:de,isBoothMarker:he,getDefaultColorName:Se,onChange:nt,onSave:st,onCancel:tt}):e.jsx(ft,{marker:x,isSpecialMarker:de,isDefaultMarker:se,isBoothMarker:he,getDefaultColorName:Se})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:f("mapManagement.selectMarker")})})]}),e.jsx("div",{className:"flex-1 relative bg-gray-50 flex flex-col",children:e.jsx(pt,{isAdminView:!0,previewUseVisitorSizing:!0,markersState:s,updateMarker:N?null:b,selectedYear:d,selectedMarkerId:L,editMode:!N&&Q,onMarkerSelect:t=>{if(H(t),N||W(!1),D||ye(!0),t){const a=w==null?void 0:w.find(n=>n.marker_id===t);if(a){const n=y==null?void 0:y.find(r=>r.company_id===a.company_id);_(n?n.id:null)}else _(null)}else _(null)},onMarkerDrag:(t,a,n)=>{!N&&Q&&L===t&&O(r=>({...r,lat:a,lng:n}))},onMapReady:t=>{var n,r;Te(t);const a=((r=(n=t==null?void 0:t.printControl)==null?void 0:n.options)==null?void 0:r.printModes)||[];Fe(Array.isArray(a)?a:[])}})}),!N&&e.jsxs("div",{className:`border-l border-gray-200 overflow-hidden flex-shrink-0 bg-white relative flex flex-col ${!G&&"border-l-0"}`,style:{width:G?Ge:0,transition:j==="right"?"none":"width 0.3s ease-in-out"},children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-400 z-50 active:bg-blue-600 transition-colors",onMouseDown:()=>K("right")}),e.jsxs("div",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider px-3 py-2 bg-white sticky top-0 z-10 flex justify-between items-center",children:[e.jsx("span",{children:"Subscription List"}),e.jsx("span",{className:"text-[10px] font-normal",children:(()=>!y||!w?"0 / 0":`${y.filter(a=>w.some(n=>n.company_id===a.company_id)).length} / ${y.length}`)()})]}),e.jsxs("div",{className:"p-3 border-b border-gray-200 bg-gray-50 flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx(M,{path:Ee,size:.8,className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search company...",value:ee,onChange:t=>Ke(t.target.value),className:"w-full pl-8 pr-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md shadow-sm bg-white",children:[e.jsxs("select",{value:oe,onChange:t=>Qe(t.target.value),className:"flex-1 pl-2 pr-2 py-1.5 border-0 rounded-l-md bg-white text-gray-900 text-xs focus:ring-0 appearance-none min-w-0","aria-label":"Sort subscriptions by",children:[e.jsx("option",{value:"name",children:"Sort by Company"}),e.jsx("option",{value:"booths",children:"Sort by Booths"}),e.jsx("option",{value:"assigned",children:"Sort by Assigned"})]}),e.jsxs("button",{type:"button",onClick:()=>Ze(U==="asc"?"desc":"asc"),"aria-label":`Toggle sort direction to ${U==="asc"?"descending":"ascending"}`,className:"px-2 py-1.5 border-l border-gray-300 text-gray-500 hover:bg-gray-50 rounded-r-md text-xs",children:[e.jsx(M,{path:U==="asc"?Ae:_e,size:.7}),e.jsx("span",{className:"sr-only",children:"Sort"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 relative",children:[e.jsx("div",{className:"overflow-y-auto w-full",style:{height:V?`${je*100}%`:"100%",transition:j?"none":"height 0.3s ease-in-out"},children:Xe?e.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:"Loading..."}):(te==null?void 0:te.length)===0?e.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:"No subscriptions"}):te.map(t=>{const a=V===t.id,n=t.company||{},r=w==null?void 0:w.find(S=>S.company_id===n.id),l=!!r,o=r==null?void 0:r.marker_id,u=s==null?void 0:s.find(S=>S.id===o),C=u?`Booth ${u.id}`:"Assigned";return e.jsxs("button",{onClick:()=>{const S=a?null:t.id;_(S),H(S&&o?o:null)},className:`w-full text-left p-3 border-b border-gray-100 hover:bg-gray-50 transition-colors flex items-center gap-3 ${a?"bg-blue-50 border-l-4 border-l-blue-500 pl-[11px]":""}`,children:[e.jsx("div",{className:"w-8 h-8 flex-shrink-0 bg-white border border-gray-200 rounded flex items-center justify-center overflow-hidden",children:n.logo?e.jsx("img",{src:$e(n.logo),alt:n.name,className:"w-full h-full object-contain"}):e.jsx(M,{path:ze,size:.6,className:"text-gray-300"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:n.name||"Unknown Company"}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[l?e.jsxs("span",{className:"text-green-600 flex items-center gap-0.5",children:[e.jsx(M,{path:Be,size:.5})," ",C]}):e.jsx("span",{className:"text-orange-500",children:"Unassigned"}),t.booth_count>0&&e.jsxs("span",{children:["• ",t.booth_count," ",t.booth_count===1?"booth":"booths"]})]})]})]},t.id)})}),V&&e.jsx("div",{className:"w-full h-1 cursor-row-resize bg-gray-200 hover:bg-blue-400 z-50 active:bg-blue-600 transition-colors flex-shrink-0",onMouseDown:()=>K("split-right")}),V&&e.jsx("div",{className:"w-full overflow-y-auto p-4 bg-gray-50/50 border-t border-gray-200",style:{height:`${(1-je)*100}%`,transition:j?"none":"height 0.3s ease-in-out"},children:P?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Subscription Details"}),e.jsx("button",{onClick:()=>{_(null),H(null)},className:"text-gray-400 hover:text-gray-600",title:"Close details",children:e.jsx(M,{path:Ie,size:.8})})]}),e.jsx("div",{className:"bg-white p-3 rounded border border-gray-200 shadow-sm text-left",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-left",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-0.5 text-left",children:"Company"}),e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate text-left",title:(Ce=P.company)==null?void 0:Ce.name,children:((Me=P.company)==null?void 0:Me.name)||"Unknown"})]}),e.jsxs("div",{className:"col-span-2 text-left",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-0.5 text-left",children:"Booths"}),e.jsx("div",{className:"text-sm text-gray-900 text-left",children:P.booth_count||0})]}),e.jsxs("div",{className:"col-span-2 text-left",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-0.5 text-left",children:"Coins"}),e.jsx("div",{className:"text-sm text-gray-900 text-left",children:P.coins||0})]}),e.jsxs("div",{className:"col-span-2 text-left",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-0.5 text-left",children:"Meals (Saturday)"}),e.jsxs("div",{className:"text-xs text-gray-700 flex gap-3 text-left",children:[e.jsxs("span",{children:["Breakfast: ",e.jsx("span",{className:"font-medium text-gray-900",children:P.breakfast_sat||0})]}),e.jsxs("span",{children:["Lunch: ",e.jsx("span",{className:"font-medium text-gray-900",children:P.lunch_sat||0})]}),e.jsxs("span",{children:["BBQ: ",e.jsx("span",{className:"font-medium text-gray-900",children:P.bbq_sat||0})]})]})]}),e.jsxs("div",{className:"col-span-2 text-left",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-0.5 text-left",children:"Meals (Sunday)"}),e.jsxs("div",{className:"text-xs text-gray-700 flex gap-3 text-left",children:[e.jsxs("span",{children:["Breakfast: ",e.jsx("span",{className:"font-medium text-gray-900",children:P.breakfast_sun||0})]}),e.jsxs("span",{children:["Lunch: ",e.jsx("span",{className:"font-medium text-gray-900",children:P.lunch_sun||0})]})]})]}),e.jsxs("div",{className:"col-span-2 text-left",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase block mb-0.5 text-left",children:"Notes"}),e.jsx("div",{className:"text-xs bg-gray-50 p-2 rounded text-gray-600 whitespace-pre-wrap min-h-[3rem] border border-gray-100 text-left",children:P.notes||e.jsx("span",{className:"text-gray-400 italic",children:"No notes"})})]})]})})]}):e.jsx("div",{className:"text-center text-gray-400 py-4",children:"Select a subscription"})})]})]})]})]})})}function ft({marker:s,isSpecialMarker:g,isDefaultMarker:b,isBoothMarker:d,getDefaultColorName:R}){var h;return e.jsxs("div",{className:"space-y-6",children:[b&&e.jsxs("div",{className:"bg-amber-50 border-2 border-amber-300 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-amber-900 mb-2",children:"ℹ️ About Default Markers"}),e.jsx("p",{className:"text-sm text-amber-800 mb-2",children:s.id===-1?"This defines the default appearance for booth markers (ID < 1000) that have a company assigned.":"This defines the default appearance for booth markers (ID < 1000) that have no company assigned."}),e.jsx("p",{className:"text-sm text-amber-800",children:"Individual booth markers can override these defaults by having their own values in the Appearance table."})]}),!b&&e.jsxs(q,{title:"Position & Structure",children:[e.jsx(m,{label:"Latitude",value:s.lat}),e.jsx(m,{label:"Longitude",value:s.lng}),e.jsx(m,{label:"Rectangle",value:JSON.stringify(s.rectangle)}),e.jsx(m,{label:"Angle",value:s.angle||0})]}),e.jsxs(q,{title:b?"Default Visual Styling":"Visual Styling",children:[e.jsx(m,{label:"Icon",children:s.iconUrl?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:pe(s.iconUrl),alt:"icon",className:"w-8 h-8"}),e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"Custom Color"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded flex items-center justify-center text-[9px] text-gray-600 font-medium leading-none",children:"Default"}),e.jsx("span",{className:"text-xs text-blue-600 font-medium",children:d?R(((h=s.assignments)==null?void 0:h.length)>0):"Based on marker type"})]})}),e.jsx(m,{label:"Icon Size",value:JSON.stringify(s.iconSize)}),!b&&e.jsx(m,{label:"Glyph (Booth Label)",value:s.glyph}),e.jsx(m,{label:"Glyph Color",value:s.glyphColor}),e.jsx(m,{label:"Glyph Size",value:s.glyphSize}),e.jsx(m,{label:"Glyph Anchor",value:s.glyphAnchor?JSON.stringify(s.glyphAnchor):"—"}),e.jsx(m,{label:"Shadow Scale",value:s.shadowScale??"1.0"}),b&&e.jsxs(e.Fragment,{children:[e.jsx(m,{label:"Rectangle Width",value:s.rectWidth}),e.jsx(m,{label:"Rectangle Height",value:s.rectHeight})]})]}),g&&e.jsxs(q,{title:"Content (Special Marker)",children:[e.jsx(m,{label:"Name",value:s.name}),e.jsx(m,{label:"Logo",children:s.logo&&e.jsx("img",{...(()=>{const f=dt(s.logo);return f?{src:f.src,srcSet:f.srcSet,sizes:f.sizes}:{src:$e(s.logo)}})(),alt:"logo",className:"w-12 h-12"})}),e.jsx(m,{label:"Website",value:s.website}),e.jsx(m,{label:"Info",value:s.info})]})]})}function yt({marker:s,isDefaultMarker:g,isSpecialMarker:b,isBoothMarker:d,getDefaultColorName:R,onChange:h,onSave:f,onCancel:ae}){var re;return e.jsxs("div",{className:"space-y-6",children:[g&&e.jsxs("div",{className:"bg-amber-50 border-2 border-amber-300 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-amber-900 mb-2",children:"⚙️ Editing Global Defaults"}),e.jsx("p",{className:"text-sm text-amber-800 mb-2",children:s.id===-1?"Changes here will affect all booth markers (ID < 1000) that have a company assigned, unless they have individual overrides.":"Changes here will affect all booth markers (ID < 1000) that have no company assigned, unless they have individual overrides."})]}),!g&&e.jsxs(q,{title:"Position & Structure",children:[e.jsx(v,{label:"Latitude",type:"number",step:"0.0001",value:s.lat,onChange:i=>h("lat",parseFloat(i))}),e.jsx(v,{label:"Longitude",type:"number",step:"0.0001",value:s.lng,onChange:i=>h("lng",parseFloat(i))}),e.jsx(v,{label:"Angle",type:"number",step:"0.1",value:s.angle||0,onChange:i=>h("angle",parseFloat(i))})]}),e.jsxs(q,{title:g?"Default Visual Styling":"Visual Styling",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Icon"}),e.jsxs("div",{className:"grid grid-cols-6 gap-2",children:[e.jsx("button",{onClick:()=>h("iconUrl",null),className:`w-10 h-10 border-2 rounded-lg transition-all flex items-center justify-center ${s.iconUrl?"border-gray-200 hover:border-gray-400":"border-blue-500 bg-blue-50"}`,title:"Use default color based on assignment status",children:e.jsx("div",{className:"text-[9px] text-gray-600 font-medium leading-none",children:"Default"})}),ht.map(i=>e.jsx("button",{onClick:()=>h("iconUrl",i),className:`p-2 border-2 rounded-lg transition-all ${s.iconUrl===i?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-400"}`,children:e.jsx("img",{src:pe(i),alt:i,className:"w-8 h-8"})},i))]}),s.iconUrl?e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Using custom color override"}):e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Using default color:"," ",d?R(((re=s.assignments)==null?void 0:re.length)>0):"Based on marker type"]})]}),!g&&e.jsx(v,{label:"Glyph (Booth Label)",value:s.glyph,onChange:i=>h("glyph",i)}),e.jsx(v,{label:"Glyph Color",type:"color",value:s.glyphColor,onChange:i=>h("glyphColor",i)}),e.jsx(v,{label:"Glyph Size",type:"number",step:"0.01",value:s.glyphSize,onChange:i=>h("glyphSize",parseFloat(i))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(v,{label:"Glyph Anchor X",type:"number",step:"0.01",value:s.glyphAnchor?s.glyphAnchor[0]:"",onChange:i=>h("glyphAnchor",[parseFloat(i)||0,s.glyphAnchor&&s.glyphAnchor[1]||0])}),e.jsx(v,{label:"Glyph Anchor Y",type:"number",step:"0.01",value:s.glyphAnchor?s.glyphAnchor[1]:"",onChange:i=>h("glyphAnchor",[s.glyphAnchor&&s.glyphAnchor[0]||0,parseFloat(i)||0])})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(v,{label:"Icon Width",type:"number",step:"0.01",value:s.iconSize?s.iconSize[0]:"",onChange:i=>h("iconSize",[parseFloat(i)||null,s.iconSize?s.iconSize[1]:null])}),e.jsx(v,{label:"Icon Height",type:"number",step:"0.01",value:s.iconSize?s.iconSize[1]:"",onChange:i=>h("iconSize",[s.iconSize?s.iconSize[0]:null,parseFloat(i)||null])})]}),e.jsx(v,{label:"Shadow Scale",type:"number",step:"0.01",value:s.shadowScale??1,onChange:i=>h("shadowScale",parseFloat(i))}),g&&e.jsxs(e.Fragment,{children:[e.jsx(v,{label:"Rectangle Width",type:"number",step:"1",value:s.rectWidth,onChange:i=>h("rectWidth",parseFloat(i))}),e.jsx(v,{label:"Rectangle Height",type:"number",step:"1",value:s.rectHeight,onChange:i=>h("rectHeight",parseFloat(i))})]})]}),b&&e.jsxs(q,{title:"Content (Special Marker)",children:[e.jsx(v,{label:"Name",value:s.name,onChange:i=>h("name",i)}),e.jsx(v,{label:"Logo URL",value:s.logo,onChange:i=>h("logo",i)}),e.jsx(v,{label:"Website",value:s.website,onChange:i=>h("website",i)}),e.jsx(vt,{label:"Info",value:s.info,onChange:i=>h("info",i)})]}),d&&e.jsx(e.Fragment,{}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(M,{path:Be,size:.9}),"Save Changes"]}),e.jsxs("button",{onClick:ae,className:"flex items-center gap-2 px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:[e.jsx(M,{path:Ie,size:.9}),"Cancel"]})]})]})}function q({title:s,children:g}){return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:s}),e.jsx("div",{className:"space-y-3",children:g})]})}function m({label:s,value:g,children:b}){return e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:s}),b||e.jsx("div",{className:"text-gray-900",children:g||"—"})]})}function v({label:s,value:g,onChange:b,type:d="text",...R}){const h=d==="color"&&!g?"#000000":g||"";return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s}),e.jsx("input",{type:d,value:h,"aria-label":s,onChange:f=>b(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",...R})]})}function vt({label:s,value:g,onChange:b}){return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s}),e.jsx("textarea",{value:g||"",onChange:d=>b(d.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}export{_t as default};
