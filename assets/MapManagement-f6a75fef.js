import{u as Ue,r as u,K as Be,j as e,I as C,af as Fe,ag as Te,ah as Oe,a2 as ge,W as be,m as We,f as He,h as _e,s as X,b as Ge,c as Ve,ai as qe,aj as Je,k as Xe}from"./index-46614b82.js";import{P as Ke}from"./ProtectedSection-94353d94.js";import{g as ne,E as Qe,h as Ze}from"./EventMap-765a8dc2.js";import{u as ke}from"./useUserRole-c53ac747.js";import"./useTranslatedCompanyInfo-8c47251e.js";import"./useCategories-9d60fc56.js";import"./useEventSubscriptions-b7366f1a.js";import"./phone-376c158e.js";import"./useAssignments-0e67e352.js";import"./index-b6ca1180.js";import"./useEventMapSettings-7ce90ec5.js";function pt({markersState:s,setMarkersState:p,updateMarker:x,selectedYear:d,archiveMarkers:M,copyMarkers:c}){const{t:m}=Ue(),{isEventManager:K,isSystemManager:Q,isSuperAdmin:i}=ke(),[F,xe]=u.useState(""),[j,Z]=u.useState(null),[H,$]=u.useState(!1),[h,D]=u.useState(null),[k,me]=u.useState("id"),[T,fe]=u.useState("asc"),[R,ae]=u.useState([]),{confirm:re,toastError:_,toastSuccess:ie}=Be(),[N,ye]=u.useState(null),[le,Y]=u.useState(!1),[oe,ve]=u.useState([]),[we,G]=u.useState(!1),[P,ce]=u.useState(!0),[U,je]=u.useState(!1),[Ne,Se]=u.useState(384),[Ce,Me]=u.useState(256),[de,Pe]=u.useState(.5),[w,V]=u.useState(null);u.useEffect(()=>{const t=a=>{if(w){if(a.preventDefault(),w==="left"){const r=Math.max(250,Math.min(800,a.clientX));Se(r)}else if(w==="right"){const r=Math.max(200,Math.min(600,window.innerWidth-a.clientX));Me(r)}else if(w==="split"){const l=window.innerHeight-144,f=(a.clientY-144)/l,E=Math.max(.2,Math.min(.8,f));Pe(E)}}},n=()=>{w&&(V(null),document.body.style.cursor="default",document.body.style.userSelect="")};return w&&(window.addEventListener("mousemove",t),window.addEventListener("mouseup",n),document.body.style.userSelect="none",document.body.style.cursor=w==="split"?"row-resize":"col-resize"),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",n),document.body.style.userSelect="",document.body.style.cursor="default"}},[w]);const v=K;u.useEffect(()=>{async function t(){try{const[n,a]=await Promise.all([X.from("markers_core").select("*").in("id",[-1,-2]).eq("event_year",0),X.from("markers_appearance").select("*").in("id",[-1,-2]).eq("event_year",0)]);if(n.error)throw n.error;if(a.error)throw a.error;const r=(n.data||[]).map(l=>{const o=(a.data||[]).find(f=>f.id===l.id)||{};return{...l,...o}});ae(r)}catch(n){console.error("Error fetching default markers:",n)}}t()},[]);const he=u.useMemo(()=>{if(!s)return R;const n=[...s.filter(a=>{var l,o;const r=F.toLowerCase();return a.id.toString().includes(r)||((l=a.glyph)==null?void 0:l.toLowerCase().includes(r))||((o=a.name)==null?void 0:o.toLowerCase().includes(r))})].sort((a,r)=>{let l=0;switch(k){case"id":l=a.id-r.id;break;case"name":l=(a.glyph||a.name||"").localeCompare(r.glyph||r.name||"");break;case"type":a.id>=1e3!=r.id>=1e3?l=a.id>=1e3?-1:1:l=a.id-r.id;break;default:l=a.id-r.id}return T==="desc"?-l:l});return F?n:[...[...R].sort((r,l)=>l.id-r.id),...n]},[s,R,F,k,T]),g=u.useMemo(()=>{if(!j)return null;const t=R.find(n=>n.id===j);return t||(s==null?void 0:s.find(n=>n.id===j))},[j,s,R]),Ee=t=>{j===t.id?Z(null):Z(t.id),$(!1)},ze=()=>{g&&(D({...g}),$(!0))},Le=()=>{D(null),$(!1)},Ae=async()=>{if(!h)return;const t=h.id===-1||h.id===-2;try{if(t){const n={rectWidth:h.rectWidth,rectHeight:h.rectHeight},a={iconUrl:h.iconUrl,iconSize:h.iconSize,glyphColor:h.glyphColor,glyphSize:h.glyphSize,shadowScale:h.shadowScale},[r,l]=await Promise.all([X.from("markers_core").update(n).eq("id",h.id).eq("event_year",0),X.from("markers_appearance").update(a).eq("id",h.id).eq("event_year",0)]);if(r.error)throw r.error;if(l.error)throw l.error;ae(o=>o.map(f=>f.id===h.id?{...f,...h}:f))}else{const n={};if(Object.keys(h).forEach(a=>{h[a]!==g[a]&&(n[a]=h[a])}),Object.keys(n).length===0){$(!1),D(null);return}p(a=>a.map(r=>r.id===h.id?{...r,...h}:r)),await x(h.id,n)}$(!1),D(null)}catch(n){console.error("Error saving marker:",n),_("Failed to save marker. Please try again.")}},Ie=(t,n)=>{D(a=>({...a,[t]:n}))},$e=async()=>{if(v||!await re({title:"Archive Markers",message:`Archive all markers for ${d}? This will move them to the archive and clear the current year.`,confirmText:"Archive",variant:"warning"}))return;const{error:n}=await M();n?_(`Error archiving markers: ${n}`):ie(`Successfully archived markers for ${d}`)},ue=async()=>{if(v)return;const t=d-1;if(!await re({title:"Copy Markers",message:`Copy all markers from ${t} to ${d}?`,confirmText:"Copy",variant:"default"}))return;const{error:a}=await c(t);a?_(`Error copying markers: ${a}`):ie(`Markers copied from ${t} to ${d}`)},De=async t=>{var W,z,L;if(!N||!N.printControl||!t)return;G(!0);const n=N.printControl,a=(n==null?void 0:n.browserPrint)||n;let r=null,l=!1,o=!1;const f=()=>{if(!N||!(window.L&&window.L.BrowserPrint&&window.L.BrowserPrint.Event))return;const A=window.L.BrowserPrint.Event;try{N.off(A.PrintStart,E),N.off(A.PrintEnd,O),N.off(A.PrintCancel,J)}catch{}r&&(clearTimeout(r),r=null)},E=()=>{l=!0},O=()=>{o=!0,f()},J=()=>{o=!0,f()};try{if(window.L&&window.L.BrowserPrint&&window.L.BrowserPrint.Event){const S=window.L.BrowserPrint.Event;N.on(S.PrintStart,E),N.on(S.PrintEnd,O),N.on(S.PrintCancel,J)}try{if(typeof a.print=="function")a.print(t);else if(typeof(n==null?void 0:n._printMode)=="function")n._printMode(t);else throw new Error("No browser print API available")}catch(S){console.warn("Header BrowserPrint call failed:",S),f();const I=((W=t==null?void 0:t.title)==null?void 0:W.toLowerCase().includes("landscape"))||((z=t==null?void 0:t.name)==null?void 0:z.toLowerCase().includes("landscape"));console.info(`[MapPrint] Fallback triggered. Configuration: ${I?"Landscape":"Portrait"}`),alert("Browser print failed. Falling back to snapshot print (popup window). Verify the orientation in the dialog."),await ee({orientation:I?"landscape":"portrait"});return}if(await(()=>new Promise(S=>{if(l)return S("started");r=setTimeout(()=>S("timeout"),8e3);const I=setInterval(()=>{(l||o)&&(clearInterval(I),r&&(clearTimeout(r),r=null),S(l?"started":"finished"))},80)}))()==="timeout"){console.warn("Header BrowserPrint did not start; falling back to snapshot export"),f();const I=((t==null?void 0:t.title)||((L=t==null?void 0:t.options)==null?void 0:L.title)||(t==null?void 0:t.name)||"").toLowerCase().includes("landscape");console.info(`[MapPrint] Fallback triggered. Configuration: ${I?"Landscape":"Portrait"}`),alert("Browser print timed out. Falling back to snapshot print (popup window). Verify the orientation in the dialog."),await ee({orientation:I?"landscape":"portrait"})}}finally{G(!1)}},ee=async(t={})=>{if(!we){G(!0);try{const n=document.querySelector("#map-container")||document.querySelector(".leaflet-container");if(!n)return;await new Promise(L=>setTimeout(L,400));const r=(await Ze(n,{useCORS:!0,allowTaint:!0,logging:!1,backgroundColor:"#ffffff",scale:2,ignoreElements:L=>{var A;return(A=L.classList)==null?void 0:A.contains("map-controls-print-hide")}})).toDataURL("image/png",1),l=window.open("","_blank","width=900,height=700");if(!l){alert("Popup blocked! Please allow popups for map printing.");return}const o=l.document;o.open();const f=o.createElement("head"),E=o.createElement("title");E.textContent="Map Print";const O=o.createElement("style"),J=t.orientation==="landscape"?"landscape":"portrait";O.textContent=`
        * { margin: 0; padding: 0 }
        body { 
          display: flex; 
          justify-content: center; 
          align-items: center; 
          min-height: 100vh; 
          background: white 
        }
        img { 
          max-width: 100%; 
          max-height: 100vh; 
          object-fit: contain 
        }
        @media print { 
          @page { size: ${J}; margin: 0; }
          img { width: 100%; height: auto } 
          body { 
            display: block !important; 
            margin: 0 !important;
            padding: 0 !important;
            height: 100% !important;
          }
        }
      `,f.appendChild(E),f.appendChild(O);const W=o.createElement("body"),z=o.createElement("img");for(z.src=r,z.alt="Map",z.onload=()=>setTimeout(()=>{try{l.print()}catch{}},100),W.appendChild(z),o.documentElement||o.appendChild(o.createElement("html"));o.documentElement.firstChild;)o.documentElement.removeChild(o.documentElement.firstChild);o.documentElement.appendChild(f),o.documentElement.appendChild(W),o.close(),l.document.close(),l.onafterprint=()=>l.close()}catch(n){console.error("Snapshot print failed:",n);try{_("Snapshot failed — map tiles may be blocked by CORS or the service worker. Use the Print Map plugin preset or enable CORS for your tile provider.")}catch{}window.print()}finally{G(!1)}}},q=g&&(g.id===-1||g.id===-2),te=g&&g.id>=1e3,se=g&&g.id>0&&g.id<1e3,pe=t=>{const n=R.find(r=>r.id===(t?-1:-2));if(!(n!=null&&n.iconUrl))return t?"Blue (assigned)":"Gray (unassigned)";const a=n.iconUrl.match(/glyph-marker-icon-(\w+)\.svg/);return a?`${a[1].charAt(0).toUpperCase()+a[1].slice(1)} (${t?"assigned":"unassigned"})`:t?"Blue (assigned)":"Gray (unassigned)"};return e.jsx(Ke,{requiredRole:["super_admin","system_manager","event_manager"],children:e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:v?"Event Map Viewer":m("mapManagement.title")}),e.jsx("div",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:d})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>Y(t=>!t),className:`flex items-center gap-2 px-4 py-2 ${v?"bg-gray-600 text-white hover:bg-gray-700":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"} rounded-lg`,title:"Print map","aria-haspopup":"menu","aria-expanded":le,children:[e.jsx(C,{path:Fe,size:.8}),"Print Map"]}),le&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg z-40 overflow-hidden border border-gray-200",children:oe.length>0?e.jsx("div",{className:"py-1",children:oe.map((t,n)=>{var a,r;return e.jsx("button",{type:"button",onClick:async()=>{Y(!1),await De(t)},className:"w-full text-left px-4 py-2 text-gray-900 hover:bg-gray-50 transition-colors",children:((a=t==null?void 0:t.options)==null?void 0:a.title)||((r=t==null?void 0:t.options)==null?void 0:r.pageSize)||`Preset ${n+1}`},n)})}):e.jsx("div",{className:"py-1",children:e.jsx("button",{type:"button",onClick:async()=>{Y(!1),await ee()},className:"w-full text-left px-4 py-2 text-gray-900 hover:bg-gray-50 transition-colors",children:"Snapshot (PNG)"})})})]}),!v&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:ue,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",title:`Copy markers from ${d-1}`,children:[e.jsx(C,{path:Te,size:.8}),"Copy from ",d-1]}),e.jsxs("button",{onClick:$e,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:((s==null?void 0:s.length)||0)===0,title:`Archive all markers for ${d}`,children:[e.jsx(C,{path:Oe,size:.8}),"Archive ",d]})]})]})]}),he.length===0&&!F&&e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:["No Markers Found for ",d]}),e.jsx("p",{className:"text-blue-700 mb-4",children:v?`There are no markers configured for ${d}. Please contact your system administrator.`:`There are no markers configured for ${d}. You can copy markers from the previous year or create new ones.`}),!v&&e.jsxs("button",{onClick:ue,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:["Copy from ",d-1]})]})}),!v&&e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("button",{onClick:()=>ce(!P),className:`p-2 rounded-lg border transition-colors ${P?"bg-blue-50 border-blue-200 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,title:P?"Hide Markers & Details":"Show Markers & Details",children:e.jsx(C,{path:P?ge:be,size:1})}),e.jsx("button",{onClick:()=>je(!U),className:`p-2 rounded-lg border transition-colors ${U?"bg-blue-50 border-blue-200 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,title:U?"Hide Subscriptions List":"Show Subscriptions List",children:e.jsx(C,{path:U?be:ge,size:1})})]})]}),e.jsxs("div",{className:"flex h-[calc(100vh-150px)] relative",children:[!v&&e.jsxs("div",{className:`border-r border-gray-200 overflow-hidden flex-shrink-0 bg-white flex flex-col relative ${!P&&"border-r-0"}`,style:{width:P?Ne:0,transition:w==="left"?"none":"width 0.3s ease-in-out"},children:[e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-400 z-50 active:bg-blue-600 transition-colors",onMouseDown:()=>V("left")}),e.jsx("div",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider px-3 py-2 bg-white sticky top-0 z-10",children:"Markers List"}),e.jsxs("div",{className:"p-3 border-b border-gray-200 bg-gray-50 flex flex-col gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(C,{path:We,size:.8,className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:m("mapManagement.searchPlaceholder"),value:F,onChange:t=>xe(t.target.value),className:"w-full pl-8 pr-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md shadow-sm bg-white",children:[e.jsxs("select",{value:k,onChange:t=>me(t.target.value),className:"flex-1 pl-2 pr-2 py-1.5 border-0 rounded-l-md bg-white text-gray-900 text-xs focus:ring-0 appearance-none min-w-0","aria-label":m("mapManagement.sortBy"),children:[e.jsx("option",{value:"id",children:m("mapManagement.sortId")}),e.jsx("option",{value:"name",children:m("mapManagement.sortName")}),e.jsx("option",{value:"type",children:m("mapManagement.sortType")})]}),e.jsxs("button",{type:"button",onClick:()=>fe(T==="asc"?"desc":"asc"),"aria-label":`Toggle sort direction to ${T==="asc"?"descending":"ascending"}`,className:"px-2 py-1.5 border-l border-gray-300 text-gray-500 hover:bg-gray-50 rounded-r-md text-xs",children:[e.jsx(C,{path:T==="asc"?He:_e,size:.7}),e.jsx("span",{className:"sr-only",children:"Sort"})]})]})]}),e.jsx("div",{className:"w-full overflow-y-auto p-2 border-b border-gray-200 relative scrollbar-hide",style:{height:j?`calc(${de*100}% - 146px)`:"calc(100% - 146px)",transition:w?"none":"height 0.3s ease-in-out"},children:he.map(t=>{const n=t.id===j,a=t.id===-1||t.id===-2;return t.id>=1e3,e.jsx("button",{onClick:()=>Ee(t),className:`w-full text-left p-2 rounded-lg mb-1 transition-colors ${n?"bg-blue-50 border-2 border-blue-500":a?"bg-amber-50 border-2 border-amber-300 hover:bg-amber-100":"bg-white border border-gray-200 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.iconUrl?e.jsx("div",{className:"relative",children:e.jsx("img",{src:ne(t.iconUrl),alt:"icon",className:"w-5 h-5"})}):e.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded flex items-center justify-center text-[10px] text-gray-600",children:"D"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-sm text-gray-900 truncate",children:a?t.id===-1?"Assigned Booth":"Unassigned Booth":t.glyph||`Marker ${t.id}`}),e.jsxs("span",{className:"text-xs text-gray-400 font-mono ml-2",children:["#",t.id]})]}),t.name&&e.jsx("div",{className:"text-xs text-gray-500 truncate",children:t.name})]})]})},t.id)})}),j&&e.jsx("div",{className:"w-full h-1 cursor-row-resize bg-gray-200 hover:bg-blue-400 z-50 active:bg-blue-600 transition-colors",onMouseDown:()=>V("split")}),j&&e.jsx("div",{className:"w-full overflow-y-auto p-6 bg-gray-50/50 flex-shrink-0",style:{height:`${(1-de)*100}%`,transition:w?"none":"height 0.3s ease-in-out"},children:g?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:q?g.id===-1?"Assigned Booth Default":"Unassigned Booth Default":g.glyph||`Marker ${g.id}`}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",g.id,q&&" ⚙️ Global Default for Booth Markers",te&&" (Special Marker)",se&&" (Booth - Content managed via Companies/Assignments)"]})]}),!H&&!v&&e.jsx("button",{onClick:ze,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Edit"})]}),H?e.jsx(et,{marker:h,isDefaultMarker:q,isSpecialMarker:te,isBoothMarker:se,getDefaultColorName:pe,onChange:Ie,onSave:Ae,onCancel:Le}):e.jsx(Ye,{marker:g,isSpecialMarker:te,isDefaultMarker:q,isBoothMarker:se,getDefaultColorName:pe})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:m("mapManagement.selectMarker")})})]}),e.jsx("div",{className:"flex-1 relative bg-gray-50 flex flex-col",children:e.jsx(Qe,{isAdminView:!0,previewUseVisitorSizing:!0,markersState:s,updateMarker:v?null:x,selectedYear:d,selectedMarkerId:j,editMode:!v&&H,onMarkerSelect:t=>{Z(t),v||$(!1),P||ce(!0)},onMarkerDrag:(t,n,a)=>{!v&&H&&j===t&&D(r=>({...r,lat:n,lng:a}))},onMapReady:t=>{var a,r;ye(t);const n=((r=(a=t==null?void 0:t.printControl)==null?void 0:a.options)==null?void 0:r.printModes)||[];ve(Array.isArray(n)?n:[])}})}),!v&&e.jsxs("div",{className:`border-l border-gray-200 overflow-hidden flex-shrink-0 bg-white relative ${!U&&"border-l-0"}`,style:{width:U?Ce:0,transition:w==="right"?"none":"width 0.3s ease-in-out"},children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-blue-400 z-50 active:bg-blue-600 transition-colors",onMouseDown:()=>V("right")}),e.jsxs("div",{className:"p-4 w-full h-full flex items-center justify-center text-gray-400 text-sm text-center",children:["Subscriptions List",e.jsx("br",{}),"(Coming Soon)"]})]})]})]})})}function Ye({marker:s,isSpecialMarker:p,isDefaultMarker:x,isBoothMarker:d,getDefaultColorName:M}){var c;return e.jsxs("div",{className:"space-y-6",children:[x&&e.jsxs("div",{className:"bg-amber-50 border-2 border-amber-300 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-amber-900 mb-2",children:"ℹ️ About Default Markers"}),e.jsx("p",{className:"text-sm text-amber-800 mb-2",children:s.id===-1?"This defines the default appearance for booth markers (ID < 1000) that have a company assigned.":"This defines the default appearance for booth markers (ID < 1000) that have no company assigned."}),e.jsx("p",{className:"text-sm text-amber-800",children:"Individual booth markers can override these defaults by having their own values in the Appearance table."})]}),!x&&e.jsxs(B,{title:"Position & Structure",children:[e.jsx(b,{label:"Latitude",value:s.lat}),e.jsx(b,{label:"Longitude",value:s.lng}),e.jsx(b,{label:"Rectangle",value:JSON.stringify(s.rectangle)}),e.jsx(b,{label:"Angle",value:s.angle||0})]}),e.jsxs(B,{title:x?"Default Visual Styling":"Visual Styling",children:[e.jsx(b,{label:"Icon",children:s.iconUrl?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:ne(s.iconUrl),alt:"icon",className:"w-8 h-8"}),e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"Custom Color"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded flex items-center justify-center text-[9px] text-gray-600 font-medium leading-none",children:"Default"}),e.jsx("span",{className:"text-xs text-blue-600 font-medium",children:d?M(((c=s.assignments)==null?void 0:c.length)>0):"Based on marker type"})]})}),e.jsx(b,{label:"Icon Size",value:JSON.stringify(s.iconSize)}),!x&&e.jsx(b,{label:"Glyph (Booth Label)",value:s.glyph}),e.jsx(b,{label:"Glyph Color",value:s.glyphColor}),e.jsx(b,{label:"Glyph Size",value:s.glyphSize}),e.jsx(b,{label:"Glyph Anchor",value:s.glyphAnchor?JSON.stringify(s.glyphAnchor):"—"}),e.jsx(b,{label:"Shadow Scale",value:s.shadowScale??"1.0"}),x&&e.jsxs(e.Fragment,{children:[e.jsx(b,{label:"Rectangle Width",value:s.rectWidth}),e.jsx(b,{label:"Rectangle Height",value:s.rectHeight})]})]}),p&&e.jsxs(B,{title:"Content (Special Marker)",children:[e.jsx(b,{label:"Name",value:s.name}),e.jsx(b,{label:"Logo",children:s.logo&&e.jsx("img",{...(()=>{const m=Ge(s.logo);return m?{src:m.src,srcSet:m.srcSet,sizes:m.sizes}:{src:Ve(s.logo)}})(),alt:"logo",className:"w-12 h-12"})}),e.jsx(b,{label:"Website",value:s.website}),e.jsx(b,{label:"Info",value:s.info})]})]})}function et({marker:s,isDefaultMarker:p,isSpecialMarker:x,isBoothMarker:d,getDefaultColorName:M,onChange:c,onSave:m,onCancel:K}){var Q;return e.jsxs("div",{className:"space-y-6",children:[p&&e.jsxs("div",{className:"bg-amber-50 border-2 border-amber-300 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-amber-900 mb-2",children:"⚙️ Editing Global Defaults"}),e.jsx("p",{className:"text-sm text-amber-800 mb-2",children:s.id===-1?"Changes here will affect all booth markers (ID < 1000) that have a company assigned, unless they have individual overrides.":"Changes here will affect all booth markers (ID < 1000) that have no company assigned, unless they have individual overrides."})]}),!p&&e.jsxs(B,{title:"Position & Structure",children:[e.jsx(y,{label:"Latitude",type:"number",step:"0.0001",value:s.lat,onChange:i=>c("lat",parseFloat(i))}),e.jsx(y,{label:"Longitude",type:"number",step:"0.0001",value:s.lng,onChange:i=>c("lng",parseFloat(i))}),e.jsx(y,{label:"Angle",type:"number",step:"0.1",value:s.angle||0,onChange:i=>c("angle",parseFloat(i))})]}),e.jsxs(B,{title:p?"Default Visual Styling":"Visual Styling",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Icon"}),e.jsxs("div",{className:"grid grid-cols-6 gap-2",children:[e.jsx("button",{onClick:()=>c("iconUrl",null),className:`w-10 h-10 border-2 rounded-lg transition-all flex items-center justify-center ${s.iconUrl?"border-gray-200 hover:border-gray-400":"border-blue-500 bg-blue-50"}`,title:"Use default color based on assignment status",children:e.jsx("div",{className:"text-[9px] text-gray-600 font-medium leading-none",children:"Default"})}),qe.map(i=>e.jsx("button",{onClick:()=>c("iconUrl",i),className:`p-2 border-2 rounded-lg transition-all ${s.iconUrl===i?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-400"}`,children:e.jsx("img",{src:ne(i),alt:i,className:"w-8 h-8"})},i))]}),s.iconUrl?e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Using custom color override"}):e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Using default color:"," ",d?M(((Q=s.assignments)==null?void 0:Q.length)>0):"Based on marker type"]})]}),!p&&e.jsx(y,{label:"Glyph (Booth Label)",value:s.glyph,onChange:i=>c("glyph",i)}),e.jsx(y,{label:"Glyph Color",type:"color",value:s.glyphColor,onChange:i=>c("glyphColor",i)}),e.jsx(y,{label:"Glyph Size",type:"number",step:"0.01",value:s.glyphSize,onChange:i=>c("glyphSize",parseFloat(i))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(y,{label:"Glyph Anchor X",type:"number",step:"0.01",value:s.glyphAnchor?s.glyphAnchor[0]:"",onChange:i=>c("glyphAnchor",[parseFloat(i)||0,s.glyphAnchor&&s.glyphAnchor[1]||0])}),e.jsx(y,{label:"Glyph Anchor Y",type:"number",step:"0.01",value:s.glyphAnchor?s.glyphAnchor[1]:"",onChange:i=>c("glyphAnchor",[s.glyphAnchor&&s.glyphAnchor[0]||0,parseFloat(i)||0])})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(y,{label:"Icon Width",type:"number",step:"0.01",value:s.iconSize?s.iconSize[0]:"",onChange:i=>c("iconSize",[parseFloat(i)||null,s.iconSize?s.iconSize[1]:null])}),e.jsx(y,{label:"Icon Height",type:"number",step:"0.01",value:s.iconSize?s.iconSize[1]:"",onChange:i=>c("iconSize",[s.iconSize?s.iconSize[0]:null,parseFloat(i)||null])})]}),e.jsx(y,{label:"Shadow Scale",type:"number",step:"0.01",value:s.shadowScale??1,onChange:i=>c("shadowScale",parseFloat(i))}),p&&e.jsxs(e.Fragment,{children:[e.jsx(y,{label:"Rectangle Width",type:"number",step:"1",value:s.rectWidth,onChange:i=>c("rectWidth",parseFloat(i))}),e.jsx(y,{label:"Rectangle Height",type:"number",step:"1",value:s.rectHeight,onChange:i=>c("rectHeight",parseFloat(i))})]})]}),x&&e.jsxs(B,{title:"Content (Special Marker)",children:[e.jsx(y,{label:"Name",value:s.name,onChange:i=>c("name",i)}),e.jsx(y,{label:"Logo URL",value:s.logo,onChange:i=>c("logo",i)}),e.jsx(y,{label:"Website",value:s.website,onChange:i=>c("website",i)}),e.jsx(tt,{label:"Info",value:s.info,onChange:i=>c("info",i)})]}),d&&e.jsx(e.Fragment,{}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(C,{path:Je,size:.9}),"Save Changes"]}),e.jsxs("button",{onClick:K,className:"flex items-center gap-2 px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:[e.jsx(C,{path:Xe,size:.9}),"Cancel"]})]})]})}function B({title:s,children:p}){return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:s}),e.jsx("div",{className:"space-y-3",children:p})]})}function b({label:s,value:p,children:x}){return e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:s}),x||e.jsx("div",{className:"text-gray-900",children:p||"—"})]})}function y({label:s,value:p,onChange:x,type:d="text",...M}){const c=d==="color"&&!p?"#000000":p||"";return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s}),e.jsx("input",{type:d,value:c,"aria-label":s,onChange:m=>x(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",...M})]})}function tt({label:s,value:p,onChange:x}){return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s}),e.jsx("textarea",{value:p||"",onChange:d=>x(d.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}export{pt as default};
