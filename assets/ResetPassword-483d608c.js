import{u as I,a as U,r,B as q,j as e,s as p}from"./index-88c468a1.js";import{L as B}from"./LanguageToggle-34dfa959.js";function H({branding:t}){const{t:s}=I(),w=U(),[i,k]=r.useState(""),[b,S]=r.useState(""),[d,T]=r.useState(!1),[c,m]=r.useState(null),[g,x]=r.useState(null),[P,j]=r.useState(!1),[E,L]=r.useState(!1),u=r.useRef(null);r.useEffect(()=>{c&&u.current&&u.current.focus()},[c]),r.useEffect(()=>{(async()=>{const l=window.location.hash;let a;if(l.includes("error=")){const n=l.substring(1);a=new URLSearchParams(n)}else{const n=l.indexOf("#",1);if(n>0){const h=l.substring(n+1);a=new URLSearchParams(h)}else a=new URLSearchParams(window.location.search)}const N=a.get("access_token"),v=a.get("refresh_token"),y=a.get("error"),f=a.get("error_description");if(y){y==="access_denied"||f!=null&&f.includes("expired")?x(s("resetPassword.errors.tokenExpired")):x(s("resetPassword.errors.invalidToken"));return}if(N&&v){const{data:{session:n},error:h}=await p.auth.setSession({access_token:N,refresh_token:v});(h||!n)&&(console.error("Failed to set session:",h),x(s("resetPassword.errors.invalidToken")));return}const{data:{session:F}}=await p.auth.getSession();F||x(s("resetPassword.errors.invalidToken"))})()},[s]);const R=async o=>{if(o.preventDefault(),m(null),i.length<6){m(s("resetPassword.errors.passwordTooShort"));return}if(i!==b){m(s("resetPassword.errors.passwordMismatch"));return}j(!0);const{error:l}=await p.auth.updateUser({password:i});j(!1),l?m(s("resetPassword.errors.updateFailed")):(L(!0),setTimeout(()=>{w("/admin")},3e3))},C=(t==null?void 0:t.eventName)||"4x4 Vakantiebeurs",_=(t==null?void 0:t.logo)||q.getDefaultLogoPath();return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-orange-50 flex items-center justify-center px-4 py-8",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[e.jsx("div",{className:"flex justify-end mb-6",children:e.jsx(B,{})}),e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsx("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 p-3 rounded-xl shadow-lg mb-4",children:e.jsx("img",{src:_,alt:"Event Logo",className:"h-12 w-12 object-contain"})}),e.jsx("h1",{className:"font-bold text-2xl text-gray-800 mb-1",children:C}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Manager Portal"})]}),e.jsx("h2",{className:"text-xl font-bold mb-2 text-gray-800",children:s("resetPassword.title")}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:s("resetPassword.instructions")}),E?e.jsxs("div",{className:"bg-green-50 border-l-4 border-green-500 text-green-700 px-4 py-3 rounded-lg shadow-sm",role:"alert","aria-live":"polite",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-xl mr-3",children:"‚úì"}),e.jsx("span",{className:"font-semibold",children:s("resetPassword.success")})]}),e.jsx("p",{className:"text-sm ml-8",children:s("resetPassword.redirecting")})]}):g?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{ref:u,className:"bg-red-50 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded-lg shadow-sm",role:"alert","aria-live":"assertive",tabIndex:-1,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-xl mr-3",children:"‚ö†"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold mb-1",children:s("resetPassword.errors.linkExpiredTitle")}),e.jsx("p",{className:"text-sm",children:g})]})]})}),e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{type:"button",onClick:()=>w("/admin"),className:"flex-1 btn-primary",children:s("resetPassword.requestNewLink")})})]}):e.jsxs("form",{onSubmit:R,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"new-password",className:"label-base",children:s("resetPassword.newPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"new-password",type:d?"text":"password",value:i,onChange:o=>k(o.target.value),className:"input-base",placeholder:s("resetPassword.newPasswordPlaceholder"),"aria-label":s("resetPassword.newPassword"),required:!0,minLength:6}),e.jsx("button",{type:"button",onClick:()=>T(!d),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors text-sm","aria-label":s(d?"resetPassword.hidePassword":"resetPassword.showPassword"),children:d?"üëÅÔ∏è":"üëÅÔ∏è‚Äçüó®Ô∏è"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("resetPassword.passwordRequirements")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirm-password",className:"label-base",children:s("resetPassword.confirmPassword")}),e.jsx("input",{id:"confirm-password",type:d?"text":"password",value:b,onChange:o=>S(o.target.value),className:"input-base",placeholder:s("resetPassword.confirmPasswordPlaceholder"),"aria-label":s("resetPassword.confirmPassword"),required:!0})]}),c&&e.jsx("div",{ref:u,className:"bg-red-50 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded-lg shadow-sm",role:"alert","aria-live":"assertive",tabIndex:-1,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-xl mr-3",children:"‚ö†"}),e.jsx("span",{className:"text-sm",children:c})]})}),e.jsx("button",{type:"submit",className:"btn-primary w-full",disabled:P,children:s(P?"resetPassword.updating":"resetPassword.updatePassword")}),e.jsxs("button",{type:"button",onClick:()=>w("/admin"),className:"w-full py-2 text-orange-600 hover:text-orange-700 font-medium text-sm transition-colors",children:["‚Üê ",s("resetPassword.backToLogin")]})]})]})})})}export{H as default};
