import{c as A,r as n,R as H,j as e,I as i}from"./vendor-react-505adfae.js";import{b5 as V,aZ as ee,b6 as q,b7 as se,a_ as te,a$ as ae,aY as ne,aF as Y,at as O,b8 as re,b9 as ie,ba as J,bb as W,bc as K,ap as P,bd as Q,be as le,an as oe,aH as ce,bf as de}from"./vendor-3a7855fa.js";import{u as X}from"./useUserRole-58d31cc8.js";import"./ProtectedSection-f8d87ce8.js";import{i as B,s as U,M as me,l as G}from"./index-5891cb02.js";import{L as ge}from"./LanguageToggle-490dead0.js";import ue from"./CategoryManagement-4b578a73.js";import{u as xe}from"./useEventMapSettings-a4b2ca38.js";import"./vendor-i18n-2e1fa53c.js";import"./vendor-supabase-54a3b136.js";import"./vendor-map-5eb3cb24.js";import"./useCategories-6fd5f963.js";function pe(){const{t:s}=A(),{isSuperAdmin:t}=X(),{confirm:r}=B(),[h,Z]=n.useState([]),[y,w]=n.useState(!0),[g,p]=n.useState(null),[L,c]=n.useState(!1),[j,x]=n.useState(""),[a,S]=n.useState("event_manager"),[D,m]=n.useState(!1),[u,v]=n.useState(!1),[I,$]=n.useState(null),k=H.useCallback(async()=>{try{w(!0),p(null);let l,o;try{const z=await U.rpc("get_user_roles_with_email");l=z.data,o=z.error}catch{console.warn("get_user_roles_with_email not available, using fallback");const d=await U.from("user_roles").select("user_id, role, created_at, updated_at").order("created_at",{ascending:!1});l=d.data,o=d.error}if(o)throw o;const{data:{user:b}}=await U.auth.getUser(),N=(l||[]).map(z=>{const d=(b==null?void 0:b.id)===z.user_id;return{id:z.user_id,email:z.email||(d?b.email:`user-${z.user_id.substring(0,8)}...`),role:z.role,created_at:z.created_at,last_sign_in_at:z.last_sign_in_at||(d?b.last_sign_in_at:null),isCurrentUser:d}});Z(N),w(!1)}catch(l){console.error("Error fetching users:",l),p(s("settings.userManagement.errors.fetchFailed")),w(!1)}},[s]);n.useEffect(()=>{k()},[k]);const F=async l=>{var o;l.preventDefault(),m(!0),p(null);try{const N="/Map",z=`${window.location.origin}${N}#/reset-password`,d=Math.random().toString(36).slice(-12)+"A1!",{data:R,error:M}=await U.auth.signUp({email:j,password:d,options:{data:{role:a},emailRedirectTo:z}});if(M)throw M;if((o=R==null?void 0:R.user)!=null&&o.id){const{error:T}=await U.from("user_roles").insert({user_id:R.user.id,role:a});T&&console.warn("Failed to add user to user_roles:",T)}const{error:_}=await U.auth.resetPasswordForEmail(j,{redirectTo:z});_&&console.warn("Password reset email failed:",_),v(!0),setTimeout(()=>{c(!1),v(!1),x(""),S("event_manager"),k()},8e3)}catch(b){console.error("Error inviting user:",b),p(b.message||s("settings.userManagement.errors.inviteFailed"))}finally{m(!1)}},f=async(l,o)=>{if(await r({title:s("settings.userManagement.deleteUser"),message:s("settings.userManagement.confirmDelete",{email:o}),confirmText:s("common.delete"),variant:"danger"}))try{p(null);const{error:N}=await U.from("user_roles").delete().eq("user_id",l);if(N)throw N;await k()}catch(N){console.error("Error deleting user:",N),p(s("settings.userManagement.errors.deleteFailed"))}},C={super_admin:s("settings.userManagement.roles.superAdmin"),system_manager:s("settings.userManagement.roles.systemManager"),event_manager:s("settings.userManagement.roles.eventManager")},E={super_admin:"bg-purple-100 text-purple-800 border-purple-200",system_manager:"bg-blue-100 text-blue-800 border-blue-200",event_manager:"bg-green-100 text-green-800 border-green-200"};return y?e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-gray-500",children:s("settings.userManagement.loading")})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(i,{path:V,size:1}),s("settings.userManagement.title")]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s("settings.userManagement.description")})]}),e.jsxs("button",{onClick:()=>c(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(i,{path:ee,size:.8}),s("settings.userManagement.inviteUser")]})]}),g&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(i,{path:q,size:.8,className:"mr-2"}),e.jsx("span",{className:"text-sm",children:g})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:s("settings.userManagement.table.email")}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:s("settings.userManagement.table.role")}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:s("settings.userManagement.table.created")}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:s("settings.userManagement.table.lastLogin")}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-gray-700",children:s("settings.userManagement.table.actions")})]})}),e.jsx("tbody",{children:h.map(l=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{path:se,size:.7,className:"text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:l.email})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-medium border ${E[l.role]||"bg-gray-100 text-gray-800"}`,children:C[l.role]||l.role})}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:new Date(l.created_at).toLocaleDateString()}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:l.last_sign_in_at?new Date(l.last_sign_in_at).toLocaleDateString():"-"}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>$(l),className:"p-2 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:s("settings.userManagement.editRole"),children:e.jsx(i,{path:te,size:.7})}),t&&e.jsx("button",{onClick:()=>f(l.id,l.email),className:"p-2 text-red-600 hover:bg-red-50 rounded transition-colors",title:s("settings.userManagement.deleteUser"),children:e.jsx(i,{path:ae,size:.7})})]})})]},l.id))})]})})]}),e.jsx(me,{isOpen:L,onClose:()=>c(!1),title:s("settings.userManagement.inviteUser"),size:"md",children:e.jsx("div",{className:"p-6",children:u?e.jsx("div",{className:"bg-green-50 border-l-4 border-green-500 text-green-700 px-4 py-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(i,{path:ne,size:.8,className:"mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s("settings.userManagement.inviteSuccess")}),e.jsx("p",{className:"text-sm mt-1",children:s("settings.userManagement.inviteSuccessMessage")})]})]})}):e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label-base",children:s("settings.userManagement.emailLabel")}),e.jsx("input",{type:"email",value:j,onChange:l=>x(l.target.value),className:"input-base",placeholder:"manager@example.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-base",children:s("settings.userManagement.roleLabel")}),e.jsxs("select",{value:a,onChange:l=>S(l.target.value),className:"input-base",children:[e.jsx("option",{value:"event_manager",children:C.event_manager}),e.jsx("option",{value:"system_manager",children:C.system_manager}),t&&e.jsx("option",{value:"super_admin",children:C.super_admin})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s(`settings.userManagement.roleDescriptions.${a}`)})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),className:"flex-1 py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:s("settings.userManagement.cancel")}),e.jsx("button",{type:"submit",disabled:D,className:"flex-1 btn-primary",children:s(D?"settings.userManagement.sending":"settings.userManagement.sendInvite")})]})]})})})]})}function he(){const{t:s}=A(),{settings:t,loading:r,error:h,updateSettings:Z}=G(),{toastError:y,toastWarning:w}=B(),[g,p]=n.useState(!1),[L,c]=n.useState(!1),[j,x]=n.useState(null),[a,S]=n.useState(0),[D,m]=n.useState(0),[u,v]=n.useState(0),[I,$]=n.useState(0),[k,F]=n.useState(0),[f,C]=n.useState(!0),[E,l]=n.useState(!0),[o,b]=n.useState(!0);n.useEffect(()=>{if(t&&(S(t.default_breakfast_sat??0),m(t.default_lunch_sat??0),v(t.default_bbq_sat??0),$(t.default_breakfast_sun??0),F(t.default_lunch_sun??0),t.notification_settings)){const d=typeof t.notification_settings=="string"?JSON.parse(t.notification_settings):t.notification_settings;C(d.emailNotifications??!0),l(d.newSubscriptionNotify??!0),b(d.assignmentChangeNotify??!0)}},[t]);const N=async d=>{var R;d.preventDefault(),p(!0),x(null),c(!1);try{if(!await Z({default_breakfast_sat:a,default_lunch_sat:D,default_bbq_sat:u,default_breakfast_sun:I,default_lunch_sun:k,notification_settings:{emailNotifications:f,newSubscriptionNotify:E,assignmentChangeNotify:o}}))throw new Error("Failed to update settings");c(!0),setTimeout(()=>c(!1),3e3)}catch(M){console.error("Failed to save settings:",M),(R=M.message)!=null&&R.includes("updated by another admin")?(w(M.message),x(s("settings.eventDefaults.errors.saveFailed"))):(y(M.message||s("settings.eventDefaults.errors.saveFailed")),x(M.message||s("settings.eventDefaults.errors.saveFailed")))}finally{p(!1)}},z=()=>{if(t&&(S(t.default_breakfast_sat??0),m(t.default_lunch_sat??0),v(t.default_bbq_sat??0),$(t.default_breakfast_sun??0),F(t.default_lunch_sun??0),t.notification_settings)){const d=typeof t.notification_settings=="string"?JSON.parse(t.notification_settings):t.notification_settings;C(d.emailNotifications??!0),l(d.newSubscriptionNotify??!0),b(d.assignmentChangeNotify??!0)}};return r?e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:s("settings.eventDefaults.loading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s("settings.eventDefaults.title")}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(i,{path:Y,size:.6,className:"text-orange-600"}),e.jsx("span",{className:"text-xs font-semibold text-orange-700 uppercase tracking-wide",children:"Organization Setting"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s("settings.eventDefaults.description")})]}),L&&e.jsxs("div",{className:"bg-green-50 border-l-4 border-green-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:O,size:1,className:"text-green-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-800",children:s("settings.eventDefaults.saveSuccess")}),e.jsx("p",{className:"text-sm text-green-700",children:s("settings.eventDefaults.saveSuccessMessage")})]})]}),j&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:q,size:1,className:"text-red-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-800",children:s("settings.eventDefaults.error")}),e.jsx("p",{className:"text-sm text-red-700",children:j})]})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(i,{path:re,size:1,className:"text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("settings.eventDefaults.mealDefaults.title")})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:s("settings.eventDefaults.mealDefaults.description")}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:s("settings.eventDefaults.mealDefaults.saturday")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"breakfastSat",className:"label-base",children:s("settings.eventDefaults.mealDefaults.breakfast")}),e.jsx("input",{type:"number",id:"breakfastSat",min:"0",max:"9999",value:a,onChange:d=>S(parseInt(d.target.value)||0),className:"input-base"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"lunchSat",className:"label-base",children:s("settings.eventDefaults.mealDefaults.lunch")}),e.jsx("input",{type:"number",id:"lunchSat",min:"0",max:"9999",value:D,onChange:d=>m(parseInt(d.target.value)||0),className:"input-base"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bbqSat",className:"label-base",children:s("settings.eventDefaults.mealDefaults.bbq")}),e.jsx("input",{type:"number",id:"bbqSat",min:"0",max:"9999",value:u,onChange:d=>v(parseInt(d.target.value)||0),className:"input-base"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:s("settings.eventDefaults.mealDefaults.sunday")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"breakfastSun",className:"label-base",children:s("settings.eventDefaults.mealDefaults.breakfast")}),e.jsx("input",{type:"number",id:"breakfastSun",min:"0",max:"9999",value:I,onChange:d=>$(parseInt(d.target.value)||0),className:"input-base"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"lunchSun",className:"label-base",children:s("settings.eventDefaults.mealDefaults.lunch")}),e.jsx("input",{type:"number",id:"lunchSun",min:"0",max:"9999",value:k,onChange:d=>F(parseInt(d.target.value)||0),className:"input-base"})]}),e.jsxs("div",{className:"opacity-50",children:[e.jsx("label",{className:"label-base text-gray-400",children:s("settings.eventDefaults.mealDefaults.bbq")}),e.jsx("span",{className:"input-base bg-gray-100 cursor-not-allowed block w-full h-[2.5rem] rounded text-center text-gray-400","aria-disabled":"true",children:"â€”"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s("settings.eventDefaults.mealDefaults.sundayNoBbq")})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(i,{path:ie,size:1,className:"text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("settings.eventDefaults.notifications.title")})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:s("settings.eventDefaults.notifications.description")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"emailNotifications",className:"font-medium text-gray-900",children:s("settings.eventDefaults.notifications.emailNotifications")}),e.jsx("p",{className:"text-sm text-gray-600",children:s("settings.eventDefaults.notifications.emailNotificationsDesc")})]}),e.jsx("button",{type:"button",role:"switch","aria-checked":f,onClick:()=>C(!f),className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 ${f?"bg-orange-600":"bg-gray-300"}`,children:e.jsx("span",{className:`pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${f?"translate-x-5":"translate-x-0"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newSubscriptionNotify",className:"font-medium text-gray-900",children:s("settings.eventDefaults.notifications.newSubscription")}),e.jsx("p",{className:"text-sm text-gray-600",children:s("settings.eventDefaults.notifications.newSubscriptionDesc")})]}),e.jsx("button",{type:"button",role:"switch","aria-checked":E,onClick:()=>l(!E),disabled:!f,className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 ${E&&f?"bg-orange-600":"bg-gray-300"} ${f?"":"opacity-50 cursor-not-allowed"}`,children:e.jsx("span",{className:`pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${E?"translate-x-5":"translate-x-0"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"assignmentChangeNotify",className:"font-medium text-gray-900",children:s("settings.eventDefaults.notifications.assignmentChange")}),e.jsx("p",{className:"text-sm text-gray-600",children:s("settings.eventDefaults.notifications.assignmentChangeDesc")})]}),e.jsx("button",{type:"button",role:"switch","aria-checked":o,onClick:()=>b(!o),disabled:!f,className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 ${o&&f?"bg-orange-600":"bg-gray-300"} ${f?"":"opacity-50 cursor-not-allowed"}`,children:e.jsx("span",{className:`pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${o?"translate-x-5":"translate-x-0"}`})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 bg-white rounded-lg shadow p-6",children:[e.jsx("button",{type:"button",onClick:z,disabled:g,className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:s("settings.eventDefaults.reset")}),e.jsx("button",{type:"submit",disabled:g,className:"btn-primary px-6 py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:s(g?"settings.eventDefaults.saving":"settings.eventDefaults.save")})]})]})]})}function fe(){const{t:s}=A(),{settings:t,loading:r,updateSetting:h}=G(),{toastError:Z,toastWarning:y}=B(),[w,g]=n.useState(""),[p,L]=n.useState(!1),[c,j]=n.useState(!1),[x,a]=n.useState(null);n.useEffect(()=>{t&&g(t.public_default_year==null?"":String(t.public_default_year))},[t]);const S=m=>{if(m==="")return!0;const u=Number(m);return!(!Number.isInteger(u)||u<2e3||u>2100)},D=async m=>{var u;m.preventDefault(),a(null),L(!0);try{if(!S(w))throw new Error(s("settings.publicDefaultYear.errors.invalid"));const v=w===""?null:parseInt(w,10);await h("public_default_year",v),j(!0),setTimeout(()=>j(!1),2500)}catch(v){console.error("Failed to update public default year",v),(u=v.message)!=null&&u.includes("updated by another admin")?y(v.message):Z(v.message||s("settings.publicDefaultYear.errors.saveFailed")),a(v.message||s("settings.publicDefaultYear.errors.saveFailed"))}finally{L(!1)}};return r?e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:s("settings.publicDefaultYear.loading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s("settings.publicDefaultYear.title")}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(i,{path:Y,size:.6,className:"text-orange-600"}),e.jsx("span",{className:"text-xs font-semibold text-orange-700 uppercase tracking-wide",children:"Organization Setting"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s("settings.publicDefaultYear.description")})]}),c&&e.jsxs("div",{className:"bg-green-50 border-l-4 border-green-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:O,size:1,className:"text-green-600 mr-3 flex-shrink-0"}),e.jsx("div",{children:e.jsx("p",{className:"font-semibold text-green-800",children:s("settings.publicDefaultYear.saveSuccess")})})]}),x&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:q,size:1,className:"text-red-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-800",children:s("settings.publicDefaultYear.error")}),e.jsx("p",{className:"text-sm text-red-700",children:x})]})]}),e.jsxs("form",{onSubmit:D,className:"bg-white rounded-lg shadow p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"publicDefaultYear",className:"label-base",children:s("settings.publicDefaultYear.inputLabel")}),e.jsx("input",{id:"publicDefaultYear",type:"number",min:"2000",max:"2100",placeholder:s("settings.publicDefaultYear.placeholder"),value:w,onChange:m=>g(m.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:s("settings.publicDefaultYear.hint")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"submit",disabled:p,className:"btn-primary","data-testid":"save-public-default-year",children:s(p?"settings.saving":"settings.save")}),e.jsx("button",{type:"button",onClick:()=>g((t==null?void 0:t.public_default_year)==null?"":String(t.public_default_year)),className:"btn-outline",children:s("settings.reset")})]})]})]})}function be(){const{t:s}=A(),{settings:t,loading:r,updateSettings:h}=G(),{toastError:Z,toastWarning:y}=B(),[w,g]=n.useState(!1),[p,L]=n.useState(!1),[c,j]=n.useState("#3b82f6"),[x,a]=n.useState("Arvo, serif");n.useEffect(()=>{t&&(j(t.theme_color||"#3b82f6"),a(t.font_family||"Arvo, serif"))},[t]);const S=async()=>{var m;try{if(g(!0),!await h({theme_color:c,font_family:x}))throw new Error("Failed to update branding settings");L(!0),setTimeout(()=>L(!1),3e3)}catch(u){console.error("Error saving branding settings:",u),(m=u.message)!=null&&m.includes("updated by another admin")?y(u.message):Z(u.message||s("settings.branding.errors.saveFailed"))}finally{g(!1)}},D=()=>{t&&(j(t.theme_color||"#3b82f6"),a(t.font_family||"Arvo, serif"))};return r?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"text-gray-500",children:s("settings.branding.loading")})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{path:J,size:1,className:"text-orange-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s("settings.branding.title")})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(i,{path:Y,size:.6,className:"text-orange-600"}),e.jsx("span",{className:"text-xs font-semibold text-orange-700 uppercase tracking-wide",children:"Organization Setting"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s("settings.branding.description")}),e.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:["ðŸ’¡ ",s("settings.branding.note")]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("settings.branding.themeColor.label")}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:s("settings.branding.themeColor.description")}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"color",value:c,onChange:m=>j(m.target.value),className:"h-12 w-24 border border-gray-300 rounded cursor-pointer"}),e.jsx("input",{type:"text",value:c,onChange:m=>j(m.target.value),placeholder:"#ffffff",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",maxLength:7})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"p-4 rounded-lg border-2",style:{backgroundColor:c,borderColor:c},children:[e.jsx("p",{className:"font-bold text-white text-lg",children:"Preview Text (White on Color)"}),e.jsx("p",{className:"text-white text-sm opacity-90",children:"The quick brown fox jumps over the lazy dog"})]}),e.jsxs("div",{className:"p-4 rounded-lg border-2 border-gray-300 bg-white",children:[e.jsx("p",{className:"font-bold text-lg",style:{color:c},children:"Preview Text (Color on White)"}),e.jsx("p",{className:"text-sm",style:{color:c},children:"The quick brown fox jumps over the lazy dog"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("settings.branding.fontFamily.label")}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:s("settings.branding.fontFamily.description")}),e.jsxs("select",{value:x,onChange:m=>a(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Arvo, Sans-serif",children:"Arvo (Default)"}),e.jsx("option",{value:"Arial, sans-serif",children:"Arial"}),e.jsx("option",{value:"Helvetica, sans-serif",children:"Helvetica"}),e.jsx("option",{value:"Georgia, serif",children:"Georgia"}),e.jsx("option",{value:"'Times New Roman', serif",children:"Times New Roman"}),e.jsx("option",{value:"'Courier New', monospace",children:"Courier New"}),e.jsx("option",{value:"Verdana, sans-serif",children:"Verdana"}),e.jsx("option",{value:"'Comic Sans MS', cursive",children:"Comic Sans MS"}),e.jsx("option",{value:"Impact, sans-serif",children:"Impact"})]}),e.jsxs("div",{className:"mt-3 p-4 rounded-lg border border-gray-300 bg-white",style:{fontFamily:x},children:[e.jsx("p",{className:"text-lg text-gray-900 font-semibold",children:"The quick brown fox jumps over the lazy dog"}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:"1234567890 !@#$%^&*()"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:D,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50",children:s("settings.branding.reset")}),e.jsx("button",{onClick:S,disabled:w,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:w?s("common.saving"):p?e.jsxs(e.Fragment,{children:[e.jsx(i,{path:O,size:.8}),s("settings.branding.saveSuccess")]}):s("common.save")})]})]})}function je(){const{t:s}=A();return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{path:W,size:1.2,className:"text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s("settings.uiLanguage.title")}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s("settings.uiLanguage.description")})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(i,{path:K,size:.6,className:"text-blue-600"}),e.jsx("span",{className:"text-xs font-semibold text-blue-700 uppercase tracking-wide",children:"Personal Setting"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(i,{path:W,size:.9,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:s("settings.uiLanguage.note.title")}),e.jsx("p",{children:s("settings.uiLanguage.note.description")})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:s("settings.uiLanguage.selectLanguage")}),e.jsx(ge,{})]})]})]})}function ve(){return e.jsx(ue,{})}function Ne(){const{t:s}=A(),{settings:t,loading:r,error:h,updateSettings:Z}=G(),{toastError:y,toastWarning:w}=B(),[g,p]=n.useState(!1),[L,c]=n.useState(!1),[j,x]=n.useState(null),[a,S]=n.useState(51.898095),[D,m]=n.useState(5.772961),[u,v]=n.useState(17),[I,$]=n.useState(14),[k,F]=n.useState(22),[f,C]=n.useState(21);n.useEffect(()=>{t&&(S(t.map_center_lat??51.898095),m(t.map_center_lng??5.772961),v(t.map_default_zoom??17),$(t.map_min_zoom??14),F(t.map_max_zoom??22),C(t.map_search_zoom??21))},[t]);const E=async o=>{var b;o.preventDefault(),p(!0),x(null),c(!1);try{if(I>u||u>k)throw new Error(s("settings.mapDefaults.errors.invalidZoomLevels"));if(f<I||f>k)throw new Error(s("settings.mapDefaults.errors.invalidSearchZoom"));if(!await Z({map_center_lat:parseFloat(a),map_center_lng:parseFloat(D),map_default_zoom:parseInt(u),map_min_zoom:parseInt(I),map_max_zoom:parseInt(k),map_search_zoom:parseInt(f)}))throw new Error("Failed to update map settings");c(!0),setTimeout(()=>c(!1),3e3)}catch(N){console.error("Failed to save map settings:",N),(b=N.message)!=null&&b.includes("updated by another admin")?(w(N.message),x(s("settings.mapDefaults.errors.saveFailed"))):(y(N.message||s("settings.mapDefaults.errors.saveFailed")),x(N.message||s("settings.mapDefaults.errors.saveFailed")))}finally{p(!1)}},l=()=>{t&&(S(t.map_center_lat??51.898095),m(t.map_center_lng??5.772961),v(t.map_default_zoom??17),$(t.map_min_zoom??14),F(t.map_max_zoom??22),C(t.map_search_zoom??21))};return r?e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:s("settings.mapDefaults.loading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s("settings.mapDefaults.title")}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(i,{path:Y,size:.6,className:"text-orange-600"}),e.jsx("span",{className:"text-xs font-semibold text-orange-700 uppercase tracking-wide",children:"Organization Setting"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s("settings.mapDefaults.description")})]}),L&&e.jsxs("div",{className:"bg-green-50 border-l-4 border-green-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:O,size:1,className:"text-green-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-800",children:s("settings.mapDefaults.saveSuccess")}),e.jsx("p",{className:"text-sm text-green-700",children:s("settings.mapDefaults.saveSuccessMessage")})]})]}),j&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:q,size:1,className:"text-red-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-800",children:s("settings.mapDefaults.error")}),e.jsx("p",{className:"text-sm text-red-700",children:j})]})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(i,{path:P,size:1,className:"text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("settings.mapDefaults.mapCenter.title")})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:s("settings.mapDefaults.mapCenter.description")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapCenterLat",className:"label-base",children:s("settings.mapDefaults.mapCenter.latitude")}),e.jsx("input",{type:"number",id:"mapCenterLat",step:"0.000001",min:"-90",max:"90",value:a,onChange:o=>S(o.target.value),className:"input-base",placeholder:"51.898095"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("settings.mapDefaults.mapCenter.latitudeRange")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapCenterLng",className:"label-base",children:s("settings.mapDefaults.mapCenter.longitude")}),e.jsx("input",{type:"number",id:"mapCenterLng",step:"0.000001",min:"-180",max:"180",value:D,onChange:o=>m(o.target.value),className:"input-base",placeholder:"5.772961"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("settings.mapDefaults.mapCenter.longitudeRange")})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-2",children:[e.jsx(i,{path:Q,size:.8,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-blue-800",children:s("settings.mapDefaults.mapCenter.hint")})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(i,{path:P,size:1,className:"text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("settings.mapDefaults.zoomLevels.title")})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:s("settings.mapDefaults.zoomLevels.description")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapDefaultZoom",className:"label-base",children:s("settings.mapDefaults.zoomLevels.defaultZoom")}),e.jsx("input",{type:"number",id:"mapDefaultZoom",min:"1",max:"22",value:u,onChange:o=>v(o.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("settings.mapDefaults.zoomLevels.defaultZoomDesc")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapSearchZoom",className:"label-base",children:s("settings.mapDefaults.zoomLevels.searchZoom")}),e.jsx("input",{type:"number",id:"mapSearchZoom",min:"1",max:"22",value:f,onChange:o=>C(o.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("settings.mapDefaults.zoomLevels.searchZoomDesc")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapMinZoom",className:"label-base",children:s("settings.mapDefaults.zoomLevels.minZoom")}),e.jsx("input",{type:"number",id:"mapMinZoom",min:"1",max:"22",value:I,onChange:o=>$(o.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("settings.mapDefaults.zoomLevels.minZoomDesc")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapMaxZoom",className:"label-base",children:s("settings.mapDefaults.zoomLevels.maxZoom")}),e.jsx("input",{type:"number",id:"mapMaxZoom",min:"1",max:"22",value:k,onChange:o=>F(o.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("settings.mapDefaults.zoomLevels.maxZoomDesc")})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-amber-800",children:[e.jsxs("span",{className:"font-medium",children:[s("settings.mapDefaults.zoomLevels.constraint"),":"]})," ",s("settings.mapDefaults.zoomLevels.constraintDesc")]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 bg-white rounded-lg shadow p-6",children:[e.jsx("button",{type:"button",onClick:l,disabled:g,className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:s("settings.mapDefaults.reset")}),e.jsx("button",{type:"submit",disabled:g,className:"btn-primary px-6 py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:s(g?"settings.mapDefaults.saving":"settings.mapDefaults.save")})]})]})]})}function ye({selectedYear:s,setSelectedYear:t}){const{t:r}=A(),{settings:h,loading:Z}=G(),{settings:y,loading:w,updateSettings:g,resetToGlobal:p}=xe(s),{toastError:L,toastWarning:c,confirm:j}=B(),[x,a]=n.useState(!1),[S,D]=n.useState(!1),[m,u]=n.useState(null),[v,I]=n.useState(51.898095),[$,k]=n.useState(5.772961),[F,f]=n.useState(17),[C,E]=n.useState(14),[l,o]=n.useState(22),[b,N]=n.useState(21);n.useEffect(()=>{y?(I(y.map_center_lat??51.898095),k(y.map_center_lng??5.772961),f(y.map_default_zoom??17),E(y.map_min_zoom??14),o(y.map_max_zoom??22),N(y.map_search_zoom??21)):h&&(I(h.map_center_lat??51.898095),k(h.map_center_lng??5.772961),f(h.map_default_zoom??17),E(h.map_min_zoom??14),o(h.map_max_zoom??22),N(h.map_search_zoom??21))},[y,h]);const z=async _=>{_.preventDefault(),a(!0),u(null),D(!1);try{if(C>F||F>l)throw new Error(r("settings.mapDefaults.errors.invalidZoomLevels"));if(b<C||b>l)throw new Error(r("settings.mapDefaults.errors.invalidSearchZoom"));if(!await g({map_center_lat:parseFloat(v),map_center_lng:parseFloat($),map_default_zoom:parseInt(F),map_min_zoom:parseInt(C),map_max_zoom:parseInt(l),map_search_zoom:parseInt(b)}))throw new Error("Failed to update map settings");D(!0),setTimeout(()=>D(!1),3e3)}catch(T){console.error("Failed to save map settings:",T),L(T.message||r("settings.mapDefaults.errors.saveFailed")),u(T.message||r("settings.mapDefaults.errors.saveFailed"))}finally{a(!1)}},d=async()=>{if(await j({title:"Reset to Global Settings",message:`Reset map settings for ${s} to use global organization defaults? This will delete any event-specific settings.`,confirmText:"Reset",variant:"warning"}))try{a(!0),await p()&&(D(!0),setTimeout(()=>D(!1),3e3))}catch(T){console.error("Failed to reset to global settings:",T),L("Failed to reset settings")}finally{a(!1)}},R=Z||w,M=!!y;return R?e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:r("settings.mapDefaults.loading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[r("settings.mapDefaults.title")," - ",s]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 border rounded-lg ${M?"bg-green-50 border-green-200":"bg-orange-50 border-orange-200"}`,children:[e.jsx(i,{path:Y,size:.6,className:M?"text-green-600":"text-orange-600"}),e.jsx("span",{className:`text-xs font-semibold uppercase tracking-wide ${M?"text-green-700":"text-orange-700"}`,children:M?"Event Settings":"Global Defaults"})]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Event Year"}),e.jsxs("select",{value:s,onChange:_=>t(parseInt(_.target.value)),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:2024,children:"2024"}),e.jsx("option",{value:2025,children:"2025"}),e.jsx("option",{value:2026,children:"2026"}),e.jsx("option",{value:2027,children:"2027"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:M?`Configure map settings specific to the ${s} event.`:`Using global organization defaults for ${s}. Configure event-specific settings below.`})]}),S&&e.jsxs("div",{className:"bg-green-50 border-l-4 border-green-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:O,size:1,className:"text-green-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-800",children:r("settings.mapDefaults.saveSuccess")}),e.jsx("p",{className:"text-sm text-green-700",children:M?`Map settings updated for ${s}.`:`Settings reset to global defaults for ${s}.`})]})]}),m&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:q,size:1,className:"text-red-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-800",children:r("settings.mapDefaults.error")}),e.jsx("p",{className:"text-sm text-red-700",children:m})]})]}),e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(i,{path:P,size:1,className:"text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r("settings.mapDefaults.mapCenter.title")})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:r("settings.mapDefaults.mapCenter.description")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapCenterLat",className:"label-base",children:r("settings.mapDefaults.mapCenter.latitude")}),e.jsx("input",{type:"number",id:"mapCenterLat",step:"0.000001",min:"-90",max:"90",value:v,onChange:_=>I(_.target.value),className:"input-base",placeholder:"51.898095"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r("settings.mapDefaults.mapCenter.latitudeRange")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapCenterLng",className:"label-base",children:r("settings.mapDefaults.mapCenter.longitude")}),e.jsx("input",{type:"number",id:"mapCenterLng",step:"0.000001",min:"-180",max:"180",value:$,onChange:_=>k(_.target.value),className:"input-base",placeholder:"5.772961"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r("settings.mapDefaults.mapCenter.longitudeRange")})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-2",children:[e.jsx(i,{path:Q,size:.8,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-blue-800",children:r("settings.mapDefaults.mapCenter.hint")})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(i,{path:P,size:1,className:"text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r("settings.mapDefaults.zoomLevels.title")})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:r("settings.mapDefaults.zoomLevels.description")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapDefaultZoom",className:"label-base",children:r("settings.mapDefaults.zoomLevels.defaultZoom")}),e.jsx("input",{type:"number",id:"mapDefaultZoom",min:"1",max:"22",value:F,onChange:_=>f(_.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r("settings.mapDefaults.zoomLevels.defaultZoomDesc")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapSearchZoom",className:"label-base",children:r("settings.mapDefaults.zoomLevels.searchZoom")}),e.jsx("input",{type:"number",id:"mapSearchZoom",min:"1",max:"22",value:b,onChange:_=>N(_.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r("settings.mapDefaults.zoomLevels.searchZoomDesc")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapMinZoom",className:"label-base",children:r("settings.mapDefaults.zoomLevels.minZoom")}),e.jsx("input",{type:"number",id:"mapMinZoom",min:"1",max:"22",value:C,onChange:_=>E(_.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r("settings.mapDefaults.zoomLevels.minZoomDesc")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapMaxZoom",className:"label-base",children:r("settings.mapDefaults.zoomLevels.maxZoom")}),e.jsx("input",{type:"number",id:"mapMaxZoom",min:"1",max:"22",value:l,onChange:_=>o(_.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r("settings.mapDefaults.zoomLevels.maxZoomDesc")})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-amber-800",children:[e.jsxs("span",{className:"font-medium",children:[r("settings.mapDefaults.zoomLevels.constraint"),":"]})," ",r("settings.mapDefaults.zoomLevels.constraintDesc")]})})]}),e.jsxs("div",{className:"flex justify-between bg-white rounded-lg shadow p-6",children:[e.jsxs("button",{type:"button",onClick:d,disabled:x||!M,className:"flex items-center gap-2 px-6 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(i,{path:le,size:.8}),r("settings.mapDefaults.reset")]}),e.jsx("button",{type:"submit",disabled:x,className:"btn-primary px-6 py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:r(x?"settings.mapDefaults.saving":"settings.mapDefaults.save")})]})]})]})}function $e({selectedYear:s,setSelectedYear:t}){var x;const{t:r}=A(),{role:h,isSuperAdmin:Z,isSystemManager:y,isEventManager:w}=X(),[g,p]=n.useState("user-management"),c=[{id:"ui-language",label:r("settings.uiLanguage.title"),icon:W,roles:["super_admin","system_manager","event_manager"],component:e.jsx(je,{}),scope:"personal",description:"Your personal language preference"},{id:"user-management",label:r("settings.userManagement.title"),icon:V,roles:["super_admin","system_manager"],component:e.jsx(pe,{}),scope:"organization",description:"Manage user accounts and roles"},{id:"category-settings",label:r("settings.categoryManagement.title"),icon:oe,roles:["super_admin","system_manager"],component:e.jsx(ve,{}),scope:"organization",description:"Company categories for all users"},{id:"branding",label:r("settings.branding.title"),icon:J,roles:["super_admin","system_manager"],component:e.jsx(be,{}),scope:"organization",description:"Logo, colors, and app name"},{id:"map-defaults",label:r("settings.mapDefaults.title"),icon:P,roles:["super_admin","system_manager"],component:e.jsx(Ne,{}),scope:"organization",description:"Default map position and zoom"},{id:"map-settings",label:"Map Settings by Year",icon:P,roles:["super_admin","system_manager"],component:e.jsx(ye,{selectedYear:s,setSelectedYear:t}),scope:"organization",description:"Configure map settings per event year"},{id:"event-defaults",label:r("settings.eventDefaults.title"),icon:ce,roles:["super_admin","system_manager","event_manager"],component:e.jsx(he,{}),scope:"organization",description:"Default meal counts for events"},{id:"public-default-year",label:r("settings.publicDefaultYear.title"),icon:de,roles:["super_admin","system_manager"],component:e.jsx(fe,{}),scope:"organization",description:"Global public-facing default event year"},{id:"advanced",label:r("settings.advanced.title"),icon:q,roles:["super_admin"],component:e.jsx(_e,{}),scope:"organization",description:"System configuration (danger zone)"}].filter(a=>Z?!0:a.roles.includes(h));H.useEffect(()=>{var a;c.find(S=>S.id===g)||p(((a=c[0])==null?void 0:a.id)||"event-defaults")},[h,c,g]);const j=(x=c.find(a=>a.id===g))==null?void 0:x.component;return e.jsxs("div",{className:"h-full flex flex-col","data-testid":"settings-container",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 px-6 py-4","data-testid":"settings-header",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:r("settings.title")}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[r("settings.subtitle"),e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs font-medium capitalize",children:h==null?void 0:h.replace("_"," ")})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("aside",{className:"w-64 bg-white border-r border-gray-200 overflow-y-auto","data-testid":"settings-sidebar",children:e.jsxs("nav",{className:"p-4 space-y-4",children:[c.filter(a=>a.scope==="personal").length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 mb-1","data-testid":"personal-settings-group",children:[e.jsx(i,{path:K,size:.7,className:"text-blue-600"}),e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Personal Settings"})]}),e.jsx("div",{className:"space-y-1",children:c.filter(a=>a.scope==="personal").map(a=>e.jsxs("button",{onClick:()=>p(a.id),"data-testid":`settings-section-${a.id}`,className:`w-full flex items-start gap-3 px-4 py-3 rounded-lg text-left transition-colors ${g===a.id?"bg-blue-50 text-blue-700 font-medium":"text-gray-700 hover:bg-gray-50"}`,title:a.description,children:[e.jsx(i,{path:a.icon,size:.9,className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium",children:a.label}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:a.description})]})]},a.id))})]}),c.filter(a=>a.scope==="organization").length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 mb-1","data-testid":"organization-settings-group",children:[e.jsx(i,{path:Y,size:.7,className:"text-orange-600"}),e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Organization Settings"})]}),e.jsx("div",{className:"space-y-1",children:c.filter(a=>a.scope==="organization").map(a=>e.jsxs("button",{onClick:()=>p(a.id),"data-testid":`settings-section-${a.id}`,className:`w-full flex items-start gap-3 px-4 py-3 rounded-lg text-left transition-colors ${g===a.id?"bg-orange-50 text-orange-700 font-medium":"text-gray-700 hover:bg-gray-50"}`,title:a.description,children:[e.jsx(i,{path:a.icon,size:.9,className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium",children:a.label}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:a.description})]})]},a.id))})]})]})}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-50 p-6","data-testid":"settings-content",children:j})]})]})}function _e(){const{t:s}=A();return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(i,{path:q,size:1,className:"text-red-600"}),s("settings.advanced.title")]}),e.jsx("p",{className:"text-gray-600",children:s("settings.advanced.description")}),e.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800",children:"âš ï¸ Advanced Settings (Danger Zone) coming soon..."})})]})}export{$e as default};
