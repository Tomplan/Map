import{u as R,K as O,r as a,R as H,s as A,j as e,I as i,aS as K,ag as ae,aT as q,aU as ne,as as re,aj as le,M as ie,aJ as oe,aE as W,a1 as B,L as G,aV as ce,aW as de,aX as me,aY as X,aZ as J,a_ as Q,o as P,a$ as ee,b0 as ue,a2 as ge,a3 as se,i as xe,a5 as pe,b1 as fe}from"./index-12ba77bc.js";import{u as te}from"./useUserRole-cf3c7d99.js";import"./ProtectedSection-9257d117.js";import{u as he}from"./useOrganizationProfile-df09fa4f.js";import{L as be}from"./LanguageToggle-cfa10ab6.js";import je from"./CategoryManagement-5dc8b5bb.js";import{u as ve}from"./useEventMapSettings-ac5f7175.js";import"./phone-376c158e.js";import"./useCategories-9824a5e1.js";function Ne(){const{t:s}=R(),{isSuperAdmin:t}=te(),{confirm:n}=O(),[x,S]=a.useState([]),[y,D]=a.useState(!0),[u,f]=a.useState(null),[F,d]=a.useState(!1),[v,p]=a.useState(""),[r,z]=a.useState("event_manager"),[C,m]=a.useState(!1),[g,N]=a.useState(!1),[I,T]=a.useState(null),k=H.useCallback(async()=>{try{D(!0),f(null);let o,c;try{const _=await A.rpc("get_user_roles_with_email");o=_.data,c=_.error}catch{console.warn("get_user_roles_with_email not available, using fallback");const w=await A.from("user_roles").select("user_id, role, created_at, updated_at").order("created_at",{ascending:!1});o=w.data,c=w.error}if(c)throw c;const{data:{user:b}}=await A.auth.getUser(),j=(o||[]).map(_=>{const w=(b==null?void 0:b.id)===_.user_id;return{id:_.user_id,email:_.email||(w?b.email:`user-${_.user_id.substring(0,8)}...`),role:_.role,created_at:_.created_at,last_sign_in_at:_.last_sign_in_at||(w?b.last_sign_in_at:null),isCurrentUser:w}});S(j),D(!1)}catch(o){console.error("Error fetching users:",o),f(s("settings.userManagement.errors.fetchFailed")),D(!1)}},[s]);a.useEffect(()=>{k()},[k]);const L=async o=>{var c;o.preventDefault(),m(!0),f(null);try{const j="/Map",_=`${window.location.origin}${j}#/reset-password`,w=Math.random().toString(36).slice(-12)+"A1!",{data:U,error:$}=await A.auth.signUp({email:v,password:w,options:{data:{role:r},emailRedirectTo:_}});if($)throw $;if((c=U==null?void 0:U.user)!=null&&c.id){const{error:Z}=await A.from("user_roles").insert({user_id:U.user.id,role:r});Z&&console.warn("Failed to add user to user_roles:",Z)}const{error:l}=await A.auth.resetPasswordForEmail(v,{redirectTo:_});l&&console.warn("Password reset email failed:",l),N(!0),setTimeout(()=>{d(!1),N(!1),p(""),z("event_manager"),k()},8e3)}catch(b){console.error("Error inviting user:",b),f(b.message||s("settings.userManagement.errors.inviteFailed"))}finally{m(!1)}},h=async(o,c)=>{if(await n({title:s("settings.userManagement.deleteUser"),message:s("settings.userManagement.confirmDelete",{email:c}),confirmText:s("common.delete"),variant:"danger"}))try{f(null);const{error:j}=await A.from("user_roles").delete().eq("user_id",o);if(j)throw j;await k()}catch(j){console.error("Error deleting user:",j),f(s("settings.userManagement.errors.deleteFailed"))}},M={super_admin:s("settings.userManagement.roles.superAdmin"),system_manager:s("settings.userManagement.roles.systemManager"),event_manager:s("settings.userManagement.roles.eventManager")},E={super_admin:"bg-purple-100 text-purple-800 border-purple-200",system_manager:"bg-blue-100 text-blue-800 border-blue-200",event_manager:"bg-green-100 text-green-800 border-green-200"};return y?e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-gray-500",children:s("settings.userManagement.loading")})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(i,{path:K,size:1}),s("settings.userManagement.title")]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s("settings.userManagement.description")})]}),e.jsxs("button",{onClick:()=>d(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(i,{path:ae,size:.8}),s("settings.userManagement.inviteUser")]})]}),u&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(i,{path:q,size:.8,className:"mr-2"}),e.jsx("span",{className:"text-sm",children:u})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:s("settings.userManagement.table.email")}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:s("settings.userManagement.table.role")}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:s("settings.userManagement.table.created")}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-gray-700",children:s("settings.userManagement.table.lastLogin")}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-gray-700",children:s("settings.userManagement.table.actions")})]})}),e.jsx("tbody",{children:x.map(o=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{path:ne,size:.7,className:"text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:o.email})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-medium border ${E[o.role]||"bg-gray-100 text-gray-800"}`,children:M[o.role]||o.role})}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:new Date(o.created_at).toLocaleDateString()}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:o.last_sign_in_at?new Date(o.last_sign_in_at).toLocaleDateString():"-"}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>T(o),className:"p-2 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:s("settings.userManagement.editRole"),children:e.jsx(i,{path:re,size:.7})}),t&&e.jsx("button",{onClick:()=>h(o.id,o.email),className:"p-2 text-red-600 hover:bg-red-50 rounded transition-colors",title:s("settings.userManagement.deleteUser"),children:e.jsx(i,{path:le,size:.7})})]})})]},o.id))})]})})]}),e.jsx(ie,{isOpen:F,onClose:()=>d(!1),title:s("settings.userManagement.inviteUser"),size:"md",children:e.jsx("div",{className:"p-6",children:g?e.jsx("div",{className:"bg-green-50 border-l-4 border-green-500 text-green-700 px-4 py-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(i,{path:oe,size:.8,className:"mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s("settings.userManagement.inviteSuccess")}),e.jsx("p",{className:"text-sm mt-1",children:s("settings.userManagement.inviteSuccessMessage")})]})]})}):e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label-base",children:s("settings.userManagement.emailLabel")}),e.jsx("input",{type:"email",value:v,onChange:o=>p(o.target.value),className:"input-base",placeholder:"manager@example.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-base",children:s("settings.userManagement.roleLabel")}),e.jsxs("select",{value:r,onChange:o=>z(o.target.value),className:"input-base",children:[e.jsx("option",{value:"event_manager",children:M.event_manager}),e.jsx("option",{value:"system_manager",children:M.system_manager}),t&&e.jsx("option",{value:"super_admin",children:M.super_admin})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s(`settings.userManagement.roleDescriptions.${r}`)})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"flex-1 py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:s("settings.userManagement.cancel")}),e.jsx("button",{type:"submit",disabled:C,className:"flex-1 btn-primary",children:s(C?"settings.userManagement.sending":"settings.userManagement.sendInvite")})]})]})})})]})}function ye(){const{t:s}=R(),{settings:t,loading:n,error:x,updateSettings:S}=W(),{toastError:y,toastWarning:D}=O(),[u,f]=a.useState(!1),[F,d]=a.useState(!1),[v,p]=a.useState(null),[r,z]=a.useState(0),[C,m]=a.useState(0),[g,N]=a.useState(0),[I,T]=a.useState(0),[k,L]=a.useState(0),[h,M]=a.useState(!0),[E,o]=a.useState(!0),[c,b]=a.useState(!0),[j,_]=a.useState(0);a.useEffect(()=>{if(t&&(z(t.default_breakfast_sat??0),m(t.default_lunch_sat??0),N(t.default_bbq_sat??0),T(t.default_breakfast_sun??0),L(t.default_lunch_sun??0),t.notification_settings)){const l=typeof t.notification_settings=="string"?JSON.parse(t.notification_settings):t.notification_settings;M(l.emailNotifications??!0),o(l.newSubscriptionNotify??!0),b(l.assignmentChangeNotify??!0)}},[t]);const{profile:w}=he();a.useEffect(()=>{typeof(w==null?void 0:w.default_coins)=="number"&&_(w.default_coins)},[w]);const U=async l=>{var Z;l.preventDefault(),f(!0),p(null),d(!1);try{if(!await S({default_breakfast_sat:r,default_lunch_sat:C,default_bbq_sat:g,default_breakfast_sun:I,default_lunch_sun:k,notification_settings:{emailNotifications:h,newSubscriptionNotify:E,assignmentChangeNotify:c}}))throw new Error("Failed to update settings");try{const{error:V}=await A.from("organization_profile").update({default_coins:j}).eq("id",1);V&&console.warn("Failed to persist default_coins to organization_profile:",V)}catch(V){console.warn("Failed to persist default_coins to organization_profile:",V)}d(!0),setTimeout(()=>d(!1),3e3)}catch(Y){console.error("Failed to save settings:",Y),(Z=Y.message)!=null&&Z.includes("updated by another admin")?(D(Y.message),p(s("settings.eventDefaults.errors.saveFailed"))):(y(Y.message||s("settings.eventDefaults.errors.saveFailed")),p(Y.message||s("settings.eventDefaults.errors.saveFailed")))}finally{f(!1)}},$=()=>{if(t){if(z(t.default_breakfast_sat??0),m(t.default_lunch_sat??0),N(t.default_bbq_sat??0),T(t.default_breakfast_sun??0),L(t.default_lunch_sun??0),t.notification_settings){const l=typeof t.notification_settings=="string"?JSON.parse(t.notification_settings):t.notification_settings;M(l.emailNotifications??!0),o(l.newSubscriptionNotify??!0),b(l.assignmentChangeNotify??!0)}w&&typeof w.default_coins=="number"&&_(w.default_coins)}};return n?e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:s("settings.eventDefaults.loading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s("settings.eventDefaults.title")}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(i,{path:B,size:.6,className:"text-orange-600"}),e.jsx("span",{className:"text-xs font-semibold text-orange-700 uppercase tracking-wide",children:"Organization Setting"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s("settings.eventDefaults.description")})]}),F&&e.jsxs("div",{className:"bg-green-50 border-l-4 border-green-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:G,size:1,className:"text-green-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-800",children:s("settings.eventDefaults.saveSuccess")}),e.jsx("p",{className:"text-sm text-green-700",children:s("settings.eventDefaults.saveSuccessMessage")})]})]}),v&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:q,size:1,className:"text-red-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-800",children:s("settings.eventDefaults.error")}),e.jsx("p",{className:"text-sm text-red-700",children:v})]})]}),e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(i,{path:ce,size:1,className:"text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("settings.eventDefaults.mealDefaults.title")})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:s("settings.eventDefaults.mealDefaults.description")}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:s("settings.eventDefaults.mealDefaults.saturday")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"breakfastSat",className:"label-base",children:s("settings.eventDefaults.mealDefaults.breakfast")}),e.jsx("input",{type:"number",id:"breakfastSat",min:"0",max:"9999",value:r,onChange:l=>z(parseInt(l.target.value)||0),className:"input-base"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"lunchSat",className:"label-base",children:s("settings.eventDefaults.mealDefaults.lunch")}),e.jsx("input",{type:"number",id:"lunchSat",min:"0",max:"9999",value:C,onChange:l=>m(parseInt(l.target.value)||0),className:"input-base"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bbqSat",className:"label-base",children:s("settings.eventDefaults.mealDefaults.bbq")}),e.jsx("input",{type:"number",id:"bbqSat",min:"0",max:"9999",value:g,onChange:l=>N(parseInt(l.target.value)||0),className:"input-base"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:s("settings.eventDefaults.mealDefaults.sunday")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"breakfastSun",className:"label-base",children:s("settings.eventDefaults.mealDefaults.breakfast")}),e.jsx("input",{type:"number",id:"breakfastSun",min:"0",max:"9999",value:I,onChange:l=>T(parseInt(l.target.value)||0),className:"input-base"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"lunchSun",className:"label-base",children:s("settings.eventDefaults.mealDefaults.lunch")}),e.jsx("input",{type:"number",id:"lunchSun",min:"0",max:"9999",value:k,onChange:l=>L(parseInt(l.target.value)||0),className:"input-base"})]}),e.jsxs("div",{className:"opacity-50",children:[e.jsx("label",{className:"label-base text-gray-400",children:s("settings.eventDefaults.mealDefaults.bbq")}),e.jsx("span",{className:"input-base bg-gray-100 cursor-not-allowed block w-full h-[2.5rem] rounded text-center text-gray-400","aria-disabled":"true",children:"â€”"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s("settings.eventDefaults.mealDefaults.sundayNoBbq")})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(i,{path:de,size:1,className:"text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("settings.eventDefaults.coins.title","Default coins")})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:s("settings.eventDefaults.coins.description","Number of default coins assigned to a new subscription when created.")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 max-w-sm",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"defaultCoins",className:"label-base",children:s("settings.eventDefaults.coins.label","Default coins")}),e.jsx("input",{type:"number",id:"defaultCoins",min:"0",max:"9999",value:j,onChange:l=>_(parseInt(l.target.value)||0),className:"input-base"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(i,{path:me,size:1,className:"text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("settings.eventDefaults.notifications.title")})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:s("settings.eventDefaults.notifications.description")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"emailNotifications",className:"font-medium text-gray-900",children:s("settings.eventDefaults.notifications.emailNotifications")}),e.jsx("p",{className:"text-sm text-gray-600",children:s("settings.eventDefaults.notifications.emailNotificationsDesc")})]}),e.jsx("button",{type:"button",role:"switch","aria-checked":h,onClick:()=>M(!h),className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 ${h?"bg-orange-600":"bg-gray-300"}`,children:e.jsx("span",{className:`pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${h?"translate-x-5":"translate-x-0"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newSubscriptionNotify",className:"font-medium text-gray-900",children:s("settings.eventDefaults.notifications.newSubscription")}),e.jsx("p",{className:"text-sm text-gray-600",children:s("settings.eventDefaults.notifications.newSubscriptionDesc")})]}),e.jsx("button",{type:"button",role:"switch","aria-checked":E,onClick:()=>o(!E),disabled:!h,className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 ${E&&h?"bg-orange-600":"bg-gray-300"} ${h?"":"opacity-50 cursor-not-allowed"}`,children:e.jsx("span",{className:`pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${E?"translate-x-5":"translate-x-0"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"assignmentChangeNotify",className:"font-medium text-gray-900",children:s("settings.eventDefaults.notifications.assignmentChange")}),e.jsx("p",{className:"text-sm text-gray-600",children:s("settings.eventDefaults.notifications.assignmentChangeDesc")})]}),e.jsx("button",{type:"button",role:"switch","aria-checked":c,onClick:()=>b(!c),disabled:!h,className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 ${c&&h?"bg-orange-600":"bg-gray-300"} ${h?"":"opacity-50 cursor-not-allowed"}`,children:e.jsx("span",{className:`pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${c?"translate-x-5":"translate-x-0"}`})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 bg-white rounded-lg shadow p-6",children:[e.jsx("button",{type:"button",onClick:$,disabled:u,className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:s("settings.eventDefaults.reset")}),e.jsx("button",{type:"submit",disabled:u,className:"btn-primary px-6 py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:s(u?"settings.eventDefaults.saving":"settings.eventDefaults.save")})]})]})]})}function _e(){const{t:s}=R(),{settings:t,loading:n,updateSetting:x}=W(),{toastError:S,toastWarning:y}=O(),[D,u]=a.useState(""),[f,F]=a.useState(!1),[d,v]=a.useState(!1),[p,r]=a.useState(null);a.useEffect(()=>{t&&u(t.public_default_year==null?"":String(t.public_default_year))},[t]);const z=m=>{if(m==="")return!0;const g=Number(m);return!(!Number.isInteger(g)||g<2e3||g>2100)},C=async m=>{var g;m.preventDefault(),r(null),F(!0);try{if(!z(D))throw new Error(s("settings.publicDefaultYear.errors.invalid"));const N=D===""?null:parseInt(D,10);await x("public_default_year",N),v(!0),setTimeout(()=>v(!1),2500)}catch(N){console.error("Failed to update public default year",N),(g=N.message)!=null&&g.includes("updated by another admin")?y(N.message):S(N.message||s("settings.publicDefaultYear.errors.saveFailed")),r(N.message||s("settings.publicDefaultYear.errors.saveFailed"))}finally{F(!1)}};return n?e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:s("settings.publicDefaultYear.loading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s("settings.publicDefaultYear.title")}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(i,{path:B,size:.6,className:"text-orange-600"}),e.jsx("span",{className:"text-xs font-semibold text-orange-700 uppercase tracking-wide",children:"Organization Setting"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s("settings.publicDefaultYear.description")})]}),d&&e.jsxs("div",{className:"bg-green-50 border-l-4 border-green-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:G,size:1,className:"text-green-600 mr-3 flex-shrink-0"}),e.jsx("div",{children:e.jsx("p",{className:"font-semibold text-green-800",children:s("settings.publicDefaultYear.saveSuccess")})})]}),p&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:q,size:1,className:"text-red-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-800",children:s("settings.publicDefaultYear.error")}),e.jsx("p",{className:"text-sm text-red-700",children:p})]})]}),e.jsxs("form",{onSubmit:C,className:"bg-white rounded-lg shadow p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"publicDefaultYear",className:"label-base",children:s("settings.publicDefaultYear.inputLabel")}),e.jsx("input",{id:"publicDefaultYear",type:"number",min:"2000",max:"2100",placeholder:s("settings.publicDefaultYear.placeholder"),value:D,onChange:m=>u(m.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:s("settings.publicDefaultYear.hint")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"submit",disabled:f,className:"btn-primary","data-testid":"save-public-default-year",children:s(f?"settings.publicDefaultYear.saving":"settings.publicDefaultYear.save")}),e.jsx("button",{type:"button",onClick:()=>u((t==null?void 0:t.public_default_year)==null?"":String(t.public_default_year)),className:"btn-outline",children:s("settings.publicDefaultYear.reset")})]})]})]})}function we(){const{t:s}=R(),{settings:t,loading:n,updateSettings:x}=W(),{toastError:S,toastWarning:y}=O(),[D,u]=a.useState(!1),[f,F]=a.useState(!1),[d,v]=a.useState("#3b82f6"),[p,r]=a.useState("Arvo, serif");a.useEffect(()=>{t&&(v(t.theme_color||"#3b82f6"),r(t.font_family||"Arvo, serif"))},[t]);const z=async()=>{var m;try{if(u(!0),!await x({theme_color:d,font_family:p}))throw new Error("Failed to update branding settings");F(!0),setTimeout(()=>F(!1),3e3)}catch(g){console.error("Error saving branding settings:",g),(m=g.message)!=null&&m.includes("updated by another admin")?y(g.message):S(g.message||s("settings.branding.errors.saveFailed"))}finally{u(!1)}},C=()=>{t&&(v(t.theme_color||"#3b82f6"),r(t.font_family||"Arvo, serif"))};return n?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"text-gray-500",children:s("settings.branding.loading")})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{path:X,size:1,className:"text-orange-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s("settings.branding.title")})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(i,{path:B,size:.6,className:"text-orange-600"}),e.jsx("span",{className:"text-xs font-semibold text-orange-700 uppercase tracking-wide",children:"Organization Setting"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s("settings.branding.description")}),e.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:["ðŸ’¡ ",s("settings.branding.note")]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("settings.branding.themeColor.label")}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:s("settings.branding.themeColor.description")}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"color",value:d,onChange:m=>v(m.target.value),className:"h-12 w-24 border border-gray-300 rounded cursor-pointer"}),e.jsx("input",{type:"text",value:d,onChange:m=>v(m.target.value),placeholder:"#ffffff",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",maxLength:7})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"p-4 rounded-lg border-2",style:{backgroundColor:d,borderColor:d},children:[e.jsx("p",{className:"font-bold text-white text-lg",children:"Preview Text (White on Color)"}),e.jsx("p",{className:"text-white text-sm opacity-90",children:"The quick brown fox jumps over the lazy dog"})]}),e.jsxs("div",{className:"p-4 rounded-lg border-2 border-gray-300 bg-white",children:[e.jsx("p",{className:"font-bold text-lg",style:{color:d},children:"Preview Text (Color on White)"}),e.jsx("p",{className:"text-sm",style:{color:d},children:"The quick brown fox jumps over the lazy dog"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("settings.branding.fontFamily.label")}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:s("settings.branding.fontFamily.description")}),e.jsxs("select",{value:p,onChange:m=>r(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Arvo, Sans-serif",children:"Arvo (Default)"}),e.jsx("option",{value:"Arial, sans-serif",children:"Arial"}),e.jsx("option",{value:"Helvetica, sans-serif",children:"Helvetica"}),e.jsx("option",{value:"Georgia, serif",children:"Georgia"}),e.jsx("option",{value:"'Times New Roman', serif",children:"Times New Roman"}),e.jsx("option",{value:"'Courier New', monospace",children:"Courier New"}),e.jsx("option",{value:"Verdana, sans-serif",children:"Verdana"}),e.jsx("option",{value:"'Comic Sans MS', cursive",children:"Comic Sans MS"}),e.jsx("option",{value:"Impact, sans-serif",children:"Impact"})]}),e.jsxs("div",{className:"mt-3 p-4 rounded-lg border border-gray-300 bg-white",style:{fontFamily:p},children:[e.jsx("p",{className:"text-lg text-gray-900 font-semibold",children:"The quick brown fox jumps over the lazy dog"}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:"1234567890 !@#$%^&*()"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:C,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50",children:s("settings.branding.reset")}),e.jsx("button",{onClick:z,disabled:D,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:D?s("common.saving"):f?e.jsxs(e.Fragment,{children:[e.jsx(i,{path:G,size:.8}),s("settings.branding.saveSuccess")]}):s("common.save")})]})]})}function Se(){const{t:s}=R();return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{path:J,size:1.2,className:"text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s("settings.uiLanguage.title")}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s("settings.uiLanguage.description")})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(i,{path:Q,size:.6,className:"text-blue-600"}),e.jsx("span",{className:"text-xs font-semibold text-blue-700 uppercase tracking-wide",children:"Personal Setting"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(i,{path:J,size:.9,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:s("settings.uiLanguage.note.title")}),e.jsx("p",{children:s("settings.uiLanguage.note.description")})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:s("settings.uiLanguage.selectLanguage")}),e.jsx(be,{})]})]})]})}function De(){return e.jsx(je,{})}function ze(){const{t:s}=R(),{settings:t,loading:n,error:x,updateSettings:S}=W(),{toastError:y,toastWarning:D}=O(),[u,f]=a.useState(!1),[F,d]=a.useState(!1),[v,p]=a.useState(null),[r,z]=a.useState(51.898095),[C,m]=a.useState(5.772961),[g,N]=a.useState(17),[I,T]=a.useState(14),[k,L]=a.useState(22),[h,M]=a.useState(21);a.useEffect(()=>{t&&(z(t.map_center_lat??51.898095),m(t.map_center_lng??5.772961),N(t.map_default_zoom??17),T(t.map_min_zoom??14),L(t.map_max_zoom??22),M(t.map_search_zoom??21))},[t]);const E=async c=>{var b;c.preventDefault(),f(!0),p(null),d(!1);try{if(I>g||g>k)throw new Error(s("settings.mapDefaults.errors.invalidZoomLevels"));if(h<I||h>k)throw new Error(s("settings.mapDefaults.errors.invalidSearchZoom"));if(!await S({map_center_lat:parseFloat(r),map_center_lng:parseFloat(C),map_default_zoom:parseInt(g),map_min_zoom:parseInt(I),map_max_zoom:parseInt(k),map_search_zoom:parseInt(h)}))throw new Error("Failed to update map settings");d(!0),setTimeout(()=>d(!1),3e3)}catch(j){console.error("Failed to save map settings:",j),(b=j.message)!=null&&b.includes("updated by another admin")?(D(j.message),p(s("settings.mapDefaults.errors.saveFailed"))):(y(j.message||s("settings.mapDefaults.errors.saveFailed")),p(j.message||s("settings.mapDefaults.errors.saveFailed")))}finally{f(!1)}},o=()=>{t&&(z(t.map_center_lat??51.898095),m(t.map_center_lng??5.772961),N(t.map_default_zoom??17),T(t.map_min_zoom??14),L(t.map_max_zoom??22),M(t.map_search_zoom??21))};return n?e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:s("settings.mapDefaults.loading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s("settings.mapDefaults.title")}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(i,{path:B,size:.6,className:"text-orange-600"}),e.jsx("span",{className:"text-xs font-semibold text-orange-700 uppercase tracking-wide",children:"Organization Setting"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s("settings.mapDefaults.description")})]}),F&&e.jsxs("div",{className:"bg-green-50 border-l-4 border-green-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:G,size:1,className:"text-green-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-800",children:s("settings.mapDefaults.saveSuccess")}),e.jsx("p",{className:"text-sm text-green-700",children:s("settings.mapDefaults.saveSuccessMessage")})]})]}),v&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:q,size:1,className:"text-red-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-800",children:s("settings.mapDefaults.error")}),e.jsx("p",{className:"text-sm text-red-700",children:v})]})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(i,{path:P,size:1,className:"text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("settings.mapDefaults.mapCenter.title")})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:s("settings.mapDefaults.mapCenter.description")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapCenterLat",className:"label-base",children:s("settings.mapDefaults.mapCenter.latitude")}),e.jsx("input",{type:"number",id:"mapCenterLat",step:"0.000001",min:"-90",max:"90",value:r,onChange:c=>z(c.target.value),className:"input-base",placeholder:"51.898095"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("settings.mapDefaults.mapCenter.latitudeRange")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapCenterLng",className:"label-base",children:s("settings.mapDefaults.mapCenter.longitude")}),e.jsx("input",{type:"number",id:"mapCenterLng",step:"0.000001",min:"-180",max:"180",value:C,onChange:c=>m(c.target.value),className:"input-base",placeholder:"5.772961"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("settings.mapDefaults.mapCenter.longitudeRange")})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-2",children:[e.jsx(i,{path:ee,size:.8,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-blue-800",children:s("settings.mapDefaults.mapCenter.hint")})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(i,{path:P,size:1,className:"text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("settings.mapDefaults.zoomLevels.title")})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:s("settings.mapDefaults.zoomLevels.description")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapDefaultZoom",className:"label-base",children:s("settings.mapDefaults.zoomLevels.defaultZoom")}),e.jsx("input",{type:"number",id:"mapDefaultZoom",min:"1",max:"22",value:g,onChange:c=>N(c.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("settings.mapDefaults.zoomLevels.defaultZoomDesc")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapSearchZoom",className:"label-base",children:s("settings.mapDefaults.zoomLevels.searchZoom")}),e.jsx("input",{type:"number",id:"mapSearchZoom",min:"1",max:"22",value:h,onChange:c=>M(c.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("settings.mapDefaults.zoomLevels.searchZoomDesc")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapMinZoom",className:"label-base",children:s("settings.mapDefaults.zoomLevels.minZoom")}),e.jsx("input",{type:"number",id:"mapMinZoom",min:"1",max:"22",value:I,onChange:c=>T(c.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("settings.mapDefaults.zoomLevels.minZoomDesc")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapMaxZoom",className:"label-base",children:s("settings.mapDefaults.zoomLevels.maxZoom")}),e.jsx("input",{type:"number",id:"mapMaxZoom",min:"1",max:"22",value:k,onChange:c=>L(c.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("settings.mapDefaults.zoomLevels.maxZoomDesc")})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-amber-800",children:[e.jsxs("span",{className:"font-medium",children:[s("settings.mapDefaults.zoomLevels.constraint"),":"]})," ",s("settings.mapDefaults.zoomLevels.constraintDesc")]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 bg-white rounded-lg shadow p-6",children:[e.jsx("button",{type:"button",onClick:o,disabled:u,className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:s("settings.mapDefaults.reset")}),e.jsx("button",{type:"submit",disabled:u,className:"btn-primary px-6 py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:s(u?"settings.mapDefaults.saving":"settings.mapDefaults.save")})]})]})]})}function Ce({selectedYear:s,setSelectedYear:t}){const{t:n}=R(),{settings:x,loading:S}=W(),{settings:y,loading:D,updateSettings:u,resetToGlobal:f}=ve(s),{toastError:F,toastWarning:d,confirm:v}=O(),[p,r]=a.useState(!1),[z,C]=a.useState(!1),[m,g]=a.useState(null),[N,I]=a.useState(51.898095),[T,k]=a.useState(5.772961),[L,h]=a.useState(17),[M,E]=a.useState(14),[o,c]=a.useState(22),[b,j]=a.useState(21);a.useEffect(()=>{y?(I(y.map_center_lat??51.898095),k(y.map_center_lng??5.772961),h(y.map_default_zoom??17),E(y.map_min_zoom??14),c(y.map_max_zoom??22),j(y.map_search_zoom??21)):x&&(I(x.map_center_lat??51.898095),k(x.map_center_lng??5.772961),h(x.map_default_zoom??17),E(x.map_min_zoom??14),c(x.map_max_zoom??22),j(x.map_search_zoom??21))},[y,x]);const _=async l=>{l.preventDefault(),r(!0),g(null),C(!1);try{if(M>L||L>o)throw new Error(n("settings.mapDefaults.errors.invalidZoomLevels"));if(b<M||b>o)throw new Error(n("settings.mapDefaults.errors.invalidSearchZoom"));if(!await u({map_center_lat:parseFloat(N),map_center_lng:parseFloat(T),map_default_zoom:parseInt(L),map_min_zoom:parseInt(M),map_max_zoom:parseInt(o),map_search_zoom:parseInt(b)}))throw new Error("Failed to update map settings");C(!0),setTimeout(()=>C(!1),3e3)}catch(Z){console.error("Failed to save map settings:",Z),F(Z.message||n("settings.mapDefaults.errors.saveFailed")),g(Z.message||n("settings.mapDefaults.errors.saveFailed"))}finally{r(!1)}},w=async()=>{if(await v({title:"Reset to Global Settings",message:`Reset map settings for ${s} to use global organization defaults? This will delete any event-specific settings.`,confirmText:"Reset",variant:"warning"}))try{r(!0),await f()&&(C(!0),setTimeout(()=>C(!1),3e3))}catch(Z){console.error("Failed to reset to global settings:",Z),F("Failed to reset settings")}finally{r(!1)}},U=S||D,$=!!y;return U?e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:n("settings.mapDefaults.loading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[n("settings.mapDefaults.title")," - ",s]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 border rounded-lg ${$?"bg-green-50 border-green-200":"bg-orange-50 border-orange-200"}`,children:[e.jsx(i,{path:B,size:.6,className:$?"text-green-600":"text-orange-600"}),e.jsx("span",{className:`text-xs font-semibold uppercase tracking-wide ${$?"text-green-700":"text-orange-700"}`,children:$?"Event Settings":"Global Defaults"})]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Event Year"}),e.jsxs("select",{value:s,onChange:l=>t(parseInt(l.target.value)),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:2024,children:"2024"}),e.jsx("option",{value:2025,children:"2025"}),e.jsx("option",{value:2026,children:"2026"}),e.jsx("option",{value:2027,children:"2027"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:$?`Configure map settings specific to the ${s} event.`:`Using global organization defaults for ${s}. Configure event-specific settings below.`})]}),z&&e.jsxs("div",{className:"bg-green-50 border-l-4 border-green-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:G,size:1,className:"text-green-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-800",children:n("settings.mapDefaults.saveSuccess")}),e.jsx("p",{className:"text-sm text-green-700",children:$?`Map settings updated for ${s}.`:`Settings reset to global defaults for ${s}.`})]})]}),m&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-lg flex items-start",children:[e.jsx(i,{path:q,size:1,className:"text-red-600 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-800",children:n("settings.mapDefaults.error")}),e.jsx("p",{className:"text-sm text-red-700",children:m})]})]}),e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(i,{path:P,size:1,className:"text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:n("settings.mapDefaults.mapCenter.title")})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:n("settings.mapDefaults.mapCenter.description")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapCenterLat",className:"label-base",children:n("settings.mapDefaults.mapCenter.latitude")}),e.jsx("input",{type:"number",id:"mapCenterLat",step:"0.000001",min:"-90",max:"90",value:N,onChange:l=>I(l.target.value),className:"input-base",placeholder:"51.898095"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:n("settings.mapDefaults.mapCenter.latitudeRange")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapCenterLng",className:"label-base",children:n("settings.mapDefaults.mapCenter.longitude")}),e.jsx("input",{type:"number",id:"mapCenterLng",step:"0.000001",min:"-180",max:"180",value:T,onChange:l=>k(l.target.value),className:"input-base",placeholder:"5.772961"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:n("settings.mapDefaults.mapCenter.longitudeRange")})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-2",children:[e.jsx(i,{path:ee,size:.8,className:"text-blue-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-blue-800",children:n("settings.mapDefaults.mapCenter.hint")})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(i,{path:P,size:1,className:"text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:n("settings.mapDefaults.zoomLevels.title")})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:n("settings.mapDefaults.zoomLevels.description")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapDefaultZoom",className:"label-base",children:n("settings.mapDefaults.zoomLevels.defaultZoom")}),e.jsx("input",{type:"number",id:"mapDefaultZoom",min:"1",max:"22",value:L,onChange:l=>h(l.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:n("settings.mapDefaults.zoomLevels.defaultZoomDesc")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapSearchZoom",className:"label-base",children:n("settings.mapDefaults.zoomLevels.searchZoom")}),e.jsx("input",{type:"number",id:"mapSearchZoom",min:"1",max:"22",value:b,onChange:l=>j(l.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:n("settings.mapDefaults.zoomLevels.searchZoomDesc")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapMinZoom",className:"label-base",children:n("settings.mapDefaults.zoomLevels.minZoom")}),e.jsx("input",{type:"number",id:"mapMinZoom",min:"1",max:"22",value:M,onChange:l=>E(l.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:n("settings.mapDefaults.zoomLevels.minZoomDesc")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mapMaxZoom",className:"label-base",children:n("settings.mapDefaults.zoomLevels.maxZoom")}),e.jsx("input",{type:"number",id:"mapMaxZoom",min:"1",max:"22",value:o,onChange:l=>c(l.target.value),className:"input-base"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:n("settings.mapDefaults.zoomLevels.maxZoomDesc")})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-amber-800",children:[e.jsxs("span",{className:"font-medium",children:[n("settings.mapDefaults.zoomLevels.constraint"),":"]})," ",n("settings.mapDefaults.zoomLevels.constraintDesc")]})})]}),e.jsxs("div",{className:"flex justify-between bg-white rounded-lg shadow p-6",children:[e.jsxs("button",{type:"button",onClick:w,disabled:p||!$,className:"flex items-center gap-2 px-6 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(i,{path:ue,size:.8}),n("settings.mapDefaults.reset")]}),e.jsx("button",{type:"submit",disabled:p,className:"btn-primary px-6 py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:n(p?"settings.mapDefaults.saving":"settings.mapDefaults.save")})]})]})]})}function Me(){const{t:s}=R(),[t,n]=a.useState(!1);a.useEffect(()=>{const S=()=>{n(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",S),()=>document.removeEventListener("fullscreenchange",S)},[]);const x=async()=>{try{document.fullscreenElement?document.exitFullscreen&&await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(S){console.error("Error toggling fullscreen:",S)}};return e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(i,{path:t?ge:se,size:1,className:"text-gray-500"}),s("settings.fullScreen.title","Full Screen Mode")]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s("settings.fullScreen.description","Toggle full screen mode for an immersive experience.")})]}),e.jsx("button",{onClick:x,className:`px-4 py-2 rounded-lg font-medium transition-colors ${t?"bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-300":"bg-blue-600 text-white hover:bg-blue-700 shadow-sm"}`,children:t?s("settings.fullScreen.exit","Exit Full Screen"):s("settings.fullScreen.enter","Enter Full Screen")})]})})}function qe({selectedYear:s,setSelectedYear:t}){var p;const{t:n}=R(),{role:x,isSuperAdmin:S,isSystemManager:y,isEventManager:D}=te(),[u,f]=a.useState("user-management"),d=[{id:"full-screen",label:n("settings.fullScreen.title","Full Screen"),icon:se,roles:["super_admin","system_manager","event_manager","content_editor"],component:e.jsx(Me,{}),scope:"personal",description:n("settings.fullScreen.description","Toggle full screen mode")},{id:"ui-language",label:n("settings.uiLanguage.title"),icon:J,roles:["super_admin","system_manager","event_manager"],component:e.jsx(Se,{}),scope:"personal",description:"Your personal language preference"},{id:"user-management",label:n("settings.userManagement.title"),icon:K,roles:["super_admin","system_manager"],component:e.jsx(Ne,{}),scope:"organization",description:"Manage user accounts and roles"},{id:"category-settings",label:n("settings.categoryManagement.title"),icon:xe,roles:["super_admin","system_manager"],component:e.jsx(De,{}),scope:"organization",description:"Company categories for all users"},{id:"branding",label:n("settings.branding.title"),icon:X,roles:["super_admin","system_manager"],component:e.jsx(we,{}),scope:"organization",description:"Logo, colors, and app name"},{id:"map-defaults",label:n("settings.mapDefaults.title"),icon:P,roles:["super_admin","system_manager"],component:e.jsx(ze,{}),scope:"organization",description:"Default map position and zoom"},{id:"map-settings",label:"Map Settings by Year",icon:P,roles:["super_admin","system_manager"],component:e.jsx(Ce,{selectedYear:s,setSelectedYear:t}),scope:"organization",description:"Configure map settings per event year"},{id:"event-defaults",label:n("settings.eventDefaults.title"),icon:pe,roles:["super_admin","system_manager","event_manager"],component:e.jsx(ye,{}),scope:"organization",description:"Default meal counts for events"},{id:"public-default-year",label:n("settings.publicDefaultYear.title"),icon:fe,roles:["super_admin","system_manager"],component:e.jsx(_e,{}),scope:"organization",description:"Global public-facing default event year"},{id:"advanced",label:n("settings.advanced.title"),icon:q,roles:["super_admin"],component:e.jsx(ke,{}),scope:"organization",description:"System configuration (danger zone)"}].filter(r=>S?!0:r.roles.includes(x));H.useEffect(()=>{var r;d.find(z=>z.id===u)||f(((r=d[0])==null?void 0:r.id)||"event-defaults")},[x,d,u]);const v=(p=d.find(r=>r.id===u))==null?void 0:p.component;return e.jsxs("div",{className:"h-full flex flex-col","data-testid":"settings-container",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 px-6 py-4","data-testid":"settings-header",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:n("settings.title")}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[n("settings.subtitle"),e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs font-medium capitalize",children:x==null?void 0:x.replace("_"," ")})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("aside",{className:"w-64 bg-white border-r border-gray-200 overflow-y-auto","data-testid":"settings-sidebar",children:e.jsxs("nav",{className:"p-4 space-y-4",children:[d.filter(r=>r.scope==="personal").length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 mb-1","data-testid":"personal-settings-group",children:[e.jsx(i,{path:Q,size:.7,className:"text-blue-600"}),e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Personal Settings"})]}),e.jsx("div",{className:"space-y-1",children:d.filter(r=>r.scope==="personal").map(r=>e.jsxs("button",{onClick:()=>f(r.id),"data-testid":`settings-section-${r.id}`,className:`w-full flex items-start gap-3 px-4 py-3 rounded-lg text-left transition-colors ${u===r.id?"bg-blue-50 text-blue-700 font-medium":"text-gray-700 hover:bg-gray-50"}`,title:r.description,children:[e.jsx(i,{path:r.icon,size:.9,className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium",children:r.label}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:r.description})]})]},r.id))})]}),d.filter(r=>r.scope==="organization").length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 mb-1","data-testid":"organization-settings-group",children:[e.jsx(i,{path:B,size:.7,className:"text-orange-600"}),e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Organization Settings"})]}),e.jsx("div",{className:"space-y-1",children:d.filter(r=>r.scope==="organization").map(r=>e.jsxs("button",{onClick:()=>f(r.id),"data-testid":`settings-section-${r.id}`,className:`w-full flex items-start gap-3 px-4 py-3 rounded-lg text-left transition-colors ${u===r.id?"bg-orange-50 text-orange-700 font-medium":"text-gray-700 hover:bg-gray-50"}`,title:r.description,children:[e.jsx(i,{path:r.icon,size:.9,className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium",children:r.label}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:r.description})]})]},r.id))})]})]})}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-50 p-6","data-testid":"settings-content",children:v})]})]})}function ke(){const{t:s}=R();return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(i,{path:q,size:1,className:"text-red-600"}),s("settings.advanced.title")]}),e.jsx("p",{className:"text-gray-600",children:s("settings.advanced.description")}),e.jsx("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800",children:"âš ï¸ Advanced Settings (Danger Zone) coming soon..."})})]})}export{qe as default};
