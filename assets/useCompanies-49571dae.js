import{r as n,s as t}from"./index-1e4c7e6c.js";import{n as u}from"./phone-376c158e.js";function S(){const[c,a]=n.useState([]),[C,f]=n.useState(!0),[g,h]=n.useState(null),i=n.useCallback(async()=>{try{f(!0),h(null);const{data:e,error:r}=await t.from("companies").select("*").order("name",{ascending:!0});if(r)throw r;a(e||[])}catch(e){console.error("Error loading companies:",e),h(e.message)}finally{f(!1)}},[]),w=n.useCallback(async e=>{try{e!=null&&e.phone&&(e.phone=u(e.phone)),e!=null&&e.email&&(e.email=e.email.toLowerCase().trim());const{data:r,error:o}=await t.from("companies").insert([e]).select().single();if(o)throw o;return a(s=>[...s,r].sort((m,l)=>m.name.localeCompare(l.name))),{data:r,error:null}}catch(r){return console.error("Error creating company:",r),{data:null,error:r.message}}},[]),E=n.useCallback(async(e,r)=>{try{(r!=null&&r.phone||(r==null?void 0:r.phone)==="")&&(r.phone=u(r.phone)),r!=null&&r.email&&(r.email=r.email.toLowerCase().trim());const{data:o,error:s}=await t.from("companies").update(r).eq("id",e).select().single();if(s)throw s;return a(m=>m.map(l=>l.id===e?o:l).sort((l,k)=>l.name.localeCompare(k.name))),{data:o,error:null}}catch(o){return console.error("Error updating company:",o),{data:null,error:o.message}}},[]),b=n.useCallback(async e=>{try{const{error:r}=await t.from("companies").delete().eq("id",e);if(r)throw r;return a(o=>o.filter(s=>s.id!==e)),{error:null}}catch(r){return console.error("Error deleting company:",r),{error:r.message}}},[]),p=n.useCallback(e=>{if(!e)return c;const r=e.toLowerCase();return c.filter(o=>{var s;return(s=o.name)==null?void 0:s.toLowerCase().includes(r)})},[c]);return n.useEffect(()=>{i()},[i]),n.useEffect(()=>{const e=t.channel("companies-changes").on("postgres_changes",{event:"*",schema:"public",table:"companies"},()=>{i()}).subscribe();return()=>{t.removeChannel(e)}},[i]),{companies:c,loading:C,error:g,createCompany:w,updateCompany:E,deleteCompany:b,searchCompanies:p,reload:i}}export{S as u};
