import{r as a,s as i}from"./index-88c468a1.js";const l=new Map;function d(t,s){return`${t}:${s}`}function p(t,s){const e=d(t,s);if(l.has(e))return l.get(e);const n={state:{count:0,loading:!0,error:null},listeners:new Set,refCount:0,channel:null,loadPromise:null};return l.set(e,n),n}async function _(t,s,e){return e.loadPromise||(e.loadPromise=(async()=>{try{const n=i.from(t).select("count").eq("event_year",s);let o;n&&typeof n.maybeSingle=="function"?o=await n.maybeSingle():n&&typeof n.single=="function"?o=await n.single():o=await n;const{data:r,error:u}=o||{};if(u)throw u;e.state.count=(r==null?void 0:r.count)||0,e.state.error=null}catch(n){console.error(`Error loading ${t} count for ${s}:`,n),e.state.count=0,e.state.error=(n==null?void 0:n.message)||String(n)}finally{e.state.loading=!1,e.listeners.forEach(n=>n(e.state))}})()),e.loadPromise}function b(t,s,e){if(e.channel)return;const n=`${t}-count-${s}`;e.channel=i.channel(n).on("postgres_changes",{event:"*",schema:"public",table:t},o=>{(o.new&&o.new.event_year===s||o.old&&o.old.event_year===s)&&(o.new?e.state.count=o.new.count:o.eventType==="DELETE"&&(e.state.count=0),e.listeners.forEach(u=>u(e.state)))}).subscribe()}function w(t,s){const e=d(t,s),n=l.get(e);n&&(n.channel&&i.removeChannel(n.channel),l.delete(e))}function h(t){return function(e){const[n,o]=a.useState({count:0,loading:!0,error:null});return a.useEffect(()=>{if(e==null||Number.isNaN(Number(e))){o({count:0,loading:!1,error:null});return}const r=p(t,e);r.refCount+=1;const u=m=>o({...m});return r.listeners.add(u),o({...r.state}),r.state.loading&&_(t,e,r),b(t,e,r),()=>{r.listeners.delete(u),r.refCount-=1,r.refCount<=0&&w(t,e)}},[e]),n}}const S=h("subscription_counts"),y=h("assignment_counts"),$=h("marker_counts");function k(){const[t,s]=a.useState(0),[e,n]=a.useState(!0),[o,r]=a.useState(null);return a.useEffect(()=>{const u=async()=>{try{n(!0);const c=i.from("company_counts").select("count");let f;c&&typeof c.maybeSingle=="function"?f=await c.maybeSingle():c&&typeof c.single=="function"?f=await c.single():f=await c;const{data:g,error:C}=f||{};if(C)throw C;s((g==null?void 0:g.count)||0)}catch(c){console.error("Error loading company count:",c),r(c.message),s(0)}finally{n(!1)}};u();const m=i.channel("company-count").on("postgres_changes",{event:"*",schema:"public",table:"company_counts"},c=>{u()}).subscribe();return()=>{i.removeChannel(m)}},[]),{count:t,loading:e,error:o}}export{y as a,$ as b,k as c,S as u};
