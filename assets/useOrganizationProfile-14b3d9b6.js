import{r as e,s as i}from"./index-5ece8994.js";import{n as h}from"./phone-376c158e.js";function z(){const[f,n]=e.useState(null),[s,l]=e.useState(!0),[g,t]=e.useState(null),a=e.useCallback(async()=>{try{l(!0);const{data:r,error:o}=await i.from("organization_profile").select("*").single();if(o)if(o.code==="PGRST116")console.warn("No organization profile found. A default one should be created by the migration."),n(null);else throw o;n(r),t(null)}catch(r){console.error("Error fetching organization profile:",r),t(r.message)}finally{l(!1)}},[]);return e.useEffect(()=>{a();const r=i.channel("public:organization_profile").on("postgres_changes",{event:"*",schema:"public",table:"organization_profile",filter:"id=eq.1"},o=>{o.new&&n(o.new)}).subscribe();return()=>{i.removeChannel(r)}},[a]),{profile:f,loading:s,error:g,updateProfile:async r=>{try{(r!=null&&r.phone||(r==null?void 0:r.phone)==="")&&(r.phone=h(r.phone)),r!=null&&r.email&&(r.email=r.email.toLowerCase().trim());const{data:o,error:c}=await i.from("organization_profile").update(r).eq("id",1).select().single();if(c)throw c;return n(o),{data:o,error:null}}catch(o){return console.error("Error updating organization profile:",o),{data:null,error:o.message}}}}}export{z as u};
